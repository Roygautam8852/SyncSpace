{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\components\\\\video\\\\WebRTCMeeting.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, Minimize2, Maximize2, GripHorizontal } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\n/**\r\n * WebRTCMeeting — Zoom-like group call via P2P mesh.\r\n * \r\n * - Renders as a draggable, resizable floating window (not fullscreen)\r\n * - Supports multiple participants via mesh topology\r\n * - Each participant independently joins/leaves; call persists\r\n * - PIP layout: biggest video = main stage, others = small tiles\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WebRTCMeeting = ({\n  socket,\n  roomId,\n  username,\n  onLeave\n}) => {\n  _s();\n  var _username$;\n  // ── UI State ──────────────────────────────────────────────────────────────\n  const [localStream, setLocalStream] = useState(null);\n  const [peers, setPeers] = useState({}); // { socketId: { pc, stream, username } }\n  const [isMicEnabled, setIsMicEnabled] = useState(true);\n  const [isCamEnabled, setIsCamEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const [status, setStatus] = useState('Joining...');\n  const localVideoRef = useRef(null);\n  const streamRef = useRef(null);\n  const screenRef = useRef(null);\n  const peersRef = useRef({}); // Mirror of peers state as ref for closures\n  const componentMounted = useRef(true);\n  const onLeaveRef = useRef(onLeave);\n  useEffect(() => {\n    onLeaveRef.current = onLeave;\n  }, [onLeave]);\n\n  // ── Drag state ────────────────────────────────────────────────────────────\n  const containerRef = useRef(null);\n  const isDragging = useRef(false);\n  const dragOffset = useRef({\n    x: 0,\n    y: 0\n  });\n  const [position, setPosition] = useState({\n    x: 16,\n    y: 70\n  });\n  const rtcConfig = {\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }]\n  };\n\n  // ── Create a PeerConnection for a remote user ─────────────────────────────\n  const createPeer = useCallback((targetSocketId, targetUsername, stream, isInitiator) => {\n    if (peersRef.current[targetSocketId]) return; // Already connected\n\n    const pc = new RTCPeerConnection(rtcConfig);\n\n    // Add local tracks\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n\n    // Remote stream handler\n    pc.ontrack = event => {\n      const remoteStream = event.streams[0];\n      peersRef.current[targetSocketId] = {\n        ...peersRef.current[targetSocketId],\n        stream: remoteStream\n      };\n      setPeers(prev => ({\n        ...prev,\n        [targetSocketId]: {\n          ...prev[targetSocketId],\n          stream: remoteStream\n        }\n      }));\n    };\n\n    // ICE candidates\n    pc.onicecandidate = event => {\n      if (event.candidate) {\n        socket.emit('mesh:candidate', {\n          roomId,\n          to: targetSocketId,\n          candidate: event.candidate\n        });\n      }\n    };\n    pc.oniceconnectionstatechange = () => {\n      const s = pc.iceConnectionState;\n      if (s === 'disconnected' || s === 'failed' || s === 'closed') {\n        removePeer(targetSocketId);\n      }\n    };\n    const peerObj = {\n      pc,\n      stream: null,\n      username: targetUsername\n    };\n    peersRef.current[targetSocketId] = peerObj;\n    setPeers(prev => ({\n      ...prev,\n      [targetSocketId]: peerObj\n    }));\n\n    // If initiator, create and send offer\n    if (isInitiator) {\n      pc.createOffer().then(offer => pc.setLocalDescription(offer)).then(() => {\n        socket.emit('mesh:offer', {\n          roomId,\n          to: targetSocketId,\n          offer: pc.localDescription\n        });\n      }).catch(err => console.error('[Mesh] Offer error:', err));\n    }\n    return pc;\n  }, [socket, roomId]);\n  const removePeer = useCallback(socketId => {\n    if (peersRef.current[socketId]) {\n      var _peersRef$current$soc;\n      (_peersRef$current$soc = peersRef.current[socketId].pc) === null || _peersRef$current$soc === void 0 ? void 0 : _peersRef$current$soc.close();\n      delete peersRef.current[socketId];\n      setPeers(prev => {\n        const n = {\n          ...prev\n        };\n        delete n[socketId];\n        return n;\n      });\n    }\n  }, []);\n\n  // ── 1. Get media and join the call room ──────────────────────────────────\n  useEffect(() => {\n    componentMounted.current = true;\n    const start = async () => {\n      try {\n        setStatus('Accessing camera & mic...');\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        if (!componentMounted.current) {\n          stream.getTracks().forEach(t => t.stop());\n          return;\n        }\n        streamRef.current = stream;\n        setLocalStream(stream);\n        if (localVideoRef.current) localVideoRef.current.srcObject = stream;\n        setStatus('Connected');\n        // Tell the server we have joined the call\n        socket.emit('mesh:join', {\n          roomId,\n          username\n        });\n      } catch (err) {\n        console.error('[WebRTC] Media error:', err);\n        setStatus('Camera/Mic Denied');\n        toast.error('Could not access camera or microphone.');\n      }\n    };\n    start();\n    return () => {\n      componentMounted.current = false;\n      // Cleanup all peers\n      Object.keys(peersRef.current).forEach(id => {\n        var _peersRef$current$id, _peersRef$current$id$;\n        (_peersRef$current$id = peersRef.current[id]) === null || _peersRef$current$id === void 0 ? void 0 : (_peersRef$current$id$ = _peersRef$current$id.pc) === null || _peersRef$current$id$ === void 0 ? void 0 : _peersRef$current$id$.close();\n      });\n      peersRef.current = {};\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(t => t.stop());\n        streamRef.current = null;\n      }\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n    };\n  }, [socket, roomId, username]);\n\n  // ── 2. Socket signaling (mesh topology) ──────────────────────────────────\n  useEffect(() => {\n    if (!socket) return;\n\n    // When we join, server sends us the list of existing participants\n    const onExistingPeers = ({\n      peers: existingPeers\n    }) => {\n      if (!streamRef.current) return;\n      existingPeers.forEach(p => {\n        createPeer(p.socketId, p.username, streamRef.current, true); // We initiate to existing peers\n      });\n    };\n\n    // When a NEW peer joins after us, THEY will send us nothing — we need to create a peer for them\n    const onNewPeer = ({\n      socketId,\n      username: peerUsername\n    }) => {\n      if (!streamRef.current) return;\n      createPeer(socketId, peerUsername, streamRef.current, false); // Don't initiate — wait for their offer\n    };\n\n    // Receive offer from a peer\n    const onOffer = async ({\n      from,\n      offer,\n      username: peerUsername\n    }) => {\n      if (!streamRef.current) return;\n      let peerObj = peersRef.current[from];\n      let pc;\n      if (!peerObj) {\n        pc = createPeer(from, peerUsername, streamRef.current, false);\n      } else {\n        pc = peerObj.pc;\n      }\n      if (!pc) return;\n      try {\n        await pc.setRemoteDescription(new RTCSessionDescription(offer));\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        socket.emit('mesh:answer', {\n          roomId,\n          to: from,\n          answer\n        });\n      } catch (e) {\n        console.error('[Mesh] Offer handling error:', e);\n      }\n    };\n    const onAnswer = async ({\n      from,\n      answer\n    }) => {\n      const peerObj = peersRef.current[from];\n      if (!(peerObj !== null && peerObj !== void 0 && peerObj.pc)) return;\n      try {\n        await peerObj.pc.setRemoteDescription(new RTCSessionDescription(answer));\n      } catch (e) {\n        console.error('[Mesh] Answer error:', e);\n      }\n    };\n    const onCandidate = async ({\n      from,\n      candidate\n    }) => {\n      const peerObj = peersRef.current[from];\n      if (!(peerObj !== null && peerObj !== void 0 && peerObj.pc)) return;\n      try {\n        var _peerObj$pc$remoteDes;\n        if ((_peerObj$pc$remoteDes = peerObj.pc.remoteDescription) !== null && _peerObj$pc$remoteDes !== void 0 && _peerObj$pc$remoteDes.type) {\n          await peerObj.pc.addIceCandidate(new RTCIceCandidate(candidate));\n        }\n      } catch (_) {}\n    };\n    const onPeerLeft = ({\n      socketId\n    }) => {\n      removePeer(socketId);\n    };\n    socket.on('mesh:existing-peers', onExistingPeers);\n    socket.on('mesh:new-peer', onNewPeer);\n    socket.on('mesh:offer', onOffer);\n    socket.on('mesh:answer', onAnswer);\n    socket.on('mesh:candidate', onCandidate);\n    socket.on('mesh:peer-left', onPeerLeft);\n    return () => {\n      socket.off('mesh:existing-peers', onExistingPeers);\n      socket.off('mesh:new-peer', onNewPeer);\n      socket.off('mesh:offer', onOffer);\n      socket.off('mesh:answer', onAnswer);\n      socket.off('mesh:candidate', onCandidate);\n      socket.off('mesh:peer-left', onPeerLeft);\n    };\n  }, [socket, roomId, createPeer, removePeer]);\n\n  // ── Controls ──────────────────────────────────────────────────────────────\n  const toggleMic = () => {\n    var _streamRef$current;\n    const track = (_streamRef$current = streamRef.current) === null || _streamRef$current === void 0 ? void 0 : _streamRef$current.getAudioTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsMicEnabled(track.enabled);\n    }\n  };\n  const toggleCam = () => {\n    var _streamRef$current2;\n    const track = (_streamRef$current2 = streamRef.current) === null || _streamRef$current2 === void 0 ? void 0 : _streamRef$current2.getVideoTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsCamEnabled(track.enabled);\n    }\n  };\n  const toggleScreenShare = async () => {\n    if (isScreenSharing) {\n      var _streamRef$current3;\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n      const camTrack = (_streamRef$current3 = streamRef.current) === null || _streamRef$current3 === void 0 ? void 0 : _streamRef$current3.getVideoTracks()[0];\n      Object.values(peersRef.current).forEach(({\n        pc\n      }) => {\n        const sender = pc === null || pc === void 0 ? void 0 : pc.getSenders().find(s => {\n          var _s$track;\n          return ((_s$track = s.track) === null || _s$track === void 0 ? void 0 : _s$track.kind) === 'video';\n        });\n        if (sender && camTrack) sender.replaceTrack(camTrack);\n      });\n      if (localVideoRef.current && streamRef.current) localVideoRef.current.srcObject = streamRef.current;\n      setIsScreenSharing(false);\n    } else {\n      try {\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({\n          video: true\n        });\n        screenRef.current = screenStream;\n        const screenTrack = screenStream.getVideoTracks()[0];\n        Object.values(peersRef.current).forEach(({\n          pc\n        }) => {\n          const sender = pc === null || pc === void 0 ? void 0 : pc.getSenders().find(s => {\n            var _s$track2;\n            return ((_s$track2 = s.track) === null || _s$track2 === void 0 ? void 0 : _s$track2.kind) === 'video';\n          });\n          if (sender) sender.replaceTrack(screenTrack);\n        });\n        if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\n        screenTrack.onended = () => toggleScreenShare();\n        setIsScreenSharing(true);\n      } catch (_) {}\n    }\n  };\n  const handleLeave = () => {\n    socket.emit('mesh:leave', {\n      roomId\n    });\n    Object.keys(peersRef.current).forEach(id => {\n      var _peersRef$current$id2, _peersRef$current$id3;\n      (_peersRef$current$id2 = peersRef.current[id]) === null || _peersRef$current$id2 === void 0 ? void 0 : (_peersRef$current$id3 = _peersRef$current$id2.pc) === null || _peersRef$current$id3 === void 0 ? void 0 : _peersRef$current$id3.close();\n    });\n    peersRef.current = {};\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(t => t.stop());\n      streamRef.current = null;\n    }\n    if (screenRef.current) {\n      screenRef.current.getTracks().forEach(t => t.stop());\n      screenRef.current = null;\n    }\n    onLeaveRef.current();\n  };\n\n  // ── Drag handlers ─────────────────────────────────────────────────────────\n  const onDragStart = e => {\n    isDragging.current = true;\n    const rect = containerRef.current.getBoundingClientRect();\n    dragOffset.current = {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    };\n    document.addEventListener('mousemove', onDragMove);\n    document.addEventListener('mouseup', onDragEnd);\n  };\n  const onDragMove = e => {\n    if (!isDragging.current) return;\n    setPosition({\n      x: Math.max(0, Math.min(window.innerWidth - 120, e.clientX - dragOffset.current.x)),\n      y: Math.max(0, Math.min(window.innerHeight - 80, e.clientY - dragOffset.current.y))\n    });\n  };\n  const onDragEnd = () => {\n    isDragging.current = false;\n    document.removeEventListener('mousemove', onDragMove);\n    document.removeEventListener('mouseup', onDragEnd);\n  };\n  const peerEntries = Object.entries(peers);\n  const participantCount = 1 + peerEntries.length; // local + remotes\n\n  // ── Minimized view ────────────────────────────────────────────────────────\n  if (isMinimized) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"wbrtc-floating wbrtc-minimized\",\n      style: {\n        left: position.x,\n        top: position.y\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-mini-bar\",\n        onMouseDown: onDragStart,\n        children: [/*#__PURE__*/_jsxDEV(GripHorizontal, {\n          size: 14,\n          className: \"wbrtc-grip\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-mini-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"wbrtc-mini-dot\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 312,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [participantCount, \" in call\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn\",\n          onClick: () => setIsMinimized(false),\n          title: \"Expand\",\n          children: /*#__PURE__*/_jsxDEV(Maximize2, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 109\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn wbrtc-mini-leave\",\n          onClick: handleLeave,\n          title: \"Leave\",\n          children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 109\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 13\n    }, this);\n  }\n\n  // ── Full floating view ────────────────────────────────────────────────────\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    className: \"wbrtc-floating\",\n    style: {\n      left: position.x,\n      top: position.y\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-drag-bar\",\n      onMouseDown: onDragStart,\n      children: [/*#__PURE__*/_jsxDEV(GripHorizontal, {\n        size: 14,\n        className: \"wbrtc-grip\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"wbrtc-drag-title\",\n        children: [participantCount, \" in call\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-drag-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn\",\n          onClick: () => setIsMinimized(true),\n          title: \"Minimize\",\n          children: /*#__PURE__*/_jsxDEV(Minimize2, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 110\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-tile\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localVideoRef,\n          autoPlay: true,\n          muted: true,\n          playsInline: true,\n          className: \"wbrtc-tile-video\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 21\n        }, this), !isCamEnabled && !isScreenSharing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile-avatar\",\n          children: (_username$ = username[0]) === null || _username$ === void 0 ? void 0 : _username$.toUpperCase()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile-name\",\n          children: [username, \" (You)\", !isMicEnabled && /*#__PURE__*/_jsxDEV(MicOff, {\n            size: 10,\n            className: \"wbrtc-tile-muted\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 346,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 17\n      }, this), peerEntries.map(([socketId, peer]) => {\n        var _2;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile\",\n          children: [peer.stream ? /*#__PURE__*/_jsxDEV(RemoteVideo, {\n            stream: peer.stream\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wbrtc-tile-avatar\",\n            children: (_2 = (peer.username || '?')[0]) === null || _2 === void 0 ? void 0 : _2.toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 358,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wbrtc-tile-name\",\n            children: peer.username || 'Participant'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 25\n          }, this)]\n        }, socketId, true, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 21\n        }, this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMic,\n        className: `wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isMicEnabled ? 'Mute' : 'Unmute',\n        children: isMicEnabled ? /*#__PURE__*/_jsxDEV(Mic, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 368,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(MicOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 368,\n          columnNumber: 57\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleCam,\n        className: `wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isCamEnabled ? 'Stop Video' : 'Start Video',\n        children: isCamEnabled ? /*#__PURE__*/_jsxDEV(Video, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(VideoOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 59\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleScreenShare,\n        className: `wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`,\n        title: isScreenSharing ? 'Stop Sharing' : 'Share Screen',\n        children: isScreenSharing ? /*#__PURE__*/_jsxDEV(MonitorOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 40\n        }, this) : /*#__PURE__*/_jsxDEV(Monitor, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 67\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 373,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-divider\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLeave,\n        className: \"wbrtc-btn wbrtc-btn--leave\",\n        title: \"Leave call\",\n        children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 324,\n    columnNumber: 9\n  }, this);\n};\n\n// ── Helper: renders a remote video stream ─────────────────────────────────────\n_s(WebRTCMeeting, \"yxsO15fKFhu80HTMqANlZcYE520=\");\n_c = WebRTCMeeting;\nconst RemoteVideo = ({\n  stream\n}) => {\n  _s2();\n  const ref = useRef(null);\n  useEffect(() => {\n    if (ref.current && stream) {\n      ref.current.srcObject = stream;\n      ref.current.play().catch(() => {});\n    }\n  }, [stream]);\n  return /*#__PURE__*/_jsxDEV(\"video\", {\n    ref: ref,\n    autoPlay: true,\n    playsInline: true,\n    className: \"wbrtc-tile-video\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 394,\n    columnNumber: 12\n  }, this);\n};\n_s2(RemoteVideo, \"8uVE59eA/r6b92xF80p7sH8rXLk=\");\n_c2 = RemoteVideo;\nexport default WebRTCMeeting;\nvar _c, _c2;\n$RefreshReg$(_c, \"WebRTCMeeting\");\n$RefreshReg$(_c2, \"RemoteVideo\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Mic","MicOff","Video","VideoOff","PhoneOff","Monitor","MonitorOff","Minimize2","Maximize2","GripHorizontal","toast","jsxDEV","_jsxDEV","WebRTCMeeting","socket","roomId","username","onLeave","_s","_username$","localStream","setLocalStream","peers","setPeers","isMicEnabled","setIsMicEnabled","isCamEnabled","setIsCamEnabled","isScreenSharing","setIsScreenSharing","isMinimized","setIsMinimized","status","setStatus","localVideoRef","streamRef","screenRef","peersRef","componentMounted","onLeaveRef","current","containerRef","isDragging","dragOffset","x","y","position","setPosition","rtcConfig","iceServers","urls","createPeer","targetSocketId","targetUsername","stream","isInitiator","pc","RTCPeerConnection","getTracks","forEach","track","addTrack","ontrack","event","remoteStream","streams","prev","onicecandidate","candidate","emit","to","oniceconnectionstatechange","s","iceConnectionState","removePeer","peerObj","createOffer","then","offer","setLocalDescription","localDescription","catch","err","console","error","socketId","_peersRef$current$soc","close","n","start","navigator","mediaDevices","getUserMedia","video","audio","t","stop","srcObject","Object","keys","id","_peersRef$current$id","_peersRef$current$id$","onExistingPeers","existingPeers","p","onNewPeer","peerUsername","onOffer","from","setRemoteDescription","RTCSessionDescription","answer","createAnswer","e","onAnswer","onCandidate","_peerObj$pc$remoteDes","remoteDescription","type","addIceCandidate","RTCIceCandidate","_","onPeerLeft","on","off","toggleMic","_streamRef$current","getAudioTracks","enabled","toggleCam","_streamRef$current2","getVideoTracks","toggleScreenShare","_streamRef$current3","camTrack","values","sender","getSenders","find","_s$track","kind","replaceTrack","screenStream","getDisplayMedia","screenTrack","_s$track2","onended","handleLeave","_peersRef$current$id2","_peersRef$current$id3","onDragStart","rect","getBoundingClientRect","clientX","left","clientY","top","document","addEventListener","onDragMove","onDragEnd","Math","max","min","window","innerWidth","innerHeight","removeEventListener","peerEntries","entries","participantCount","length","ref","className","style","children","onMouseDown","size","fileName","_jsxFileName","lineNumber","columnNumber","onClick","title","autoPlay","muted","playsInline","toUpperCase","map","peer","_2","RemoteVideo","_c","_s2","play","_c2","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/components/video/WebRTCMeeting.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, Minimize2, Maximize2, GripHorizontal } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * WebRTCMeeting — Zoom-like group call via P2P mesh.\r\n * \r\n * - Renders as a draggable, resizable floating window (not fullscreen)\r\n * - Supports multiple participants via mesh topology\r\n * - Each participant independently joins/leaves; call persists\r\n * - PIP layout: biggest video = main stage, others = small tiles\r\n */\r\nconst WebRTCMeeting = ({ socket, roomId, username, onLeave }) => {\r\n    // ── UI State ──────────────────────────────────────────────────────────────\r\n    const [localStream, setLocalStream] = useState(null);\r\n    const [peers, setPeers] = useState({}); // { socketId: { pc, stream, username } }\r\n    const [isMicEnabled, setIsMicEnabled] = useState(true);\r\n    const [isCamEnabled, setIsCamEnabled] = useState(true);\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const [isMinimized, setIsMinimized] = useState(false);\r\n    const [status, setStatus] = useState('Joining...');\r\n\r\n    const localVideoRef = useRef(null);\r\n    const streamRef = useRef(null);\r\n    const screenRef = useRef(null);\r\n    const peersRef = useRef({}); // Mirror of peers state as ref for closures\r\n    const componentMounted = useRef(true);\r\n    const onLeaveRef = useRef(onLeave);\r\n    useEffect(() => { onLeaveRef.current = onLeave; }, [onLeave]);\r\n\r\n    // ── Drag state ────────────────────────────────────────────────────────────\r\n    const containerRef = useRef(null);\r\n    const isDragging = useRef(false);\r\n    const dragOffset = useRef({ x: 0, y: 0 });\r\n    const [position, setPosition] = useState({ x: 16, y: 70 });\r\n\r\n    const rtcConfig = {\r\n        iceServers: [\r\n            { urls: 'stun:stun.l.google.com:19302' },\r\n            { urls: 'stun:stun1.l.google.com:19302' },\r\n        ],\r\n    };\r\n\r\n    // ── Create a PeerConnection for a remote user ─────────────────────────────\r\n    const createPeer = useCallback((targetSocketId, targetUsername, stream, isInitiator) => {\r\n        if (peersRef.current[targetSocketId]) return; // Already connected\r\n\r\n        const pc = new RTCPeerConnection(rtcConfig);\r\n\r\n        // Add local tracks\r\n        stream.getTracks().forEach(track => pc.addTrack(track, stream));\r\n\r\n        // Remote stream handler\r\n        pc.ontrack = (event) => {\r\n            const remoteStream = event.streams[0];\r\n            peersRef.current[targetSocketId] = {\r\n                ...peersRef.current[targetSocketId],\r\n                stream: remoteStream,\r\n            };\r\n            setPeers(prev => ({\r\n                ...prev,\r\n                [targetSocketId]: { ...prev[targetSocketId], stream: remoteStream },\r\n            }));\r\n        };\r\n\r\n        // ICE candidates\r\n        pc.onicecandidate = (event) => {\r\n            if (event.candidate) {\r\n                socket.emit('mesh:candidate', { roomId, to: targetSocketId, candidate: event.candidate });\r\n            }\r\n        };\r\n\r\n        pc.oniceconnectionstatechange = () => {\r\n            const s = pc.iceConnectionState;\r\n            if (s === 'disconnected' || s === 'failed' || s === 'closed') {\r\n                removePeer(targetSocketId);\r\n            }\r\n        };\r\n\r\n        const peerObj = { pc, stream: null, username: targetUsername };\r\n        peersRef.current[targetSocketId] = peerObj;\r\n        setPeers(prev => ({ ...prev, [targetSocketId]: peerObj }));\r\n\r\n        // If initiator, create and send offer\r\n        if (isInitiator) {\r\n            pc.createOffer()\r\n                .then(offer => pc.setLocalDescription(offer))\r\n                .then(() => {\r\n                    socket.emit('mesh:offer', { roomId, to: targetSocketId, offer: pc.localDescription });\r\n                })\r\n                .catch(err => console.error('[Mesh] Offer error:', err));\r\n        }\r\n\r\n        return pc;\r\n    }, [socket, roomId]);\r\n\r\n    const removePeer = useCallback((socketId) => {\r\n        if (peersRef.current[socketId]) {\r\n            peersRef.current[socketId].pc?.close();\r\n            delete peersRef.current[socketId];\r\n            setPeers(prev => {\r\n                const n = { ...prev };\r\n                delete n[socketId];\r\n                return n;\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    // ── 1. Get media and join the call room ──────────────────────────────────\r\n    useEffect(() => {\r\n        componentMounted.current = true;\r\n\r\n        const start = async () => {\r\n            try {\r\n                setStatus('Accessing camera & mic...');\r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n                if (!componentMounted.current) { stream.getTracks().forEach(t => t.stop()); return; }\r\n\r\n                streamRef.current = stream;\r\n                setLocalStream(stream);\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = stream;\r\n\r\n                setStatus('Connected');\r\n                // Tell the server we have joined the call\r\n                socket.emit('mesh:join', { roomId, username });\r\n            } catch (err) {\r\n                console.error('[WebRTC] Media error:', err);\r\n                setStatus('Camera/Mic Denied');\r\n                toast.error('Could not access camera or microphone.');\r\n            }\r\n        };\r\n\r\n        start();\r\n\r\n        return () => {\r\n            componentMounted.current = false;\r\n            // Cleanup all peers\r\n            Object.keys(peersRef.current).forEach(id => {\r\n                peersRef.current[id]?.pc?.close();\r\n            });\r\n            peersRef.current = {};\r\n            if (streamRef.current) {\r\n                streamRef.current.getTracks().forEach(t => t.stop());\r\n                streamRef.current = null;\r\n            }\r\n            if (screenRef.current) {\r\n                screenRef.current.getTracks().forEach(t => t.stop());\r\n                screenRef.current = null;\r\n            }\r\n        };\r\n    }, [socket, roomId, username]);\r\n\r\n    // ── 2. Socket signaling (mesh topology) ──────────────────────────────────\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n\r\n        // When we join, server sends us the list of existing participants\r\n        const onExistingPeers = ({ peers: existingPeers }) => {\r\n            if (!streamRef.current) return;\r\n            existingPeers.forEach(p => {\r\n                createPeer(p.socketId, p.username, streamRef.current, true); // We initiate to existing peers\r\n            });\r\n        };\r\n\r\n        // When a NEW peer joins after us, THEY will send us nothing — we need to create a peer for them\r\n        const onNewPeer = ({ socketId, username: peerUsername }) => {\r\n            if (!streamRef.current) return;\r\n            createPeer(socketId, peerUsername, streamRef.current, false); // Don't initiate — wait for their offer\r\n        };\r\n\r\n        // Receive offer from a peer\r\n        const onOffer = async ({ from, offer, username: peerUsername }) => {\r\n            if (!streamRef.current) return;\r\n            let peerObj = peersRef.current[from];\r\n            let pc;\r\n            if (!peerObj) {\r\n                pc = createPeer(from, peerUsername, streamRef.current, false);\r\n            } else {\r\n                pc = peerObj.pc;\r\n            }\r\n            if (!pc) return;\r\n            try {\r\n                await pc.setRemoteDescription(new RTCSessionDescription(offer));\r\n                const answer = await pc.createAnswer();\r\n                await pc.setLocalDescription(answer);\r\n                socket.emit('mesh:answer', { roomId, to: from, answer });\r\n            } catch (e) { console.error('[Mesh] Offer handling error:', e); }\r\n        };\r\n\r\n        const onAnswer = async ({ from, answer }) => {\r\n            const peerObj = peersRef.current[from];\r\n            if (!peerObj?.pc) return;\r\n            try {\r\n                await peerObj.pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n            } catch (e) { console.error('[Mesh] Answer error:', e); }\r\n        };\r\n\r\n        const onCandidate = async ({ from, candidate }) => {\r\n            const peerObj = peersRef.current[from];\r\n            if (!peerObj?.pc) return;\r\n            try {\r\n                if (peerObj.pc.remoteDescription?.type) {\r\n                    await peerObj.pc.addIceCandidate(new RTCIceCandidate(candidate));\r\n                }\r\n            } catch (_) { }\r\n        };\r\n\r\n        const onPeerLeft = ({ socketId }) => {\r\n            removePeer(socketId);\r\n        };\r\n\r\n        socket.on('mesh:existing-peers', onExistingPeers);\r\n        socket.on('mesh:new-peer', onNewPeer);\r\n        socket.on('mesh:offer', onOffer);\r\n        socket.on('mesh:answer', onAnswer);\r\n        socket.on('mesh:candidate', onCandidate);\r\n        socket.on('mesh:peer-left', onPeerLeft);\r\n\r\n        return () => {\r\n            socket.off('mesh:existing-peers', onExistingPeers);\r\n            socket.off('mesh:new-peer', onNewPeer);\r\n            socket.off('mesh:offer', onOffer);\r\n            socket.off('mesh:answer', onAnswer);\r\n            socket.off('mesh:candidate', onCandidate);\r\n            socket.off('mesh:peer-left', onPeerLeft);\r\n        };\r\n    }, [socket, roomId, createPeer, removePeer]);\r\n\r\n    // ── Controls ──────────────────────────────────────────────────────────────\r\n    const toggleMic = () => {\r\n        const track = streamRef.current?.getAudioTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsMicEnabled(track.enabled); }\r\n    };\r\n\r\n    const toggleCam = () => {\r\n        const track = streamRef.current?.getVideoTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsCamEnabled(track.enabled); }\r\n    };\r\n\r\n    const toggleScreenShare = async () => {\r\n        if (isScreenSharing) {\r\n            if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n            const camTrack = streamRef.current?.getVideoTracks()[0];\r\n            Object.values(peersRef.current).forEach(({ pc }) => {\r\n                const sender = pc?.getSenders().find(s => s.track?.kind === 'video');\r\n                if (sender && camTrack) sender.replaceTrack(camTrack);\r\n            });\r\n            if (localVideoRef.current && streamRef.current) localVideoRef.current.srcObject = streamRef.current;\r\n            setIsScreenSharing(false);\r\n        } else {\r\n            try {\r\n                const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });\r\n                screenRef.current = screenStream;\r\n                const screenTrack = screenStream.getVideoTracks()[0];\r\n                Object.values(peersRef.current).forEach(({ pc }) => {\r\n                    const sender = pc?.getSenders().find(s => s.track?.kind === 'video');\r\n                    if (sender) sender.replaceTrack(screenTrack);\r\n                });\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\r\n                screenTrack.onended = () => toggleScreenShare();\r\n                setIsScreenSharing(true);\r\n            } catch (_) { }\r\n        }\r\n    };\r\n\r\n    const handleLeave = () => {\r\n        socket.emit('mesh:leave', { roomId });\r\n        Object.keys(peersRef.current).forEach(id => {\r\n            peersRef.current[id]?.pc?.close();\r\n        });\r\n        peersRef.current = {};\r\n        if (streamRef.current) { streamRef.current.getTracks().forEach(t => t.stop()); streamRef.current = null; }\r\n        if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n        onLeaveRef.current();\r\n    };\r\n\r\n    // ── Drag handlers ─────────────────────────────────────────────────────────\r\n    const onDragStart = (e) => {\r\n        isDragging.current = true;\r\n        const rect = containerRef.current.getBoundingClientRect();\r\n        dragOffset.current = { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n        document.addEventListener('mousemove', onDragMove);\r\n        document.addEventListener('mouseup', onDragEnd);\r\n    };\r\n    const onDragMove = (e) => {\r\n        if (!isDragging.current) return;\r\n        setPosition({\r\n            x: Math.max(0, Math.min(window.innerWidth - 120, e.clientX - dragOffset.current.x)),\r\n            y: Math.max(0, Math.min(window.innerHeight - 80, e.clientY - dragOffset.current.y)),\r\n        });\r\n    };\r\n    const onDragEnd = () => {\r\n        isDragging.current = false;\r\n        document.removeEventListener('mousemove', onDragMove);\r\n        document.removeEventListener('mouseup', onDragEnd);\r\n    };\r\n\r\n    const peerEntries = Object.entries(peers);\r\n    const participantCount = 1 + peerEntries.length; // local + remotes\r\n\r\n    // ── Minimized view ────────────────────────────────────────────────────────\r\n    if (isMinimized) {\r\n        return (\r\n            <div\r\n                ref={containerRef}\r\n                className=\"wbrtc-floating wbrtc-minimized\"\r\n                style={{ left: position.x, top: position.y }}\r\n            >\r\n                <div className=\"wbrtc-mini-bar\" onMouseDown={onDragStart}>\r\n                    <GripHorizontal size={14} className=\"wbrtc-grip\" />\r\n                    <div className=\"wbrtc-mini-info\">\r\n                        <span className=\"wbrtc-mini-dot\" />\r\n                        <span>{participantCount} in call</span>\r\n                    </div>\r\n                    <button className=\"wbrtc-mini-btn\" onClick={() => setIsMinimized(false)} title=\"Expand\"><Maximize2 size={13} /></button>\r\n                    <button className=\"wbrtc-mini-btn wbrtc-mini-leave\" onClick={handleLeave} title=\"Leave\"><PhoneOff size={13} /></button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ── Full floating view ────────────────────────────────────────────────────\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className=\"wbrtc-floating\"\r\n            style={{ left: position.x, top: position.y }}\r\n        >\r\n            {/* Drag handle */}\r\n            <div className=\"wbrtc-drag-bar\" onMouseDown={onDragStart}>\r\n                <GripHorizontal size={14} className=\"wbrtc-grip\" />\r\n                <span className=\"wbrtc-drag-title\">{participantCount} in call</span>\r\n                <div className=\"wbrtc-drag-actions\">\r\n                    <button className=\"wbrtc-mini-btn\" onClick={() => setIsMinimized(true)} title=\"Minimize\"><Minimize2 size={13} /></button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Video grid */}\r\n            <div className=\"wbrtc-grid\">\r\n                {/* Local */}\r\n                <div className=\"wbrtc-tile\">\r\n                    <video ref={localVideoRef} autoPlay muted playsInline className=\"wbrtc-tile-video\" />\r\n                    {!isCamEnabled && !isScreenSharing && (\r\n                        <div className=\"wbrtc-tile-avatar\">{username[0]?.toUpperCase()}</div>\r\n                    )}\r\n                    <div className=\"wbrtc-tile-name\">\r\n                        {username} (You)\r\n                        {!isMicEnabled && <MicOff size={10} className=\"wbrtc-tile-muted\" />}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Remote peers */}\r\n                {peerEntries.map(([socketId, peer]) => (\r\n                    <div className=\"wbrtc-tile\" key={socketId}>\r\n                        {peer.stream ? (\r\n                            <RemoteVideo stream={peer.stream} />\r\n                        ) : (\r\n                            <div className=\"wbrtc-tile-avatar\">{(peer.username || '?')[0]?.toUpperCase()}</div>\r\n                        )}\r\n                        <div className=\"wbrtc-tile-name\">{peer.username || 'Participant'}</div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div className=\"wbrtc-controls\">\r\n                <button onClick={toggleMic} className={`wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`} title={isMicEnabled ? 'Mute' : 'Unmute'}>\r\n                    {isMicEnabled ? <Mic size={15} /> : <MicOff size={15} />}\r\n                </button>\r\n                <button onClick={toggleCam} className={`wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`} title={isCamEnabled ? 'Stop Video' : 'Start Video'}>\r\n                    {isCamEnabled ? <Video size={15} /> : <VideoOff size={15} />}\r\n                </button>\r\n                <button onClick={toggleScreenShare} className={`wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`} title={isScreenSharing ? 'Stop Sharing' : 'Share Screen'}>\r\n                    {isScreenSharing ? <MonitorOff size={15} /> : <Monitor size={15} />}\r\n                </button>\r\n                <div className=\"wbrtc-divider\" />\r\n                <button onClick={handleLeave} className=\"wbrtc-btn wbrtc-btn--leave\" title=\"Leave call\">\r\n                    <PhoneOff size={15} />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// ── Helper: renders a remote video stream ─────────────────────────────────────\r\nconst RemoteVideo = ({ stream }) => {\r\n    const ref = useRef(null);\r\n    useEffect(() => {\r\n        if (ref.current && stream) {\r\n            ref.current.srcObject = stream;\r\n            ref.current.play().catch(() => { });\r\n        }\r\n    }, [stream]);\r\n    return <video ref={ref} autoPlay playsInline className=\"wbrtc-tile-video\" />;\r\n};\r\n\r\nexport default WebRTCMeeting;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}