{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\components\\\\video\\\\WebRTCMeeting.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, RefreshCcw } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\n/**\r\n * WebRTCMeeting — Modern SaaS layout\r\n * - Remote video fills the entire panel (main stage)\r\n * - Local video is a draggable PIP in the bottom-right corner\r\n * - Screen share button included\r\n * - Glassmorphism control bar with smooth hover reveals\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WebRTCMeeting = ({\n  socket,\n  roomId,\n  signalingId,\n  isCaller,\n  username,\n  onLeave\n}) => {\n  _s();\n  var _username$;\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const [isMicEnabled, setIsMicEnabled] = useState(true);\n  const [isCamEnabled, setIsCamEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [status, setStatus] = useState('Initializing...');\n  const [isConnected, setIsConnected] = useState(false);\n  const pcRef = useRef(null);\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const streamRef = useRef(null);\n  const screenRef = useRef(null);\n  const candidateQueue = useRef([]);\n  const makingOffer = useRef(false);\n  const componentMounted = useRef(true);\n\n  // Stable refs for props\n  const signalingIdRef = useRef(signalingId);\n  const isCallerRef = useRef(isCaller);\n  const onLeaveRef = useRef(onLeave);\n  useEffect(() => {\n    signalingIdRef.current = signalingId;\n  }, [signalingId]);\n  useEffect(() => {\n    isCallerRef.current = isCaller;\n  }, [isCaller]);\n  useEffect(() => {\n    onLeaveRef.current = onLeave;\n  }, [onLeave]);\n  const rtcConfig = {\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }]\n  };\n\n  // ── Lifecycle helpers ─────────────────────────────────────────────────────\n  const fullDestruction = useCallback(() => {\n    if (pcRef.current) {\n      pcRef.current.close();\n      pcRef.current = null;\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(t => t.stop());\n      streamRef.current = null;\n    }\n    if (screenRef.current) {\n      screenRef.current.getTracks().forEach(t => t.stop());\n      screenRef.current = null;\n    }\n    setLocalStream(null);\n    setRemoteStream(null);\n    setIsConnected(false);\n    setStatus('Call Ended');\n  }, []);\n\n  // ── Negotiation ───────────────────────────────────────────────────────────\n  const handleNegotiation = useCallback(async () => {\n    if (!pcRef.current || makingOffer.current) return;\n    try {\n      makingOffer.current = true;\n      setStatus('Connecting...');\n      const offer = await pcRef.current.createOffer();\n      await pcRef.current.setLocalDescription(offer);\n      socket.emit('call:offer', {\n        roomId,\n        to: signalingIdRef.current,\n        offer\n      });\n    } catch (err) {\n      console.error('[WebRTC] Negotiation Failed:', err);\n    } finally {\n      makingOffer.current = false;\n    }\n  }, [socket, roomId]);\n\n  // ── Signal listeners (registered first so callee never misses offer) ──────\n  useEffect(() => {\n    if (!socket) return;\n    const processQueue = async () => {\n      while (candidateQueue.current.length > 0 && (_pcRef$current = pcRef.current) !== null && _pcRef$current !== void 0 && _pcRef$current.remoteDescription) {\n        var _pcRef$current;\n        const cand = candidateQueue.current.shift();\n        try {\n          await pcRef.current.addIceCandidate(new RTCIceCandidate(cand));\n        } catch (_) {}\n      }\n    };\n    const onOffer = async ({\n      from,\n      offer\n    }) => {\n      const pc = pcRef.current;\n      if (!pc || pc.signalingState !== 'stable') return;\n      try {\n        await pc.setRemoteDescription(new RTCSessionDescription(offer));\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        socket.emit('call:answer', {\n          roomId,\n          to: from,\n          answer\n        });\n        await processQueue();\n      } catch (e) {\n        console.error('[WebRTC] Offer failed:', e);\n      }\n    };\n    const onAnswer = async ({\n      answer\n    }) => {\n      const pc = pcRef.current;\n      if (!pc || pc.signalingState !== 'have-local-offer') return;\n      try {\n        await pc.setRemoteDescription(new RTCSessionDescription(answer));\n        await processQueue();\n      } catch (e) {\n        console.error('[WebRTC] Answer failed:', e);\n      }\n    };\n    const onCandidate = async ({\n      candidate\n    }) => {\n      var _pc$remoteDescription;\n      const pc = pcRef.current;\n      if (!pc) return;\n      if ((_pc$remoteDescription = pc.remoteDescription) !== null && _pc$remoteDescription !== void 0 && _pc$remoteDescription.type) {\n        try {\n          await pc.addIceCandidate(new RTCIceCandidate(candidate));\n        } catch (_) {}\n      } else {\n        candidateQueue.current.push(candidate);\n      }\n    };\n    const onEnd = () => {\n      fullDestruction();\n      onLeaveRef.current();\n    };\n    socket.on('call:offer', onOffer);\n    socket.on('call:answer', onAnswer);\n    socket.on('call:candidate', onCandidate);\n    socket.on('call:ended', onEnd);\n    return () => {\n      socket.off('call:offer', onOffer);\n      socket.off('call:answer', onAnswer);\n      socket.off('call:candidate', onCandidate);\n      socket.off('call:ended', onEnd);\n    };\n  }, [socket, roomId, fullDestruction]);\n\n  // ── Media + PeerConnection ────────────────────────────────────────────────\n  useEffect(() => {\n    componentMounted.current = true;\n    const start = async () => {\n      try {\n        setStatus('Requesting camera & mic...');\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        if (!componentMounted.current) {\n          stream.getTracks().forEach(t => t.stop());\n          return;\n        }\n        streamRef.current = stream;\n        setLocalStream(stream);\n        if (localVideoRef.current) localVideoRef.current.srcObject = stream;\n        const pc = new RTCPeerConnection(rtcConfig);\n        pcRef.current = pc;\n        stream.getTracks().forEach(track => pc.addTrack(track, stream));\n        pc.ontrack = event => {\n          const rStream = event.streams[0];\n          setRemoteStream(rStream);\n          if (remoteVideoRef.current) {\n            remoteVideoRef.current.srcObject = rStream;\n            remoteVideoRef.current.play().catch(() => {});\n          }\n        };\n        pc.oniceconnectionstatechange = () => {\n          if (!componentMounted.current) return;\n          const s = pc.iceConnectionState;\n          if (s === 'connected' || s === 'completed') {\n            setStatus('Connected');\n            setIsConnected(true);\n          } else if (s === 'checking') {\n            setStatus('Connecting...');\n          } else if (s === 'disconnected' || s === 'failed') {\n            setStatus('Connection Lost');\n            setIsConnected(false);\n          } else if (s === 'closed') {\n            setStatus('Ended');\n            setIsConnected(false);\n          }\n        };\n        pc.onicecandidate = event => {\n          if (event.candidate && signalingIdRef.current) socket.emit('call:candidate', {\n            roomId,\n            to: signalingIdRef.current,\n            candidate: event.candidate\n          });\n        };\n        if (isCallerRef.current) {\n          setTimeout(() => {\n            if (componentMounted.current) handleNegotiation();\n          }, 300);\n        } else {\n          setStatus('Waiting for peer...');\n        }\n      } catch (err) {\n        console.error('[WebRTC] Media error:', err);\n        setStatus('Camera/Mic Denied');\n        toast.error('Could not access camera or microphone.');\n      }\n    };\n    start();\n    return () => {\n      componentMounted.current = false;\n      fullDestruction();\n    };\n  }, [socket, fullDestruction, handleNegotiation, roomId]);\n\n  // ── Controls ──────────────────────────────────────────────────────────────\n  const toggleMic = () => {\n    var _streamRef$current;\n    const track = (_streamRef$current = streamRef.current) === null || _streamRef$current === void 0 ? void 0 : _streamRef$current.getAudioTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsMicEnabled(track.enabled);\n    }\n  };\n  const toggleCam = () => {\n    var _streamRef$current2;\n    const track = (_streamRef$current2 = streamRef.current) === null || _streamRef$current2 === void 0 ? void 0 : _streamRef$current2.getVideoTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsCamEnabled(track.enabled);\n    }\n  };\n  const toggleScreenShare = async () => {\n    if (isScreenSharing) {\n      var _streamRef$current3;\n      // Stop screen share, revert to camera\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n      // Replace the video sender track back to camera\n      const camTrack = (_streamRef$current3 = streamRef.current) === null || _streamRef$current3 === void 0 ? void 0 : _streamRef$current3.getVideoTracks()[0];\n      if (camTrack && pcRef.current) {\n        const sender = pcRef.current.getSenders().find(s => {\n          var _s$track;\n          return ((_s$track = s.track) === null || _s$track === void 0 ? void 0 : _s$track.kind) === 'video';\n        });\n        if (sender) await sender.replaceTrack(camTrack);\n      }\n      if (localVideoRef.current && streamRef.current) localVideoRef.current.srcObject = streamRef.current;\n      setIsScreenSharing(false);\n      toast.success('Screen share stopped');\n    } else {\n      try {\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({\n          video: true,\n          audio: false\n        });\n        screenRef.current = screenStream;\n        const screenTrack = screenStream.getVideoTracks()[0];\n\n        // Replace cam track in the PeerConnection\n        if (pcRef.current) {\n          const sender = pcRef.current.getSenders().find(s => {\n            var _s$track2;\n            return ((_s$track2 = s.track) === null || _s$track2 === void 0 ? void 0 : _s$track2.kind) === 'video';\n          });\n          if (sender) await sender.replaceTrack(screenTrack);\n        }\n        if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\n\n        // Auto-revert when user stops via browser UI\n        screenTrack.onended = () => toggleScreenShare();\n        setIsScreenSharing(true);\n        toast.success('Screen share started');\n      } catch (err) {\n        console.warn('[WebRTC] Screen share cancelled or denied:', err);\n      }\n    }\n  };\n  const handleLeave = () => {\n    socket.emit('call:end', {\n      roomId,\n      to: signalingIdRef.current\n    });\n    fullDestruction();\n    onLeaveRef.current();\n  };\n  const handleReconnect = () => {\n    if (isCallerRef.current) handleNegotiation();else setStatus('Waiting for host to reconnect...');\n  };\n\n  // ── Render ────────────────────────────────────────────────────────────────\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wbrtc-root\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: `wbrtc-status-pill ${isConnected ? 'connected' : ''}`,\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"wbrtc-status-dot\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: status\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-main-stage\",\n      children: [/*#__PURE__*/_jsxDEV(\"video\", {\n        ref: remoteVideoRef,\n        autoPlay: true,\n        playsInline: true,\n        className: \"wbrtc-remote-video\",\n        style: {\n          opacity: remoteStream ? 1 : 0\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 17\n      }, this), !remoteStream && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-waiting\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-waiting-ring\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wbrtc-waiting-spinner\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"wbrtc-waiting-label\",\n          children: \"Waiting for peer\\u2026\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-pip\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localVideoRef,\n          autoPlay: true,\n          muted: true,\n          playsInline: true,\n          className: \"wbrtc-pip-video\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 21\n        }, this), !isCamEnabled && !isScreenSharing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-pip-avatar\",\n          children: (_username$ = username[0]) === null || _username$ === void 0 ? void 0 : _username$.toUpperCase()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-pip-label\",\n          children: [username, \" (You)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMic,\n        className: `wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isMicEnabled ? 'Mute' : 'Unmute',\n        children: isMicEnabled ? /*#__PURE__*/_jsxDEV(Mic, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(MicOff, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 57\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleCam,\n        className: `wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isCamEnabled ? 'Stop Camera' : 'Start Camera',\n        children: isCamEnabled ? /*#__PURE__*/_jsxDEV(Video, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(VideoOff, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 59\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleScreenShare,\n        className: `wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`,\n        title: isScreenSharing ? 'Stop sharing' : 'Share screen',\n        children: isScreenSharing ? /*#__PURE__*/_jsxDEV(MonitorOff, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 40\n        }, this) : /*#__PURE__*/_jsxDEV(Monitor, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 67\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleReconnect,\n        className: \"wbrtc-btn\",\n        title: \"Reconnect\",\n        children: /*#__PURE__*/_jsxDEV(RefreshCcw, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-divider\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 328,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLeave,\n        className: \"wbrtc-btn wbrtc-btn--leave\",\n        title: \"End call\",\n        children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n          size: 18\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 256,\n    columnNumber: 9\n  }, this);\n};\n_s(WebRTCMeeting, \"2smIWk82fqhjMTBiURnwXD+lpSQ=\");\n_c = WebRTCMeeting;\nexport default WebRTCMeeting;\nvar _c;\n$RefreshReg$(_c, \"WebRTCMeeting\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Mic","MicOff","Video","VideoOff","PhoneOff","Monitor","MonitorOff","RefreshCcw","toast","jsxDEV","_jsxDEV","WebRTCMeeting","socket","roomId","signalingId","isCaller","username","onLeave","_s","_username$","localStream","setLocalStream","remoteStream","setRemoteStream","isMicEnabled","setIsMicEnabled","isCamEnabled","setIsCamEnabled","isScreenSharing","setIsScreenSharing","status","setStatus","isConnected","setIsConnected","pcRef","localVideoRef","remoteVideoRef","streamRef","screenRef","candidateQueue","makingOffer","componentMounted","signalingIdRef","isCallerRef","onLeaveRef","current","rtcConfig","iceServers","urls","fullDestruction","close","getTracks","forEach","t","stop","handleNegotiation","offer","createOffer","setLocalDescription","emit","to","err","console","error","processQueue","length","_pcRef$current","remoteDescription","cand","shift","addIceCandidate","RTCIceCandidate","_","onOffer","from","pc","signalingState","setRemoteDescription","RTCSessionDescription","answer","createAnswer","e","onAnswer","onCandidate","candidate","_pc$remoteDescription","type","push","onEnd","on","off","start","stream","navigator","mediaDevices","getUserMedia","video","audio","srcObject","RTCPeerConnection","track","addTrack","ontrack","event","rStream","streams","play","catch","oniceconnectionstatechange","s","iceConnectionState","onicecandidate","setTimeout","toggleMic","_streamRef$current","getAudioTracks","enabled","toggleCam","_streamRef$current2","getVideoTracks","toggleScreenShare","_streamRef$current3","camTrack","sender","getSenders","find","_s$track","kind","replaceTrack","success","screenStream","getDisplayMedia","screenTrack","_s$track2","onended","warn","handleLeave","handleReconnect","className","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline","style","opacity","muted","toUpperCase","onClick","title","size","_c","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/components/video/WebRTCMeeting.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, RefreshCcw } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * WebRTCMeeting — Modern SaaS layout\r\n * - Remote video fills the entire panel (main stage)\r\n * - Local video is a draggable PIP in the bottom-right corner\r\n * - Screen share button included\r\n * - Glassmorphism control bar with smooth hover reveals\r\n */\r\nconst WebRTCMeeting = ({ socket, roomId, signalingId, isCaller, username, onLeave }) => {\r\n    const [localStream, setLocalStream] = useState(null);\r\n    const [remoteStream, setRemoteStream] = useState(null);\r\n    const [isMicEnabled, setIsMicEnabled] = useState(true);\r\n    const [isCamEnabled, setIsCamEnabled] = useState(true);\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const [status, setStatus] = useState('Initializing...');\r\n    const [isConnected, setIsConnected] = useState(false);\r\n\r\n    const pcRef = useRef(null);\r\n    const localVideoRef = useRef(null);\r\n    const remoteVideoRef = useRef(null);\r\n    const streamRef = useRef(null);\r\n    const screenRef = useRef(null);\r\n    const candidateQueue = useRef([]);\r\n    const makingOffer = useRef(false);\r\n    const componentMounted = useRef(true);\r\n\r\n    // Stable refs for props\r\n    const signalingIdRef = useRef(signalingId);\r\n    const isCallerRef = useRef(isCaller);\r\n    const onLeaveRef = useRef(onLeave);\r\n    useEffect(() => { signalingIdRef.current = signalingId; }, [signalingId]);\r\n    useEffect(() => { isCallerRef.current = isCaller; }, [isCaller]);\r\n    useEffect(() => { onLeaveRef.current = onLeave; }, [onLeave]);\r\n\r\n    const rtcConfig = {\r\n        iceServers: [\r\n            { urls: 'stun:stun.l.google.com:19302' },\r\n            { urls: 'stun:stun1.l.google.com:19302' },\r\n        ],\r\n    };\r\n\r\n    // ── Lifecycle helpers ─────────────────────────────────────────────────────\r\n    const fullDestruction = useCallback(() => {\r\n        if (pcRef.current) { pcRef.current.close(); pcRef.current = null; }\r\n        if (streamRef.current) { streamRef.current.getTracks().forEach(t => t.stop()); streamRef.current = null; }\r\n        if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n        setLocalStream(null);\r\n        setRemoteStream(null);\r\n        setIsConnected(false);\r\n        setStatus('Call Ended');\r\n    }, []);\r\n\r\n    // ── Negotiation ───────────────────────────────────────────────────────────\r\n    const handleNegotiation = useCallback(async () => {\r\n        if (!pcRef.current || makingOffer.current) return;\r\n        try {\r\n            makingOffer.current = true;\r\n            setStatus('Connecting...');\r\n            const offer = await pcRef.current.createOffer();\r\n            await pcRef.current.setLocalDescription(offer);\r\n            socket.emit('call:offer', { roomId, to: signalingIdRef.current, offer });\r\n        } catch (err) {\r\n            console.error('[WebRTC] Negotiation Failed:', err);\r\n        } finally {\r\n            makingOffer.current = false;\r\n        }\r\n    }, [socket, roomId]);\r\n\r\n    // ── Signal listeners (registered first so callee never misses offer) ──────\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n\r\n        const processQueue = async () => {\r\n            while (candidateQueue.current.length > 0 && pcRef.current?.remoteDescription) {\r\n                const cand = candidateQueue.current.shift();\r\n                try { await pcRef.current.addIceCandidate(new RTCIceCandidate(cand)); } catch (_) { }\r\n            }\r\n        };\r\n\r\n        const onOffer = async ({ from, offer }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc || pc.signalingState !== 'stable') return;\r\n            try {\r\n                await pc.setRemoteDescription(new RTCSessionDescription(offer));\r\n                const answer = await pc.createAnswer();\r\n                await pc.setLocalDescription(answer);\r\n                socket.emit('call:answer', { roomId, to: from, answer });\r\n                await processQueue();\r\n            } catch (e) { console.error('[WebRTC] Offer failed:', e); }\r\n        };\r\n\r\n        const onAnswer = async ({ answer }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc || pc.signalingState !== 'have-local-offer') return;\r\n            try {\r\n                await pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n                await processQueue();\r\n            } catch (e) { console.error('[WebRTC] Answer failed:', e); }\r\n        };\r\n\r\n        const onCandidate = async ({ candidate }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc) return;\r\n            if (pc.remoteDescription?.type) {\r\n                try { await pc.addIceCandidate(new RTCIceCandidate(candidate)); } catch (_) { }\r\n            } else {\r\n                candidateQueue.current.push(candidate);\r\n            }\r\n        };\r\n\r\n        const onEnd = () => { fullDestruction(); onLeaveRef.current(); };\r\n\r\n        socket.on('call:offer', onOffer);\r\n        socket.on('call:answer', onAnswer);\r\n        socket.on('call:candidate', onCandidate);\r\n        socket.on('call:ended', onEnd);\r\n\r\n        return () => {\r\n            socket.off('call:offer', onOffer);\r\n            socket.off('call:answer', onAnswer);\r\n            socket.off('call:candidate', onCandidate);\r\n            socket.off('call:ended', onEnd);\r\n        };\r\n    }, [socket, roomId, fullDestruction]);\r\n\r\n    // ── Media + PeerConnection ────────────────────────────────────────────────\r\n    useEffect(() => {\r\n        componentMounted.current = true;\r\n\r\n        const start = async () => {\r\n            try {\r\n                setStatus('Requesting camera & mic...');\r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n                if (!componentMounted.current) { stream.getTracks().forEach(t => t.stop()); return; }\r\n\r\n                streamRef.current = stream;\r\n                setLocalStream(stream);\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = stream;\r\n\r\n                const pc = new RTCPeerConnection(rtcConfig);\r\n                pcRef.current = pc;\r\n\r\n                stream.getTracks().forEach(track => pc.addTrack(track, stream));\r\n\r\n                pc.ontrack = (event) => {\r\n                    const rStream = event.streams[0];\r\n                    setRemoteStream(rStream);\r\n                    if (remoteVideoRef.current) {\r\n                        remoteVideoRef.current.srcObject = rStream;\r\n                        remoteVideoRef.current.play().catch(() => { });\r\n                    }\r\n                };\r\n\r\n                pc.oniceconnectionstatechange = () => {\r\n                    if (!componentMounted.current) return;\r\n                    const s = pc.iceConnectionState;\r\n                    if (s === 'connected' || s === 'completed') { setStatus('Connected'); setIsConnected(true); }\r\n                    else if (s === 'checking') { setStatus('Connecting...'); }\r\n                    else if (s === 'disconnected' || s === 'failed') { setStatus('Connection Lost'); setIsConnected(false); }\r\n                    else if (s === 'closed') { setStatus('Ended'); setIsConnected(false); }\r\n                };\r\n\r\n                pc.onicecandidate = (event) => {\r\n                    if (event.candidate && signalingIdRef.current)\r\n                        socket.emit('call:candidate', { roomId, to: signalingIdRef.current, candidate: event.candidate });\r\n                };\r\n\r\n                if (isCallerRef.current) {\r\n                    setTimeout(() => { if (componentMounted.current) handleNegotiation(); }, 300);\r\n                } else {\r\n                    setStatus('Waiting for peer...');\r\n                }\r\n            } catch (err) {\r\n                console.error('[WebRTC] Media error:', err);\r\n                setStatus('Camera/Mic Denied');\r\n                toast.error('Could not access camera or microphone.');\r\n            }\r\n        };\r\n\r\n        start();\r\n\r\n        return () => {\r\n            componentMounted.current = false;\r\n            fullDestruction();\r\n        };\r\n    }, [socket, fullDestruction, handleNegotiation, roomId]);\r\n\r\n    // ── Controls ──────────────────────────────────────────────────────────────\r\n    const toggleMic = () => {\r\n        const track = streamRef.current?.getAudioTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsMicEnabled(track.enabled); }\r\n    };\r\n\r\n    const toggleCam = () => {\r\n        const track = streamRef.current?.getVideoTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsCamEnabled(track.enabled); }\r\n    };\r\n\r\n    const toggleScreenShare = async () => {\r\n        if (isScreenSharing) {\r\n            // Stop screen share, revert to camera\r\n            if (screenRef.current) {\r\n                screenRef.current.getTracks().forEach(t => t.stop());\r\n                screenRef.current = null;\r\n            }\r\n            // Replace the video sender track back to camera\r\n            const camTrack = streamRef.current?.getVideoTracks()[0];\r\n            if (camTrack && pcRef.current) {\r\n                const sender = pcRef.current.getSenders().find(s => s.track?.kind === 'video');\r\n                if (sender) await sender.replaceTrack(camTrack);\r\n            }\r\n            if (localVideoRef.current && streamRef.current)\r\n                localVideoRef.current.srcObject = streamRef.current;\r\n            setIsScreenSharing(false);\r\n            toast.success('Screen share stopped');\r\n        } else {\r\n            try {\r\n                const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });\r\n                screenRef.current = screenStream;\r\n                const screenTrack = screenStream.getVideoTracks()[0];\r\n\r\n                // Replace cam track in the PeerConnection\r\n                if (pcRef.current) {\r\n                    const sender = pcRef.current.getSenders().find(s => s.track?.kind === 'video');\r\n                    if (sender) await sender.replaceTrack(screenTrack);\r\n                }\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\r\n\r\n                // Auto-revert when user stops via browser UI\r\n                screenTrack.onended = () => toggleScreenShare();\r\n\r\n                setIsScreenSharing(true);\r\n                toast.success('Screen share started');\r\n            } catch (err) {\r\n                console.warn('[WebRTC] Screen share cancelled or denied:', err);\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleLeave = () => {\r\n        socket.emit('call:end', { roomId, to: signalingIdRef.current });\r\n        fullDestruction();\r\n        onLeaveRef.current();\r\n    };\r\n\r\n    const handleReconnect = () => {\r\n        if (isCallerRef.current) handleNegotiation();\r\n        else setStatus('Waiting for host to reconnect...');\r\n    };\r\n\r\n    // ── Render ────────────────────────────────────────────────────────────────\r\n    return (\r\n        <div className=\"wbrtc-root\">\r\n            {/* ── Status pill ── */}\r\n            <div className={`wbrtc-status-pill ${isConnected ? 'connected' : ''}`}>\r\n                <span className=\"wbrtc-status-dot\" />\r\n                <span>{status}</span>\r\n            </div>\r\n\r\n            {/* ── Main stage: remote video (or waiting placeholder) ── */}\r\n            <div className=\"wbrtc-main-stage\">\r\n                <video\r\n                    ref={remoteVideoRef}\r\n                    autoPlay\r\n                    playsInline\r\n                    className=\"wbrtc-remote-video\"\r\n                    style={{ opacity: remoteStream ? 1 : 0 }}\r\n                />\r\n\r\n                {!remoteStream && (\r\n                    <div className=\"wbrtc-waiting\">\r\n                        <div className=\"wbrtc-waiting-ring\">\r\n                            <div className=\"wbrtc-waiting-spinner\" />\r\n                        </div>\r\n                        <p className=\"wbrtc-waiting-label\">Waiting for peer…</p>\r\n                    </div>\r\n                )}\r\n\r\n                {/* ── PIP: local user ── */}\r\n                <div className=\"wbrtc-pip\">\r\n                    <video ref={localVideoRef} autoPlay muted playsInline className=\"wbrtc-pip-video\" />\r\n                    {!isCamEnabled && !isScreenSharing && (\r\n                        <div className=\"wbrtc-pip-avatar\">\r\n                            {username[0]?.toUpperCase()}\r\n                        </div>\r\n                    )}\r\n                    <div className=\"wbrtc-pip-label\">{username} (You)</div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* ── Control bar ── */}\r\n            <div className=\"wbrtc-controls\">\r\n                <button\r\n                    onClick={toggleMic}\r\n                    className={`wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`}\r\n                    title={isMicEnabled ? 'Mute' : 'Unmute'}\r\n                >\r\n                    {isMicEnabled ? <Mic size={18} /> : <MicOff size={18} />}\r\n                </button>\r\n\r\n                <button\r\n                    onClick={toggleCam}\r\n                    className={`wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`}\r\n                    title={isCamEnabled ? 'Stop Camera' : 'Start Camera'}\r\n                >\r\n                    {isCamEnabled ? <Video size={18} /> : <VideoOff size={18} />}\r\n                </button>\r\n\r\n                <button\r\n                    onClick={toggleScreenShare}\r\n                    className={`wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`}\r\n                    title={isScreenSharing ? 'Stop sharing' : 'Share screen'}\r\n                >\r\n                    {isScreenSharing ? <MonitorOff size={18} /> : <Monitor size={18} />}\r\n                </button>\r\n\r\n                <button\r\n                    onClick={handleReconnect}\r\n                    className=\"wbrtc-btn\"\r\n                    title=\"Reconnect\"\r\n                >\r\n                    <RefreshCcw size={18} />\r\n                </button>\r\n\r\n                <div className=\"wbrtc-divider\" />\r\n\r\n                <button\r\n                    onClick={handleLeave}\r\n                    className=\"wbrtc-btn wbrtc-btn--leave\"\r\n                    title=\"End call\"\r\n                >\r\n                    <PhoneOff size={18} />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WebRTCMeeting;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}