{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\components\\\\video\\\\WebRTCMeeting.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, RefreshCcw } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\n/**\r\n * WebRTCMeeting — Rebuilt from scratch with a robust 3-stage state machine.\r\n * Stage 1: HW_INIT -> Stage 2: READY_FOR_SIGNALLING -> Stage 3: CONNECTED\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WebRTCMeeting = ({\n  socket,\n  roomId,\n  signalingId,\n  isCaller,\n  username,\n  onLeave\n}) => {\n  _s();\n  // ── UI State ──────────────────────────────────────────────────────────────\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const [isMicEnabled, setIsMicEnabled] = useState(true);\n  const [isCamEnabled, setIsCamEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [status, setStatus] = useState('Initializing Media...');\n\n  // ── Management Refs (Persistent across renders) ───────────────────────────\n  const pcRef = useRef(null);\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const streamRef = useRef(null);\n  const screenRef = useRef(null);\n  const candidateQueue = useRef([]);\n  const makingOffer = useRef(false);\n  const componentMounted = useRef(true);\n  const rtcConfig = {\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }]\n  };\n\n  // ── 1. Media Initialization ───────────────────────────────────────────────\n  useEffect(() => {\n    componentMounted.current = true;\n    const startHardware = async () => {\n      try {\n        setStatus('Accessing Camera/Mic...');\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        if (!componentMounted.current) {\n          stream.getTracks().forEach(t => t.stop());\n          return;\n        }\n        streamRef.current = stream;\n        setLocalStream(stream);\n        if (localVideoRef.current) localVideoRef.current.srcObject = stream;\n        initConnection(stream);\n      } catch (err) {\n        console.error('[WebRTC] Media Fail:', err);\n        setStatus('Media Permission Denied');\n        toast.error('Could not access camera/mic. Please check permissions.');\n      }\n    };\n    const initConnection = stream => {\n      const pc = new RTCPeerConnection(rtcConfig);\n      pcRef.current = pc;\n\n      // Add local tracks\n      stream.getTracks().forEach(track => pc.addTrack(track, stream));\n\n      // Remote stream handler\n      pc.ontrack = event => {\n        console.log('[WebRTC] Received Remote Track:', event.track.kind);\n        const rStream = event.streams[0];\n        setRemoteStream(rStream);\n        if (remoteVideoRef.current) {\n          remoteVideoRef.current.srcObject = rStream;\n          remoteVideoRef.current.play().catch(e => console.warn('Autoplay blocked:', e));\n        }\n      };\n\n      // Network health handler\n      pc.oniceconnectionstatechange = () => {\n        if (!componentMounted.current) return;\n        console.log('[WebRTC] Connection State:', pc.iceConnectionState);\n        const s = pc.iceConnectionState;\n        if (s === 'connected' || s === 'completed') setStatus('Connected');else if (s === 'checking') setStatus('Connecting...');else if (s === 'disconnected' || s === 'failed') setStatus('Connection Lost');else if (s === 'closed') setStatus('Ended');\n      };\n\n      // ICE Candidate signaling\n      pc.onicecandidate = event => {\n        if (event.candidate && signalingId) {\n          socket.emit('call:candidate', {\n            roomId,\n            to: signalingId,\n            candidate: event.candidate\n          });\n        }\n      };\n\n      // Start negotiation if we are the caller\n      if (isCaller) {\n        handleNegotiation();\n      } else {\n        setStatus('Waiting for incoming stream...');\n      }\n    };\n    startHardware();\n    return () => {\n      componentMounted.current = false;\n      fullDestruction();\n    };\n  }, []); // Run once on mount\n\n  // ── 2. Negotiation Logic ──────────────────────────────────────────────────\n  const handleNegotiation = async () => {\n    if (!pcRef.current || makingOffer.current) return;\n    try {\n      makingOffer.current = true;\n      setStatus('Negotiating...');\n      const offer = await pcRef.current.createOffer();\n      await pcRef.current.setLocalDescription(offer);\n      socket.emit('call:offer', {\n        roomId,\n        to: signalingId,\n        offer\n      });\n    } catch (err) {\n      console.error('[WebRTC] Negotiation Failed:', err);\n    } finally {\n      makingOffer.current = false;\n    }\n  };\n\n  // ── 3. Signaling Handlers (Bound to socket events) ───────────────────────\n  useEffect(() => {\n    if (!socket) return;\n    const processQueue = async () => {\n      while (candidateQueue.current.length > 0 && (_pcRef$current = pcRef.current) !== null && _pcRef$current !== void 0 && _pcRef$current.remoteDescription) {\n        var _pcRef$current;\n        const cand = candidateQueue.current.shift();\n        try {\n          await pcRef.current.addIceCandidate(new RTCIceCandidate(cand));\n        } catch (e) {}\n      }\n    };\n    const onOffer = async ({\n      from,\n      offer\n    }) => {\n      const pc = pcRef.current;\n      if (!pc || pc.signalingState !== 'stable') return;\n      try {\n        await pc.setRemoteDescription(new RTCSessionDescription(offer));\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        socket.emit('call:answer', {\n          roomId,\n          to: from,\n          answer\n        });\n        await processQueue();\n      } catch (e) {\n        console.error('Offer process failed:', e);\n      }\n    };\n    const onAnswer = async ({\n      from,\n      answer\n    }) => {\n      const pc = pcRef.current;\n      if (!pc || pc.signalingState !== 'have-local-offer') return;\n      try {\n        await pc.setRemoteDescription(new RTCSessionDescription(answer));\n        await processQueue();\n      } catch (e) {\n        console.error('Answer process failed:', e);\n      }\n    };\n    const onCandidate = async ({\n      from,\n      candidate\n    }) => {\n      var _pc$remoteDescription;\n      const pc = pcRef.current;\n      if (!pc) return;\n      if ((_pc$remoteDescription = pc.remoteDescription) !== null && _pc$remoteDescription !== void 0 && _pc$remoteDescription.type) {\n        try {\n          await pc.addIceCandidate(new RTCIceCandidate(candidate));\n        } catch (e) {}\n      } else {\n        candidateQueue.current.push(candidate);\n      }\n    };\n    const onEnd = () => {\n      fullDestruction();\n      onLeave();\n    };\n    socket.on('call:offer', onOffer);\n    socket.on('call:answer', onAnswer);\n    socket.on('call:candidate', onCandidate);\n    socket.on('call:ended', onEnd);\n    return () => {\n      socket.off('call:offer', onOffer);\n      socket.off('call:answer', onAnswer);\n      socket.off('call:candidate', onCandidate);\n      socket.off('call:ended', onEnd);\n    };\n  }, [socket, signalingId, roomId, onLeave]);\n\n  // ── 4. Lifecycle Helpers ──────────────────────────────────────────────────\n  const fullDestruction = () => {\n    if (pcRef.current) {\n      pcRef.current.close();\n      pcRef.current = null;\n    }\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(t => t.stop());\n      streamRef.current = null;\n    }\n    if (screenRef.current) {\n      screenRef.current.getTracks().forEach(t => t.stop());\n      screenRef.current = null;\n    }\n    setLocalStream(null);\n    setRemoteStream(null);\n    setStatus('Call Ended');\n  };\n  const toggleMic = () => {\n    var _streamRef$current;\n    const track = (_streamRef$current = streamRef.current) === null || _streamRef$current === void 0 ? void 0 : _streamRef$current.getAudioTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsMicEnabled(track.enabled);\n    }\n  };\n  const toggleCam = () => {\n    var _streamRef$current2;\n    const track = (_streamRef$current2 = streamRef.current) === null || _streamRef$current2 === void 0 ? void 0 : _streamRef$current2.getVideoTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsCamEnabled(track.enabled);\n    }\n  };\n  const handleLeave = () => {\n    socket.emit('call:end', {\n      roomId,\n      to: signalingId\n    });\n    onEnd(); // Local cleanup\n  };\n  const handleReconnect = () => {\n    if (isCaller) handleNegotiation();else setStatus('Waiting for host to reconnect...');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wb-meeting-container bg-slate-950 flex flex-col h-full w-full relative overflow-hidden font-sans\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 grid grid-rows-2 md:grid-rows-1 md:grid-cols-2 gap-4 p-4 lg:p-6 overflow-hidden\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative group bg-slate-900 rounded-3xl overflow-hidden shadow-2xl transition-all duration-500 border border-slate-800\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localVideoRef,\n          autoPlay: true,\n          muted: true,\n          playsInline: true,\n          className: \"w-full h-full object-cover\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 21\n        }, this), !isCamEnabled && !isScreenSharing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute inset-0 flex items-center justify-center bg-slate-900 backdrop-blur-sm\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-24 h-24 bg-indigo-600 rounded-full flex items-center justify-center text-4xl font-bold text-white shadow-lg ring-4 ring-indigo-500/20\",\n            children: username[0].toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute bottom-4 left-4 flex items-center gap-2 px-3 py-1.5 bg-slate-900/60 backdrop-blur-md rounded-full border border-white/10\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-white font-semibold text-sm tracking-wide\",\n            children: [username, \" (You)\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 25\n          }, this), !isMicEnabled && /*#__PURE__*/_jsxDEV(MicOff, {\n            size: 14,\n            className: \"text-red-400\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative group bg-slate-900 rounded-3xl overflow-hidden shadow-2xl transition-all duration-500 border border-slate-800\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: remoteVideoRef,\n          autoPlay: true,\n          playsInline: true,\n          className: \"w-full h-full object-cover\",\n          style: {\n            opacity: remoteStream ? 1 : 0\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 21\n        }, this), !remoteStream && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute inset-0 flex flex-col items-center justify-center bg-slate-900 shadow-inner\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"absolute inset-0 bg-indigo-500 blur-2xl opacity-20 animate-pulse\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent shadow-xl relative\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-slate-400 mt-6 font-medium tracking-widest text-xs uppercase animate-pulse\",\n            children: \"Waiting for peer...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute bottom-4 left-4 flex items-center gap-2 px-3 py-1.5 bg-slate-900/60 backdrop-blur-md rounded-full border border-white/10\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-white font-semibold text-sm tracking-wide\",\n            children: \"Remote Participant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"h-24 flex items-center justify-center px-8 bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-4 bg-slate-900/80 backdrop-blur-2xl px-6 py-4 rounded-3xl border border-white/5 shadow-2xl\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: toggleMic,\n          className: `p-4 rounded-2xl transition-all duration-300 ${isMicEnabled ? 'bg-slate-800 hover:bg-slate-700 text-white' : 'bg-red-500 text-white ring-4 ring-red-500/20 active:scale-90 hover:bg-red-600'}`,\n          children: isMicEnabled ? /*#__PURE__*/_jsxDEV(Mic, {\n            size: 22\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 41\n          }, this) : /*#__PURE__*/_jsxDEV(MicOff, {\n            size: 22\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 61\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: toggleCam,\n          className: `p-4 rounded-2xl transition-all duration-300 ${isCamEnabled ? 'bg-slate-800 hover:bg-slate-700 text-white' : 'bg-red-500 text-white ring-4 ring-red-500/20 active:scale-90 hover:bg-red-600'}`,\n          children: isCamEnabled ? /*#__PURE__*/_jsxDEV(Video, {\n            size: 22\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 41\n          }, this) : /*#__PURE__*/_jsxDEV(VideoOff, {\n            size: 22\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 63\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleReconnect,\n          className: \"p-4 bg-slate-800 hover:bg-slate-700 rounded-2xl text-white transition-all active:scale-90 group\",\n          title: \"Reconnect\",\n          children: /*#__PURE__*/_jsxDEV(RefreshCcw, {\n            size: 22,\n            className: \"group-active:rotate-180 transition-transform\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-px h-10 bg-white/10 mx-2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleLeave,\n          className: \"p-4 bg-rose-600 hover:bg-rose-700 rounded-2xl text-white shadow-xl shadow-rose-900/20 transition-all hover:-translate-y-1 active:scale-90\",\n          children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n            size: 22\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 283,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"absolute top-6 left-1/2 -translate-x-1/2 bg-slate-900/80 backdrop-blur-xl border border-white/5 px-5 py-2 rounded-full shadow-2xl flex items-center gap-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: `w-2 h-2 rounded-full animate-pulse shadow-[0_0_10px_rgba(255,255,255,0.5)] ${status === 'Connected' ? 'bg-emerald-400' : 'bg-amber-400'}`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 290,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-white text-[11px] font-bold uppercase tracking-widest leading-none\",\n        children: status\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 227,\n    columnNumber: 9\n  }, this);\n};\n_s(WebRTCMeeting, \"F5SdBnzX0efVmiAQwEYi0SCuVUs=\");\n_c = WebRTCMeeting;\nexport default WebRTCMeeting;\nvar _c;\n$RefreshReg$(_c, \"WebRTCMeeting\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Mic","MicOff","Video","VideoOff","PhoneOff","Monitor","MonitorOff","RefreshCcw","toast","jsxDEV","_jsxDEV","WebRTCMeeting","socket","roomId","signalingId","isCaller","username","onLeave","_s","localStream","setLocalStream","remoteStream","setRemoteStream","isMicEnabled","setIsMicEnabled","isCamEnabled","setIsCamEnabled","isScreenSharing","setIsScreenSharing","status","setStatus","pcRef","localVideoRef","remoteVideoRef","streamRef","screenRef","candidateQueue","makingOffer","componentMounted","rtcConfig","iceServers","urls","current","startHardware","stream","navigator","mediaDevices","getUserMedia","video","audio","getTracks","forEach","t","stop","srcObject","initConnection","err","console","error","pc","RTCPeerConnection","track","addTrack","ontrack","event","log","kind","rStream","streams","play","catch","e","warn","oniceconnectionstatechange","iceConnectionState","s","onicecandidate","candidate","emit","to","handleNegotiation","fullDestruction","offer","createOffer","setLocalDescription","processQueue","length","_pcRef$current","remoteDescription","cand","shift","addIceCandidate","RTCIceCandidate","onOffer","from","signalingState","setRemoteDescription","RTCSessionDescription","answer","createAnswer","onAnswer","onCandidate","_pc$remoteDescription","type","push","onEnd","on","off","close","toggleMic","_streamRef$current","getAudioTracks","enabled","toggleCam","_streamRef$current2","getVideoTracks","handleLeave","handleReconnect","className","children","ref","autoPlay","muted","playsInline","fileName","_jsxFileName","lineNumber","columnNumber","toUpperCase","size","style","opacity","onClick","title","_c","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/components/video/WebRTCMeeting.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, RefreshCcw } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * WebRTCMeeting — Rebuilt from scratch with a robust 3-stage state machine.\r\n * Stage 1: HW_INIT -> Stage 2: READY_FOR_SIGNALLING -> Stage 3: CONNECTED\r\n */\r\nconst WebRTCMeeting = ({ socket, roomId, signalingId, isCaller, username, onLeave }) => {\r\n    // ── UI State ──────────────────────────────────────────────────────────────\r\n    const [localStream, setLocalStream] = useState(null);\r\n    const [remoteStream, setRemoteStream] = useState(null);\r\n    const [isMicEnabled, setIsMicEnabled] = useState(true);\r\n    const [isCamEnabled, setIsCamEnabled] = useState(true);\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const [status, setStatus] = useState('Initializing Media...');\r\n\r\n    // ── Management Refs (Persistent across renders) ───────────────────────────\r\n    const pcRef = useRef(null);\r\n    const localVideoRef = useRef(null);\r\n    const remoteVideoRef = useRef(null);\r\n    const streamRef = useRef(null);\r\n    const screenRef = useRef(null);\r\n    const candidateQueue = useRef([]);\r\n    const makingOffer = useRef(false);\r\n    const componentMounted = useRef(true);\r\n\r\n    const rtcConfig = {\r\n        iceServers: [\r\n            { urls: 'stun:stun.l.google.com:19302' },\r\n            { urls: 'stun:stun1.l.google.com:19302' },\r\n        ],\r\n    };\r\n\r\n    // ── 1. Media Initialization ───────────────────────────────────────────────\r\n    useEffect(() => {\r\n        componentMounted.current = true;\r\n\r\n        const startHardware = async () => {\r\n            try {\r\n                setStatus('Accessing Camera/Mic...');\r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n\r\n                if (!componentMounted.current) {\r\n                    stream.getTracks().forEach(t => t.stop());\r\n                    return;\r\n                }\r\n\r\n                streamRef.current = stream;\r\n                setLocalStream(stream);\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = stream;\r\n\r\n                initConnection(stream);\r\n            } catch (err) {\r\n                console.error('[WebRTC] Media Fail:', err);\r\n                setStatus('Media Permission Denied');\r\n                toast.error('Could not access camera/mic. Please check permissions.');\r\n            }\r\n        };\r\n\r\n        const initConnection = (stream) => {\r\n            const pc = new RTCPeerConnection(rtcConfig);\r\n            pcRef.current = pc;\r\n\r\n            // Add local tracks\r\n            stream.getTracks().forEach(track => pc.addTrack(track, stream));\r\n\r\n            // Remote stream handler\r\n            pc.ontrack = (event) => {\r\n                console.log('[WebRTC] Received Remote Track:', event.track.kind);\r\n                const rStream = event.streams[0];\r\n                setRemoteStream(rStream);\r\n                if (remoteVideoRef.current) {\r\n                    remoteVideoRef.current.srcObject = rStream;\r\n                    remoteVideoRef.current.play().catch(e => console.warn('Autoplay blocked:', e));\r\n                }\r\n            };\r\n\r\n            // Network health handler\r\n            pc.oniceconnectionstatechange = () => {\r\n                if (!componentMounted.current) return;\r\n                console.log('[WebRTC] Connection State:', pc.iceConnectionState);\r\n\r\n                const s = pc.iceConnectionState;\r\n                if (s === 'connected' || s === 'completed') setStatus('Connected');\r\n                else if (s === 'checking') setStatus('Connecting...');\r\n                else if (s === 'disconnected' || s === 'failed') setStatus('Connection Lost');\r\n                else if (s === 'closed') setStatus('Ended');\r\n            };\r\n\r\n            // ICE Candidate signaling\r\n            pc.onicecandidate = (event) => {\r\n                if (event.candidate && signalingId) {\r\n                    socket.emit('call:candidate', { roomId, to: signalingId, candidate: event.candidate });\r\n                }\r\n            };\r\n\r\n            // Start negotiation if we are the caller\r\n            if (isCaller) {\r\n                handleNegotiation();\r\n            } else {\r\n                setStatus('Waiting for incoming stream...');\r\n            }\r\n        };\r\n\r\n        startHardware();\r\n\r\n        return () => {\r\n            componentMounted.current = false;\r\n            fullDestruction();\r\n        };\r\n    }, []); // Run once on mount\r\n\r\n    // ── 2. Negotiation Logic ──────────────────────────────────────────────────\r\n    const handleNegotiation = async () => {\r\n        if (!pcRef.current || makingOffer.current) return;\r\n        try {\r\n            makingOffer.current = true;\r\n            setStatus('Negotiating...');\r\n            const offer = await pcRef.current.createOffer();\r\n            await pcRef.current.setLocalDescription(offer);\r\n            socket.emit('call:offer', { roomId, to: signalingId, offer });\r\n        } catch (err) {\r\n            console.error('[WebRTC] Negotiation Failed:', err);\r\n        } finally {\r\n            makingOffer.current = false;\r\n        }\r\n    };\r\n\r\n    // ── 3. Signaling Handlers (Bound to socket events) ───────────────────────\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n\r\n        const processQueue = async () => {\r\n            while (candidateQueue.current.length > 0 && pcRef.current?.remoteDescription) {\r\n                const cand = candidateQueue.current.shift();\r\n                try { await pcRef.current.addIceCandidate(new RTCIceCandidate(cand)); } catch (e) { }\r\n            }\r\n        };\r\n\r\n        const onOffer = async ({ from, offer }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc || pc.signalingState !== 'stable') return;\r\n            try {\r\n                await pc.setRemoteDescription(new RTCSessionDescription(offer));\r\n                const answer = await pc.createAnswer();\r\n                await pc.setLocalDescription(answer);\r\n                socket.emit('call:answer', { roomId, to: from, answer });\r\n                await processQueue();\r\n            } catch (e) { console.error('Offer process failed:', e); }\r\n        };\r\n\r\n        const onAnswer = async ({ from, answer }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc || pc.signalingState !== 'have-local-offer') return;\r\n            try {\r\n                await pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n                await processQueue();\r\n            } catch (e) { console.error('Answer process failed:', e); }\r\n        };\r\n\r\n        const onCandidate = async ({ from, candidate }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc) return;\r\n            if (pc.remoteDescription?.type) {\r\n                try { await pc.addIceCandidate(new RTCIceCandidate(candidate)); } catch (e) { }\r\n            } else {\r\n                candidateQueue.current.push(candidate);\r\n            }\r\n        };\r\n\r\n        const onEnd = () => {\r\n            fullDestruction();\r\n            onLeave();\r\n        };\r\n\r\n        socket.on('call:offer', onOffer);\r\n        socket.on('call:answer', onAnswer);\r\n        socket.on('call:candidate', onCandidate);\r\n        socket.on('call:ended', onEnd);\r\n\r\n        return () => {\r\n            socket.off('call:offer', onOffer);\r\n            socket.off('call:answer', onAnswer);\r\n            socket.off('call:candidate', onCandidate);\r\n            socket.off('call:ended', onEnd);\r\n        };\r\n    }, [socket, signalingId, roomId, onLeave]);\r\n\r\n    // ── 4. Lifecycle Helpers ──────────────────────────────────────────────────\r\n    const fullDestruction = () => {\r\n        if (pcRef.current) { pcRef.current.close(); pcRef.current = null; }\r\n        if (streamRef.current) {\r\n            streamRef.current.getTracks().forEach(t => t.stop());\r\n            streamRef.current = null;\r\n        }\r\n        if (screenRef.current) {\r\n            screenRef.current.getTracks().forEach(t => t.stop());\r\n            screenRef.current = null;\r\n        }\r\n        setLocalStream(null);\r\n        setRemoteStream(null);\r\n        setStatus('Call Ended');\r\n    };\r\n\r\n    const toggleMic = () => {\r\n        const track = streamRef.current?.getAudioTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsMicEnabled(track.enabled); }\r\n    };\r\n\r\n    const toggleCam = () => {\r\n        const track = streamRef.current?.getVideoTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsCamEnabled(track.enabled); }\r\n    };\r\n\r\n    const handleLeave = () => {\r\n        socket.emit('call:end', { roomId, to: signalingId });\r\n        onEnd(); // Local cleanup\r\n    };\r\n\r\n    const handleReconnect = () => {\r\n        if (isCaller) handleNegotiation();\r\n        else setStatus('Waiting for host to reconnect...');\r\n    };\r\n\r\n    return (\r\n        <div className=\"wb-meeting-container bg-slate-950 flex flex-col h-full w-full relative overflow-hidden font-sans\">\r\n            {/* Main Video Stage */}\r\n            <div className=\"flex-1 grid grid-rows-2 md:grid-rows-1 md:grid-cols-2 gap-4 p-4 lg:p-6 overflow-hidden\">\r\n                {/* Local User */}\r\n                <div className=\"relative group bg-slate-900 rounded-3xl overflow-hidden shadow-2xl transition-all duration-500 border border-slate-800\">\r\n                    <video ref={localVideoRef} autoPlay muted playsInline className=\"w-full h-full object-cover\" />\r\n                    {!isCamEnabled && !isScreenSharing && (\r\n                        <div className=\"absolute inset-0 flex items-center justify-center bg-slate-900 backdrop-blur-sm\">\r\n                            <div className=\"w-24 h-24 bg-indigo-600 rounded-full flex items-center justify-center text-4xl font-bold text-white shadow-lg ring-4 ring-indigo-500/20\">\r\n                                {username[0].toUpperCase()}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"absolute bottom-4 left-4 flex items-center gap-2 px-3 py-1.5 bg-slate-900/60 backdrop-blur-md rounded-full border border-white/10\">\r\n                        <span className=\"text-white font-semibold text-sm tracking-wide\">{username} (You)</span>\r\n                        {!isMicEnabled && <MicOff size={14} className=\"text-red-400\" />}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Remote User */}\r\n                <div className=\"relative group bg-slate-900 rounded-3xl overflow-hidden shadow-2xl transition-all duration-500 border border-slate-800\">\r\n                    <video ref={remoteVideoRef} autoPlay playsInline className=\"w-full h-full object-cover\"\r\n                        style={{ opacity: remoteStream ? 1 : 0 }} />\r\n                    {!remoteStream && (\r\n                        <div className=\"absolute inset-0 flex flex-col items-center justify-center bg-slate-900 shadow-inner\">\r\n                            <div className=\"relative\">\r\n                                <div className=\"absolute inset-0 bg-indigo-500 blur-2xl opacity-20 animate-pulse\"></div>\r\n                                <div className=\"animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent shadow-xl relative\"></div>\r\n                            </div>\r\n                            <p className=\"text-slate-400 mt-6 font-medium tracking-widest text-xs uppercase animate-pulse\">Waiting for peer...</p>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"absolute bottom-4 left-4 flex items-center gap-2 px-3 py-1.5 bg-slate-900/60 backdrop-blur-md rounded-full border border-white/10\">\r\n                        <span className=\"text-white font-semibold text-sm tracking-wide\">Remote Participant</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Premium Control Bar */}\r\n            <div className=\"h-24 flex items-center justify-center px-8 bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent\">\r\n                <div className=\"flex items-center gap-4 bg-slate-900/80 backdrop-blur-2xl px-6 py-4 rounded-3xl border border-white/5 shadow-2xl\">\r\n                    <button onClick={toggleMic} className={`p-4 rounded-2xl transition-all duration-300 ${isMicEnabled ? 'bg-slate-800 hover:bg-slate-700 text-white' : 'bg-red-500 text-white ring-4 ring-red-500/20 active:scale-90 hover:bg-red-600'}`}>\r\n                        {isMicEnabled ? <Mic size={22} /> : <MicOff size={22} />}\r\n                    </button>\r\n\r\n                    <button onClick={toggleCam} className={`p-4 rounded-2xl transition-all duration-300 ${isCamEnabled ? 'bg-slate-800 hover:bg-slate-700 text-white' : 'bg-red-500 text-white ring-4 ring-red-500/20 active:scale-90 hover:bg-red-600'}`}>\r\n                        {isCamEnabled ? <Video size={22} /> : <VideoOff size={22} />}\r\n                    </button>\r\n\r\n                    <button onClick={handleReconnect} className=\"p-4 bg-slate-800 hover:bg-slate-700 rounded-2xl text-white transition-all active:scale-90 group\" title=\"Reconnect\">\r\n                        <RefreshCcw size={22} className=\"group-active:rotate-180 transition-transform\" />\r\n                    </button>\r\n\r\n                    <div className=\"w-px h-10 bg-white/10 mx-2\"></div>\r\n\r\n                    <button onClick={handleLeave} className=\"p-4 bg-rose-600 hover:bg-rose-700 rounded-2xl text-white shadow-xl shadow-rose-900/20 transition-all hover:-translate-y-1 active:scale-90\">\r\n                        <PhoneOff size={22} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Dynamic Status Indicator */}\r\n            <div className=\"absolute top-6 left-1/2 -translate-x-1/2 bg-slate-900/80 backdrop-blur-xl border border-white/5 px-5 py-2 rounded-full shadow-2xl flex items-center gap-3\">\r\n                <div className={`w-2 h-2 rounded-full animate-pulse shadow-[0_0_10px_rgba(255,255,255,0.5)] ${status === 'Connected' ? 'bg-emerald-400' : 'bg-amber-400'}`}></div>\r\n                <span className=\"text-white text-[11px] font-bold uppercase tracking-widest leading-none\">{status}</span>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WebRTCMeeting;\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,WAAW,QAAQ,OAAO;AACvE,SAASC,GAAG,EAAEC,MAAM,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,OAAO,EAAEC,UAAU,EAAEC,UAAU,QAAQ,cAAc;AACtG,OAAOC,KAAK,MAAM,iBAAiB;;AAEnC;AACA;AACA;AACA;AAHA,SAAAC,MAAA,IAAAC,OAAA;AAIA,MAAMC,aAAa,GAAGA,CAAC;EAAEC,MAAM;EAAEC,MAAM;EAAEC,WAAW;EAAEC,QAAQ;EAAEC,QAAQ;EAAEC;AAAQ,CAAC,KAAK;EAAAC,EAAA;EACpF;EACA,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGtB,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAACuB,YAAY,EAAEC,eAAe,CAAC,GAAGxB,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAM,CAACyB,YAAY,EAAEC,eAAe,CAAC,GAAG1B,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAM,CAAC2B,YAAY,EAAEC,eAAe,CAAC,GAAG5B,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAM,CAAC6B,eAAe,EAAEC,kBAAkB,CAAC,GAAG9B,QAAQ,CAAC,KAAK,CAAC;EAC7D,MAAM,CAAC+B,MAAM,EAAEC,SAAS,CAAC,GAAGhC,QAAQ,CAAC,uBAAuB,CAAC;;EAE7D;EACA,MAAMiC,KAAK,GAAGlC,MAAM,CAAC,IAAI,CAAC;EAC1B,MAAMmC,aAAa,GAAGnC,MAAM,CAAC,IAAI,CAAC;EAClC,MAAMoC,cAAc,GAAGpC,MAAM,CAAC,IAAI,CAAC;EACnC,MAAMqC,SAAS,GAAGrC,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMsC,SAAS,GAAGtC,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMuC,cAAc,GAAGvC,MAAM,CAAC,EAAE,CAAC;EACjC,MAAMwC,WAAW,GAAGxC,MAAM,CAAC,KAAK,CAAC;EACjC,MAAMyC,gBAAgB,GAAGzC,MAAM,CAAC,IAAI,CAAC;EAErC,MAAM0C,SAAS,GAAG;IACdC,UAAU,EAAE,CACR;MAAEC,IAAI,EAAE;IAA+B,CAAC,EACxC;MAAEA,IAAI,EAAE;IAAgC,CAAC;EAEjD,CAAC;;EAED;EACA7C,SAAS,CAAC,MAAM;IACZ0C,gBAAgB,CAACI,OAAO,GAAG,IAAI;IAE/B,MAAMC,aAAa,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACAb,SAAS,CAAC,yBAAyB,CAAC;QACpC,MAAMc,MAAM,GAAG,MAAMC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC;UAAEC,KAAK,EAAE,IAAI;UAAEC,KAAK,EAAE;QAAK,CAAC,CAAC;QAEtF,IAAI,CAACX,gBAAgB,CAACI,OAAO,EAAE;UAC3BE,MAAM,CAACM,SAAS,CAAC,CAAC,CAACC,OAAO,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;UACzC;QACJ;QAEAnB,SAAS,CAACQ,OAAO,GAAGE,MAAM;QAC1BxB,cAAc,CAACwB,MAAM,CAAC;QACtB,IAAIZ,aAAa,CAACU,OAAO,EAAEV,aAAa,CAACU,OAAO,CAACY,SAAS,GAAGV,MAAM;QAEnEW,cAAc,CAACX,MAAM,CAAC;MAC1B,CAAC,CAAC,OAAOY,GAAG,EAAE;QACVC,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAEF,GAAG,CAAC;QAC1C1B,SAAS,CAAC,yBAAyB,CAAC;QACpCtB,KAAK,CAACkD,KAAK,CAAC,wDAAwD,CAAC;MACzE;IACJ,CAAC;IAED,MAAMH,cAAc,GAAIX,MAAM,IAAK;MAC/B,MAAMe,EAAE,GAAG,IAAIC,iBAAiB,CAACrB,SAAS,CAAC;MAC3CR,KAAK,CAACW,OAAO,GAAGiB,EAAE;;MAElB;MACAf,MAAM,CAACM,SAAS,CAAC,CAAC,CAACC,OAAO,CAACU,KAAK,IAAIF,EAAE,CAACG,QAAQ,CAACD,KAAK,EAAEjB,MAAM,CAAC,CAAC;;MAE/D;MACAe,EAAE,CAACI,OAAO,GAAIC,KAAK,IAAK;QACpBP,OAAO,CAACQ,GAAG,CAAC,iCAAiC,EAAED,KAAK,CAACH,KAAK,CAACK,IAAI,CAAC;QAChE,MAAMC,OAAO,GAAGH,KAAK,CAACI,OAAO,CAAC,CAAC,CAAC;QAChC9C,eAAe,CAAC6C,OAAO,CAAC;QACxB,IAAIlC,cAAc,CAACS,OAAO,EAAE;UACxBT,cAAc,CAACS,OAAO,CAACY,SAAS,GAAGa,OAAO;UAC1ClC,cAAc,CAACS,OAAO,CAAC2B,IAAI,CAAC,CAAC,CAACC,KAAK,CAACC,CAAC,IAAId,OAAO,CAACe,IAAI,CAAC,mBAAmB,EAAED,CAAC,CAAC,CAAC;QAClF;MACJ,CAAC;;MAED;MACAZ,EAAE,CAACc,0BAA0B,GAAG,MAAM;QAClC,IAAI,CAACnC,gBAAgB,CAACI,OAAO,EAAE;QAC/Be,OAAO,CAACQ,GAAG,CAAC,4BAA4B,EAAEN,EAAE,CAACe,kBAAkB,CAAC;QAEhE,MAAMC,CAAC,GAAGhB,EAAE,CAACe,kBAAkB;QAC/B,IAAIC,CAAC,KAAK,WAAW,IAAIA,CAAC,KAAK,WAAW,EAAE7C,SAAS,CAAC,WAAW,CAAC,CAAC,KAC9D,IAAI6C,CAAC,KAAK,UAAU,EAAE7C,SAAS,CAAC,eAAe,CAAC,CAAC,KACjD,IAAI6C,CAAC,KAAK,cAAc,IAAIA,CAAC,KAAK,QAAQ,EAAE7C,SAAS,CAAC,iBAAiB,CAAC,CAAC,KACzE,IAAI6C,CAAC,KAAK,QAAQ,EAAE7C,SAAS,CAAC,OAAO,CAAC;MAC/C,CAAC;;MAED;MACA6B,EAAE,CAACiB,cAAc,GAAIZ,KAAK,IAAK;QAC3B,IAAIA,KAAK,CAACa,SAAS,IAAI/D,WAAW,EAAE;UAChCF,MAAM,CAACkE,IAAI,CAAC,gBAAgB,EAAE;YAAEjE,MAAM;YAAEkE,EAAE,EAAEjE,WAAW;YAAE+D,SAAS,EAAEb,KAAK,CAACa;UAAU,CAAC,CAAC;QAC1F;MACJ,CAAC;;MAED;MACA,IAAI9D,QAAQ,EAAE;QACViE,iBAAiB,CAAC,CAAC;MACvB,CAAC,MAAM;QACHlD,SAAS,CAAC,gCAAgC,CAAC;MAC/C;IACJ,CAAC;IAEDa,aAAa,CAAC,CAAC;IAEf,OAAO,MAAM;MACTL,gBAAgB,CAACI,OAAO,GAAG,KAAK;MAChCuC,eAAe,CAAC,CAAC;IACrB,CAAC;EACL,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC;;EAER;EACA,MAAMD,iBAAiB,GAAG,MAAAA,CAAA,KAAY;IAClC,IAAI,CAACjD,KAAK,CAACW,OAAO,IAAIL,WAAW,CAACK,OAAO,EAAE;IAC3C,IAAI;MACAL,WAAW,CAACK,OAAO,GAAG,IAAI;MAC1BZ,SAAS,CAAC,gBAAgB,CAAC;MAC3B,MAAMoD,KAAK,GAAG,MAAMnD,KAAK,CAACW,OAAO,CAACyC,WAAW,CAAC,CAAC;MAC/C,MAAMpD,KAAK,CAACW,OAAO,CAAC0C,mBAAmB,CAACF,KAAK,CAAC;MAC9CtE,MAAM,CAACkE,IAAI,CAAC,YAAY,EAAE;QAAEjE,MAAM;QAAEkE,EAAE,EAAEjE,WAAW;QAAEoE;MAAM,CAAC,CAAC;IACjE,CAAC,CAAC,OAAO1B,GAAG,EAAE;MACVC,OAAO,CAACC,KAAK,CAAC,8BAA8B,EAAEF,GAAG,CAAC;IACtD,CAAC,SAAS;MACNnB,WAAW,CAACK,OAAO,GAAG,KAAK;IAC/B;EACJ,CAAC;;EAED;EACA9C,SAAS,CAAC,MAAM;IACZ,IAAI,CAACgB,MAAM,EAAE;IAEb,MAAMyE,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC7B,OAAOjD,cAAc,CAACM,OAAO,CAAC4C,MAAM,GAAG,CAAC,KAAAC,cAAA,GAAIxD,KAAK,CAACW,OAAO,cAAA6C,cAAA,eAAbA,cAAA,CAAeC,iBAAiB,EAAE;QAAA,IAAAD,cAAA;QAC1E,MAAME,IAAI,GAAGrD,cAAc,CAACM,OAAO,CAACgD,KAAK,CAAC,CAAC;QAC3C,IAAI;UAAE,MAAM3D,KAAK,CAACW,OAAO,CAACiD,eAAe,CAAC,IAAIC,eAAe,CAACH,IAAI,CAAC,CAAC;QAAE,CAAC,CAAC,OAAOlB,CAAC,EAAE,CAAE;MACxF;IACJ,CAAC;IAED,MAAMsB,OAAO,GAAG,MAAAA,CAAO;MAAEC,IAAI;MAAEZ;IAAM,CAAC,KAAK;MACvC,MAAMvB,EAAE,GAAG5B,KAAK,CAACW,OAAO;MACxB,IAAI,CAACiB,EAAE,IAAIA,EAAE,CAACoC,cAAc,KAAK,QAAQ,EAAE;MAC3C,IAAI;QACA,MAAMpC,EAAE,CAACqC,oBAAoB,CAAC,IAAIC,qBAAqB,CAACf,KAAK,CAAC,CAAC;QAC/D,MAAMgB,MAAM,GAAG,MAAMvC,EAAE,CAACwC,YAAY,CAAC,CAAC;QACtC,MAAMxC,EAAE,CAACyB,mBAAmB,CAACc,MAAM,CAAC;QACpCtF,MAAM,CAACkE,IAAI,CAAC,aAAa,EAAE;UAAEjE,MAAM;UAAEkE,EAAE,EAAEe,IAAI;UAAEI;QAAO,CAAC,CAAC;QACxD,MAAMb,YAAY,CAAC,CAAC;MACxB,CAAC,CAAC,OAAOd,CAAC,EAAE;QAAEd,OAAO,CAACC,KAAK,CAAC,uBAAuB,EAAEa,CAAC,CAAC;MAAE;IAC7D,CAAC;IAED,MAAM6B,QAAQ,GAAG,MAAAA,CAAO;MAAEN,IAAI;MAAEI;IAAO,CAAC,KAAK;MACzC,MAAMvC,EAAE,GAAG5B,KAAK,CAACW,OAAO;MACxB,IAAI,CAACiB,EAAE,IAAIA,EAAE,CAACoC,cAAc,KAAK,kBAAkB,EAAE;MACrD,IAAI;QACA,MAAMpC,EAAE,CAACqC,oBAAoB,CAAC,IAAIC,qBAAqB,CAACC,MAAM,CAAC,CAAC;QAChE,MAAMb,YAAY,CAAC,CAAC;MACxB,CAAC,CAAC,OAAOd,CAAC,EAAE;QAAEd,OAAO,CAACC,KAAK,CAAC,wBAAwB,EAAEa,CAAC,CAAC;MAAE;IAC9D,CAAC;IAED,MAAM8B,WAAW,GAAG,MAAAA,CAAO;MAAEP,IAAI;MAAEjB;IAAU,CAAC,KAAK;MAAA,IAAAyB,qBAAA;MAC/C,MAAM3C,EAAE,GAAG5B,KAAK,CAACW,OAAO;MACxB,IAAI,CAACiB,EAAE,EAAE;MACT,KAAA2C,qBAAA,GAAI3C,EAAE,CAAC6B,iBAAiB,cAAAc,qBAAA,eAApBA,qBAAA,CAAsBC,IAAI,EAAE;QAC5B,IAAI;UAAE,MAAM5C,EAAE,CAACgC,eAAe,CAAC,IAAIC,eAAe,CAACf,SAAS,CAAC,CAAC;QAAE,CAAC,CAAC,OAAON,CAAC,EAAE,CAAE;MAClF,CAAC,MAAM;QACHnC,cAAc,CAACM,OAAO,CAAC8D,IAAI,CAAC3B,SAAS,CAAC;MAC1C;IACJ,CAAC;IAED,MAAM4B,KAAK,GAAGA,CAAA,KAAM;MAChBxB,eAAe,CAAC,CAAC;MACjBhE,OAAO,CAAC,CAAC;IACb,CAAC;IAEDL,MAAM,CAAC8F,EAAE,CAAC,YAAY,EAAEb,OAAO,CAAC;IAChCjF,MAAM,CAAC8F,EAAE,CAAC,aAAa,EAAEN,QAAQ,CAAC;IAClCxF,MAAM,CAAC8F,EAAE,CAAC,gBAAgB,EAAEL,WAAW,CAAC;IACxCzF,MAAM,CAAC8F,EAAE,CAAC,YAAY,EAAED,KAAK,CAAC;IAE9B,OAAO,MAAM;MACT7F,MAAM,CAAC+F,GAAG,CAAC,YAAY,EAAEd,OAAO,CAAC;MACjCjF,MAAM,CAAC+F,GAAG,CAAC,aAAa,EAAEP,QAAQ,CAAC;MACnCxF,MAAM,CAAC+F,GAAG,CAAC,gBAAgB,EAAEN,WAAW,CAAC;MACzCzF,MAAM,CAAC+F,GAAG,CAAC,YAAY,EAAEF,KAAK,CAAC;IACnC,CAAC;EACL,CAAC,EAAE,CAAC7F,MAAM,EAAEE,WAAW,EAAED,MAAM,EAAEI,OAAO,CAAC,CAAC;;EAE1C;EACA,MAAMgE,eAAe,GAAGA,CAAA,KAAM;IAC1B,IAAIlD,KAAK,CAACW,OAAO,EAAE;MAAEX,KAAK,CAACW,OAAO,CAACkE,KAAK,CAAC,CAAC;MAAE7E,KAAK,CAACW,OAAO,GAAG,IAAI;IAAE;IAClE,IAAIR,SAAS,CAACQ,OAAO,EAAE;MACnBR,SAAS,CAACQ,OAAO,CAACQ,SAAS,CAAC,CAAC,CAACC,OAAO,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;MACpDnB,SAAS,CAACQ,OAAO,GAAG,IAAI;IAC5B;IACA,IAAIP,SAAS,CAACO,OAAO,EAAE;MACnBP,SAAS,CAACO,OAAO,CAACQ,SAAS,CAAC,CAAC,CAACC,OAAO,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;MACpDlB,SAAS,CAACO,OAAO,GAAG,IAAI;IAC5B;IACAtB,cAAc,CAAC,IAAI,CAAC;IACpBE,eAAe,CAAC,IAAI,CAAC;IACrBQ,SAAS,CAAC,YAAY,CAAC;EAC3B,CAAC;EAED,MAAM+E,SAAS,GAAGA,CAAA,KAAM;IAAA,IAAAC,kBAAA;IACpB,MAAMjD,KAAK,IAAAiD,kBAAA,GAAG5E,SAAS,CAACQ,OAAO,cAAAoE,kBAAA,uBAAjBA,kBAAA,CAAmBC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;IACpD,IAAIlD,KAAK,EAAE;MAAEA,KAAK,CAACmD,OAAO,GAAG,CAACnD,KAAK,CAACmD,OAAO;MAAExF,eAAe,CAACqC,KAAK,CAACmD,OAAO,CAAC;IAAE;EACjF,CAAC;EAED,MAAMC,SAAS,GAAGA,CAAA,KAAM;IAAA,IAAAC,mBAAA;IACpB,MAAMrD,KAAK,IAAAqD,mBAAA,GAAGhF,SAAS,CAACQ,OAAO,cAAAwE,mBAAA,uBAAjBA,mBAAA,CAAmBC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC;IACpD,IAAItD,KAAK,EAAE;MAAEA,KAAK,CAACmD,OAAO,GAAG,CAACnD,KAAK,CAACmD,OAAO;MAAEtF,eAAe,CAACmC,KAAK,CAACmD,OAAO,CAAC;IAAE;EACjF,CAAC;EAED,MAAMI,WAAW,GAAGA,CAAA,KAAM;IACtBxG,MAAM,CAACkE,IAAI,CAAC,UAAU,EAAE;MAAEjE,MAAM;MAAEkE,EAAE,EAAEjE;IAAY,CAAC,CAAC;IACpD2F,KAAK,CAAC,CAAC,CAAC,CAAC;EACb,CAAC;EAED,MAAMY,eAAe,GAAGA,CAAA,KAAM;IAC1B,IAAItG,QAAQ,EAAEiE,iBAAiB,CAAC,CAAC,CAAC,KAC7BlD,SAAS,CAAC,kCAAkC,CAAC;EACtD,CAAC;EAED,oBACIpB,OAAA;IAAK4G,SAAS,EAAC,kGAAkG;IAAAC,QAAA,gBAE7G7G,OAAA;MAAK4G,SAAS,EAAC,wFAAwF;MAAAC,QAAA,gBAEnG7G,OAAA;QAAK4G,SAAS,EAAC,wHAAwH;QAAAC,QAAA,gBACnI7G,OAAA;UAAO8G,GAAG,EAAExF,aAAc;UAACyF,QAAQ;UAACC,KAAK;UAACC,WAAW;UAACL,SAAS,EAAC;QAA4B;UAAAM,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,EAC9F,CAACtG,YAAY,IAAI,CAACE,eAAe,iBAC9BjB,OAAA;UAAK4G,SAAS,EAAC,iFAAiF;UAAAC,QAAA,eAC5F7G,OAAA;YAAK4G,SAAS,EAAC,yIAAyI;YAAAC,QAAA,EACnJvG,QAAQ,CAAC,CAAC,CAAC,CAACgH,WAAW,CAAC;UAAC;YAAAJ,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACzB;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL,CACR,eACDrH,OAAA;UAAK4G,SAAS,EAAC,mIAAmI;UAAAC,QAAA,gBAC9I7G,OAAA;YAAM4G,SAAS,EAAC,gDAAgD;YAAAC,QAAA,GAAEvG,QAAQ,EAAC,QAAM;UAAA;YAAA4G,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC,EACvF,CAACxG,YAAY,iBAAIb,OAAA,CAACT,MAAM;YAACgI,IAAI,EAAE,EAAG;YAACX,SAAS,EAAC;UAAc;YAAAM,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC9D,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CAAC,eAGNrH,OAAA;QAAK4G,SAAS,EAAC,wHAAwH;QAAAC,QAAA,gBACnI7G,OAAA;UAAO8G,GAAG,EAAEvF,cAAe;UAACwF,QAAQ;UAACE,WAAW;UAACL,SAAS,EAAC,4BAA4B;UACnFY,KAAK,EAAE;YAAEC,OAAO,EAAE9G,YAAY,GAAG,CAAC,GAAG;UAAE;QAAE;UAAAuG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,EAC/C,CAAC1G,YAAY,iBACVX,OAAA;UAAK4G,SAAS,EAAC,sFAAsF;UAAAC,QAAA,gBACjG7G,OAAA;YAAK4G,SAAS,EAAC,UAAU;YAAAC,QAAA,gBACrB7G,OAAA;cAAK4G,SAAS,EAAC;YAAkE;cAAAM,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC,eACxFrH,OAAA;cAAK4G,SAAS,EAAC;YAAwG;cAAAM,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC7H,CAAC,eACNrH,OAAA;YAAG4G,SAAS,EAAC,iFAAiF;YAAAC,QAAA,EAAC;UAAmB;YAAAK,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAG,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACrH,CACR,eACDrH,OAAA;UAAK4G,SAAS,EAAC,mIAAmI;UAAAC,QAAA,eAC9I7G,OAAA;YAAM4G,SAAS,EAAC,gDAAgD;YAAAC,QAAA,EAAC;UAAkB;YAAAK,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzF,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,eAGNrH,OAAA;MAAK4G,SAAS,EAAC,4GAA4G;MAAAC,QAAA,eACvH7G,OAAA;QAAK4G,SAAS,EAAC,kHAAkH;QAAAC,QAAA,gBAC7H7G,OAAA;UAAQ0H,OAAO,EAAEvB,SAAU;UAACS,SAAS,EAAE,+CAA+C/F,YAAY,GAAG,4CAA4C,GAAG,+EAA+E,EAAG;UAAAgG,QAAA,EACjOhG,YAAY,gBAAGb,OAAA,CAACV,GAAG;YAACiI,IAAI,EAAE;UAAG;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,gBAAGrH,OAAA,CAACT,MAAM;YAACgI,IAAI,EAAE;UAAG;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACpD,CAAC,eAETrH,OAAA;UAAQ0H,OAAO,EAAEnB,SAAU;UAACK,SAAS,EAAE,+CAA+C7F,YAAY,GAAG,4CAA4C,GAAG,+EAA+E,EAAG;UAAA8F,QAAA,EACjO9F,YAAY,gBAAGf,OAAA,CAACR,KAAK;YAAC+H,IAAI,EAAE;UAAG;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,gBAAGrH,OAAA,CAACP,QAAQ;YAAC8H,IAAI,EAAE;UAAG;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxD,CAAC,eAETrH,OAAA;UAAQ0H,OAAO,EAAEf,eAAgB;UAACC,SAAS,EAAC,iGAAiG;UAACe,KAAK,EAAC,WAAW;UAAAd,QAAA,eAC3J7G,OAAA,CAACH,UAAU;YAAC0H,IAAI,EAAE,EAAG;YAACX,SAAS,EAAC;UAA8C;YAAAM,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7E,CAAC,eAETrH,OAAA;UAAK4G,SAAS,EAAC;QAA4B;UAAAM,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eAElDrH,OAAA;UAAQ0H,OAAO,EAAEhB,WAAY;UAACE,SAAS,EAAC,2IAA2I;UAAAC,QAAA,eAC/K7G,OAAA,CAACN,QAAQ;YAAC6H,IAAI,EAAE;UAAG;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClB,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACR;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,eAGNrH,OAAA;MAAK4G,SAAS,EAAC,2JAA2J;MAAAC,QAAA,gBACtK7G,OAAA;QAAK4G,SAAS,EAAE,8EAA8EzF,MAAM,KAAK,WAAW,GAAG,gBAAgB,GAAG,cAAc;MAAG;QAAA+F,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC,eAClKrH,OAAA;QAAM4G,SAAS,EAAC,yEAAyE;QAAAC,QAAA,EAAE1F;MAAM;QAAA+F,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAO,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACxG,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEd,CAAC;AAAC7G,EAAA,CA9RIP,aAAa;AAAA2H,EAAA,GAAb3H,aAAa;AAgSnB,eAAeA,aAAa;AAAC,IAAA2H,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}