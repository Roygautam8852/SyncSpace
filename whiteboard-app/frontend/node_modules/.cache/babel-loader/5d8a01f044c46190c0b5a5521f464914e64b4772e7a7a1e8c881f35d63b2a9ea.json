{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\pages\\\\WhiteboardRoom.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useSocket } from \"../context/SocketContext\";\nimport { roomService } from \"../services/api\";\nimport Toolbar from \"../components/Toolbar\";\nimport Chat from \"../components/Chat\";\nimport StylingPanel from \"../components/StylingPanel\";\nimport toast from \"react-hot-toast\";\nimport { Plus, Minus, Save, FilePlus, ChevronRight, MessageCircle, Users, X, Share2, Download, Palette, Type, Sliders, ChevronDown, Edit2, Check, Video, Monitor, Copy, Sun, Moon, StickyNote, ImagePlus } from \"lucide-react\";\nimport WebRTCMeeting from \"../components/video/WebRTCMeeting\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WhiteboardRoom = () => {\n  _s();\n  var _room$host, _room$host2;\n  const {\n    roomId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth();\n  const {\n    socket\n  } = useSocket();\n  const canvasRef = useRef(null);\n  const viewportRef = useRef(null);\n  const contextRef = useRef(null);\n\n  // Tools & Styling\n  const [tool, setTool] = useState(\"pencil\");\n  const [showStyling, setShowStyling] = useState(true);\n  const [color, setColor] = useState(\"#000000\");\n  const [size, setSize] = useState(4);\n  const [opacity, setOpacity] = useState(1);\n  const [strokeStyle, setStrokeStyle] = useState('solid');\n  const [fill, setFill] = useState(false);\n  const [canvasBackground, setCanvasBackground] = useState('dots');\n  const [darkMode, setDarkMode] = useState(false);\n\n  // Sync dark mode to <body> (for portalled flyouts) + auto-switch pen color\n  useEffect(() => {\n    if (darkMode) {\n      document.body.classList.add('wb-dark-active');\n      // Auto switch black â†’ white so strokes are visible on dark canvas\n      if (color === '#000000') setColor('#ffffff');\n    } else {\n      document.body.classList.remove('wb-dark-active');\n      // Auto switch white â†’ black for light canvas\n      if (color === '#ffffff') setColor('#000000');\n    }\n    return () => document.body.classList.remove('wb-dark-active');\n  }, [darkMode]);\n\n  // Camera / Infinite Canvas\n  const [cameraScale, setCameraScale] = useState(1);\n  const [cameraOffset, setCameraOffset] = useState({\n    x: -4000 + window.innerWidth / 2,\n    y: -4000 + window.innerHeight / 2\n  });\n  const cameraScaleRef = useRef(1);\n  const cameraOffsetRef = useRef({\n    x: -4000 + window.innerWidth / 2,\n    y: -4000 + window.innerHeight / 2\n  });\n  const isPanningRef = useRef(false);\n  const panStartRef = useRef({\n    x: 0,\n    y: 0\n  });\n\n  // â”€â”€â”€ STROKE-BASED ARCHITECTURE (Source of Truth) â”€â”€â”€\n  const strokesRef = useRef([]); // Performance ref â€” authoritative source\n  const [strokesVersion, setStrokesVersion] = useState(0); // Trigger re-render when needed\n\n  // Performance Refs for Drawing\n  const isDrawingRef = useRef(false);\n  const currentPointsRef = useRef([]);\n  const startPosRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const lastPosRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const snapshotCanvasRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  const lastCursorEmitRef = useRef(0);\n  const imageFileRef = useRef(null);\n  const importImageRef = useRef(null);\n  const imagePlacePosRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const imageCache = useRef(new Map());\n\n  // Undo/Redo history (stroke snapshots)\n  const historyRef = useRef([]);\n  const historyIndexRef = useRef(-1);\n\n  // Room State\n  const [room, setRoom] = useState(null);\n  const [participants, setParticipants] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [sharedFiles, setSharedFiles] = useState([]);\n  const [activeTab, setActiveTab] = useState(\"chat\");\n  const [loadingFileUpload, setLoadingFileUpload] = useState(false);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false); // Hidden by default\n  const [remoteCursors, setRemoteCursors] = useState({});\n  const [typingUsers, setTypingUsers] = useState([]);\n  // Zoom-like group call state\n  const [inCall, setInCall] = useState(false); // Am I currently in the call?\n  const [activeCallInfo, setActiveCallInfo] = useState({\n    active: false,\n    participants: []\n  }); // Room-level call status\n\n  const handleJoinCall = useCallback(() => {\n    setInCall(true);\n  }, []);\n  const handleLeaveCall = useCallback(() => {\n    setInCall(false);\n  }, []);\n\n  // Multi-page state\n  const [pages, setPages] = useState([]);\n  const [activePageId, setActivePageId] = useState(\"\");\n\n  // Dropdown states\n  const [activeDropdown, setActiveDropdown] = useState(null);\n  const [isEditingName, setIsEditingName] = useState(false);\n  const [tempBoardName, setTempBoardName] = useState(\"\");\n  const colors = [\"#000000\", \"#374151\", \"#6b7280\", \"#9ca3af\", \"#ffffff\", \"#dc2626\", \"#ea580c\", \"#d97706\", \"#ca8a04\", \"#65a30d\", \"#16a34a\", \"#0d9488\", \"#0891b2\", \"#0284c7\", \"#2563eb\", \"#4f46e5\", \"#7c3aed\", \"#9333ea\", \"#c026d3\", \"#db2777\"];\n  const isDrawingTool = [\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\", \"precision-eraser\", \"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\", \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\", \"cylinder\", \"document\", \"cloud\"].includes(tool);\n  const canvasCursor = {\n    select: 'default',\n    pan: 'grab',\n    eraser: 'cell',\n    'precision-eraser': 'cell',\n    text: 'text',\n    upload: 'copy'\n  }[tool] || 'crosshair';\n  const handleToolChange = newTool => {\n    if (tool === newTool) {\n      setShowStyling(!showStyling);\n    } else {\n      setTool(newTool);\n      setShowStyling(true);\n    }\n  };\n  const interactionRef = useRef({\n    type: null,\n    // 'move' or 'resize'\n    strokeId: null,\n    startPos: {\n      x: 0,\n      y: 0\n    },\n    originalPoints: [],\n    originalImgW: 0,\n    originalImgH: 0\n  });\n\n  // â”€â”€â”€ STROKE HELPERS â”€â”€â”€\n  const setStrokes = useCallback(newStrokes => {\n    if (typeof newStrokes === 'function') {\n      strokesRef.current = newStrokes(strokesRef.current);\n    } else {\n      strokesRef.current = newStrokes;\n    }\n    setStrokesVersion(v => v + 1);\n  }, []);\n  const pushToHistory = useCallback(() => {\n    const snapshot = JSON.parse(JSON.stringify(strokesRef.current));\n    historyRef.current = historyRef.current.slice(0, historyIndexRef.current + 1);\n    historyRef.current.push(snapshot);\n    historyIndexRef.current = historyRef.current.length - 1;\n  }, []);\n\n  // â”€â”€â”€ SOCKET SETUP â”€â”€â”€\n  useEffect(() => {\n    const fetchRoomDetails = async () => {\n      try {\n        const res = await roomService.getRoom(roomId);\n        setRoom(res.data.room);\n        setTempBoardName(res.data.room.roomName || \"Untitled Board\");\n        setSharedFiles(res.data.room.sharedFiles || []);\n      } catch (err) {\n        toast.error(\"Failed to load workspace\");\n        navigate(\"/dashboard\");\n      }\n    };\n    fetchRoomDetails();\n    if (socket) {\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user._id,\n        userName: user.name\n      });\n      socket.on(\"user-joined\", data => toast.success(`${data.userName} joined`));\n      socket.on(\"online-users\", users => setParticipants(users));\n      socket.on(\"chat-message\", msg => setMessages(prev => [...prev, msg]));\n      socket.on(\"chat-history\", h => setMessages(h));\n      socket.on(\"drawing\", data => drawRemote(data));\n      socket.on(\"erase\", data => eraseRemote(data));\n      socket.on(\"board-cleared\", () => {\n        strokesRef.current = [];\n        historyRef.current = [[]];\n        historyIndexRef.current = 0;\n        setStrokesVersion(v => v + 1);\n        redrawCanvas();\n      });\n\n      // â”€â”€â”€ CANVAS STATE (strokes are the ONLY source of truth) â”€â”€â”€\n      socket.on(\"canvas-state\", data => {\n        if (data) {\n          const loadedStrokes = data.strokes && data.strokes.length > 0 ? data.strokes : [];\n          strokesRef.current = loadedStrokes;\n          setStrokesVersion(v => v + 1);\n          historyRef.current = [JSON.parse(JSON.stringify(loadedStrokes))];\n          historyIndexRef.current = 0;\n\n          // Pages\n          if (data.pages) setPages(data.pages);\n          if (data.pageId) setActivePageId(data.pageId);\n          requestAnimationFrame(() => redrawCanvas());\n        }\n      });\n      socket.on(\"new-stroke\", stroke => {\n        strokesRef.current = [...strokesRef.current, stroke];\n        setStrokesVersion(v => v + 1);\n        redrawCanvas();\n      });\n      socket.on(\"update-stroke\", updatedStroke => {\n        strokesRef.current = strokesRef.current.map(s => s.id === updatedStroke.id ? updatedStroke : s);\n        setStrokesVersion(v => v + 1);\n        redrawCanvas();\n      });\n      socket.on(\"erase-stroke\", ({\n        strokeId\n      }) => {\n        strokesRef.current = strokesRef.current.filter(s => s.id !== strokeId);\n        setStrokesVersion(v => v + 1);\n        redrawCanvas();\n      });\n      socket.on(\"board-state-updated\", updatedStrokes => {\n        strokesRef.current = updatedStrokes;\n        setStrokesVersion(v => v + 1);\n        redrawCanvas();\n      });\n      socket.on(\"new-file\", file => setSharedFiles(prev => [...prev, file]));\n      socket.on(\"user-left\", data => toast(`ðŸ‘‹ ${data.userName} left`));\n      socket.on(\"cursor-move\", data => {\n        setRemoteCursors(prev => ({\n          ...prev,\n          [data.socketId]: data\n        }));\n        setTimeout(() => setRemoteCursors(prev => {\n          const n = {\n            ...prev\n          };\n          delete n[data.socketId];\n          return n;\n        }), 3000);\n      });\n\n      // Typing indicators\n      socket.on(\"typing-start\", ({\n        userName,\n        socketId\n      }) => {\n        setTypingUsers(prev => {\n          if (prev.find(u => u.socketId === socketId)) return prev;\n          return [...prev, {\n            userName,\n            socketId\n          }];\n        });\n      });\n      socket.on(\"typing-stop\", ({\n        socketId\n      }) => {\n        setTypingUsers(prev => prev.filter(u => u.socketId !== socketId));\n      });\n\n      // Room-level active call status\n      socket.on(\"call:active\", data => {\n        setActiveCallInfo(data);\n      });\n\n      // Page events\n      socket.on(\"page-added\", data => {\n        setPages(data.pages);\n        setActivePageId(data.pageId);\n        strokesRef.current = [];\n        setStrokesVersion(v => v + 1);\n        historyRef.current = [[]];\n        historyIndexRef.current = 0;\n        redrawCanvas();\n      });\n      socket.on(\"page-switched\", data => {\n        setActivePageId(data.pageId);\n        strokesRef.current = data.strokes || [];\n        setStrokesVersion(v => v + 1);\n        historyRef.current = [JSON.parse(JSON.stringify(data.strokes || []))];\n        historyIndexRef.current = 0;\n        redrawCanvas();\n      });\n      socket.on(\"page-deleted\", data => {\n        setPages(data.pages);\n        if (data.activePageId !== activePageId) {\n          setActivePageId(data.activePageId);\n          strokesRef.current = data.strokes || [];\n          setStrokesVersion(v => v + 1);\n          historyRef.current = [JSON.parse(JSON.stringify(data.strokes || []))];\n          historyIndexRef.current = 0;\n          redrawCanvas();\n        }\n        toast.success(\"Page deleted\");\n      });\n      socket.on(\"board-saved\", ({\n        pageId\n      }) => {\n        toast.success(\"Board saved!\");\n      });\n\n      // Undo/Redo from remote\n      socket.on(\"undo\", () => {/* Remote undo handled via board-state-updated */});\n      socket.on(\"redo\", () => {/* Remote redo handled via board-state-updated */});\n    }\n    return () => {\n      if (socket) {\n        socket.emit(\"leave-room\", {\n          roomId,\n          userId: user._id,\n          userName: user.name\n        });\n        [\"user-joined\", \"online-users\", \"chat-message\", \"chat-history\", \"drawing\", \"erase\", \"board-cleared\", \"canvas-state\", \"undo\", \"redo\", \"user-left\", \"new-stroke\", \"board-state-updated\", \"new-file\", \"cursor-move\", \"typing-start\", \"typing-stop\", \"page-added\", \"page-switched\", \"board-saved\", \"page-deleted\", \"call:active\"].forEach(ev => socket.off(ev));\n      }\n    };\n  }, [roomId, socket, user, navigate]);\n\n  // â”€â”€â”€ CANVAS SETUP â”€â”€â”€\n  useEffect(() => {\n    const viewport = viewportRef.current;\n    const canvas = canvasRef.current;\n    if (!viewport || !canvas) return;\n    const updateCanvasSize = () => {\n      const dpr = window.devicePixelRatio || 1;\n      canvas.width = viewport.clientWidth * dpr;\n      canvas.height = viewport.clientHeight * dpr;\n      const context = canvas.getContext(\"2d\", {\n        alpha: true\n      });\n      if (context) {\n        context.lineCap = \"round\";\n        context.lineJoin = \"round\";\n        contextRef.current = context;\n      }\n      if (!snapshotCanvasRef.current) {\n        snapshotCanvasRef.current = document.createElement('canvas');\n      }\n      snapshotCanvasRef.current.width = canvas.width;\n      snapshotCanvasRef.current.height = canvas.height;\n      redrawCanvas();\n    };\n    const ro = new ResizeObserver(() => updateCanvasSize());\n    ro.observe(viewport);\n    return () => ro.disconnect();\n  }, []);\n\n  // Redraw when strokes change\n  useEffect(() => {\n    redrawCanvas();\n  }, [strokesVersion]);\n\n  // â”€â”€â”€ ZOOM â”€â”€â”€\n  useEffect(() => {\n    const handleZoomIn = () => updateZoom(1.1);\n    const handleZoomOut = () => updateZoom(1 / 1.1);\n    const handleResetZoom = () => {\n      cameraScaleRef.current = 1;\n      cameraOffsetRef.current = {\n        x: -4000 + window.innerWidth / 2,\n        y: -4000 + window.innerHeight / 2\n      };\n      setCameraScale(1);\n      setCameraOffset(cameraOffsetRef.current);\n      syncViewDOM();\n    };\n    window.addEventListener('wb-zoom-in', handleZoomIn);\n    window.addEventListener('wb-zoom-out', handleZoomOut);\n    window.addEventListener('wb-reset-view', handleResetZoom);\n    return () => {\n      window.removeEventListener('wb-zoom-in', handleZoomIn);\n      window.removeEventListener('wb-zoom-out', handleZoomOut);\n      window.removeEventListener('wb-reset-view', handleResetZoom);\n    };\n  }, []);\n  useEffect(() => {\n    const viewport = viewportRef.current;\n    if (!viewport) return;\n    const handleWheel = e => {\n      e.preventDefault();\n      if (e.ctrlKey) {\n        const zoomSpeed = 0.0012;\n        const delta = -e.deltaY * zoomSpeed * cameraScaleRef.current;\n        const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current + delta));\n        const rect = viewport.getBoundingClientRect();\n        const mouseX = e.clientX - rect.left;\n        const mouseY = e.clientY - rect.top;\n        const worldX = (mouseX - cameraOffsetRef.current.x) / cameraScaleRef.current;\n        const worldY = (mouseY - cameraOffsetRef.current.y) / cameraScaleRef.current;\n        cameraScaleRef.current = newScale;\n        cameraOffsetRef.current = {\n          x: mouseX - worldX * newScale,\n          y: mouseY - worldY * newScale\n        };\n        setCameraScale(newScale);\n        setCameraOffset(cameraOffsetRef.current);\n        syncViewDOM();\n      } else {\n        cameraOffsetRef.current = {\n          x: cameraOffsetRef.current.x - e.deltaX,\n          y: cameraOffsetRef.current.y - e.deltaY\n        };\n        syncViewDOM();\n        setCameraOffset(cameraOffsetRef.current);\n      }\n    };\n    viewport.addEventListener('wheel', handleWheel, {\n      passive: false\n    });\n    return () => viewport.removeEventListener('wheel', handleWheel);\n  }, []);\n  const updateZoom = factor => {\n    const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current * factor));\n    const centerX = window.innerWidth / 2;\n    const centerY = window.innerHeight / 2;\n    const worldX = (centerX - cameraOffsetRef.current.x) / cameraScaleRef.current;\n    const worldY = (centerY - cameraOffsetRef.current.y) / cameraScaleRef.current;\n    cameraScaleRef.current = newScale;\n    cameraOffsetRef.current = {\n      x: centerX - worldX * newScale,\n      y: centerY - worldY * newScale\n    };\n    setCameraScale(newScale);\n    setCameraOffset(cameraOffsetRef.current);\n    syncViewDOM();\n  };\n  const syncViewDOM = () => {\n    if (viewportRef.current) {\n      const ox = cameraOffsetRef.current.x;\n      const oy = cameraOffsetRef.current.y;\n      // Only update position â€” React handles backgroundImage & backgroundSize via inline styles\n      viewportRef.current.style.backgroundPosition = `${ox}px ${oy}px`;\n    }\n    redrawCanvas();\n  };\n\n  // â”€â”€â”€ CANVAS RENDERING (Pure stroke-based, no bitmap ghosts) â”€â”€â”€\n  const redrawCanvas = useCallback(() => {\n    const canvas = canvasRef.current;\n    const ctx = contextRef.current;\n    if (!canvas || !ctx) return;\n    const dpr = window.devicePixelRatio || 1;\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Apply Camera Transform\n    ctx.setTransform(cameraScaleRef.current * dpr, 0, 0, cameraScaleRef.current * dpr, cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr);\n\n    // Render all strokes â€” strokes are the ONLY source of truth\n    strokesRef.current.forEach(stroke => renderStroke(ctx, stroke));\n  }, []);\n  const renderStroke = (ctx, stroke) => {\n    const {\n      type,\n      points,\n      color,\n      size,\n      opacity,\n      strokeStyle,\n      fill\n    } = stroke;\n    if (type === 'text') {\n      ctx.save();\n      ctx.font = `bold ${size}px Inter, sans-serif`;\n      ctx.fillStyle = color;\n      ctx.globalAlpha = opacity;\n      ctx.globalCompositeOperation = \"source-over\";\n      ctx.shadowBlur = 0;\n      ctx.fillText(stroke.text || '', points[0].x, points[0].y);\n      ctx.restore();\n      return;\n    }\n    if (type === 'image') {\n      const cached = imageCache.current.get(stroke.src);\n      if (cached) {\n        ctx.save();\n        ctx.globalAlpha = stroke.opacity || 1;\n        ctx.drawImage(cached, points[0].x, points[0].y, stroke.imgW || 300, stroke.imgH || 200);\n        ctx.restore();\n      } else {\n        const img = new window.Image();\n        img.onload = () => {\n          imageCache.current.set(stroke.src, img);\n          redrawCanvas();\n        };\n        img.src = stroke.src;\n      }\n      return;\n    }\n    ctx.save();\n    if (type === 'eraser-precision' || type === 'mask') {\n      ctx.globalCompositeOperation = \"destination-out\";\n    } else {\n      ctx.globalCompositeOperation = \"source-over\";\n      ctx.globalAlpha = opacity;\n      ctx.strokeStyle = color;\n      ctx.fillStyle = color;\n      ctx.lineWidth = size;\n      ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\n      if (type === 'soft-brush') {\n        ctx.shadowBlur = size / 2;\n        ctx.shadowColor = color;\n      }\n      if (type === 'marker') {\n        ctx.globalAlpha = opacity * 0.6;\n      }\n    }\n    if (['pencil', 'highlighter', 'soft-brush', 'marker', 'smooth-pencil', 'eraser-precision'].includes(type)) {\n      if (points.length < 2) {\n        ctx.restore();\n        return;\n      }\n      ctx.beginPath();\n      ctx.moveTo(points[0].x, points[0].y);\n      for (let i = 1; i < points.length; i++) ctx.lineTo(points[i].x, points[i].y);\n      ctx.stroke();\n    } else {\n      drawShape(ctx, type, points, {\n        color,\n        size,\n        opacity,\n        strokeStyle,\n        fill\n      });\n    }\n    ctx.restore();\n  };\n  const drawShape = (ctx, type, points, style) => {\n    const start = points[0];\n    const end = points[points.length - 1];\n    const w = end.x - start.x;\n    const h = end.y - start.y;\n    if (type === 'rect') {\n      if (style.fill) ctx.fillRect(start.x, start.y, w, h);\n      ctx.strokeRect(start.x, start.y, w, h);\n    } else if (type === 'rounded-rect') {\n      ctx.beginPath();\n      ctx.roundRect(start.x, start.y, w, h, Math.min(Math.abs(w), Math.abs(h)) * 0.2);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'circle' || type === 'ellipse') {\n      ctx.beginPath();\n      if (type === 'circle') {\n        const radius = Math.sqrt(w * w + h * h);\n        ctx.arc(start.x, start.y, radius, 0, 2 * Math.PI);\n      } else {\n        ctx.ellipse(start.x + w / 2, start.y + h / 2, Math.abs(w / 2), Math.abs(h / 2), 0, 0, 2 * Math.PI);\n      }\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'triangle') {\n      ctx.beginPath();\n      ctx.moveTo(start.x + w / 2, start.y);\n      ctx.lineTo(end.x, end.y);\n      ctx.lineTo(start.x, end.y);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'diamond') {\n      ctx.beginPath();\n      ctx.moveTo(start.x + w / 2, start.y);\n      ctx.lineTo(end.x, start.y + h / 2);\n      ctx.lineTo(start.x + w / 2, end.y);\n      ctx.lineTo(start.x, start.y + h / 2);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'line' || type === 'arrow' || type === 'double-arrow') {\n      ctx.beginPath();\n      ctx.moveTo(start.x, start.y);\n      ctx.lineTo(end.x, end.y);\n      ctx.stroke();\n      if (type === 'arrow' || type === 'double-arrow') drawArrowHead(ctx, start.x, start.y, end.x, end.y, style.size);\n      if (type === 'double-arrow') drawArrowHead(ctx, end.x, end.y, start.x, start.y, style.size);\n    } else if (type === 'sticky') {\n      ctx.save();\n      ctx.fillStyle = style.fill ? style.color : \"#fef08a\";\n      ctx.shadowBlur = 10;\n      ctx.shadowColor = \"rgba(0,0,0,0.1)\";\n      ctx.fillRect(start.x, start.y, w, h);\n      ctx.strokeStyle = \"rgba(0,0,0,0.05)\";\n      ctx.strokeRect(start.x, start.y, w, h);\n      ctx.restore();\n    } else if (type === 'speech-bubble') {\n      ctx.beginPath();\n      ctx.roundRect(start.x, start.y, w, h * 0.8, 10);\n      ctx.moveTo(start.x + w * 0.2, start.y + h * 0.8);\n      ctx.lineTo(start.x + w * 0.1, end.y);\n      ctx.lineTo(start.x + w * 0.4, start.y + h * 0.8);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'parallelogram') {\n      const shift = w * 0.2;\n      ctx.beginPath();\n      ctx.moveTo(start.x + shift, start.y);\n      ctx.lineTo(end.x, start.y);\n      ctx.lineTo(end.x - shift, end.y);\n      ctx.lineTo(start.x, end.y);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'cylinder') {\n      const ry = Math.abs(h * 0.1);\n      ctx.beginPath();\n      ctx.ellipse(start.x + w / 2, end.y - ry, Math.abs(w / 2), ry, 0, 0, Math.PI, false);\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.moveTo(start.x, start.y + ry);\n      ctx.lineTo(start.x, end.y - ry);\n      ctx.moveTo(end.x, start.y + ry);\n      ctx.lineTo(end.x, end.y - ry);\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.ellipse(start.x + w / 2, start.y + ry, Math.abs(w / 2), ry, 0, 0, 2 * Math.PI);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'document') {\n      const fold = Math.min(w, h) * 0.2;\n      ctx.beginPath();\n      ctx.moveTo(start.x, start.y);\n      ctx.lineTo(end.x - fold, start.y);\n      ctx.lineTo(end.x, start.y + fold);\n      ctx.lineTo(end.x, end.y);\n      ctx.lineTo(start.x, end.y);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n      ctx.beginPath();\n      ctx.moveTo(end.x - fold, start.y);\n      ctx.lineTo(end.x - fold, start.y + fold);\n      ctx.lineTo(end.x, start.y + fold);\n      ctx.stroke();\n    } else if (type === 'cloud') {\n      ctx.beginPath();\n      const mw = start.x + w / 2;\n      const mh = start.y + h / 2;\n      ctx.arc(mw - w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      ctx.arc(mw + w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      ctx.arc(mw, mh - h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      ctx.arc(mw, mh + h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    }\n  };\n  const drawArrowHead = (ctx, fromx, fromy, tox, toy, weight) => {\n    const headlen = weight * 4;\n    const angle = Math.atan2(toy - fromy, tox - fromx);\n    ctx.save();\n    ctx.translate(tox, toy);\n    ctx.rotate(angle);\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(-headlen, -headlen / 2);\n    ctx.lineTo(-headlen, headlen / 2);\n    ctx.closePath();\n    ctx.fill();\n    ctx.restore();\n  };\n  const getMousePos = e => {\n    const viewport = viewportRef.current;\n    if (!viewport) return {\n      x: 0,\n      y: 0\n    };\n    const rect = viewport.getBoundingClientRect();\n    return {\n      x: (e.clientX - rect.left - cameraOffsetRef.current.x) / cameraScaleRef.current,\n      y: (e.clientY - rect.top - cameraOffsetRef.current.y) / cameraScaleRef.current\n    };\n  };\n\n  // â”€â”€â”€ ERASER: Stroke removal (no ghost rendering) â”€â”€â”€\n  const eraseObjectAt = pos => {\n    const threshold = 15;\n    const newStrokes = strokesRef.current.filter(stroke => {\n      return !stroke.points.some(p => {\n        const dist = Math.sqrt(Math.pow(p.x - pos.x, 2) + Math.pow(p.y - pos.y, 2));\n        return dist < threshold;\n      });\n    });\n    if (newStrokes.length !== strokesRef.current.length) {\n      strokesRef.current = newStrokes;\n      setStrokesVersion(v => v + 1);\n      redrawCanvas();\n      // Sync erased state to all clients and DB\n      socket.emit(\"update-board-state\", {\n        roomId,\n        strokes: newStrokes,\n        pageId: activePageId\n      });\n    }\n  };\n\n  // â”€â”€â”€ DRAWING â”€â”€â”€\n  const startDrawing = e => {\n    if (e.button === 1 || tool === 'pan') {\n      isPanningRef.current = true;\n      panStartRef.current = {\n        x: e.clientX - cameraOffsetRef.current.x,\n        y: e.clientY - cameraOffsetRef.current.y\n      };\n      return;\n    }\n    const canvas = canvasRef.current;\n    if (!canvas || !contextRef.current) return;\n    const pos = getMousePos(e);\n    if (tool === 'select') return;\n    if (tool === 'upload') {\n      var _imageFileRef$current;\n      imagePlacePosRef.current = pos;\n      (_imageFileRef$current = imageFileRef.current) === null || _imageFileRef$current === void 0 ? void 0 : _imageFileRef$current.click();\n      return;\n    }\n    if (tool === 'eraser') {\n      eraseObjectAt(pos);\n      return;\n    }\n    if (tool === 'text') {\n      const textInput = prompt('Enter text:');\n      if (!textInput) return;\n      const textStroke = {\n        id: Date.now() + Math.random(),\n        type: 'text',\n        text: textInput,\n        points: [pos],\n        color,\n        size: size * 4,\n        opacity,\n        strokeStyle,\n        fill\n      };\n      strokesRef.current = [...strokesRef.current, textStroke];\n      setStrokesVersion(v => v + 1);\n      pushToHistory();\n      socket.emit('new-stroke', {\n        roomId,\n        stroke: textStroke,\n        pageId: activePageId\n      });\n      redrawCanvas();\n      return;\n    }\n    isDrawingRef.current = true;\n    currentPointsRef.current = [pos];\n    startPosRef.current = pos;\n    lastPosRef.current = pos;\n\n    // Take snapshot for shape preview\n    const snapCtx = snapshotCanvasRef.current.getContext('2d');\n    snapCtx.setTransform(1, 0, 0, 1, 0, 0);\n    snapCtx.clearRect(0, 0, canvas.width, canvas.height);\n    snapCtx.drawImage(canvas, 0, 0);\n    if (isDrawingTool) {\n      const ctx = contextRef.current;\n      const dpr = window.devicePixelRatio || 1;\n      ctx.setTransform(cameraScaleRef.current * dpr, 0, 0, cameraScaleRef.current * dpr, cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr);\n      ctx.beginPath();\n      ctx.moveTo(pos.x, pos.y);\n      ctx.lineWidth = size;\n      ctx.strokeStyle = color;\n      ctx.globalAlpha = tool === \"highlighter\" ? opacity * 0.4 : tool === \"marker\" ? opacity * 0.6 : opacity;\n      ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\n      ctx.lineCap = \"round\";\n      ctx.lineJoin = \"round\";\n      ctx.globalCompositeOperation = tool === \"precision-eraser\" ? \"destination-out\" : \"source-over\";\n      ctx.shadowBlur = 0;\n    }\n  };\n  const handleMouseMove = e => {\n    const now = Date.now();\n    if (socket && now - lastCursorEmitRef.current > 50) {\n      lastCursorEmitRef.current = now;\n      socket.emit('cursor-move', {\n        roomId,\n        cursorData: {\n          x: e.clientX,\n          y: e.clientY,\n          userName: user.name,\n          color\n        }\n      });\n    }\n    if (isPanningRef.current) {\n      cameraOffsetRef.current = {\n        x: e.clientX - panStartRef.current.x,\n        y: e.clientY - panStartRef.current.y\n      };\n      syncViewDOM();\n      return;\n    }\n    if (isDrawingRef.current) {\n      if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\n      const clientX = e.clientX;\n      const clientY = e.clientY;\n      const shiftKey = e.shiftKey;\n      animationFrameRef.current = requestAnimationFrame(() => draw({\n        clientX,\n        clientY,\n        shiftKey\n      }));\n    } else if (interactionRef.current.type) {\n      const pos = getMousePos(e);\n      const dx = pos.x - interactionRef.current.startPos.x;\n      const dy = pos.y - interactionRef.current.startPos.y;\n      const strokeId = interactionRef.current.strokeId;\n      const newStrokes = strokesRef.current.map(s => {\n        if (s.id !== strokeId) return s;\n        if (interactionRef.current.type === 'move') {\n          const newPoints = interactionRef.current.originalPoints.map(p => ({\n            x: p.x + dx,\n            y: p.y + dy\n          }));\n          return {\n            ...s,\n            points: newPoints\n          };\n        } else if (interactionRef.current.type === 'resize') {\n          if (s.type === 'image') {\n            return {\n              ...s,\n              imgW: Math.max(50, interactionRef.current.originalImgW + dx),\n              imgH: Math.max(50, interactionRef.current.originalImgH + dy)\n            };\n          } else if (s.type === 'sticky') {\n            const start = interactionRef.current.originalPoints[0];\n            const newEnd = {\n              x: Math.max(start.x + 50, interactionRef.current.originalPoints[1].x + dx),\n              y: Math.max(start.y + 50, interactionRef.current.originalPoints[1].y + dy)\n            };\n            return {\n              ...s,\n              points: [start, newEnd]\n            };\n          }\n        }\n        return s;\n      });\n      strokesRef.current = newStrokes;\n      setStrokesVersion(v => v + 1);\n      redrawCanvas();\n\n      // Emit update to others\n      const updatedStroke = strokesRef.current.find(s => s.id === strokeId);\n      if (socket && updatedStroke) {\n        socket.emit('update-stroke', {\n          roomId,\n          stroke: updatedStroke,\n          pageId: activePageId\n        });\n      }\n    } else if (tool === 'eraser' && e.buttons === 1) {\n      eraseObjectAt(getMousePos(e));\n    }\n  };\n  const draw = e => {\n    if (!isDrawingRef.current || !contextRef.current) return;\n    const pos = getMousePos(e);\n    let currentPos = pos;\n    if (tool === 'smooth-pencil' && currentPointsRef.current.length > 0) {\n      const lastPoint = currentPointsRef.current[currentPointsRef.current.length - 1];\n      currentPos = {\n        x: lastPoint.x * 0.8 + pos.x * 0.2,\n        y: lastPoint.y * 0.8 + pos.y * 0.2,\n        shiftKey: e.shiftKey\n      };\n    } else {\n      currentPos = {\n        ...pos,\n        shiftKey: e.shiftKey\n      };\n    }\n    currentPointsRef.current.push(currentPos);\n    const ctx = contextRef.current;\n    if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\", \"precision-eraser\"].includes(tool)) {\n      if (e.shiftKey) {\n        redrawCanvas();\n        ctx.beginPath();\n        ctx.moveTo(startPosRef.current.x, startPosRef.current.y);\n        ctx.lineTo(currentPos.x, currentPos.y);\n        ctx.stroke();\n        return;\n      }\n      ctx.lineTo(currentPos.x, currentPos.y);\n      ctx.stroke();\n\n      // Throttled emit for real-time collab\n      socket.emit(\"drawing\", {\n        roomId,\n        drawingData: {\n          x: currentPos.x,\n          y: currentPos.y,\n          prevX: lastPosRef.current.x,\n          prevY: lastPosRef.current.y,\n          color,\n          size,\n          opacity: ctx.globalAlpha,\n          tool\n        }\n      });\n      lastPosRef.current = currentPos;\n    } else if ([\"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\", \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\", \"cylinder\", \"document\", \"cloud\"].includes(tool)) {\n      const dpr = window.devicePixelRatio || 1;\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      ctx.drawImage(snapshotCanvasRef.current, 0, 0);\n      ctx.setTransform(cameraScaleRef.current * dpr, 0, 0, cameraScaleRef.current * dpr, cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr);\n      drawShape(ctx, tool, [startPosRef.current, currentPos], {\n        color,\n        size,\n        opacity,\n        strokeStyle,\n        fill\n      });\n    }\n  };\n  const stopDrawing = () => {\n    if (interactionRef.current.type) {\n      interactionRef.current = {\n        type: null,\n        strokeId: null,\n        startPos: {\n          x: 0,\n          y: 0\n        },\n        originalPoints: [],\n        originalImgW: 0,\n        originalImgH: 0\n      };\n      pushToHistory();\n      return;\n    }\n    if (isPanningRef.current) {\n      isPanningRef.current = false;\n      setCameraOffset(cameraOffsetRef.current);\n      return;\n    }\n    const canvas = canvasRef.current;\n    if (!isDrawingRef.current || !canvas) return;\n    if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\n    isDrawingRef.current = false;\n    let points = [...currentPointsRef.current];\n    if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\"].includes(tool) && points.length > 1 && points[points.length - 1].shiftKey) {\n      points = [points[0], points[points.length - 1]];\n    }\n    const newStroke = {\n      id: Date.now() + Math.random(),\n      type: tool === 'precision-eraser' ? 'eraser-precision' : tool,\n      points,\n      color,\n      size: tool === 'precision-eraser' ? 10 : size,\n      opacity: tool === 'highlighter' ? 0.4 : tool === 'marker' ? 0.6 : opacity,\n      strokeStyle,\n      fill\n    };\n    if (tool !== 'eraser') {\n      strokesRef.current = [...strokesRef.current, newStroke];\n      setStrokesVersion(v => v + 1);\n      pushToHistory();\n      socket.emit(\"new-stroke\", {\n        roomId,\n        stroke: newStroke,\n        pageId: activePageId\n      });\n    }\n    currentPointsRef.current = [];\n    // NO bitmap save â€” strokes are the source of truth\n  };\n\n  // â”€â”€â”€ UNDO / REDO (stroke-based) â”€â”€â”€\n  const handleUndo = () => {\n    if (historyIndexRef.current > 0) {\n      historyIndexRef.current -= 1;\n      const snapshot = historyRef.current[historyIndexRef.current];\n      strokesRef.current = JSON.parse(JSON.stringify(snapshot));\n      setStrokesVersion(v => v + 1);\n      redrawCanvas();\n      socket.emit(\"update-board-state\", {\n        roomId,\n        strokes: strokesRef.current,\n        pageId: activePageId\n      });\n    }\n  };\n  const handleRedo = () => {\n    if (historyIndexRef.current < historyRef.current.length - 1) {\n      historyIndexRef.current += 1;\n      const snapshot = historyRef.current[historyIndexRef.current];\n      strokesRef.current = JSON.parse(JSON.stringify(snapshot));\n      setStrokesVersion(v => v + 1);\n      redrawCanvas();\n      socket.emit(\"update-board-state\", {\n        roomId,\n        strokes: strokesRef.current,\n        pageId: activePageId\n      });\n    }\n  };\n  const drawRemote = data => {\n    const {\n      x,\n      y,\n      prevX,\n      prevY,\n      color,\n      size,\n      opacity,\n      tool\n    } = data;\n    const ctx = contextRef.current;\n    if (!ctx) return;\n    const dpr = window.devicePixelRatio || 1;\n    ctx.save();\n    ctx.setTransform(cameraScaleRef.current * dpr, 0, 0, cameraScaleRef.current * dpr, cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr);\n    ctx.globalAlpha = opacity || 1;\n    ctx.strokeStyle = color;\n    ctx.lineWidth = size;\n    ctx.lineCap = \"round\";\n    ctx.lineJoin = \"round\";\n    ctx.globalCompositeOperation = tool === \"precision-eraser\" ? \"destination-out\" : \"source-over\";\n    ctx.beginPath();\n    if (prevX && prevY) ctx.moveTo(prevX, prevY);else ctx.moveTo(x, y);\n    ctx.lineTo(x, y);\n    ctx.stroke();\n    ctx.restore();\n  };\n  const eraseRemote = data => {\n    // Remote erase is now handled via board-state-updated\n  };\n  const handleClearBoard = () => {\n    if (window.confirm('Clear all drawings for everyone?')) socket.emit('clear-board', {\n      roomId,\n      userId: user._id,\n      pageId: activePageId\n    });\n  };\n  const downloadCanvas = () => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const link = document.createElement('a');\n    link.download = `${(room === null || room === void 0 ? void 0 : room.roomName) || 'whiteboard'}-${Date.now()}.png`;\n    link.href = canvas.toDataURL('image/png');\n    link.click();\n    toast.success('Board exported as PNG!');\n  };\n  const handleImageUpload = e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = ev => {\n      const src = ev.target.result;\n      const img = new window.Image();\n      img.onload = () => {\n        const maxW = 400;\n        const scale = Math.min(1, maxW / img.width);\n        const imgW = Math.round(img.width * scale);\n        const imgH = Math.round(img.height * scale);\n        const pos = imagePlacePosRef.current;\n        imageCache.current.set(src, img);\n        const imageStroke = {\n          id: Date.now() + Math.random(),\n          type: 'image',\n          src,\n          points: [pos],\n          imgW,\n          imgH,\n          color,\n          size,\n          opacity,\n          strokeStyle,\n          fill\n        };\n        strokesRef.current = [...strokesRef.current, imageStroke];\n        setStrokesVersion(v => v + 1);\n        pushToHistory();\n        if (socket) socket.emit('new-stroke', {\n          roomId,\n          stroke: imageStroke,\n          pageId: activePageId\n        });\n        redrawCanvas();\n      };\n      img.src = src;\n    };\n    reader.readAsDataURL(file);\n    e.target.value = '';\n  };\n\n  // Import image directly to center of current viewport\n  const handleImportImage = e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = ev => {\n      const src = ev.target.result;\n      const img = new window.Image();\n      img.onload = () => {\n        var _viewportRef$current, _viewportRef$current2;\n        const maxW = 250; // Card-sized import\n        const scale = Math.min(1, maxW / img.width);\n        const imgW = Math.round(img.width * scale);\n        const imgH = Math.round(img.height * scale);\n        // Place at center of current viewport\n        const viewportW = ((_viewportRef$current = viewportRef.current) === null || _viewportRef$current === void 0 ? void 0 : _viewportRef$current.clientWidth) || window.innerWidth;\n        const viewportH = ((_viewportRef$current2 = viewportRef.current) === null || _viewportRef$current2 === void 0 ? void 0 : _viewportRef$current2.clientHeight) || window.innerHeight;\n        const centerX = (viewportW / 2 - cameraOffsetRef.current.x) / cameraScaleRef.current;\n        const centerY = (viewportH / 2 - cameraOffsetRef.current.y) / cameraScaleRef.current;\n        const pos = {\n          x: centerX - imgW / 2,\n          y: centerY - imgH / 2\n        };\n        imageCache.current.set(src, img);\n        const imageStroke = {\n          id: Date.now() + Math.random(),\n          type: 'image',\n          src,\n          points: [pos],\n          imgW,\n          imgH,\n          color,\n          size,\n          opacity,\n          strokeStyle,\n          fill\n        };\n        strokesRef.current = [...strokesRef.current, imageStroke];\n        setStrokesVersion(v => v + 1);\n        pushToHistory();\n        if (socket) socket.emit('new-stroke', {\n          roomId,\n          stroke: imageStroke,\n          pageId: activePageId\n        });\n        redrawCanvas();\n        toast.success('Image imported!');\n      };\n      img.src = src;\n    };\n    reader.readAsDataURL(file);\n    e.target.value = '';\n  };\n\n  // â”€â”€â”€ PAGE MANAGEMENT â”€â”€â”€\n  const handleSaveBoard = () => {\n    socket.emit(\"save-board\", {\n      roomId,\n      pageId: activePageId\n    });\n  };\n  const handleNewPage = () => {\n    socket.emit(\"new-page\", {\n      roomId,\n      userId: user._id\n    });\n  };\n  const handleSwitchPage = pageId => {\n    if (pageId === activePageId) return;\n    socket.emit(\"switch-page\", {\n      roomId,\n      pageId\n    });\n  };\n  const handleUpdateRoomName = async () => {\n    if (!tempBoardName.trim()) return setIsEditingName(false);\n    try {\n      // Simplified: only local update for now as we don't have the API yet\n      // But we update the room state\n      setRoom(prev => ({\n        ...prev,\n        roomName: tempBoardName\n      }));\n      setIsEditingName(false);\n      toast.success(\"Board renamed\");\n    } catch (err) {\n      toast.error(\"Rename failed\");\n    }\n  };\n  const handleDeletePage = (e, pageId) => {\n    e.stopPropagation(); // Prevent switching to page while deleting\n    if (pages.length <= 1) {\n      toast.error(\"Cannot delete the last page\");\n      return;\n    }\n    if (window.confirm(\"Are you sure you want to delete this page? All drawings on it will be lost.\")) {\n      socket.emit(\"delete-page\", {\n        roomId,\n        pageId,\n        userId: user._id\n      });\n    }\n  };\n\n  // â”€â”€â”€ KEYBOARD SHORTCUTS â”€â”€â”€\n  React.useEffect(() => {\n    const onKey = e => {\n      if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;\n      if (e.ctrlKey || e.metaKey) {\n        if (e.key === 'z') {\n          e.preventDefault();\n          handleUndo();\n        }\n        if (e.key === 'y') {\n          e.preventDefault();\n          handleRedo();\n        }\n        return;\n      }\n      const map = {\n        v: 'select',\n        h: 'pan',\n        p: 'pencil',\n        e: 'eraser',\n        t: 'text'\n      };\n      if (map[e.key.toLowerCase()]) setTool(map[e.key.toLowerCase()]);\n    };\n    window.addEventListener('keydown', onKey);\n    return () => window.removeEventListener('keydown', onKey);\n  }, []);\n\n  // Unread messages badge\n  const [unreadCount, setUnreadCount] = useState(0);\n  useEffect(() => {\n    if (!isSidebarOpen && messages.length > 0) {\n      setUnreadCount(prev => prev + 1);\n    }\n  }, [messages.length]);\n  useEffect(() => {\n    if (isSidebarOpen) setUnreadCount(0);\n  }, [isSidebarOpen]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `wb-layout-container ${darkMode ? 'wb-dark' : ''}`,\n    \"data-sidebar\": isSidebarOpen ? \"open\" : \"closed\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"wb-header-modern\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wb-header-left\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-logo-box\",\n          onClick: () => navigate('/dashboard'),\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"S\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1121,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1120,\n          columnNumber: 21\n        }, this), isEditingName ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-name-edit\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            autoFocus: true,\n            value: tempBoardName,\n            onChange: e => setTempBoardName(e.target.value),\n            onBlur: handleUpdateRoomName,\n            onKeyDown: e => e.key === 'Enter' && handleUpdateRoomName()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1125,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Check, {\n            size: 14,\n            className: \"text-emerald-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1132,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1124,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-name-display\",\n          onClick: () => setIsEditingName(true),\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            children: (room === null || room === void 0 ? void 0 : room.roomName) || 'Untitled Board'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1136,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Edit2, {\n            size: 12,\n            className: \"wb-edit-icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1137,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1135,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"wb-id-badge\",\n          children: [\"ID: \", roomId, /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"wb-id-copy-btn\",\n            title: \"Copy Room ID\",\n            onClick: () => {\n              navigator.clipboard.writeText(roomId);\n              toast.success('Room ID copied!', {\n                duration: 1500,\n                style: {\n                  fontSize: '12px'\n                }\n              });\n            },\n            children: /*#__PURE__*/_jsxDEV(Copy, {\n              size: 11\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1150,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1142,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1140,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-online-pill\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"wb-status-dot\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1154,\n            columnNumber: 25\n          }, this), participants.length]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1153,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1119,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wb-header-center\",\n        children: isDrawingTool && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-toolbar-controls-modern\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-dropdown-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: `wb-dropdown-trigger ${activeDropdown === 'color' ? 'active' : ''}`,\n              onClick: () => setActiveDropdown(activeDropdown === 'color' ? null : 'color'),\n              title: \"Color\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-color-preview\",\n                style: {\n                  backgroundColor: color\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1170,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(ChevronDown, {\n                size: 12\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1171,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1165,\n              columnNumber: 33\n            }, this), activeDropdown === 'color' && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-dropdown-menu wb-color-menu\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-color-grid-modern\",\n                children: colors.map(c => /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => {\n                    setColor(c);\n                    setActiveDropdown(null);\n                  },\n                  className: `wb-color-box ${color === c ? 'selected' : ''}`,\n                  style: {\n                    backgroundColor: c\n                  }\n                }, c, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1177,\n                  columnNumber: 49\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1175,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1174,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1164,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-header-divider-mini\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1189,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-dropdown-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: `wb-dropdown-trigger ${activeDropdown === 'size' ? 'active' : ''}`,\n              onClick: () => setActiveDropdown(activeDropdown === 'size' ? null : 'size'),\n              title: \"Line Width\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-[10px] font-bold\",\n                children: [size, \"px\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1198,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(ChevronDown, {\n                size: 12\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1199,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1193,\n              columnNumber: 33\n            }, this), activeDropdown === 'size' && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-dropdown-menu\",\n              children: [1, 2, 4, 8, 12, 16, 24, 32].map(s => /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `wb-menu-item ${size === s ? 'active' : ''}`,\n                onClick: () => {\n                  setSize(s);\n                  setActiveDropdown(null);\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"wb-size-preview\",\n                  style: {\n                    height: `${Math.min(s / 2, 12)}px`,\n                    width: '16px'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1209,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [s, \"px\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1210,\n                  columnNumber: 49\n                }, this)]\n              }, s, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1204,\n                columnNumber: 45\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1202,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1192,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-header-divider-mini\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1217,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-dropdown-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: `wb-dropdown-trigger ${activeDropdown === 'opacity' ? 'active' : ''}`,\n              onClick: () => setActiveDropdown(activeDropdown === 'opacity' ? null : 'opacity'),\n              title: \"Opacity\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-[10px] font-bold\",\n                children: [Math.round(opacity * 100), \"%\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1226,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(ChevronDown, {\n                size: 12\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1227,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1221,\n              columnNumber: 33\n            }, this), activeDropdown === 'opacity' && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-dropdown-menu\",\n              children: [0.1, 0.2, 0.4, 0.6, 0.8, 1].map(o => /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `wb-menu-item ${opacity === o ? 'active' : ''}`,\n                onClick: () => {\n                  setOpacity(o);\n                  setActiveDropdown(null);\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"wb-opacity-preview\",\n                  style: {\n                    opacity: o,\n                    height: '8px',\n                    width: '16px'\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1237,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: [Math.round(o * 100), \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1238,\n                  columnNumber: 49\n                }, this)]\n              }, o, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1232,\n                columnNumber: 45\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1230,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1220,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-header-divider-mini\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1245,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-dropdown-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: `wb-dropdown-trigger ${activeDropdown === 'style' ? 'active' : ''}`,\n              onClick: () => setActiveDropdown(activeDropdown === 'style' ? null : 'style'),\n              title: \"Line Type\",\n              children: [strokeStyle === 'solid' ? /*#__PURE__*/_jsxDEV(Minus, {\n                size: 14\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1254,\n                columnNumber: 64\n              }, this) : /*#__PURE__*/_jsxDEV(Sliders, {\n                size: 14\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1254,\n                columnNumber: 86\n              }, this), /*#__PURE__*/_jsxDEV(ChevronDown, {\n                size: 12\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1255,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1249,\n              columnNumber: 33\n            }, this), activeDropdown === 'style' && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-dropdown-menu\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: `wb-menu-item ${strokeStyle === 'solid' ? 'active' : ''}`,\n                onClick: () => {\n                  setStrokeStyle('solid');\n                  setActiveDropdown(null);\n                },\n                children: [/*#__PURE__*/_jsxDEV(Minus, {\n                  size: 14\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1263,\n                  columnNumber: 45\n                }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Solid\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1263,\n                  columnNumber: 65\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1259,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `wb-menu-item ${strokeStyle === 'dashed' ? 'active' : ''}`,\n                onClick: () => {\n                  setStrokeStyle('dashed');\n                  setActiveDropdown(null);\n                },\n                children: [/*#__PURE__*/_jsxDEV(Sliders, {\n                  size: 14\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1269,\n                  columnNumber: 45\n                }, this), \" \", /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Dashed\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1269,\n                  columnNumber: 67\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1265,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1258,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1248,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1162,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1160,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wb-header-right\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-action-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `wb-btn-icon-modern ${tool === 'sticky' ? 'wb-btn-active' : ''}`,\n            onClick: () => {\n              setTool('sticky');\n              toast('Click & drag on canvas to place a sticky note', {\n                icon: 'ðŸ“'\n              });\n            },\n            title: \"Sticky Note\",\n            children: /*#__PURE__*/_jsxDEV(StickyNote, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1286,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1281,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"wb-btn-icon-modern\",\n            onClick: () => {\n              var _importImageRef$curre;\n              return (_importImageRef$curre = importImageRef.current) === null || _importImageRef$curre === void 0 ? void 0 : _importImageRef$curre.click();\n            },\n            title: \"Import Image to Board\",\n            children: /*#__PURE__*/_jsxDEV(ImagePlus, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1293,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1288,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            accept: \"image/*\",\n            className: \"hidden\",\n            ref: importImageRef,\n            onChange: handleImportImage\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1295,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-header-divider-mini\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1296,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"wb-btn-icon-modern\",\n            onClick: () => setDarkMode(!darkMode),\n            title: darkMode ? 'Light Mode' : 'Dark Mode',\n            children: darkMode ? /*#__PURE__*/_jsxDEV(Sun, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1302,\n              columnNumber: 41\n            }, this) : /*#__PURE__*/_jsxDEV(Moon, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1302,\n              columnNumber: 61\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1297,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"wb-btn-icon-modern\",\n            onClick: handleSaveBoard,\n            title: \"Save Board\",\n            children: /*#__PURE__*/_jsxDEV(Save, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1305,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1304,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"wb-btn-icon-modern\",\n            onClick: downloadCanvas,\n            title: \"Export PNG\",\n            children: /*#__PURE__*/_jsxDEV(Download, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1308,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1307,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"wb-btn-icon-modern\",\n            onClick: () => {\n              navigator.clipboard.writeText(window.location.href);\n              toast.success('Link copied!');\n            },\n            title: \"Invite Members\",\n            children: /*#__PURE__*/_jsxDEV(Share2, {\n              size: 18\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1314,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1310,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1280,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-header-divider\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1317,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `wb-btn-chat-modern ${isSidebarOpen ? 'active' : ''}`,\n          onClick: () => setIsSidebarOpen(!isSidebarOpen),\n          title: \"Toggle Chat\",\n          children: [/*#__PURE__*/_jsxDEV(MessageCircle, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1323,\n            columnNumber: 25\n          }, this), unreadCount > 0 && !isSidebarOpen && /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"wb-badge-modern\",\n            children: unreadCount > 9 ? '9+' : unreadCount\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1325,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1318,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1279,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1117,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wb-workspace\",\n      children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n        className: \"wb-left-panel\",\n        children: /*#__PURE__*/_jsxDEV(Toolbar, {\n          activeTool: tool,\n          setTool: handleToolChange,\n          isHost: (room === null || room === void 0 ? void 0 : (_room$host = room.host) === null || _room$host === void 0 ? void 0 : _room$host.toString()) === user._id || (room === null || room === void 0 ? void 0 : (_room$host2 = room.host) === null || _room$host2 === void 0 ? void 0 : _room$host2._id) === user._id,\n          onClear: handleClearBoard,\n          onUndo: handleUndo,\n          onRedo: handleRedo,\n          onDelete: () => {},\n          canvasBackground: canvasBackground,\n          setCanvasBackground: setCanvasBackground,\n          darkMode: darkMode,\n          setDarkMode: setDarkMode\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1333,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1332,\n        columnNumber: 17\n      }, this), (() => {\n        const s = 24 * cameraScale;\n        const ox = cameraOffset.x;\n        const oy = cameraOffset.y;\n        const dm = darkMode;\n        const dotColor = dm ? 'rgba(255,255,255,0.12)' : '#e2e8f0';\n        const lineColor = dm ? 'rgba(255,255,255,0.07)' : '#e2e8f0';\n        const fineColor = dm ? 'rgba(255,255,255,0.04)' : '#eef2f7';\n        const bgColor = dm ? '#0f172a' : '#ffffff';\n        const bgMap = {\n          dots: {\n            backgroundImage: `radial-gradient(${dotColor} 1px, transparent 1px)`,\n            backgroundSize: `${s}px ${s}px`\n          },\n          grid: {\n            backgroundImage: `linear-gradient(${lineColor} 1px, transparent 1px), linear-gradient(90deg, ${lineColor} 1px, transparent 1px)`,\n            backgroundSize: `${s}px ${s}px`\n          },\n          lines: {\n            backgroundImage: `linear-gradient(${lineColor} 1px, transparent 1px)`,\n            backgroundSize: `${s}px ${s}px`\n          },\n          cross: {\n            backgroundImage: `radial-gradient(${dotColor} 1px, transparent 1px), linear-gradient(${lineColor} 1px, transparent 1px), linear-gradient(90deg, ${lineColor} 1px, transparent 1px)`,\n            backgroundSize: `${s}px ${s}px`\n          },\n          isometric: {\n            backgroundImage: `linear-gradient(30deg, ${lineColor} 1px, transparent 1px), linear-gradient(150deg, ${lineColor} 1px, transparent 1px), linear-gradient(270deg, ${lineColor} 1px, transparent 1px)`,\n            backgroundSize: `${s}px ${s * 0.866}px`\n          },\n          'graph-paper': {\n            backgroundImage: `linear-gradient(${lineColor} 1px, transparent 1px), linear-gradient(90deg, ${lineColor} 1px, transparent 1px), linear-gradient(${fineColor} 1px, transparent 1px), linear-gradient(90deg, ${fineColor} 1px, transparent 1px)`,\n            backgroundSize: `${s * 4}px ${s * 4}px, ${s * 4}px ${s * 4}px, ${s}px ${s}px, ${s}px ${s}px`\n          },\n          blank: {\n            backgroundImage: 'none',\n            backgroundSize: 'auto'\n          }\n        };\n        const bg = bgMap[canvasBackground] || bgMap.dots;\n        return /*#__PURE__*/_jsxDEV(\"main\", {\n          ref: viewportRef,\n          className: \"wb-viewport\",\n          style: {\n            ...bg,\n            backgroundPosition: `${ox}px ${oy}px`,\n            backgroundColor: bgColor\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: canvasRef,\n            className: \"wb-canvas\",\n            style: {\n              cursor: canvasCursor\n            },\n            onMouseDown: startDrawing,\n            onMouseMove: handleMouseMove,\n            onMouseUp: stopDrawing,\n            onMouseOut: stopDrawing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1403,\n            columnNumber: 29\n          }, this), strokesRef.current.filter(s => s.type === 'image' || s.type === 'sticky').map(stroke => {\n            const start = stroke.points[0];\n            const end = stroke.type === 'sticky' ? stroke.points[1] : null;\n            const x = Math.min(start.x, end ? end.x : start.x);\n            const y = Math.min(start.y, end ? end.y : start.y);\n            const w = stroke.type === 'sticky' ? Math.abs(end.x - start.x) : stroke.imgW || 250;\n            const h = stroke.type === 'sticky' ? Math.abs(end.y - start.y) : stroke.imgH || 180;\n            const screenX = x * cameraScale + cameraOffset.x;\n            const screenY = y * cameraScale + cameraOffset.y;\n            const screenW = w * cameraScale;\n            const screenH = h * cameraScale;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-obj-overlay\",\n              style: {\n                position: 'absolute',\n                left: screenX,\n                top: screenY,\n                width: screenW,\n                height: screenH,\n                zIndex: 10,\n                pointerEvents: ['pencil', 'eraser', 'highlighter'].includes(tool) ? 'none' : 'all'\n              },\n              onMouseDown: e => {\n                if (e.button !== 0) return;\n                e.stopPropagation();\n                const pos = getMousePos(e);\n                interactionRef.current = {\n                  type: 'move',\n                  strokeId: stroke.id,\n                  startPos: pos,\n                  originalPoints: JSON.parse(JSON.stringify(stroke.points)),\n                  originalImgW: stroke.imgW,\n                  originalImgH: stroke.imgH\n                };\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"wb-obj-delete-btn\",\n                title: \"Remove\",\n                onClick: e => {\n                  e.stopPropagation();\n                  strokesRef.current = strokesRef.current.filter(s => s.id !== stroke.id);\n                  setStrokesVersion(v => v + 1);\n                  pushToHistory();\n                  if (socket) socket.emit('erase-stroke', {\n                    roomId,\n                    strokeId: stroke.id,\n                    pageId: activePageId\n                  });\n                  redrawCanvas();\n                  toast.success('Removed');\n                },\n                children: /*#__PURE__*/_jsxDEV(X, {\n                  size: 14\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1468,\n                  columnNumber: 45\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1455,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-resize-handle\",\n                onMouseDown: e => {\n                  e.stopPropagation();\n                  const pos = getMousePos(e);\n                  interactionRef.current = {\n                    type: 'resize',\n                    strokeId: stroke.id,\n                    startPos: pos,\n                    originalPoints: JSON.parse(JSON.stringify(stroke.points)),\n                    originalImgW: stroke.imgW,\n                    originalImgH: stroke.imgH\n                  };\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1471,\n                columnNumber: 41\n              }, this)]\n            }, stroke.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1429,\n              columnNumber: 37\n            }, this);\n          }), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            accept: \"image/*\",\n            className: \"hidden\",\n            ref: imageFileRef,\n            onChange: handleImageUpload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1490,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(StylingPanel, {\n            tool: tool,\n            visible: showStyling,\n            strokeStyle: strokeStyle,\n            setStrokeStyle: setStrokeStyle,\n            fill: fill,\n            setFill: setFill\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1491,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-bottom-bar\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-bar-section-pages\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"wb-bar-btn-add\",\n                onClick: handleNewPage,\n                title: \"New Page\",\n                children: /*#__PURE__*/_jsxDEV(Plus, {\n                  size: 16\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1498,\n                  columnNumber: 41\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1497,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-bar-divider-mini\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1500,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-page-tabs-scrollable\",\n                children: (() => {\n                  const totalPages = pages.length;\n                  if (totalPages === 0) return null;\n                  const activeIndex = pages.findIndex(p => p.pageId === activePageId);\n                  const visibleItems = [];\n\n                  // Constants for pagination\n                  const neighbors = 2; // Show 2 pages before and after active\n\n                  // Always include first page\n                  visibleItems.push(pages[0]);\n                  let start = Math.max(1, activeIndex - neighbors);\n                  let end = Math.min(totalPages - 2, activeIndex + neighbors);\n\n                  // Add ellipsis after first if needed\n                  if (start > 1) {\n                    visibleItems.push({\n                      type: 'ellipsis',\n                      id: 'ellipsis-start'\n                    });\n                  }\n\n                  // Add pages in dynamic range\n                  for (let i = start; i <= end; i++) {\n                    visibleItems.push(pages[i]);\n                  }\n\n                  // Add ellipsis before last if needed\n                  if (end < totalPages - 2) {\n                    visibleItems.push({\n                      type: 'ellipsis',\n                      id: 'ellipsis-end'\n                    });\n                  }\n\n                  // Always include last page if there's more than one\n                  if (totalPages > 1) {\n                    visibleItems.push(pages[totalPages - 1]);\n                  }\n                  return visibleItems.map(item => {\n                    if (item.type === 'ellipsis') {\n                      return /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"wb-page-tab-ellipsis\",\n                        children: \"...\"\n                      }, item.id, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1540,\n                        columnNumber: 60\n                      }, this);\n                    }\n                    return /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: `wb-page-tab-container ${item.pageId === activePageId ? 'active' : ''}`,\n                      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"wb-page-tab\",\n                        onClick: () => handleSwitchPage(item.pageId),\n                        children: item.pageName.replace('Page ', '')\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1547,\n                        columnNumber: 57\n                      }, this), pages.length > 1 && /*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"wb-page-tab-delete\",\n                        onClick: e => handleDeletePage(e, item.pageId),\n                        title: \"Delete Page\",\n                        children: /*#__PURE__*/_jsxDEV(X, {\n                          size: 10\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1559,\n                          columnNumber: 65\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1554,\n                        columnNumber: 61\n                      }, this)]\n                    }, item.pageId, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1543,\n                      columnNumber: 53\n                    }, this);\n                  });\n                })()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1501,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1496,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-bar-divider\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1569,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-bar-section-zoom\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-zoom-controls\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => {\n                    cameraScaleRef.current = 1;\n                    cameraOffsetRef.current = {\n                      x: -4000 + window.innerWidth / 2,\n                      y: -4000 + window.innerHeight / 2\n                    };\n                    setCameraScale(1);\n                    setCameraOffset(cameraOffsetRef.current);\n                    syncViewDOM();\n                  },\n                  className: \"wb-zoom-btn wb-zoom-label\",\n                  children: [Math.round(cameraScale * 100), \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1574,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"wb-zoom-divider\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1584,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => updateZoom(1.1),\n                  className: \"wb-zoom-btn\",\n                  children: /*#__PURE__*/_jsxDEV(Plus, {\n                    size: 14\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1585,\n                    columnNumber: 105\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1585,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: () => updateZoom(1 / 1.1),\n                  className: \"wb-zoom-btn\",\n                  children: /*#__PURE__*/_jsxDEV(Minus, {\n                    size: 14\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1586,\n                    columnNumber: 109\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1586,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1573,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1572,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1494,\n            columnNumber: 29\n          }, this), Object.values(remoteCursors).map(cursor => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-remote-cursor\",\n            style: {\n              left: cursor.x,\n              top: cursor.y\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              width: \"12\",\n              height: \"16\",\n              viewBox: \"0 0 12 16\",\n              xmlns: \"http://www.w3.org/2000/svg\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                d: \"M0 0 L0 14 L4 10 L6.5 14.5 L8 13.5 L5.5 9 L10 9 Z\",\n                fill: cursor.color || '#06b6d4',\n                stroke: \"white\",\n                strokeWidth: \"1\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1599,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1598,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"wb-cursor-label\",\n              style: {\n                backgroundColor: cursor.color || '#06b6d4'\n              },\n              children: cursor.userName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1602,\n              columnNumber: 37\n            }, this)]\n          }, cursor.socketId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1593,\n            columnNumber: 33\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1393,\n          columnNumber: 25\n        }, this);\n      })(), /*#__PURE__*/_jsxDEV(\"aside\", {\n        className: `wb-right-panel ${isSidebarOpen ? 'open' : ''}`,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-sidebar-inner\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-sidebar-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-sidebar-tabs\",\n              children: ['chat', 'files', 'users'].map(tab => /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setActiveTab(tab),\n                className: `wb-sidebar-tab ${activeTab === tab ? \"active\" : \"\"}`,\n                children: [tab === 'chat' && /*#__PURE__*/_jsxDEV(MessageCircle, {\n                  size: 13\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1622,\n                  columnNumber: 60\n                }, this), tab === 'users' && /*#__PURE__*/_jsxDEV(Users, {\n                  size: 13\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1623,\n                  columnNumber: 61\n                }, this), tab]\n              }, tab, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1617,\n                columnNumber: 37\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1615,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"wb-sidebar-close\",\n              onClick: () => setIsSidebarOpen(false),\n              children: /*#__PURE__*/_jsxDEV(X, {\n                size: 16\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1629,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1628,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1614,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-sidebar-content\",\n            children: activeTab === \"chat\" ? /*#__PURE__*/_jsxDEV(Chat, {\n              messages: messages,\n              onSendMessage: txt => socket.emit(\"chat-message\", {\n                roomId,\n                message: txt,\n                userId: user._id,\n                userName: user.name\n              }),\n              currentUser: user,\n              socket: socket,\n              roomId: roomId,\n              typingUsers: typingUsers,\n              participants: participants,\n              inCall: inCall,\n              activeCallInfo: activeCallInfo,\n              onJoinCall: handleJoinCall\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1634,\n              columnNumber: 33\n            }, this) : activeTab === \"files\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-files-panel\",\n              children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                className: `wb-file-upload-btn ${loadingFileUpload ? 'disabled' : ''}`,\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  children: loadingFileUpload ? 'Uploading...' : 'ðŸ“Ž Share Asset'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1649,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\",\n                  className: \"hidden\",\n                  disabled: loadingFileUpload,\n                  onChange: async e => {\n                    const file = e.target.files[0];\n                    if (!file) return;\n                    setLoadingFileUpload(true);\n                    try {\n                      const fd = new FormData();\n                      fd.append('file', file);\n                      const res = await roomService.uploadFile(roomId, fd);\n                      setSharedFiles(prev => [...prev, res.data.file]);\n                      socket.emit('file-shared', {\n                        roomId,\n                        file: res.data.file\n                      });\n                      toast.success(`${file.name} shared!`);\n                    } catch {\n                      toast.error('Upload failed');\n                    } finally {\n                      setLoadingFileUpload(false);\n                      e.target.value = '';\n                    }\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1650,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1648,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-files-list\",\n                children: sharedFiles.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"wb-files-empty\",\n                  children: \"No files shared yet\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1670,\n                  columnNumber: 45\n                }, this) : sharedFiles.map((f, i) => {\n                  const backendUrl = (process.env.REACT_APP_API_URL || 'http://localhost:5000/api').replace('/api', '');\n                  const fullUrl = `${backendUrl}${f.fileUrl}`;\n                  const sizeKB = f.fileSize ? `${(f.fileSize / 1024).toFixed(1)} KB` : '';\n                  return /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"wb-file-item\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"wb-file-info\",\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"wb-file-name\",\n                        title: f.fileName,\n                        children: f.fileName\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1679,\n                        columnNumber: 61\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"wb-file-meta\",\n                        children: [f.senderName && /*#__PURE__*/_jsxDEV(\"span\", {\n                          children: f.senderName\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1681,\n                          columnNumber: 82\n                        }, this), sizeKB && /*#__PURE__*/_jsxDEV(\"span\", {\n                          children: [\" \\xB7 \", sizeKB]\n                        }, void 0, true, {\n                          fileName: _jsxFileName,\n                          lineNumber: 1682,\n                          columnNumber: 76\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1680,\n                        columnNumber: 61\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1678,\n                      columnNumber: 57\n                    }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                      href: fullUrl,\n                      download: f.fileName,\n                      target: \"_blank\",\n                      rel: \"noopener noreferrer\",\n                      className: \"wb-file-download-btn\",\n                      title: \"Download file\",\n                      children: /*#__PURE__*/_jsxDEV(Download, {\n                        size: 14\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1693,\n                        columnNumber: 61\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1685,\n                      columnNumber: 57\n                    }, this)]\n                  }, i, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1677,\n                    columnNumber: 53\n                  }, this);\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1668,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1647,\n              columnNumber: 33\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"wb-users-panel\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-users-count\",\n                children: [participants.length, \" Online\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1703,\n                columnNumber: 37\n              }, this), participants.map((p, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"wb-user-item\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"wb-user-avatar\",\n                  children: p.userName[0]\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1706,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"wb-user-name\",\n                  children: p.userName\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1707,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"wb-user-status\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1708,\n                  columnNumber: 45\n                }, this)]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1705,\n                columnNumber: 41\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1702,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1632,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1613,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1612,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1331,\n      columnNumber: 13\n    }, this), inCall && /*#__PURE__*/_jsxDEV(WebRTCMeeting, {\n      socket: socket,\n      roomId: roomId,\n      username: user.name,\n      onLeave: handleLeaveCall\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1720,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1116,\n    columnNumber: 9\n  }, this);\n};\n_s(WhiteboardRoom, \"VQCWc2GguKH5V/teh8uggloeY1A=\", false, function () {\n  return [useParams, useNavigate, useAuth, useSocket];\n});\n_c = WhiteboardRoom;\nexport default WhiteboardRoom;\nvar _c;\n$RefreshReg$(_c, \"WhiteboardRoom\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useParams","useNavigate","useAuth","useSocket","roomService","Toolbar","Chat","StylingPanel","toast","Plus","Minus","Save","FilePlus","ChevronRight","MessageCircle","Users","X","Share2","Download","Palette","Type","Sliders","ChevronDown","Edit2","Check","Video","Monitor","Copy","Sun","Moon","StickyNote","ImagePlus","WebRTCMeeting","jsxDEV","_jsxDEV","WhiteboardRoom","_s","_room$host","_room$host2","roomId","navigate","user","socket","canvasRef","viewportRef","contextRef","tool","setTool","showStyling","setShowStyling","color","setColor","size","setSize","opacity","setOpacity","strokeStyle","setStrokeStyle","fill","setFill","canvasBackground","setCanvasBackground","darkMode","setDarkMode","document","body","classList","add","remove","cameraScale","setCameraScale","cameraOffset","setCameraOffset","x","window","innerWidth","y","innerHeight","cameraScaleRef","cameraOffsetRef","isPanningRef","panStartRef","strokesRef","strokesVersion","setStrokesVersion","isDrawingRef","currentPointsRef","startPosRef","lastPosRef","snapshotCanvasRef","animationFrameRef","lastCursorEmitRef","imageFileRef","importImageRef","imagePlacePosRef","imageCache","Map","historyRef","historyIndexRef","room","setRoom","participants","setParticipants","messages","setMessages","sharedFiles","setSharedFiles","activeTab","setActiveTab","loadingFileUpload","setLoadingFileUpload","isSidebarOpen","setIsSidebarOpen","remoteCursors","setRemoteCursors","typingUsers","setTypingUsers","inCall","setInCall","activeCallInfo","setActiveCallInfo","active","handleJoinCall","handleLeaveCall","pages","setPages","activePageId","setActivePageId","activeDropdown","setActiveDropdown","isEditingName","setIsEditingName","tempBoardName","setTempBoardName","colors","isDrawingTool","includes","canvasCursor","select","pan","eraser","text","upload","handleToolChange","newTool","interactionRef","type","strokeId","startPos","originalPoints","originalImgW","originalImgH","setStrokes","newStrokes","current","v","pushToHistory","snapshot","JSON","parse","stringify","slice","push","length","fetchRoomDetails","res","getRoom","data","roomName","err","error","emit","userId","_id","userName","name","on","success","users","msg","prev","h","drawRemote","eraseRemote","redrawCanvas","loadedStrokes","strokes","pageId","requestAnimationFrame","stroke","updatedStroke","map","s","id","filter","updatedStrokes","file","socketId","setTimeout","n","find","u","forEach","ev","off","viewport","canvas","updateCanvasSize","dpr","devicePixelRatio","width","clientWidth","height","clientHeight","context","getContext","alpha","lineCap","lineJoin","createElement","ro","ResizeObserver","observe","disconnect","handleZoomIn","updateZoom","handleZoomOut","handleResetZoom","syncViewDOM","addEventListener","removeEventListener","handleWheel","e","preventDefault","ctrlKey","zoomSpeed","delta","deltaY","newScale","Math","max","min","rect","getBoundingClientRect","mouseX","clientX","left","mouseY","clientY","top","worldX","worldY","deltaX","passive","factor","centerX","centerY","ox","oy","style","backgroundPosition","ctx","setTransform","clearRect","renderStroke","points","save","font","fillStyle","globalAlpha","globalCompositeOperation","shadowBlur","fillText","restore","cached","get","src","drawImage","imgW","imgH","img","Image","onload","set","lineWidth","setLineDash","shadowColor","beginPath","moveTo","i","lineTo","drawShape","start","end","w","fillRect","strokeRect","roundRect","abs","radius","sqrt","arc","PI","ellipse","closePath","drawArrowHead","shift","ry","fold","mw","mh","fromx","fromy","tox","toy","weight","headlen","angle","atan2","translate","rotate","getMousePos","eraseObjectAt","pos","threshold","some","p","dist","pow","startDrawing","button","_imageFileRef$current","click","textInput","prompt","textStroke","Date","now","random","snapCtx","handleMouseMove","cursorData","cancelAnimationFrame","shiftKey","draw","dx","dy","newPoints","newEnd","buttons","currentPos","lastPoint","drawingData","prevX","prevY","stopDrawing","newStroke","handleUndo","handleRedo","handleClearBoard","confirm","downloadCanvas","link","download","href","toDataURL","handleImageUpload","target","files","reader","FileReader","result","maxW","scale","round","imageStroke","readAsDataURL","value","handleImportImage","_viewportRef$current","_viewportRef$current2","viewportW","viewportH","handleSaveBoard","handleNewPage","handleSwitchPage","handleUpdateRoomName","trim","handleDeletePage","stopPropagation","onKey","tagName","metaKey","key","t","toLowerCase","unreadCount","setUnreadCount","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","autoFocus","onChange","onBlur","onKeyDown","title","navigator","clipboard","writeText","duration","fontSize","backgroundColor","c","o","icon","_importImageRef$curre","accept","ref","location","activeTool","isHost","host","toString","onClear","onUndo","onRedo","onDelete","dm","dotColor","lineColor","fineColor","bgColor","bgMap","dots","backgroundImage","backgroundSize","grid","lines","cross","isometric","blank","bg","cursor","onMouseDown","onMouseMove","onMouseUp","onMouseOut","screenX","screenY","screenW","screenH","position","zIndex","pointerEvents","visible","totalPages","activeIndex","findIndex","visibleItems","neighbors","item","pageName","replace","Object","values","viewBox","xmlns","d","strokeWidth","tab","onSendMessage","txt","message","currentUser","onJoinCall","disabled","fd","FormData","append","uploadFile","f","backendUrl","process","env","REACT_APP_API_URL","fullUrl","fileUrl","sizeKB","fileSize","toFixed","senderName","rel","username","onLeave","_c","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/pages/WhiteboardRoom.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport { useSocket } from \"../context/SocketContext\";\r\nimport { roomService } from \"../services/api\";\r\nimport Toolbar from \"../components/Toolbar\";\r\nimport Chat from \"../components/Chat\";\r\nimport StylingPanel from \"../components/StylingPanel\";\r\nimport toast from \"react-hot-toast\";\r\nimport { Plus, Minus, Save, FilePlus, ChevronRight, MessageCircle, Users, X, Share2, Download, Palette, Type, Sliders, ChevronDown, Edit2, Check, Video, Monitor, Copy, Sun, Moon, StickyNote, ImagePlus } from \"lucide-react\";\r\nimport WebRTCMeeting from \"../components/video/WebRTCMeeting\";\r\n\r\n\r\nconst WhiteboardRoom = () => {\r\n    const { roomId } = useParams();\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const { socket } = useSocket();\r\n\r\n    const canvasRef = useRef(null);\r\n    const viewportRef = useRef(null);\r\n    const contextRef = useRef(null);\r\n\r\n    // Tools & Styling\r\n    const [tool, setTool] = useState(\"pencil\");\r\n    const [showStyling, setShowStyling] = useState(true);\r\n    const [color, setColor] = useState(\"#000000\");\r\n    const [size, setSize] = useState(4);\r\n    const [opacity, setOpacity] = useState(1);\r\n    const [strokeStyle, setStrokeStyle] = useState('solid');\r\n    const [fill, setFill] = useState(false);\r\n    const [canvasBackground, setCanvasBackground] = useState('dots');\r\n    const [darkMode, setDarkMode] = useState(false);\r\n\r\n    // Sync dark mode to <body> (for portalled flyouts) + auto-switch pen color\r\n    useEffect(() => {\r\n        if (darkMode) {\r\n            document.body.classList.add('wb-dark-active');\r\n            // Auto switch black â†’ white so strokes are visible on dark canvas\r\n            if (color === '#000000') setColor('#ffffff');\r\n        } else {\r\n            document.body.classList.remove('wb-dark-active');\r\n            // Auto switch white â†’ black for light canvas\r\n            if (color === '#ffffff') setColor('#000000');\r\n        }\r\n        return () => document.body.classList.remove('wb-dark-active');\r\n    }, [darkMode]);\r\n\r\n    // Camera / Infinite Canvas\r\n    const [cameraScale, setCameraScale] = useState(1);\r\n    const [cameraOffset, setCameraOffset] = useState({ x: -4000 + window.innerWidth / 2, y: -4000 + window.innerHeight / 2 });\r\n\r\n    const cameraScaleRef = useRef(1);\r\n    const cameraOffsetRef = useRef({ x: -4000 + window.innerWidth / 2, y: -4000 + window.innerHeight / 2 });\r\n    const isPanningRef = useRef(false);\r\n    const panStartRef = useRef({ x: 0, y: 0 });\r\n\r\n    // â”€â”€â”€ STROKE-BASED ARCHITECTURE (Source of Truth) â”€â”€â”€\r\n    const strokesRef = useRef([]);  // Performance ref â€” authoritative source\r\n    const [strokesVersion, setStrokesVersion] = useState(0); // Trigger re-render when needed\r\n\r\n    // Performance Refs for Drawing\r\n    const isDrawingRef = useRef(false);\r\n    const currentPointsRef = useRef([]);\r\n    const startPosRef = useRef({ x: 0, y: 0 });\r\n    const lastPosRef = useRef({ x: 0, y: 0 });\r\n    const snapshotCanvasRef = useRef(null);\r\n    const animationFrameRef = useRef(null);\r\n    const lastCursorEmitRef = useRef(0);\r\n    const imageFileRef = useRef(null);\r\n    const importImageRef = useRef(null);\r\n    const imagePlacePosRef = useRef({ x: 0, y: 0 });\r\n    const imageCache = useRef(new Map());\r\n\r\n    // Undo/Redo history (stroke snapshots)\r\n    const historyRef = useRef([]);\r\n    const historyIndexRef = useRef(-1);\r\n\r\n    // Room State\r\n    const [room, setRoom] = useState(null);\r\n    const [participants, setParticipants] = useState([]);\r\n    const [messages, setMessages] = useState([]);\r\n    const [sharedFiles, setSharedFiles] = useState([]);\r\n    const [activeTab, setActiveTab] = useState(\"chat\");\r\n    const [loadingFileUpload, setLoadingFileUpload] = useState(false);\r\n    const [isSidebarOpen, setIsSidebarOpen] = useState(false); // Hidden by default\r\n    const [remoteCursors, setRemoteCursors] = useState({});\r\n    const [typingUsers, setTypingUsers] = useState([]);\r\n    // Zoom-like group call state\r\n    const [inCall, setInCall] = useState(false);  // Am I currently in the call?\r\n    const [activeCallInfo, setActiveCallInfo] = useState({ active: false, participants: [] }); // Room-level call status\r\n\r\n    const handleJoinCall = useCallback(() => {\r\n        setInCall(true);\r\n    }, []);\r\n\r\n    const handleLeaveCall = useCallback(() => {\r\n        setInCall(false);\r\n    }, []);\r\n\r\n    // Multi-page state\r\n    const [pages, setPages] = useState([]);\r\n    const [activePageId, setActivePageId] = useState(\"\");\r\n\r\n    // Dropdown states\r\n    const [activeDropdown, setActiveDropdown] = useState(null);\r\n    const [isEditingName, setIsEditingName] = useState(false);\r\n    const [tempBoardName, setTempBoardName] = useState(\"\");\r\n\r\n\r\n    const colors = [\r\n        \"#000000\", \"#374151\", \"#6b7280\", \"#9ca3af\", \"#ffffff\",\r\n        \"#dc2626\", \"#ea580c\", \"#d97706\", \"#ca8a04\", \"#65a30d\",\r\n        \"#16a34a\", \"#0d9488\", \"#0891b2\", \"#0284c7\", \"#2563eb\",\r\n        \"#4f46e5\", \"#7c3aed\", \"#9333ea\", \"#c026d3\", \"#db2777\"\r\n    ];\r\n\r\n    const isDrawingTool = [\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\", \"precision-eraser\",\r\n        \"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\",\r\n        \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\",\r\n        \"cylinder\", \"document\", \"cloud\"\r\n    ].includes(tool);\r\n\r\n    const canvasCursor = {\r\n        select: 'default', pan: 'grab', eraser: 'cell',\r\n        'precision-eraser': 'cell', text: 'text', upload: 'copy',\r\n    }[tool] || 'crosshair';\r\n\r\n    const handleToolChange = (newTool) => {\r\n        if (tool === newTool) { setShowStyling(!showStyling); }\r\n        else { setTool(newTool); setShowStyling(true); }\r\n    };\r\n\r\n    const interactionRef = useRef({\r\n        type: null, // 'move' or 'resize'\r\n        strokeId: null,\r\n        startPos: { x: 0, y: 0 },\r\n        originalPoints: [],\r\n        originalImgW: 0,\r\n        originalImgH: 0\r\n    });\r\n\r\n    // â”€â”€â”€ STROKE HELPERS â”€â”€â”€\r\n    const setStrokes = useCallback((newStrokes) => {\r\n        if (typeof newStrokes === 'function') {\r\n            strokesRef.current = newStrokes(strokesRef.current);\r\n        } else {\r\n            strokesRef.current = newStrokes;\r\n        }\r\n        setStrokesVersion(v => v + 1);\r\n    }, []);\r\n\r\n    const pushToHistory = useCallback(() => {\r\n        const snapshot = JSON.parse(JSON.stringify(strokesRef.current));\r\n        historyRef.current = historyRef.current.slice(0, historyIndexRef.current + 1);\r\n        historyRef.current.push(snapshot);\r\n        historyIndexRef.current = historyRef.current.length - 1;\r\n    }, []);\r\n\r\n    // â”€â”€â”€ SOCKET SETUP â”€â”€â”€\r\n    useEffect(() => {\r\n        const fetchRoomDetails = async () => {\r\n            try {\r\n                const res = await roomService.getRoom(roomId);\r\n                setRoom(res.data.room);\r\n                setTempBoardName(res.data.room.roomName || \"Untitled Board\");\r\n                setSharedFiles(res.data.room.sharedFiles || []);\r\n            } catch (err) {\r\n                toast.error(\"Failed to load workspace\");\r\n                navigate(\"/dashboard\");\r\n            }\r\n        };\r\n\r\n        fetchRoomDetails();\r\n\r\n        if (socket) {\r\n            socket.emit(\"join-room\", { roomId, userId: user._id, userName: user.name });\r\n\r\n            socket.on(\"user-joined\", (data) => toast.success(`${data.userName} joined`));\r\n            socket.on(\"online-users\", (users) => setParticipants(users));\r\n            socket.on(\"chat-message\", (msg) => setMessages((prev) => [...prev, msg]));\r\n            socket.on(\"chat-history\", (h) => setMessages(h));\r\n            socket.on(\"drawing\", (data) => drawRemote(data));\r\n            socket.on(\"erase\", (data) => eraseRemote(data));\r\n\r\n            socket.on(\"board-cleared\", () => {\r\n                strokesRef.current = [];\r\n                historyRef.current = [[]];\r\n                historyIndexRef.current = 0;\r\n                setStrokesVersion(v => v + 1);\r\n                redrawCanvas();\r\n            });\r\n\r\n            // â”€â”€â”€ CANVAS STATE (strokes are the ONLY source of truth) â”€â”€â”€\r\n            socket.on(\"canvas-state\", (data) => {\r\n                if (data) {\r\n                    const loadedStrokes = (data.strokes && data.strokes.length > 0) ? data.strokes : [];\r\n                    strokesRef.current = loadedStrokes;\r\n                    setStrokesVersion(v => v + 1);\r\n\r\n                    historyRef.current = [JSON.parse(JSON.stringify(loadedStrokes))];\r\n                    historyIndexRef.current = 0;\r\n\r\n                    // Pages\r\n                    if (data.pages) setPages(data.pages);\r\n                    if (data.pageId) setActivePageId(data.pageId);\r\n\r\n                    requestAnimationFrame(() => redrawCanvas());\r\n                }\r\n            });\r\n\r\n            socket.on(\"new-stroke\", (stroke) => {\r\n                strokesRef.current = [...strokesRef.current, stroke];\r\n                setStrokesVersion(v => v + 1);\r\n                redrawCanvas();\r\n            });\r\n\r\n            socket.on(\"update-stroke\", (updatedStroke) => {\r\n                strokesRef.current = strokesRef.current.map(s => s.id === updatedStroke.id ? updatedStroke : s);\r\n                setStrokesVersion(v => v + 1);\r\n                redrawCanvas();\r\n            });\r\n\r\n            socket.on(\"erase-stroke\", ({ strokeId }) => {\r\n                strokesRef.current = strokesRef.current.filter(s => s.id !== strokeId);\r\n                setStrokesVersion(v => v + 1);\r\n                redrawCanvas();\r\n            });\r\n\r\n            socket.on(\"board-state-updated\", (updatedStrokes) => {\r\n                strokesRef.current = updatedStrokes;\r\n                setStrokesVersion(v => v + 1);\r\n                redrawCanvas();\r\n            });\r\n\r\n            socket.on(\"new-file\", (file) => setSharedFiles(prev => [...prev, file]));\r\n            socket.on(\"user-left\", (data) => toast(`ðŸ‘‹ ${data.userName} left`));\r\n\r\n            socket.on(\"cursor-move\", (data) => {\r\n                setRemoteCursors(prev => ({ ...prev, [data.socketId]: data }));\r\n                setTimeout(() => setRemoteCursors(prev => { const n = { ...prev }; delete n[data.socketId]; return n; }), 3000);\r\n            });\r\n\r\n            // Typing indicators\r\n            socket.on(\"typing-start\", ({ userName, socketId }) => {\r\n                setTypingUsers(prev => {\r\n                    if (prev.find(u => u.socketId === socketId)) return prev;\r\n                    return [...prev, { userName, socketId }];\r\n                });\r\n            });\r\n            socket.on(\"typing-stop\", ({ socketId }) => {\r\n                setTypingUsers(prev => prev.filter(u => u.socketId !== socketId));\r\n            });\r\n\r\n            // Room-level active call status\r\n            socket.on(\"call:active\", (data) => {\r\n                setActiveCallInfo(data);\r\n            });\r\n\r\n            // Page events\r\n            socket.on(\"page-added\", (data) => {\r\n                setPages(data.pages);\r\n                setActivePageId(data.pageId);\r\n                strokesRef.current = [];\r\n                setStrokesVersion(v => v + 1);\r\n                historyRef.current = [[]];\r\n                historyIndexRef.current = 0;\r\n                redrawCanvas();\r\n            });\r\n\r\n            socket.on(\"page-switched\", (data) => {\r\n                setActivePageId(data.pageId);\r\n                strokesRef.current = data.strokes || [];\r\n                setStrokesVersion(v => v + 1);\r\n                historyRef.current = [JSON.parse(JSON.stringify(data.strokes || []))];\r\n                historyIndexRef.current = 0;\r\n                redrawCanvas();\r\n            });\r\n\r\n            socket.on(\"page-deleted\", (data) => {\r\n                setPages(data.pages);\r\n                if (data.activePageId !== activePageId) {\r\n                    setActivePageId(data.activePageId);\r\n                    strokesRef.current = data.strokes || [];\r\n                    setStrokesVersion(v => v + 1);\r\n                    historyRef.current = [JSON.parse(JSON.stringify(data.strokes || []))];\r\n                    historyIndexRef.current = 0;\r\n                    redrawCanvas();\r\n                }\r\n                toast.success(\"Page deleted\");\r\n            });\r\n\r\n            socket.on(\"board-saved\", ({ pageId }) => {\r\n                toast.success(\"Board saved!\");\r\n            });\r\n\r\n            // Undo/Redo from remote\r\n            socket.on(\"undo\", () => { /* Remote undo handled via board-state-updated */ });\r\n            socket.on(\"redo\", () => { /* Remote redo handled via board-state-updated */ });\r\n        }\r\n\r\n        return () => {\r\n            if (socket) {\r\n                socket.emit(\"leave-room\", { roomId, userId: user._id, userName: user.name });\r\n                [\"user-joined\", \"online-users\", \"chat-message\", \"chat-history\", \"drawing\", \"erase\",\r\n                    \"board-cleared\", \"canvas-state\", \"undo\", \"redo\", \"user-left\", \"new-stroke\",\r\n                    \"board-state-updated\", \"new-file\", \"cursor-move\", \"typing-start\", \"typing-stop\",\r\n                    \"page-added\", \"page-switched\", \"board-saved\", \"page-deleted\", \"call:active\"].forEach(ev => socket.off(ev));\r\n            }\r\n        };\r\n    }, [roomId, socket, user, navigate]);\r\n\r\n    // â”€â”€â”€ CANVAS SETUP â”€â”€â”€\r\n    useEffect(() => {\r\n        const viewport = viewportRef.current;\r\n        const canvas = canvasRef.current;\r\n        if (!viewport || !canvas) return;\r\n\r\n        const updateCanvasSize = () => {\r\n            const dpr = window.devicePixelRatio || 1;\r\n            canvas.width = viewport.clientWidth * dpr;\r\n            canvas.height = viewport.clientHeight * dpr;\r\n\r\n            const context = canvas.getContext(\"2d\", { alpha: true });\r\n            if (context) {\r\n                context.lineCap = \"round\";\r\n                context.lineJoin = \"round\";\r\n                contextRef.current = context;\r\n            }\r\n\r\n            if (!snapshotCanvasRef.current) {\r\n                snapshotCanvasRef.current = document.createElement('canvas');\r\n            }\r\n            snapshotCanvasRef.current.width = canvas.width;\r\n            snapshotCanvasRef.current.height = canvas.height;\r\n            redrawCanvas();\r\n        };\r\n\r\n        const ro = new ResizeObserver(() => updateCanvasSize());\r\n        ro.observe(viewport);\r\n        return () => ro.disconnect();\r\n    }, []);\r\n\r\n    // Redraw when strokes change\r\n    useEffect(() => { redrawCanvas(); }, [strokesVersion]);\r\n\r\n    // â”€â”€â”€ ZOOM â”€â”€â”€\r\n    useEffect(() => {\r\n        const handleZoomIn = () => updateZoom(1.1);\r\n        const handleZoomOut = () => updateZoom(1 / 1.1);\r\n        const handleResetZoom = () => {\r\n            cameraScaleRef.current = 1;\r\n            cameraOffsetRef.current = { x: -4000 + window.innerWidth / 2, y: -4000 + window.innerHeight / 2 };\r\n            setCameraScale(1);\r\n            setCameraOffset(cameraOffsetRef.current);\r\n            syncViewDOM();\r\n        };\r\n\r\n        window.addEventListener('wb-zoom-in', handleZoomIn);\r\n        window.addEventListener('wb-zoom-out', handleZoomOut);\r\n        window.addEventListener('wb-reset-view', handleResetZoom);\r\n        return () => {\r\n            window.removeEventListener('wb-zoom-in', handleZoomIn);\r\n            window.removeEventListener('wb-zoom-out', handleZoomOut);\r\n            window.removeEventListener('wb-reset-view', handleResetZoom);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const viewport = viewportRef.current;\r\n        if (!viewport) return;\r\n\r\n        const handleWheel = (e) => {\r\n            e.preventDefault();\r\n            if (e.ctrlKey) {\r\n                const zoomSpeed = 0.0012;\r\n                const delta = -e.deltaY * zoomSpeed * cameraScaleRef.current;\r\n                const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current + delta));\r\n                const rect = viewport.getBoundingClientRect();\r\n                const mouseX = e.clientX - rect.left;\r\n                const mouseY = e.clientY - rect.top;\r\n                const worldX = (mouseX - cameraOffsetRef.current.x) / cameraScaleRef.current;\r\n                const worldY = (mouseY - cameraOffsetRef.current.y) / cameraScaleRef.current;\r\n                cameraScaleRef.current = newScale;\r\n                cameraOffsetRef.current = { x: mouseX - worldX * newScale, y: mouseY - worldY * newScale };\r\n                setCameraScale(newScale);\r\n                setCameraOffset(cameraOffsetRef.current);\r\n                syncViewDOM();\r\n            } else {\r\n                cameraOffsetRef.current = {\r\n                    x: cameraOffsetRef.current.x - e.deltaX,\r\n                    y: cameraOffsetRef.current.y - e.deltaY\r\n                };\r\n                syncViewDOM();\r\n                setCameraOffset(cameraOffsetRef.current);\r\n            }\r\n        };\r\n\r\n        viewport.addEventListener('wheel', handleWheel, { passive: false });\r\n        return () => viewport.removeEventListener('wheel', handleWheel);\r\n    }, []);\r\n\r\n    const updateZoom = (factor) => {\r\n        const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current * factor));\r\n        const centerX = window.innerWidth / 2;\r\n        const centerY = window.innerHeight / 2;\r\n        const worldX = (centerX - cameraOffsetRef.current.x) / cameraScaleRef.current;\r\n        const worldY = (centerY - cameraOffsetRef.current.y) / cameraScaleRef.current;\r\n        cameraScaleRef.current = newScale;\r\n        cameraOffsetRef.current = { x: centerX - worldX * newScale, y: centerY - worldY * newScale };\r\n        setCameraScale(newScale);\r\n        setCameraOffset(cameraOffsetRef.current);\r\n        syncViewDOM();\r\n    };\r\n\r\n    const syncViewDOM = () => {\r\n        if (viewportRef.current) {\r\n            const ox = cameraOffsetRef.current.x;\r\n            const oy = cameraOffsetRef.current.y;\r\n            // Only update position â€” React handles backgroundImage & backgroundSize via inline styles\r\n            viewportRef.current.style.backgroundPosition = `${ox}px ${oy}px`;\r\n        }\r\n        redrawCanvas();\r\n    };\r\n\r\n    // â”€â”€â”€ CANVAS RENDERING (Pure stroke-based, no bitmap ghosts) â”€â”€â”€\r\n    const redrawCanvas = useCallback(() => {\r\n        const canvas = canvasRef.current;\r\n        const ctx = contextRef.current;\r\n        if (!canvas || !ctx) return;\r\n\r\n        const dpr = window.devicePixelRatio || 1;\r\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n        // Apply Camera Transform\r\n        ctx.setTransform(\r\n            cameraScaleRef.current * dpr, 0,\r\n            0, cameraScaleRef.current * dpr,\r\n            cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr\r\n        );\r\n\r\n        // Render all strokes â€” strokes are the ONLY source of truth\r\n        strokesRef.current.forEach(stroke => renderStroke(ctx, stroke));\r\n    }, []);\r\n\r\n    const renderStroke = (ctx, stroke) => {\r\n        const { type, points, color, size, opacity, strokeStyle, fill } = stroke;\r\n\r\n        if (type === 'text') {\r\n            ctx.save();\r\n            ctx.font = `bold ${size}px Inter, sans-serif`;\r\n            ctx.fillStyle = color;\r\n            ctx.globalAlpha = opacity;\r\n            ctx.globalCompositeOperation = \"source-over\";\r\n            ctx.shadowBlur = 0;\r\n            ctx.fillText(stroke.text || '', points[0].x, points[0].y);\r\n            ctx.restore();\r\n            return;\r\n        }\r\n\r\n        if (type === 'image') {\r\n            const cached = imageCache.current.get(stroke.src);\r\n            if (cached) {\r\n                ctx.save();\r\n                ctx.globalAlpha = stroke.opacity || 1;\r\n                ctx.drawImage(cached, points[0].x, points[0].y, stroke.imgW || 300, stroke.imgH || 200);\r\n                ctx.restore();\r\n            } else {\r\n                const img = new window.Image();\r\n                img.onload = () => { imageCache.current.set(stroke.src, img); redrawCanvas(); };\r\n                img.src = stroke.src;\r\n            }\r\n            return;\r\n        }\r\n\r\n        ctx.save();\r\n\r\n        if (type === 'eraser-precision' || type === 'mask') {\r\n            ctx.globalCompositeOperation = \"destination-out\";\r\n        } else {\r\n            ctx.globalCompositeOperation = \"source-over\";\r\n            ctx.globalAlpha = opacity;\r\n            ctx.strokeStyle = color;\r\n            ctx.fillStyle = color;\r\n            ctx.lineWidth = size;\r\n            ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\r\n            if (type === 'soft-brush') { ctx.shadowBlur = size / 2; ctx.shadowColor = color; }\r\n            if (type === 'marker') { ctx.globalAlpha = opacity * 0.6; }\r\n        }\r\n\r\n        if (['pencil', 'highlighter', 'soft-brush', 'marker', 'smooth-pencil', 'eraser-precision'].includes(type)) {\r\n            if (points.length < 2) { ctx.restore(); return; }\r\n            ctx.beginPath();\r\n            ctx.moveTo(points[0].x, points[0].y);\r\n            for (let i = 1; i < points.length; i++) ctx.lineTo(points[i].x, points[i].y);\r\n            ctx.stroke();\r\n        } else {\r\n            drawShape(ctx, type, points, { color, size, opacity, strokeStyle, fill });\r\n        }\r\n        ctx.restore();\r\n    };\r\n\r\n    const drawShape = (ctx, type, points, style) => {\r\n        const start = points[0];\r\n        const end = points[points.length - 1];\r\n        const w = end.x - start.x;\r\n        const h = end.y - start.y;\r\n\r\n        if (type === 'rect') {\r\n            if (style.fill) ctx.fillRect(start.x, start.y, w, h);\r\n            ctx.strokeRect(start.x, start.y, w, h);\r\n        } else if (type === 'rounded-rect') {\r\n            ctx.beginPath();\r\n            ctx.roundRect(start.x, start.y, w, h, Math.min(Math.abs(w), Math.abs(h)) * 0.2);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'circle' || type === 'ellipse') {\r\n            ctx.beginPath();\r\n            if (type === 'circle') {\r\n                const radius = Math.sqrt(w * w + h * h);\r\n                ctx.arc(start.x, start.y, radius, 0, 2 * Math.PI);\r\n            } else {\r\n                ctx.ellipse(start.x + w / 2, start.y + h / 2, Math.abs(w / 2), Math.abs(h / 2), 0, 0, 2 * Math.PI);\r\n            }\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'triangle') {\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x + w / 2, start.y);\r\n            ctx.lineTo(end.x, end.y);\r\n            ctx.lineTo(start.x, end.y);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'diamond') {\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x + w / 2, start.y);\r\n            ctx.lineTo(end.x, start.y + h / 2);\r\n            ctx.lineTo(start.x + w / 2, end.y);\r\n            ctx.lineTo(start.x, start.y + h / 2);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'line' || type === 'arrow' || type === 'double-arrow') {\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x, start.y);\r\n            ctx.lineTo(end.x, end.y);\r\n            ctx.stroke();\r\n            if (type === 'arrow' || type === 'double-arrow') drawArrowHead(ctx, start.x, start.y, end.x, end.y, style.size);\r\n            if (type === 'double-arrow') drawArrowHead(ctx, end.x, end.y, start.x, start.y, style.size);\r\n        } else if (type === 'sticky') {\r\n            ctx.save();\r\n            ctx.fillStyle = style.fill ? style.color : \"#fef08a\";\r\n            ctx.shadowBlur = 10;\r\n            ctx.shadowColor = \"rgba(0,0,0,0.1)\";\r\n            ctx.fillRect(start.x, start.y, w, h);\r\n            ctx.strokeStyle = \"rgba(0,0,0,0.05)\";\r\n            ctx.strokeRect(start.x, start.y, w, h);\r\n            ctx.restore();\r\n        } else if (type === 'speech-bubble') {\r\n            ctx.beginPath();\r\n            ctx.roundRect(start.x, start.y, w, h * 0.8, 10);\r\n            ctx.moveTo(start.x + w * 0.2, start.y + h * 0.8);\r\n            ctx.lineTo(start.x + w * 0.1, end.y);\r\n            ctx.lineTo(start.x + w * 0.4, start.y + h * 0.8);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'parallelogram') {\r\n            const shift = w * 0.2;\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x + shift, start.y);\r\n            ctx.lineTo(end.x, start.y);\r\n            ctx.lineTo(end.x - shift, end.y);\r\n            ctx.lineTo(start.x, end.y);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'cylinder') {\r\n            const ry = Math.abs(h * 0.1);\r\n            ctx.beginPath();\r\n            ctx.ellipse(start.x + w / 2, end.y - ry, Math.abs(w / 2), ry, 0, 0, Math.PI, false);\r\n            ctx.stroke();\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x, start.y + ry);\r\n            ctx.lineTo(start.x, end.y - ry);\r\n            ctx.moveTo(end.x, start.y + ry);\r\n            ctx.lineTo(end.x, end.y - ry);\r\n            ctx.stroke();\r\n            ctx.beginPath();\r\n            ctx.ellipse(start.x + w / 2, start.y + ry, Math.abs(w / 2), ry, 0, 0, 2 * Math.PI);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'document') {\r\n            const fold = Math.min(w, h) * 0.2;\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x, start.y);\r\n            ctx.lineTo(end.x - fold, start.y);\r\n            ctx.lineTo(end.x, start.y + fold);\r\n            ctx.lineTo(end.x, end.y);\r\n            ctx.lineTo(start.x, end.y);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n            ctx.beginPath();\r\n            ctx.moveTo(end.x - fold, start.y);\r\n            ctx.lineTo(end.x - fold, start.y + fold);\r\n            ctx.lineTo(end.x, start.y + fold);\r\n            ctx.stroke();\r\n        } else if (type === 'cloud') {\r\n            ctx.beginPath();\r\n            const mw = start.x + w / 2;\r\n            const mh = start.y + h / 2;\r\n            ctx.arc(mw - w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            ctx.arc(mw + w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            ctx.arc(mw, mh - h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            ctx.arc(mw, mh + h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        }\r\n    };\r\n\r\n    const drawArrowHead = (ctx, fromx, fromy, tox, toy, weight) => {\r\n        const headlen = weight * 4;\r\n        const angle = Math.atan2(toy - fromy, tox - fromx);\r\n        ctx.save();\r\n        ctx.translate(tox, toy);\r\n        ctx.rotate(angle);\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, 0);\r\n        ctx.lineTo(-headlen, -headlen / 2);\r\n        ctx.lineTo(-headlen, headlen / 2);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n        ctx.restore();\r\n    };\r\n\r\n    const getMousePos = (e) => {\r\n        const viewport = viewportRef.current;\r\n        if (!viewport) return { x: 0, y: 0 };\r\n        const rect = viewport.getBoundingClientRect();\r\n        return {\r\n            x: (e.clientX - rect.left - cameraOffsetRef.current.x) / cameraScaleRef.current,\r\n            y: (e.clientY - rect.top - cameraOffsetRef.current.y) / cameraScaleRef.current\r\n        };\r\n    };\r\n\r\n    // â”€â”€â”€ ERASER: Stroke removal (no ghost rendering) â”€â”€â”€\r\n    const eraseObjectAt = (pos) => {\r\n        const threshold = 15;\r\n        const newStrokes = strokesRef.current.filter(stroke => {\r\n            return !stroke.points.some(p => {\r\n                const dist = Math.sqrt(Math.pow(p.x - pos.x, 2) + Math.pow(p.y - pos.y, 2));\r\n                return dist < threshold;\r\n            });\r\n        });\r\n\r\n        if (newStrokes.length !== strokesRef.current.length) {\r\n            strokesRef.current = newStrokes;\r\n            setStrokesVersion(v => v + 1);\r\n            redrawCanvas();\r\n            // Sync erased state to all clients and DB\r\n            socket.emit(\"update-board-state\", { roomId, strokes: newStrokes, pageId: activePageId });\r\n        }\r\n    };\r\n\r\n    // â”€â”€â”€ DRAWING â”€â”€â”€\r\n    const startDrawing = (e) => {\r\n        if (e.button === 1 || tool === 'pan') {\r\n            isPanningRef.current = true;\r\n            panStartRef.current = { x: e.clientX - cameraOffsetRef.current.x, y: e.clientY - cameraOffsetRef.current.y };\r\n            return;\r\n        }\r\n\r\n        const canvas = canvasRef.current;\r\n        if (!canvas || !contextRef.current) return;\r\n        const pos = getMousePos(e);\r\n\r\n        if (tool === 'select') return;\r\n\r\n        if (tool === 'upload') {\r\n            imagePlacePosRef.current = pos;\r\n            imageFileRef.current?.click();\r\n            return;\r\n        }\r\n\r\n        if (tool === 'eraser') {\r\n            eraseObjectAt(pos);\r\n            return;\r\n        }\r\n\r\n        if (tool === 'text') {\r\n            const textInput = prompt('Enter text:');\r\n            if (!textInput) return;\r\n            const textStroke = {\r\n                id: Date.now() + Math.random(), type: 'text', text: textInput,\r\n                points: [pos], color, size: size * 4, opacity, strokeStyle, fill\r\n            };\r\n            strokesRef.current = [...strokesRef.current, textStroke];\r\n            setStrokesVersion(v => v + 1);\r\n            pushToHistory();\r\n            socket.emit('new-stroke', { roomId, stroke: textStroke, pageId: activePageId });\r\n            redrawCanvas();\r\n            return;\r\n        }\r\n\r\n        isDrawingRef.current = true;\r\n        currentPointsRef.current = [pos];\r\n        startPosRef.current = pos;\r\n        lastPosRef.current = pos;\r\n\r\n        // Take snapshot for shape preview\r\n        const snapCtx = snapshotCanvasRef.current.getContext('2d');\r\n        snapCtx.setTransform(1, 0, 0, 1, 0, 0);\r\n        snapCtx.clearRect(0, 0, canvas.width, canvas.height);\r\n        snapCtx.drawImage(canvas, 0, 0);\r\n\r\n        if (isDrawingTool) {\r\n            const ctx = contextRef.current;\r\n            const dpr = window.devicePixelRatio || 1;\r\n            ctx.setTransform(\r\n                cameraScaleRef.current * dpr, 0,\r\n                0, cameraScaleRef.current * dpr,\r\n                cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr\r\n            );\r\n            ctx.beginPath();\r\n            ctx.moveTo(pos.x, pos.y);\r\n            ctx.lineWidth = size;\r\n            ctx.strokeStyle = color;\r\n            ctx.globalAlpha = tool === \"highlighter\" ? (opacity * 0.4) :\r\n                tool === \"marker\" ? (opacity * 0.6) : opacity;\r\n            ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\r\n            ctx.lineCap = \"round\";\r\n            ctx.lineJoin = \"round\";\r\n            ctx.globalCompositeOperation = (tool === \"precision-eraser\") ? \"destination-out\" : \"source-over\";\r\n            ctx.shadowBlur = 0;\r\n        }\r\n    };\r\n\r\n    const handleMouseMove = (e) => {\r\n        const now = Date.now();\r\n        if (socket && now - lastCursorEmitRef.current > 50) {\r\n            lastCursorEmitRef.current = now;\r\n            socket.emit('cursor-move', { roomId, cursorData: { x: e.clientX, y: e.clientY, userName: user.name, color } });\r\n        }\r\n\r\n        if (isPanningRef.current) {\r\n            cameraOffsetRef.current = {\r\n                x: e.clientX - panStartRef.current.x,\r\n                y: e.clientY - panStartRef.current.y\r\n            };\r\n            syncViewDOM();\r\n            return;\r\n        }\r\n\r\n        if (isDrawingRef.current) {\r\n            if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\r\n            const clientX = e.clientX;\r\n            const clientY = e.clientY;\r\n            const shiftKey = e.shiftKey;\r\n            animationFrameRef.current = requestAnimationFrame(() => draw({ clientX, clientY, shiftKey }));\r\n        } else if (interactionRef.current.type) {\r\n            const pos = getMousePos(e);\r\n            const dx = pos.x - interactionRef.current.startPos.x;\r\n            const dy = pos.y - interactionRef.current.startPos.y;\r\n            const strokeId = interactionRef.current.strokeId;\r\n\r\n            const newStrokes = strokesRef.current.map(s => {\r\n                if (s.id !== strokeId) return s;\r\n\r\n                if (interactionRef.current.type === 'move') {\r\n                    const newPoints = interactionRef.current.originalPoints.map(p => ({\r\n                        x: p.x + dx,\r\n                        y: p.y + dy\r\n                    }));\r\n                    return { ...s, points: newPoints };\r\n                } else if (interactionRef.current.type === 'resize') {\r\n                    if (s.type === 'image') {\r\n                        return {\r\n                            ...s,\r\n                            imgW: Math.max(50, interactionRef.current.originalImgW + dx),\r\n                            imgH: Math.max(50, interactionRef.current.originalImgH + dy)\r\n                        };\r\n                    } else if (s.type === 'sticky') {\r\n                        const start = interactionRef.current.originalPoints[0];\r\n                        const newEnd = {\r\n                            x: Math.max(start.x + 50, interactionRef.current.originalPoints[1].x + dx),\r\n                            y: Math.max(start.y + 50, interactionRef.current.originalPoints[1].y + dy)\r\n                        };\r\n                        return { ...s, points: [start, newEnd] };\r\n                    }\r\n                }\r\n                return s;\r\n            });\r\n\r\n            strokesRef.current = newStrokes;\r\n            setStrokesVersion(v => v + 1);\r\n            redrawCanvas();\r\n\r\n            // Emit update to others\r\n            const updatedStroke = strokesRef.current.find(s => s.id === strokeId);\r\n            if (socket && updatedStroke) {\r\n                socket.emit('update-stroke', { roomId, stroke: updatedStroke, pageId: activePageId });\r\n            }\r\n        } else if (tool === 'eraser' && e.buttons === 1) {\r\n            eraseObjectAt(getMousePos(e));\r\n        }\r\n    };\r\n\r\n    const draw = (e) => {\r\n        if (!isDrawingRef.current || !contextRef.current) return;\r\n        const pos = getMousePos(e);\r\n        let currentPos = pos;\r\n\r\n        if (tool === 'smooth-pencil' && currentPointsRef.current.length > 0) {\r\n            const lastPoint = currentPointsRef.current[currentPointsRef.current.length - 1];\r\n            currentPos = {\r\n                x: lastPoint.x * 0.8 + pos.x * 0.2,\r\n                y: lastPoint.y * 0.8 + pos.y * 0.2,\r\n                shiftKey: e.shiftKey\r\n            };\r\n        } else {\r\n            currentPos = { ...pos, shiftKey: e.shiftKey };\r\n        }\r\n\r\n        currentPointsRef.current.push(currentPos);\r\n        const ctx = contextRef.current;\r\n\r\n        if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\", \"precision-eraser\"].includes(tool)) {\r\n            if (e.shiftKey) {\r\n                redrawCanvas();\r\n                ctx.beginPath();\r\n                ctx.moveTo(startPosRef.current.x, startPosRef.current.y);\r\n                ctx.lineTo(currentPos.x, currentPos.y);\r\n                ctx.stroke();\r\n                return;\r\n            }\r\n            ctx.lineTo(currentPos.x, currentPos.y);\r\n            ctx.stroke();\r\n\r\n            // Throttled emit for real-time collab\r\n            socket.emit(\"drawing\", {\r\n                roomId,\r\n                drawingData: {\r\n                    x: currentPos.x, y: currentPos.y,\r\n                    prevX: lastPosRef.current.x, prevY: lastPosRef.current.y,\r\n                    color, size, opacity: ctx.globalAlpha, tool\r\n                }\r\n            });\r\n            lastPosRef.current = currentPos;\r\n        } else if ([\"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\", \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\", \"cylinder\", \"document\", \"cloud\"].includes(tool)) {\r\n            const dpr = window.devicePixelRatio || 1;\r\n            ctx.setTransform(1, 0, 0, 1, 0, 0);\r\n            ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n            ctx.drawImage(snapshotCanvasRef.current, 0, 0);\r\n            ctx.setTransform(\r\n                cameraScaleRef.current * dpr, 0,\r\n                0, cameraScaleRef.current * dpr,\r\n                cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr\r\n            );\r\n            drawShape(ctx, tool, [startPosRef.current, currentPos], { color, size, opacity, strokeStyle, fill });\r\n        }\r\n    };\r\n\r\n    const stopDrawing = () => {\r\n        if (interactionRef.current.type) {\r\n            interactionRef.current = { type: null, strokeId: null, startPos: { x: 0, y: 0 }, originalPoints: [], originalImgW: 0, originalImgH: 0 };\r\n            pushToHistory();\r\n            return;\r\n        }\r\n\r\n        if (isPanningRef.current) {\r\n            isPanningRef.current = false;\r\n            setCameraOffset(cameraOffsetRef.current);\r\n            return;\r\n        }\r\n\r\n        const canvas = canvasRef.current;\r\n        if (!isDrawingRef.current || !canvas) return;\r\n        if (animationFrameRef.current) cancelAnimationFrame(animationFrameRef.current);\r\n\r\n        isDrawingRef.current = false;\r\n        let points = [...currentPointsRef.current];\r\n\r\n        if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\"].includes(tool) && points.length > 1 && points[points.length - 1].shiftKey) {\r\n            points = [points[0], points[points.length - 1]];\r\n        }\r\n\r\n        const newStroke = {\r\n            id: Date.now() + Math.random(),\r\n            type: tool === 'precision-eraser' ? 'eraser-precision' : tool,\r\n            points,\r\n            color,\r\n            size: tool === 'precision-eraser' ? 10 : size,\r\n            opacity: tool === 'highlighter' ? 0.4 : tool === 'marker' ? 0.6 : opacity,\r\n            strokeStyle,\r\n            fill\r\n        };\r\n\r\n        if (tool !== 'eraser') {\r\n            strokesRef.current = [...strokesRef.current, newStroke];\r\n            setStrokesVersion(v => v + 1);\r\n            pushToHistory();\r\n            socket.emit(\"new-stroke\", { roomId, stroke: newStroke, pageId: activePageId });\r\n        }\r\n\r\n        currentPointsRef.current = [];\r\n        // NO bitmap save â€” strokes are the source of truth\r\n    };\r\n\r\n    // â”€â”€â”€ UNDO / REDO (stroke-based) â”€â”€â”€\r\n    const handleUndo = () => {\r\n        if (historyIndexRef.current > 0) {\r\n            historyIndexRef.current -= 1;\r\n            const snapshot = historyRef.current[historyIndexRef.current];\r\n            strokesRef.current = JSON.parse(JSON.stringify(snapshot));\r\n            setStrokesVersion(v => v + 1);\r\n            redrawCanvas();\r\n            socket.emit(\"update-board-state\", { roomId, strokes: strokesRef.current, pageId: activePageId });\r\n        }\r\n    };\r\n\r\n    const handleRedo = () => {\r\n        if (historyIndexRef.current < historyRef.current.length - 1) {\r\n            historyIndexRef.current += 1;\r\n            const snapshot = historyRef.current[historyIndexRef.current];\r\n            strokesRef.current = JSON.parse(JSON.stringify(snapshot));\r\n            setStrokesVersion(v => v + 1);\r\n            redrawCanvas();\r\n            socket.emit(\"update-board-state\", { roomId, strokes: strokesRef.current, pageId: activePageId });\r\n        }\r\n    };\r\n\r\n    const drawRemote = (data) => {\r\n        const { x, y, prevX, prevY, color, size, opacity, tool } = data;\r\n        const ctx = contextRef.current;\r\n        if (!ctx) return;\r\n        const dpr = window.devicePixelRatio || 1;\r\n        ctx.save();\r\n        ctx.setTransform(\r\n            cameraScaleRef.current * dpr, 0,\r\n            0, cameraScaleRef.current * dpr,\r\n            cameraOffsetRef.current.x * dpr, cameraOffsetRef.current.y * dpr\r\n        );\r\n        ctx.globalAlpha = opacity || 1;\r\n        ctx.strokeStyle = color;\r\n        ctx.lineWidth = size;\r\n        ctx.lineCap = \"round\";\r\n        ctx.lineJoin = \"round\";\r\n        ctx.globalCompositeOperation = (tool === \"precision-eraser\") ? \"destination-out\" : \"source-over\";\r\n        ctx.beginPath();\r\n        if (prevX && prevY) ctx.moveTo(prevX, prevY);\r\n        else ctx.moveTo(x, y);\r\n        ctx.lineTo(x, y);\r\n        ctx.stroke();\r\n        ctx.restore();\r\n    };\r\n\r\n    const eraseRemote = (data) => {\r\n        // Remote erase is now handled via board-state-updated\r\n    };\r\n\r\n    const handleClearBoard = () => {\r\n        if (window.confirm('Clear all drawings for everyone?'))\r\n            socket.emit('clear-board', { roomId, userId: user._id, pageId: activePageId });\r\n    };\r\n\r\n    const downloadCanvas = () => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) return;\r\n        const link = document.createElement('a');\r\n        link.download = `${room?.roomName || 'whiteboard'}-${Date.now()}.png`;\r\n        link.href = canvas.toDataURL('image/png');\r\n        link.click();\r\n        toast.success('Board exported as PNG!');\r\n    };\r\n\r\n    const handleImageUpload = (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const reader = new FileReader();\r\n        reader.onload = (ev) => {\r\n            const src = ev.target.result;\r\n            const img = new window.Image();\r\n            img.onload = () => {\r\n                const maxW = 400;\r\n                const scale = Math.min(1, maxW / img.width);\r\n                const imgW = Math.round(img.width * scale);\r\n                const imgH = Math.round(img.height * scale);\r\n                const pos = imagePlacePosRef.current;\r\n                imageCache.current.set(src, img);\r\n                const imageStroke = {\r\n                    id: Date.now() + Math.random(),\r\n                    type: 'image', src,\r\n                    points: [pos], imgW, imgH,\r\n                    color, size, opacity, strokeStyle, fill\r\n                };\r\n                strokesRef.current = [...strokesRef.current, imageStroke];\r\n                setStrokesVersion(v => v + 1);\r\n                pushToHistory();\r\n                if (socket) socket.emit('new-stroke', { roomId, stroke: imageStroke, pageId: activePageId });\r\n                redrawCanvas();\r\n            };\r\n            img.src = src;\r\n        };\r\n        reader.readAsDataURL(file);\r\n        e.target.value = '';\r\n    };\r\n\r\n    // Import image directly to center of current viewport\r\n    const handleImportImage = (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n        const reader = new FileReader();\r\n        reader.onload = (ev) => {\r\n            const src = ev.target.result;\r\n            const img = new window.Image();\r\n            img.onload = () => {\r\n                const maxW = 250; // Card-sized import\r\n                const scale = Math.min(1, maxW / img.width);\r\n                const imgW = Math.round(img.width * scale);\r\n                const imgH = Math.round(img.height * scale);\r\n                // Place at center of current viewport\r\n                const viewportW = viewportRef.current?.clientWidth || window.innerWidth;\r\n                const viewportH = viewportRef.current?.clientHeight || window.innerHeight;\r\n                const centerX = (viewportW / 2 - cameraOffsetRef.current.x) / cameraScaleRef.current;\r\n                const centerY = (viewportH / 2 - cameraOffsetRef.current.y) / cameraScaleRef.current;\r\n                const pos = { x: centerX - imgW / 2, y: centerY - imgH / 2 };\r\n                imageCache.current.set(src, img);\r\n                const imageStroke = {\r\n                    id: Date.now() + Math.random(),\r\n                    type: 'image', src,\r\n                    points: [pos], imgW, imgH,\r\n                    color, size, opacity, strokeStyle, fill\r\n                };\r\n                strokesRef.current = [...strokesRef.current, imageStroke];\r\n                setStrokesVersion(v => v + 1);\r\n                pushToHistory();\r\n                if (socket) socket.emit('new-stroke', { roomId, stroke: imageStroke, pageId: activePageId });\r\n                redrawCanvas();\r\n                toast.success('Image imported!');\r\n            };\r\n            img.src = src;\r\n        };\r\n        reader.readAsDataURL(file);\r\n        e.target.value = '';\r\n    };\r\n\r\n    // â”€â”€â”€ PAGE MANAGEMENT â”€â”€â”€\r\n    const handleSaveBoard = () => {\r\n        socket.emit(\"save-board\", { roomId, pageId: activePageId });\r\n    };\r\n\r\n    const handleNewPage = () => {\r\n        socket.emit(\"new-page\", { roomId, userId: user._id });\r\n    };\r\n\r\n    const handleSwitchPage = (pageId) => {\r\n        if (pageId === activePageId) return;\r\n        socket.emit(\"switch-page\", { roomId, pageId });\r\n    };\r\n\r\n    const handleUpdateRoomName = async () => {\r\n        if (!tempBoardName.trim()) return setIsEditingName(false);\r\n        try {\r\n            // Simplified: only local update for now as we don't have the API yet\r\n            // But we update the room state\r\n            setRoom(prev => ({ ...prev, roomName: tempBoardName }));\r\n            setIsEditingName(false);\r\n            toast.success(\"Board renamed\");\r\n        } catch (err) {\r\n            toast.error(\"Rename failed\");\r\n        }\r\n    };\r\n\r\n\r\n    const handleDeletePage = (e, pageId) => {\r\n        e.stopPropagation(); // Prevent switching to page while deleting\r\n        if (pages.length <= 1) {\r\n            toast.error(\"Cannot delete the last page\");\r\n            return;\r\n        }\r\n        if (window.confirm(\"Are you sure you want to delete this page? All drawings on it will be lost.\")) {\r\n            socket.emit(\"delete-page\", { roomId, pageId, userId: user._id });\r\n        }\r\n    };\r\n\r\n    // â”€â”€â”€ KEYBOARD SHORTCUTS â”€â”€â”€\r\n    React.useEffect(() => {\r\n        const onKey = (e) => {\r\n            if (['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;\r\n            if (e.ctrlKey || e.metaKey) {\r\n                if (e.key === 'z') { e.preventDefault(); handleUndo(); }\r\n                if (e.key === 'y') { e.preventDefault(); handleRedo(); }\r\n                return;\r\n            }\r\n            const map = { v: 'select', h: 'pan', p: 'pencil', e: 'eraser', t: 'text' };\r\n            if (map[e.key.toLowerCase()]) setTool(map[e.key.toLowerCase()]);\r\n        };\r\n        window.addEventListener('keydown', onKey);\r\n        return () => window.removeEventListener('keydown', onKey);\r\n    }, []);\r\n\r\n    // Unread messages badge\r\n    const [unreadCount, setUnreadCount] = useState(0);\r\n    useEffect(() => {\r\n        if (!isSidebarOpen && messages.length > 0) {\r\n            setUnreadCount(prev => prev + 1);\r\n        }\r\n    }, [messages.length]);\r\n    useEffect(() => {\r\n        if (isSidebarOpen) setUnreadCount(0);\r\n    }, [isSidebarOpen]);\r\n\r\n    return (\r\n        <div className={`wb-layout-container ${darkMode ? 'wb-dark' : ''}`} data-sidebar={isSidebarOpen ? \"open\" : \"closed\"}>\r\n            <header className=\"wb-header-modern\">\r\n                {/* LEFT: Identity */}\r\n                <div className=\"wb-header-left\">\r\n                    <div className=\"wb-logo-box\" onClick={() => navigate('/dashboard')}>\r\n                        <span>S</span>\r\n                    </div>\r\n                    {isEditingName ? (\r\n                        <div className=\"wb-name-edit\">\r\n                            <input\r\n                                autoFocus\r\n                                value={tempBoardName}\r\n                                onChange={(e) => setTempBoardName(e.target.value)}\r\n                                onBlur={handleUpdateRoomName}\r\n                                onKeyDown={(e) => e.key === 'Enter' && handleUpdateRoomName()}\r\n                            />\r\n                            <Check size={14} className=\"text-emerald-500\" />\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"wb-name-display\" onClick={() => setIsEditingName(true)}>\r\n                            <h1>{room?.roomName || 'Untitled Board'}</h1>\r\n                            <Edit2 size={12} className=\"wb-edit-icon\" />\r\n                        </div>\r\n                    )}\r\n                    <span className=\"wb-id-badge\">\r\n                        ID: {roomId}\r\n                        <button\r\n                            className=\"wb-id-copy-btn\"\r\n                            title=\"Copy Room ID\"\r\n                            onClick={() => {\r\n                                navigator.clipboard.writeText(roomId);\r\n                                toast.success('Room ID copied!', { duration: 1500, style: { fontSize: '12px' } });\r\n                            }}\r\n                        >\r\n                            <Copy size={11} />\r\n                        </button>\r\n                    </span>\r\n                    <div className=\"wb-online-pill\">\r\n                        <span className=\"wb-status-dot\"></span>\r\n                        {participants.length}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* CENTER: Drawing Controls */}\r\n                <div className=\"wb-header-center\">\r\n                    {isDrawingTool && (\r\n                        <div className=\"wb-toolbar-controls-modern\">\r\n                            {/* Color */}\r\n                            <div className=\"wb-dropdown-container\">\r\n                                <button\r\n                                    className={`wb-dropdown-trigger ${activeDropdown === 'color' ? 'active' : ''}`}\r\n                                    onClick={() => setActiveDropdown(activeDropdown === 'color' ? null : 'color')}\r\n                                    title=\"Color\"\r\n                                >\r\n                                    <div className=\"wb-color-preview\" style={{ backgroundColor: color }}></div>\r\n                                    <ChevronDown size={12} />\r\n                                </button>\r\n                                {activeDropdown === 'color' && (\r\n                                    <div className=\"wb-dropdown-menu wb-color-menu\">\r\n                                        <div className=\"wb-color-grid-modern\">\r\n                                            {colors.map(c => (\r\n                                                <button\r\n                                                    key={c}\r\n                                                    onClick={() => { setColor(c); setActiveDropdown(null); }}\r\n                                                    className={`wb-color-box ${color === c ? 'selected' : ''}`}\r\n                                                    style={{ backgroundColor: c }}\r\n                                                />\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"wb-header-divider-mini\"></div>\r\n\r\n                            {/* Size */}\r\n                            <div className=\"wb-dropdown-container\">\r\n                                <button\r\n                                    className={`wb-dropdown-trigger ${activeDropdown === 'size' ? 'active' : ''}`}\r\n                                    onClick={() => setActiveDropdown(activeDropdown === 'size' ? null : 'size')}\r\n                                    title=\"Line Width\"\r\n                                >\r\n                                    <span className=\"text-[10px] font-bold\">{size}px</span>\r\n                                    <ChevronDown size={12} />\r\n                                </button>\r\n                                {activeDropdown === 'size' && (\r\n                                    <div className=\"wb-dropdown-menu\">\r\n                                        {[1, 2, 4, 8, 12, 16, 24, 32].map(s => (\r\n                                            <button\r\n                                                key={s}\r\n                                                className={`wb-menu-item ${size === s ? 'active' : ''}`}\r\n                                                onClick={() => { setSize(s); setActiveDropdown(null); }}\r\n                                            >\r\n                                                <div className=\"wb-size-preview\" style={{ height: `${Math.min(s / 2, 12)}px`, width: '16px' }}></div>\r\n                                                <span>{s}px</span>\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"wb-header-divider-mini\"></div>\r\n\r\n                            {/* Opacity */}\r\n                            <div className=\"wb-dropdown-container\">\r\n                                <button\r\n                                    className={`wb-dropdown-trigger ${activeDropdown === 'opacity' ? 'active' : ''}`}\r\n                                    onClick={() => setActiveDropdown(activeDropdown === 'opacity' ? null : 'opacity')}\r\n                                    title=\"Opacity\"\r\n                                >\r\n                                    <span className=\"text-[10px] font-bold\">{Math.round(opacity * 100)}%</span>\r\n                                    <ChevronDown size={12} />\r\n                                </button>\r\n                                {activeDropdown === 'opacity' && (\r\n                                    <div className=\"wb-dropdown-menu\">\r\n                                        {[0.1, 0.2, 0.4, 0.6, 0.8, 1].map(o => (\r\n                                            <button\r\n                                                key={o}\r\n                                                className={`wb-menu-item ${opacity === o ? 'active' : ''}`}\r\n                                                onClick={() => { setOpacity(o); setActiveDropdown(null); }}\r\n                                            >\r\n                                                <div className=\"wb-opacity-preview\" style={{ opacity: o, height: '8px', width: '16px' }}></div>\r\n                                                <span>{Math.round(o * 100)}%</span>\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"wb-header-divider-mini\"></div>\r\n\r\n                            {/* Style */}\r\n                            <div className=\"wb-dropdown-container\">\r\n                                <button\r\n                                    className={`wb-dropdown-trigger ${activeDropdown === 'style' ? 'active' : ''}`}\r\n                                    onClick={() => setActiveDropdown(activeDropdown === 'style' ? null : 'style')}\r\n                                    title=\"Line Type\"\r\n                                >\r\n                                    {strokeStyle === 'solid' ? <Minus size={14} /> : <Sliders size={14} />}\r\n                                    <ChevronDown size={12} />\r\n                                </button>\r\n                                {activeDropdown === 'style' && (\r\n                                    <div className=\"wb-dropdown-menu\">\r\n                                        <button\r\n                                            className={`wb-menu-item ${strokeStyle === 'solid' ? 'active' : ''}`}\r\n                                            onClick={() => { setStrokeStyle('solid'); setActiveDropdown(null); }}\r\n                                        >\r\n                                            <Minus size={14} /> <span>Solid</span>\r\n                                        </button>\r\n                                        <button\r\n                                            className={`wb-menu-item ${strokeStyle === 'dashed' ? 'active' : ''}`}\r\n                                            onClick={() => { setStrokeStyle('dashed'); setActiveDropdown(null); }}\r\n                                        >\r\n                                            <Sliders size={14} /> <span>Dashed</span>\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* RIGHT: Actions */}\r\n                <div className=\"wb-header-right\">\r\n                    <div className=\"wb-action-group\">\r\n                        <button\r\n                            className={`wb-btn-icon-modern ${tool === 'sticky' ? 'wb-btn-active' : ''}`}\r\n                            onClick={() => { setTool('sticky'); toast('Click & drag on canvas to place a sticky note', { icon: 'ðŸ“' }); }}\r\n                            title=\"Sticky Note\"\r\n                        >\r\n                            <StickyNote size={18} />\r\n                        </button>\r\n                        <button\r\n                            className=\"wb-btn-icon-modern\"\r\n                            onClick={() => importImageRef.current?.click()}\r\n                            title=\"Import Image to Board\"\r\n                        >\r\n                            <ImagePlus size={18} />\r\n                        </button>\r\n                        <input type=\"file\" accept=\"image/*\" className=\"hidden\" ref={importImageRef} onChange={handleImportImage} />\r\n                        <div className=\"wb-header-divider-mini\"></div>\r\n                        <button\r\n                            className=\"wb-btn-icon-modern\"\r\n                            onClick={() => setDarkMode(!darkMode)}\r\n                            title={darkMode ? 'Light Mode' : 'Dark Mode'}\r\n                        >\r\n                            {darkMode ? <Sun size={18} /> : <Moon size={18} />}\r\n                        </button>\r\n                        <button className=\"wb-btn-icon-modern\" onClick={handleSaveBoard} title=\"Save Board\">\r\n                            <Save size={18} />\r\n                        </button>\r\n                        <button className=\"wb-btn-icon-modern\" onClick={downloadCanvas} title=\"Export PNG\">\r\n                            <Download size={18} />\r\n                        </button>\r\n                        <button className=\"wb-btn-icon-modern\" onClick={() => {\r\n                            navigator.clipboard.writeText(window.location.href);\r\n                            toast.success('Link copied!');\r\n                        }} title=\"Invite Members\">\r\n                            <Share2 size={18} />\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"wb-header-divider\"></div>\r\n                    <button\r\n                        className={`wb-btn-chat-modern ${isSidebarOpen ? 'active' : ''}`}\r\n                        onClick={() => setIsSidebarOpen(!isSidebarOpen)}\r\n                        title=\"Toggle Chat\"\r\n                    >\r\n                        <MessageCircle size={18} />\r\n                        {unreadCount > 0 && !isSidebarOpen && (\r\n                            <span className=\"wb-badge-modern\">{unreadCount > 9 ? '9+' : unreadCount}</span>\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"wb-workspace\">\r\n                <aside className=\"wb-left-panel\">\r\n                    <Toolbar\r\n                        activeTool={tool}\r\n                        setTool={handleToolChange}\r\n                        isHost={room?.host?.toString() === user._id || room?.host?._id === user._id}\r\n                        onClear={handleClearBoard}\r\n                        onUndo={handleUndo}\r\n                        onRedo={handleRedo}\r\n                        onDelete={() => { }}\r\n                        canvasBackground={canvasBackground}\r\n                        setCanvasBackground={setCanvasBackground}\r\n                        darkMode={darkMode}\r\n                        setDarkMode={setDarkMode}\r\n                    />\r\n                </aside>\r\n\r\n                {/* Canvas Viewport */}\r\n                {(() => {\r\n                    const s = 24 * cameraScale;\r\n                    const ox = cameraOffset.x;\r\n                    const oy = cameraOffset.y;\r\n                    const dm = darkMode;\r\n                    const dotColor = dm ? 'rgba(255,255,255,0.12)' : '#e2e8f0';\r\n                    const lineColor = dm ? 'rgba(255,255,255,0.07)' : '#e2e8f0';\r\n                    const fineColor = dm ? 'rgba(255,255,255,0.04)' : '#eef2f7';\r\n                    const bgColor = dm ? '#0f172a' : '#ffffff';\r\n\r\n                    const bgMap = {\r\n                        dots: {\r\n                            backgroundImage: `radial-gradient(${dotColor} 1px, transparent 1px)`,\r\n                            backgroundSize: `${s}px ${s}px`,\r\n                        },\r\n                        grid: {\r\n                            backgroundImage: `linear-gradient(${lineColor} 1px, transparent 1px), linear-gradient(90deg, ${lineColor} 1px, transparent 1px)`,\r\n                            backgroundSize: `${s}px ${s}px`,\r\n                        },\r\n                        lines: {\r\n                            backgroundImage: `linear-gradient(${lineColor} 1px, transparent 1px)`,\r\n                            backgroundSize: `${s}px ${s}px`,\r\n                        },\r\n                        cross: {\r\n                            backgroundImage: `radial-gradient(${dotColor} 1px, transparent 1px), linear-gradient(${lineColor} 1px, transparent 1px), linear-gradient(90deg, ${lineColor} 1px, transparent 1px)`,\r\n                            backgroundSize: `${s}px ${s}px`,\r\n                        },\r\n                        isometric: {\r\n                            backgroundImage: `linear-gradient(30deg, ${lineColor} 1px, transparent 1px), linear-gradient(150deg, ${lineColor} 1px, transparent 1px), linear-gradient(270deg, ${lineColor} 1px, transparent 1px)`,\r\n                            backgroundSize: `${s}px ${s * 0.866}px`,\r\n                        },\r\n                        'graph-paper': {\r\n                            backgroundImage: `linear-gradient(${lineColor} 1px, transparent 1px), linear-gradient(90deg, ${lineColor} 1px, transparent 1px), linear-gradient(${fineColor} 1px, transparent 1px), linear-gradient(90deg, ${fineColor} 1px, transparent 1px)`,\r\n                            backgroundSize: `${s * 4}px ${s * 4}px, ${s * 4}px ${s * 4}px, ${s}px ${s}px, ${s}px ${s}px`,\r\n                        },\r\n                        blank: {\r\n                            backgroundImage: 'none',\r\n                            backgroundSize: 'auto',\r\n                        },\r\n                    };\r\n\r\n                    const bg = bgMap[canvasBackground] || bgMap.dots;\r\n\r\n                    return (\r\n                        <main\r\n                            ref={viewportRef}\r\n                            className=\"wb-viewport\"\r\n                            style={{\r\n                                ...bg,\r\n                                backgroundPosition: `${ox}px ${oy}px`,\r\n                                backgroundColor: bgColor,\r\n                            }}\r\n                        >\r\n\r\n                            <canvas\r\n                                ref={canvasRef}\r\n                                className=\"wb-canvas\"\r\n                                style={{ cursor: canvasCursor }}\r\n                                onMouseDown={startDrawing}\r\n                                onMouseMove={handleMouseMove}\r\n                                onMouseUp={stopDrawing}\r\n                                onMouseOut={stopDrawing}\r\n                            />\r\n\r\n                            {/* Object Overlays (Image & Sticky) */}\r\n                            {strokesRef.current.filter(s => s.type === 'image' || s.type === 'sticky').map(stroke => {\r\n                                const start = stroke.points[0];\r\n                                const end = stroke.type === 'sticky' ? stroke.points[1] : null;\r\n\r\n                                const x = Math.min(start.x, end ? end.x : start.x);\r\n                                const y = Math.min(start.y, end ? end.y : start.y);\r\n                                const w = stroke.type === 'sticky' ? Math.abs(end.x - start.x) : (stroke.imgW || 250);\r\n                                const h = stroke.type === 'sticky' ? Math.abs(end.y - start.y) : (stroke.imgH || 180);\r\n\r\n                                const screenX = x * cameraScale + cameraOffset.x;\r\n                                const screenY = y * cameraScale + cameraOffset.y;\r\n                                const screenW = w * cameraScale;\r\n                                const screenH = h * cameraScale;\r\n\r\n                                return (\r\n                                    <div\r\n                                        key={stroke.id}\r\n                                        className=\"wb-obj-overlay\"\r\n                                        style={{\r\n                                            position: 'absolute',\r\n                                            left: screenX,\r\n                                            top: screenY,\r\n                                            width: screenW,\r\n                                            height: screenH,\r\n                                            zIndex: 10,\r\n                                            pointerEvents: ['pencil', 'eraser', 'highlighter'].includes(tool) ? 'none' : 'all',\r\n                                        }}\r\n                                        onMouseDown={(e) => {\r\n                                            if (e.button !== 0) return;\r\n                                            e.stopPropagation();\r\n                                            const pos = getMousePos(e);\r\n                                            interactionRef.current = {\r\n                                                type: 'move',\r\n                                                strokeId: stroke.id,\r\n                                                startPos: pos,\r\n                                                originalPoints: JSON.parse(JSON.stringify(stroke.points)),\r\n                                                originalImgW: stroke.imgW,\r\n                                                originalImgH: stroke.imgH\r\n                                            };\r\n                                        }}\r\n                                    >\r\n                                        <button\r\n                                            className=\"wb-obj-delete-btn\"\r\n                                            title=\"Remove\"\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                strokesRef.current = strokesRef.current.filter(s => s.id !== stroke.id);\r\n                                                setStrokesVersion(v => v + 1);\r\n                                                pushToHistory();\r\n                                                if (socket) socket.emit('erase-stroke', { roomId, strokeId: stroke.id, pageId: activePageId });\r\n                                                redrawCanvas();\r\n                                                toast.success('Removed');\r\n                                            }}\r\n                                        >\r\n                                            <X size={14} />\r\n                                        </button>\r\n\r\n                                        <div\r\n                                            className=\"wb-resize-handle\"\r\n                                            onMouseDown={(e) => {\r\n                                                e.stopPropagation();\r\n                                                const pos = getMousePos(e);\r\n                                                interactionRef.current = {\r\n                                                    type: 'resize',\r\n                                                    strokeId: stroke.id,\r\n                                                    startPos: pos,\r\n                                                    originalPoints: JSON.parse(JSON.stringify(stroke.points)),\r\n                                                    originalImgW: stroke.imgW,\r\n                                                    originalImgH: stroke.imgH\r\n                                                };\r\n                                            }}\r\n                                        />\r\n                                    </div>\r\n                                );\r\n                            })}\r\n\r\n                            <input type=\"file\" accept=\"image/*\" className=\"hidden\" ref={imageFileRef} onChange={handleImageUpload} />\r\n                            <StylingPanel tool={tool} visible={showStyling} strokeStyle={strokeStyle} setStrokeStyle={setStrokeStyle} fill={fill} setFill={setFill} />\r\n\r\n                            {/* Bottom Bar: Consolidated Pages + Zoom */}\r\n                            <div className=\"wb-bottom-bar\">\r\n                                {/* Page Selector Section */}\r\n                                <div className=\"wb-bar-section-pages\">\r\n                                    <button className=\"wb-bar-btn-add\" onClick={handleNewPage} title=\"New Page\">\r\n                                        <Plus size={16} />\r\n                                    </button>\r\n                                    <div className=\"wb-bar-divider-mini\"></div>\r\n                                    <div className=\"wb-page-tabs-scrollable\">\r\n                                        {(() => {\r\n                                            const totalPages = pages.length;\r\n                                            if (totalPages === 0) return null;\r\n\r\n                                            const activeIndex = pages.findIndex(p => p.pageId === activePageId);\r\n                                            const visibleItems = [];\r\n\r\n                                            // Constants for pagination\r\n                                            const neighbors = 2; // Show 2 pages before and after active\r\n\r\n                                            // Always include first page\r\n                                            visibleItems.push(pages[0]);\r\n\r\n                                            let start = Math.max(1, activeIndex - neighbors);\r\n                                            let end = Math.min(totalPages - 2, activeIndex + neighbors);\r\n\r\n                                            // Add ellipsis after first if needed\r\n                                            if (start > 1) {\r\n                                                visibleItems.push({ type: 'ellipsis', id: 'ellipsis-start' });\r\n                                            }\r\n\r\n                                            // Add pages in dynamic range\r\n                                            for (let i = start; i <= end; i++) {\r\n                                                visibleItems.push(pages[i]);\r\n                                            }\r\n\r\n                                            // Add ellipsis before last if needed\r\n                                            if (end < totalPages - 2) {\r\n                                                visibleItems.push({ type: 'ellipsis', id: 'ellipsis-end' });\r\n                                            }\r\n\r\n                                            // Always include last page if there's more than one\r\n                                            if (totalPages > 1) {\r\n                                                visibleItems.push(pages[totalPages - 1]);\r\n                                            }\r\n\r\n                                            return visibleItems.map((item) => {\r\n                                                if (item.type === 'ellipsis') {\r\n                                                    return <div key={item.id} className=\"wb-page-tab-ellipsis\">...</div>;\r\n                                                }\r\n                                                return (\r\n                                                    <div\r\n                                                        key={item.pageId}\r\n                                                        className={`wb-page-tab-container ${item.pageId === activePageId ? 'active' : ''}`}\r\n                                                    >\r\n                                                        <button\r\n                                                            className=\"wb-page-tab\"\r\n                                                            onClick={() => handleSwitchPage(item.pageId)}\r\n                                                        >\r\n                                                            {item.pageName.replace('Page ', '')}\r\n                                                        </button>\r\n                                                        {pages.length > 1 && (\r\n                                                            <button\r\n                                                                className=\"wb-page-tab-delete\"\r\n                                                                onClick={(e) => handleDeletePage(e, item.pageId)}\r\n                                                                title=\"Delete Page\"\r\n                                                            >\r\n                                                                <X size={10} />\r\n                                                            </button>\r\n                                                        )}\r\n                                                    </div>\r\n                                                );\r\n                                            });\r\n                                        })()}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"wb-bar-divider\"></div>\r\n\r\n                                {/* Zoom Controls Section - Fixed width */}\r\n                                <div className=\"wb-bar-section-zoom\">\r\n                                    <div className=\"wb-zoom-controls\">\r\n                                        <button\r\n                                            onClick={() => {\r\n                                                cameraScaleRef.current = 1;\r\n                                                cameraOffsetRef.current = { x: -4000 + window.innerWidth / 2, y: -4000 + window.innerHeight / 2 };\r\n                                                setCameraScale(1); setCameraOffset(cameraOffsetRef.current); syncViewDOM();\r\n                                            }}\r\n                                            className=\"wb-zoom-btn wb-zoom-label\"\r\n                                        >\r\n                                            {Math.round(cameraScale * 100)}%\r\n                                        </button>\r\n                                        <div className=\"wb-zoom-divider\"></div>\r\n                                        <button onClick={() => updateZoom(1.1)} className=\"wb-zoom-btn\"><Plus size={14} /></button>\r\n                                        <button onClick={() => updateZoom(1 / 1.1)} className=\"wb-zoom-btn\"><Minus size={14} /></button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Remote Cursors */}\r\n                            {Object.values(remoteCursors).map(cursor => (\r\n                                <div\r\n                                    key={cursor.socketId}\r\n                                    className=\"wb-remote-cursor\"\r\n                                    style={{ left: cursor.x, top: cursor.y }}\r\n                                >\r\n                                    <svg width=\"12\" height=\"16\" viewBox=\"0 0 12 16\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                        <path d=\"M0 0 L0 14 L4 10 L6.5 14.5 L8 13.5 L5.5 9 L10 9 Z\"\r\n                                            fill={cursor.color || '#06b6d4'} stroke=\"white\" strokeWidth=\"1\" />\r\n                                    </svg>\r\n                                    <span className=\"wb-cursor-label\" style={{ backgroundColor: cursor.color || '#06b6d4' }}>\r\n                                        {cursor.userName}\r\n                                    </span>\r\n                                </div>\r\n                            ))}\r\n                        </main>\r\n                    );\r\n                })()}\r\n\r\n                {/* Right Sidebar (Chat) â€” slides in/out */}\r\n                <aside className={`wb-right-panel ${isSidebarOpen ? 'open' : ''}`}>\r\n                    <div className=\"wb-sidebar-inner\">\r\n                        <div className=\"wb-sidebar-header\">\r\n                            <div className=\"wb-sidebar-tabs\">\r\n                                {['chat', 'files', 'users'].map((tab) => (\r\n                                    <button\r\n                                        key={tab}\r\n                                        onClick={() => setActiveTab(tab)}\r\n                                        className={`wb-sidebar-tab ${activeTab === tab ? \"active\" : \"\"}`}\r\n                                    >\r\n                                        {tab === 'chat' && <MessageCircle size={13} />}\r\n                                        {tab === 'users' && <Users size={13} />}\r\n                                        {tab}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                            <button className=\"wb-sidebar-close\" onClick={() => setIsSidebarOpen(false)}>\r\n                                <X size={16} />\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"wb-sidebar-content\">\r\n                            {activeTab === \"chat\" ? (\r\n                                <Chat\r\n                                    messages={messages}\r\n                                    onSendMessage={(txt) => socket.emit(\"chat-message\", { roomId, message: txt, userId: user._id, userName: user.name })}\r\n                                    currentUser={user}\r\n                                    socket={socket}\r\n                                    roomId={roomId}\r\n                                    typingUsers={typingUsers}\r\n                                    participants={participants}\r\n                                    inCall={inCall}\r\n                                    activeCallInfo={activeCallInfo}\r\n                                    onJoinCall={handleJoinCall}\r\n                                />\r\n                            ) : activeTab === \"files\" ? (\r\n                                <div className=\"wb-files-panel\">\r\n                                    <label className={`wb-file-upload-btn ${loadingFileUpload ? 'disabled' : ''}`}>\r\n                                        <span>{loadingFileUpload ? 'Uploading...' : 'ðŸ“Ž Share Asset'}</span>\r\n                                        <input\r\n                                            type=\"file\" className=\"hidden\" disabled={loadingFileUpload}\r\n                                            onChange={async (e) => {\r\n                                                const file = e.target.files[0];\r\n                                                if (!file) return;\r\n                                                setLoadingFileUpload(true);\r\n                                                try {\r\n                                                    const fd = new FormData();\r\n                                                    fd.append('file', file);\r\n                                                    const res = await roomService.uploadFile(roomId, fd);\r\n                                                    setSharedFiles(prev => [...prev, res.data.file]);\r\n                                                    socket.emit('file-shared', { roomId, file: res.data.file });\r\n                                                    toast.success(`${file.name} shared!`);\r\n                                                } catch { toast.error('Upload failed'); }\r\n                                                finally { setLoadingFileUpload(false); e.target.value = ''; }\r\n                                            }}\r\n                                        />\r\n                                    </label>\r\n                                    <div className=\"wb-files-list\">\r\n                                        {sharedFiles.length === 0 ? (\r\n                                            <div className=\"wb-files-empty\">No files shared yet</div>\r\n                                        ) : (\r\n                                            sharedFiles.map((f, i) => {\r\n                                                const backendUrl = (process.env.REACT_APP_API_URL || 'http://localhost:5000/api').replace('/api', '');\r\n                                                const fullUrl = `${backendUrl}${f.fileUrl}`;\r\n                                                const sizeKB = f.fileSize ? `${(f.fileSize / 1024).toFixed(1)} KB` : '';\r\n                                                return (\r\n                                                    <div key={i} className=\"wb-file-item\">\r\n                                                        <div className=\"wb-file-info\">\r\n                                                            <span className=\"wb-file-name\" title={f.fileName}>{f.fileName}</span>\r\n                                                            <span className=\"wb-file-meta\">\r\n                                                                {f.senderName && <span>{f.senderName}</span>}\r\n                                                                {sizeKB && <span> Â· {sizeKB}</span>}\r\n                                                            </span>\r\n                                                        </div>\r\n                                                        <a\r\n                                                            href={fullUrl}\r\n                                                            download={f.fileName}\r\n                                                            target=\"_blank\"\r\n                                                            rel=\"noopener noreferrer\"\r\n                                                            className=\"wb-file-download-btn\"\r\n                                                            title=\"Download file\"\r\n                                                        >\r\n                                                            <Download size={14} />\r\n                                                        </a>\r\n                                                    </div>\r\n                                                );\r\n                                            })\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            ) : (\r\n                                <div className=\"wb-users-panel\">\r\n                                    <div className=\"wb-users-count\">{participants.length} Online</div>\r\n                                    {participants.map((p, i) => (\r\n                                        <div key={i} className=\"wb-user-item\">\r\n                                            <div className=\"wb-user-avatar\">{p.userName[0]}</div>\r\n                                            <span className=\"wb-user-name\">{p.userName}</span>\r\n                                            <div className=\"wb-user-status\"></div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                </aside>\r\n            </div>\r\n\r\n            {/* Floating Video Call (Zoom-like â€” not fullscreen) */}\r\n            {inCall && (\r\n                <WebRTCMeeting\r\n                    socket={socket}\r\n                    roomId={roomId}\r\n                    username={user.name}\r\n                    onLeave={handleLeaveCall}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WhiteboardRoom;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}