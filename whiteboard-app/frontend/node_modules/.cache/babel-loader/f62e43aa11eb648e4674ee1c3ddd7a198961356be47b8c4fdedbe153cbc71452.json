{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\pages\\\\WhiteboardRoom.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useSocket } from \"../context/SocketContext\";\nimport { roomService } from \"../services/api\";\nimport Toolbar from \"../components/Toolbar\";\nimport Chat from \"../components/Chat\";\nimport toast from \"react-hot-toast\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WhiteboardRoom = () => {\n  _s();\n  const {\n    roomId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth();\n  const {\n    socket\n  } = useSocket();\n  const canvasRef = useRef(null);\n  const contextRef = useRef(null);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [tool, setTool] = useState(\"pencil\");\n  const [color, setColor] = useState(\"#000000\");\n  const [size, setSize] = useState(5);\n  const [room, setRoom] = useState(null);\n  const [participants, setParticipants] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [sharedFiles, setSharedFiles] = useState([]);\n  const [activeTab, setActiveTab] = useState(\"chat\");\n  const [loadingFileUpload, setLoadingFileUpload] = useState(false);\n  const [screenStream, setScreenStream] = useState(null);\n  const screenVideoRef = useRef(null);\n\n  // History for Undo/Redo\n  const [history, setHistory] = useState([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  useEffect(() => {\n    const fetchRoomDetails = async () => {\n      try {\n        const res = await roomService.getRoom(roomId);\n        setRoom(res.data.room);\n        setSharedFiles(res.data.room.sharedFiles || []);\n      } catch (err) {\n        toast.error(\"Failed to load workspace\");\n        navigate(\"/dashboard\");\n      }\n    };\n    fetchRoomDetails();\n    if (socket) {\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user._id,\n        userName: user.name\n      });\n      socket.on(\"user-joined\", data => {\n        toast.success(`${data.userName} joined the space`);\n      });\n      socket.on(\"online-users\", users => {\n        setParticipants(users);\n      });\n      socket.on(\"chat-message\", msg => {\n        setMessages(prev => [...prev, msg]);\n      });\n      socket.on(\"chat-history\", history => {\n        setMessages(history);\n      });\n      socket.on(\"new-file\", file => {\n        setSharedFiles(prev => [file, ...prev]);\n        toast.success(`New file shared: ${file.fileName}`);\n      });\n      socket.on(\"drawing\", data => {\n        drawRemote(data);\n      });\n      socket.on(\"erase\", data => {\n        eraseRemote(data);\n      });\n      socket.on(\"board-cleared\", () => {\n        clearCanvasLocal();\n        setHistory([]);\n        setHistoryIndex(-1);\n        toast.info(\"The board was cleared by the host\");\n      });\n      socket.on(\"canvas-state\", data => {\n        if (data) {\n          applyCanvasState(data);\n          setHistory([data]);\n          setHistoryIndex(0);\n        }\n      });\n      socket.on(\"undo\", state => {\n        applyCanvasState(state);\n      });\n      socket.on(\"redo\", state => {\n        applyCanvasState(state);\n      });\n      socket.on(\"error-message\", msg => {\n        toast.error(msg);\n      });\n    }\n    const handleUndoEvent = () => handleUndo();\n    const handleRedoEvent = () => handleRedo();\n    window.addEventListener('wb-undo', handleUndoEvent);\n    window.addEventListener('wb-redo', handleRedoEvent);\n    return () => {\n      if (socket) {\n        socket.emit(\"leave-room\", {\n          roomId,\n          userId: user._id,\n          userName: user.name\n        });\n        socket.off(\"user-joined\");\n        socket.off(\"online-users\");\n        socket.off(\"chat-message\");\n        socket.off(\"chat-history\");\n        socket.off(\"new-file\");\n        socket.off(\"drawing\");\n        socket.off(\"erase\");\n        socket.off(\"board-cleared\");\n        socket.off(\"canvas-state\");\n        socket.off(\"undo\");\n        socket.off(\"redo\");\n        socket.off(\"error-message\");\n      }\n      window.removeEventListener('wb-undo', handleUndoEvent);\n      window.removeEventListener('wb-redo', handleRedoEvent);\n    };\n  }, [roomId, socket, user, navigate]);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const container = canvas.parentElement;\n    const ResizeCanvas = () => {\n      const tempCanvas = document.createElement('canvas');\n      const tempCtx = tempCanvas.getContext('2d');\n      tempCanvas.width = canvas.width;\n      tempCanvas.height = canvas.height;\n      tempCtx.drawImage(canvas, 0, 0);\n      canvas.width = container.offsetWidth;\n      canvas.height = container.offsetHeight;\n      const context = canvas.getContext(\"2d\");\n      context.lineCap = \"round\";\n      context.lineJoin = \"round\";\n      context.drawImage(tempCanvas, 0, 0);\n      contextRef.current = context;\n    };\n    window.addEventListener('resize', ResizeCanvas);\n    ResizeCanvas();\n    const dataURL = canvas.toDataURL();\n    setHistory([dataURL]);\n    setHistoryIndex(0);\n    return () => window.removeEventListener('resize', ResizeCanvas);\n  }, []);\n  const applyCanvasState = state => {\n    if (!state) {\n      clearCanvasLocal();\n      return;\n    }\n    const image = new Image();\n    image.src = state;\n    image.onload = () => {\n      clearCanvasLocal();\n      contextRef.current.drawImage(image, 0, 0);\n    };\n  };\n  const clearCanvasLocal = () => {\n    const canvas = canvasRef.current;\n    contextRef.current.clearRect(0, 0, canvas.width, canvas.height);\n  };\n  const startDrawing = ({\n    nativeEvent\n  }) => {\n    const {\n      offsetX,\n      offsetY\n    } = nativeEvent;\n    contextRef.current.beginPath();\n    contextRef.current.moveTo(offsetX, offsetY);\n    setIsDrawing(true);\n  };\n  const draw = ({\n    nativeEvent\n  }) => {\n    if (!isDrawing) return;\n    const {\n      offsetX,\n      offsetY\n    } = nativeEvent;\n    contextRef.current.lineWidth = size;\n    if (tool === \"pencil\") {\n      contextRef.current.strokeStyle = color;\n      contextRef.current.globalCompositeOperation = \"source-over\";\n      contextRef.current.lineTo(offsetX, offsetY);\n      contextRef.current.stroke();\n      socket.emit(\"drawing\", {\n        roomId,\n        drawingData: {\n          x: offsetX,\n          y: offsetY,\n          color,\n          size\n        }\n      });\n    } else {\n      contextRef.current.globalCompositeOperation = \"destination-out\";\n      contextRef.current.lineTo(offsetX, offsetY);\n      contextRef.current.stroke();\n      socket.emit(\"erase\", {\n        roomId,\n        eraseData: {\n          x: offsetX,\n          y: offsetY,\n          size: size * 2\n        }\n      });\n    }\n  };\n  const stopDrawing = () => {\n    if (!isDrawing) return;\n    contextRef.current.closePath();\n    setIsDrawing(false);\n    const dataURL = canvasRef.current.toDataURL();\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(dataURL);\n    if (newHistory.length > 50) newHistory.shift();\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n    socket.emit(\"save-canvas\", {\n      roomId,\n      canvasData: dataURL\n    });\n  };\n  const handleUndo = () => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      const state = history[newIndex];\n      setHistoryIndex(newIndex);\n      applyCanvasState(state);\n      socket.emit(\"undo\", {\n        roomId,\n        canvasState: state\n      });\n      socket.emit(\"save-canvas\", {\n        roomId,\n        canvasData: state\n      });\n    }\n  };\n  const handleRedo = () => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      const state = history[newIndex];\n      setHistoryIndex(newIndex);\n      applyCanvasState(state);\n      socket.emit(\"redo\", {\n        roomId,\n        canvasState: state\n      });\n      socket.emit(\"save-canvas\", {\n        roomId,\n        canvasData: state\n      });\n    }\n  };\n  const drawRemote = data => {\n    const {\n      x,\n      y,\n      color,\n      size\n    } = data;\n    const context = contextRef.current;\n    const prevGCO = context.globalCompositeOperation;\n    const prevStrokeStyle = context.strokeStyle;\n    const prevLineWidth = context.lineWidth;\n    context.globalCompositeOperation = \"source-over\";\n    context.strokeStyle = color;\n    context.lineWidth = size;\n    context.beginPath();\n    context.arc(x, y, size / 2, 0, Math.PI * 2);\n    context.fillStyle = color;\n    context.fill();\n    context.globalCompositeOperation = prevGCO;\n    context.strokeStyle = prevStrokeStyle;\n    context.lineWidth = prevLineWidth;\n  };\n  const eraseRemote = data => {\n    const {\n      x,\n      y,\n      size\n    } = data;\n    const context = contextRef.current;\n    const prevGCO = context.globalCompositeOperation;\n    const prevLineWidth = context.lineWidth;\n    context.globalCompositeOperation = \"destination-out\";\n    context.lineWidth = size;\n    context.beginPath();\n    context.arc(x, y, size, 0, Math.PI * 2);\n    context.fill();\n    context.globalCompositeOperation = prevGCO;\n    context.lineWidth = prevLineWidth;\n  };\n  const handleSendMessage = text => {\n    if (socket) {\n      socket.emit(\"chat-message\", {\n        roomId,\n        message: text,\n        userId: user._id,\n        userName: user.name\n      });\n    }\n  };\n  const handleClearBoard = () => {\n    if (user._id !== (room === null || room === void 0 ? void 0 : room.host)) {\n      toast.error(\"Only the host can clear the board\");\n      return;\n    }\n    if (window.confirm(\"This will clear the entire canvas for everyone. Proceed?\")) {\n      socket.emit(\"clear-board\", {\n        roomId,\n        userId: user._id\n      });\n    }\n  };\n  const handleDownload = () => {\n    const canvas = canvasRef.current;\n    const dataURL = canvas.toDataURL(\"image/png\");\n    const link = document.createElement(\"a\");\n    link.href = dataURL;\n    link.download = `whiteboard-${(room === null || room === void 0 ? void 0 : room.roomName) || roomId}.png`;\n    link.click();\n    toast.success(\"Design exported successfully!\");\n  };\n  const handleShare = () => {\n    const url = window.location.href;\n    navigator.clipboard.writeText(url);\n    toast.success(\"Invitation link copied to clipboard!\");\n  };\n  const handleFileUpload = async e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    const formData = new FormData();\n    formData.append(\"file\", file);\n    setLoadingFileUpload(true);\n    try {\n      const res = await roomService.uploadFile(roomId, formData);\n      socket.emit(\"file-shared\", {\n        roomId,\n        file: res.data.file\n      });\n      setSharedFiles(prev => [res.data.file, ...prev]);\n      toast.success(\"Asset shared with the team!\");\n    } catch (err) {\n      toast.error(\"Failed to share asset\");\n    } finally {\n      setLoadingFileUpload(false);\n    }\n  };\n  const handleScreenShare = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getDisplayMedia({\n        video: true,\n        audio: false\n      });\n      setScreenStream(stream);\n      stream.getVideoTracks()[0].onended = () => stopScreenShare();\n      if (screenVideoRef.current) screenVideoRef.current.srcObject = stream;\n      toast.success(\"Screen sharing active\");\n      socket.emit(\"screen-share-started\", {\n        roomId,\n        userId: user._id,\n        userName: user.name\n      });\n    } catch (err) {\n      toast.error(\"Screen sharing cancelled\");\n    }\n  };\n  const stopScreenShare = () => {\n    if (screenStream) {\n      screenStream.getTracks().forEach(track => track.stop());\n      setScreenStream(null);\n      socket.emit(\"screen-share-stopped\", {\n        roomId\n      });\n      toast.info(\"Screen sharing ended\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"h-screen w-screen bg-slate-950 flex flex-col overflow-hidden text-slate-100\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"glass h-16 px-6 flex items-center justify-between border-b border-white/5 z-40\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-3 cursor-pointer\",\n          onClick: () => navigate('/dashboard'),\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-8 h-8 rounded-lg bg-gradient-to-tr from-primary-600 to-indigo-600 flex items-center justify-center shadow-lg shadow-primary-900/40\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-sm font-bold text-white\",\n              children: \"C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 374,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"font-bold tracking-tight hidden md:block\",\n            children: room === null || room === void 0 ? void 0 : room.roomName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-4 w-px bg-white/10 mx-2 hidden md:block\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"px-3 py-1 rounded-full bg-white/5 border border-white/10 flex items-center gap-2 cursor-pointer group\",\n            onClick: handleShare,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-xs font-mono text-slate-400 group-hover:text-primary-400 transition-colors\",\n              children: [\"ID: \", roomId]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[10px] bg-slate-800 px-1 rounded uppercase tracking-tighter text-slate-500\",\n              children: \"Copy\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 382,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-1.5 px-3 py-1 bg-primary-500/10 border border-primary-500/20 rounded-full\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-1.5 h-1.5 rounded-full bg-primary-500 animate-pulse\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-xs font-bold text-primary-400\",\n              children: [participants.length, \" Online\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 389,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 387,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 381,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: `hidden sm:flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all\n                                  ${screenStream ? \"bg-red-500/20 text-red-400 border border-red-500/30\" : \"bg-white/5 text-slate-300 border border-white/10 hover:bg-white/10\"}`,\n          onClick: screenStream ? stopScreenShare : handleScreenShare,\n          children: screenStream ? \"End Stream\" : \"Share Stream\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 395,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleDownload,\n          className: \"btn-secondary-premium !px-4 !py-2 text-sm flex items-center gap-2\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Save Image\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 402,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => navigate('/dashboard'),\n          className: \"btn-premium !px-4 !py-2 text-sm\",\n          children: \"Leave\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 flex overflow-hidden relative\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute left-6 top-1/2 -translate-y-1/2 z-30\",\n        children: /*#__PURE__*/_jsxDEV(Toolbar, {\n          tool: tool,\n          setTool: setTool,\n          color: color,\n          setColor: setColor,\n          size: size,\n          setSize: setSize,\n          onClear: handleClearBoard,\n          isHost: user._id === (room === null || room === void 0 ? void 0 : room.host)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n        className: \"flex-1 relative bg-slate-900 group\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute inset-0 z-10 canvas-container m-6 !rounded-3xl border border-white/5 shadow-2xl overflow-hidden shadow-black/50\",\n          children: [screenStream && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"absolute inset-0 bg-black/90 z-50 flex flex-col items-center justify-center gap-6 backdrop-blur-sm\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: screenVideoRef,\n              autoPlay: true,\n              playsInline: true,\n              muted: true,\n              className: \"max-w-[80%] max-h-[70%] rounded-2xl border border-white/10 shadow-2xl shadow-primary-900/20\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 431,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"px-6 py-2 bg-red-500 text-white font-bold rounded-full text-sm animate-pulse flex items-center gap-2\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"w-2 h-2 rounded-full bg-white animate-ping\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 433,\n                columnNumber: 37\n              }, this), \"LIVE SCREEN SHARE ACTIVE\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 432,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: canvasRef,\n            onMouseDown: startDrawing,\n            onMouseMove: draw,\n            onMouseUp: stopDrawing,\n            onMouseOut: stopDrawing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 438,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"absolute bottom-10 left-1/2 -translate-x-1/2 z-20 glass px-4 py-2 rounded-full border border-white/10 flex items-center gap-6 shadow-xl\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[10px] font-bold text-slate-500 uppercase tracking-widest leading-none\",\n              children: \"Tool\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 450,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-xs font-bold text-slate-200\",\n              children: tool === \"pencil\" ? \"âœï¸ Pencil\" : \"ðŸ§½ Eraser\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 451,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 449,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-px h-3 bg-white/10\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[10px] font-bold text-slate-500 uppercase tracking-widest leading-none\",\n              children: \"Role\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 455,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-xs font-bold text-primary-400\",\n              children: user._id === (room === null || room === void 0 ? void 0 : room.host) ? \"Host\" : \"Collaborator\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 456,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 454,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 427,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n        className: \"w-80 glass border-l border-white/5 flex flex-col z-30\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex p-2 gap-1 bg-white/5 border-b border-white/5\",\n          children: ['chat', 'files', 'users'].map(tab => /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setActiveTab(tab),\n            className: `flex-1 py-1.5 rounded-lg text-xs font-bold transition-all uppercase tracking-widest\n                                          ${activeTab === tab ? \"bg-primary-600 text-white shadow-md shadow-primary-900/30\" : \"text-slate-500 hover:text-slate-300 hover:bg-white/5\"}`,\n            children: tab\n          }, tab, false, {\n            fileName: _jsxFileName,\n            lineNumber: 465,\n            columnNumber: 29\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 463,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 overflow-hidden relative\",\n          children: activeTab === \"chat\" ? /*#__PURE__*/_jsxDEV(Chat, {\n            messages: messages,\n            onSendMessage: handleSendMessage,\n            currentUser: user\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 478,\n            columnNumber: 29\n          }, this) : activeTab === \"files\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-full flex flex-col p-4 overflow-hidden\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-4\",\n              children: /*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"btn-premium w-full !py-3 !rounded-2xl cursor-pointer flex items-center justify-center gap-2 text-sm tracking-tight\",\n                children: [loadingFileUpload ? /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 488,\n                  columnNumber: 45\n                }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: \"Share Asset \\u2B06\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 489,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\",\n                  onChange: handleFileUpload,\n                  className: \"hidden\",\n                  disabled: loadingFileUpload\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 490,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 486,\n                columnNumber: 37\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 485,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex-1 overflow-y-auto space-y-3 pr-1\",\n              children: sharedFiles.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"h-full flex flex-col items-center justify-center text-center opacity-30 mt-20\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-4xl mb-4\",\n                  children: \"\\uD83D\\uDCC1\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 496,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm font-medium text-slate-400\",\n                  children: \"No collaborative assets\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 497,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 495,\n                columnNumber: 41\n              }, this) : sharedFiles.map((file, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-3 glass rounded-xl border border-white/5 flex items-center gap-3 group transition-all hover:bg-white/5 hover:border-white/10\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"w-10 h-10 rounded-lg bg-indigo-600/10 text-indigo-400 flex items-center justify-center text-lg\",\n                  children: \"\\uD83D\\uDCC4\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 502,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex-1 overflow-hidden\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"text-xs font-bold text-slate-200 truncate\",\n                    children: file.fileName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 504,\n                    columnNumber: 53\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"text-[10px] text-slate-500 font-medium\",\n                    children: [\"By \", file.senderName]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 505,\n                    columnNumber: 53\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 503,\n                  columnNumber: 49\n                }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                  href: `${process.env.REACT_APP_API_URL || \"http://localhost:5000/api\"}${file.fileUrl.startsWith('/uploads') ? file.fileUrl.replace('/uploads', '/../../uploads') : file.fileUrl}`,\n                  target: \"_blank\",\n                  rel: \"noopener noreferrer\",\n                  download: true,\n                  className: \"w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center hover:bg-primary-600 transition-all opacity-0 group-hover:opacity-100\",\n                  children: \"\\u2B07\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 507,\n                  columnNumber: 49\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 501,\n                columnNumber: 45\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 493,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 484,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 space-y-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4 px-1\",\n              children: \"Participants\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 521,\n              columnNumber: 33\n            }, this), participants.map((p, index) => {\n              var _p$userName;\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center justify-between p-3 glass rounded-xl border border-white/5 hover:bg-white/5 hover:border-white/10 transition-all duration-300\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center gap-3\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"w-8 h-8 rounded-full bg-gradient-to-tr from-slate-700 to-slate-800 border border-white/10 flex items-center justify-center text-xs font-bold text-white uppercase\",\n                    children: (_p$userName = p.userName) === null || _p$userName === void 0 ? void 0 : _p$userName[0]\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 525,\n                    columnNumber: 45\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex flex-col\",\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"text-xs font-bold text-slate-200\",\n                      children: [p.userName, \" \", p.userId === user._id && \"(You)\"]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 529,\n                      columnNumber: 49\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex items-center gap-1\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"w-1.5 h-1.5 rounded-full bg-green-500\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 531,\n                        columnNumber: 53\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"text-[10px] text-slate-500 font-medium\",\n                        children: \"Online\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 532,\n                        columnNumber: 53\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 530,\n                      columnNumber: 49\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 528,\n                    columnNumber: 45\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 524,\n                  columnNumber: 41\n                }, this), p.userId === (room === null || room === void 0 ? void 0 : room.host) && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-[10px] px-2 py-0.5 rounded-md bg-primary-500/10 border border-primary-500/20 text-primary-400 font-bold uppercase tracking-tighter shadow-sm\",\n                  children: \"Host\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 537,\n                  columnNumber: 45\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 523,\n                columnNumber: 37\n              }, this);\n            })]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 520,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 368,\n    columnNumber: 9\n  }, this);\n};\n_s(WhiteboardRoom, \"Y5oAiPBvRrYf+pTHowaE7Kadlxk=\", false, function () {\n  return [useParams, useNavigate, useAuth, useSocket];\n});\n_c = WhiteboardRoom;\nexport default WhiteboardRoom;\nvar _c;\n$RefreshReg$(_c, \"WhiteboardRoom\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","useNavigate","useAuth","useSocket","roomService","Toolbar","Chat","toast","jsxDEV","_jsxDEV","WhiteboardRoom","_s","roomId","navigate","user","socket","canvasRef","contextRef","isDrawing","setIsDrawing","tool","setTool","color","setColor","size","setSize","room","setRoom","participants","setParticipants","messages","setMessages","sharedFiles","setSharedFiles","activeTab","setActiveTab","loadingFileUpload","setLoadingFileUpload","screenStream","setScreenStream","screenVideoRef","history","setHistory","historyIndex","setHistoryIndex","fetchRoomDetails","res","getRoom","data","err","error","emit","userId","_id","userName","name","on","success","users","msg","prev","file","fileName","drawRemote","eraseRemote","clearCanvasLocal","info","applyCanvasState","state","handleUndoEvent","handleUndo","handleRedoEvent","handleRedo","window","addEventListener","off","removeEventListener","canvas","current","container","parentElement","ResizeCanvas","tempCanvas","document","createElement","tempCtx","getContext","width","height","drawImage","offsetWidth","offsetHeight","context","lineCap","lineJoin","dataURL","toDataURL","image","Image","src","onload","clearRect","startDrawing","nativeEvent","offsetX","offsetY","beginPath","moveTo","draw","lineWidth","strokeStyle","globalCompositeOperation","lineTo","stroke","drawingData","x","y","eraseData","stopDrawing","closePath","newHistory","slice","push","length","shift","canvasData","newIndex","canvasState","prevGCO","prevStrokeStyle","prevLineWidth","arc","Math","PI","fillStyle","fill","handleSendMessage","text","message","handleClearBoard","host","confirm","handleDownload","link","href","download","roomName","click","handleShare","url","location","navigator","clipboard","writeText","handleFileUpload","e","target","files","formData","FormData","append","uploadFile","handleScreenShare","stream","mediaDevices","getDisplayMedia","video","audio","getVideoTracks","onended","stopScreenShare","srcObject","getTracks","forEach","track","stop","className","children","onClick","_jsxFileName","lineNumber","columnNumber","onClear","isHost","ref","autoPlay","playsInline","muted","onMouseDown","onMouseMove","onMouseUp","onMouseOut","map","tab","onSendMessage","currentUser","type","onChange","disabled","index","senderName","process","env","REACT_APP_API_URL","fileUrl","startsWith","replace","rel","p","_p$userName","_c","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/pages/WhiteboardRoom.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport { useSocket } from \"../context/SocketContext\";\r\nimport { roomService } from \"../services/api\";\r\nimport Toolbar from \"../components/Toolbar\";\r\nimport Chat from \"../components/Chat\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nconst WhiteboardRoom = () => {\r\n    const { roomId } = useParams();\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const { socket } = useSocket();\r\n\r\n    const canvasRef = useRef(null);\r\n    const contextRef = useRef(null);\r\n    const [isDrawing, setIsDrawing] = useState(false);\r\n    const [tool, setTool] = useState(\"pencil\");\r\n    const [color, setColor] = useState(\"#000000\");\r\n    const [size, setSize] = useState(5);\r\n\r\n    const [room, setRoom] = useState(null);\r\n    const [participants, setParticipants] = useState([]);\r\n    const [messages, setMessages] = useState([]);\r\n    const [sharedFiles, setSharedFiles] = useState([]);\r\n    const [activeTab, setActiveTab] = useState(\"chat\");\r\n    const [loadingFileUpload, setLoadingFileUpload] = useState(false);\r\n    const [screenStream, setScreenStream] = useState(null);\r\n    const screenVideoRef = useRef(null);\r\n\r\n    // History for Undo/Redo\r\n    const [history, setHistory] = useState([]);\r\n    const [historyIndex, setHistoryIndex] = useState(-1);\r\n\r\n    useEffect(() => {\r\n        const fetchRoomDetails = async () => {\r\n            try {\r\n                const res = await roomService.getRoom(roomId);\r\n                setRoom(res.data.room);\r\n                setSharedFiles(res.data.room.sharedFiles || []);\r\n            } catch (err) {\r\n                toast.error(\"Failed to load workspace\");\r\n                navigate(\"/dashboard\");\r\n            }\r\n        };\r\n\r\n        fetchRoomDetails();\r\n\r\n        if (socket) {\r\n            socket.emit(\"join-room\", { roomId, userId: user._id, userName: user.name });\r\n\r\n            socket.on(\"user-joined\", (data) => {\r\n                toast.success(`${data.userName} joined the space`);\r\n            });\r\n\r\n            socket.on(\"online-users\", (users) => {\r\n                setParticipants(users);\r\n            });\r\n\r\n            socket.on(\"chat-message\", (msg) => {\r\n                setMessages((prev) => [...prev, msg]);\r\n            });\r\n\r\n            socket.on(\"chat-history\", (history) => {\r\n                setMessages(history);\r\n            });\r\n\r\n            socket.on(\"new-file\", (file) => {\r\n                setSharedFiles((prev) => [file, ...prev]);\r\n                toast.success(`New file shared: ${file.fileName}`);\r\n            });\r\n\r\n            socket.on(\"drawing\", (data) => {\r\n                drawRemote(data);\r\n            });\r\n\r\n            socket.on(\"erase\", (data) => {\r\n                eraseRemote(data);\r\n            });\r\n\r\n            socket.on(\"board-cleared\", () => {\r\n                clearCanvasLocal();\r\n                setHistory([]);\r\n                setHistoryIndex(-1);\r\n                toast.info(\"The board was cleared by the host\");\r\n            });\r\n\r\n            socket.on(\"canvas-state\", (data) => {\r\n                if (data) {\r\n                    applyCanvasState(data);\r\n                    setHistory([data]);\r\n                    setHistoryIndex(0);\r\n                }\r\n            });\r\n\r\n            socket.on(\"undo\", (state) => {\r\n                applyCanvasState(state);\r\n            });\r\n\r\n            socket.on(\"redo\", (state) => {\r\n                applyCanvasState(state);\r\n            });\r\n\r\n            socket.on(\"error-message\", (msg) => {\r\n                toast.error(msg);\r\n            });\r\n        }\r\n\r\n        const handleUndoEvent = () => handleUndo();\r\n        const handleRedoEvent = () => handleRedo();\r\n\r\n        window.addEventListener('wb-undo', handleUndoEvent);\r\n        window.addEventListener('wb-redo', handleRedoEvent);\r\n\r\n        return () => {\r\n            if (socket) {\r\n                socket.emit(\"leave-room\", { roomId, userId: user._id, userName: user.name });\r\n                socket.off(\"user-joined\");\r\n                socket.off(\"online-users\");\r\n                socket.off(\"chat-message\");\r\n                socket.off(\"chat-history\");\r\n                socket.off(\"new-file\");\r\n                socket.off(\"drawing\");\r\n                socket.off(\"erase\");\r\n                socket.off(\"board-cleared\");\r\n                socket.off(\"canvas-state\");\r\n                socket.off(\"undo\");\r\n                socket.off(\"redo\");\r\n                socket.off(\"error-message\");\r\n            }\r\n            window.removeEventListener('wb-undo', handleUndoEvent);\r\n            window.removeEventListener('wb-redo', handleRedoEvent);\r\n        };\r\n    }, [roomId, socket, user, navigate]);\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current;\r\n        const container = canvas.parentElement;\r\n\r\n        const ResizeCanvas = () => {\r\n            const tempCanvas = document.createElement('canvas');\r\n            const tempCtx = tempCanvas.getContext('2d');\r\n            tempCanvas.width = canvas.width;\r\n            tempCanvas.height = canvas.height;\r\n            tempCtx.drawImage(canvas, 0, 0);\r\n\r\n            canvas.width = container.offsetWidth;\r\n            canvas.height = container.offsetHeight;\r\n\r\n            const context = canvas.getContext(\"2d\");\r\n            context.lineCap = \"round\";\r\n            context.lineJoin = \"round\";\r\n            context.drawImage(tempCanvas, 0, 0);\r\n            contextRef.current = context;\r\n        };\r\n\r\n        window.addEventListener('resize', ResizeCanvas);\r\n        ResizeCanvas();\r\n\r\n        const dataURL = canvas.toDataURL();\r\n        setHistory([dataURL]);\r\n        setHistoryIndex(0);\r\n\r\n        return () => window.removeEventListener('resize', ResizeCanvas);\r\n    }, []);\r\n\r\n    const applyCanvasState = (state) => {\r\n        if (!state) {\r\n            clearCanvasLocal();\r\n            return;\r\n        }\r\n        const image = new Image();\r\n        image.src = state;\r\n        image.onload = () => {\r\n            clearCanvasLocal();\r\n            contextRef.current.drawImage(image, 0, 0);\r\n        };\r\n    };\r\n\r\n    const clearCanvasLocal = () => {\r\n        const canvas = canvasRef.current;\r\n        contextRef.current.clearRect(0, 0, canvas.width, canvas.height);\r\n    };\r\n\r\n    const startDrawing = ({ nativeEvent }) => {\r\n        const { offsetX, offsetY } = nativeEvent;\r\n        contextRef.current.beginPath();\r\n        contextRef.current.moveTo(offsetX, offsetY);\r\n        setIsDrawing(true);\r\n    };\r\n\r\n    const draw = ({ nativeEvent }) => {\r\n        if (!isDrawing) return;\r\n        const { offsetX, offsetY } = nativeEvent;\r\n        contextRef.current.lineWidth = size;\r\n\r\n        if (tool === \"pencil\") {\r\n            contextRef.current.strokeStyle = color;\r\n            contextRef.current.globalCompositeOperation = \"source-over\";\r\n            contextRef.current.lineTo(offsetX, offsetY);\r\n            contextRef.current.stroke();\r\n\r\n            socket.emit(\"drawing\", {\r\n                roomId,\r\n                drawingData: { x: offsetX, y: offsetY, color, size }\r\n            });\r\n        } else {\r\n            contextRef.current.globalCompositeOperation = \"destination-out\";\r\n            contextRef.current.lineTo(offsetX, offsetY);\r\n            contextRef.current.stroke();\r\n\r\n            socket.emit(\"erase\", {\r\n                roomId,\r\n                eraseData: { x: offsetX, y: offsetY, size: size * 2 }\r\n            });\r\n        }\r\n    };\r\n\r\n    const stopDrawing = () => {\r\n        if (!isDrawing) return;\r\n        contextRef.current.closePath();\r\n        setIsDrawing(false);\r\n\r\n        const dataURL = canvasRef.current.toDataURL();\r\n        const newHistory = history.slice(0, historyIndex + 1);\r\n        newHistory.push(dataURL);\r\n        if (newHistory.length > 50) newHistory.shift();\r\n\r\n        setHistory(newHistory);\r\n        setHistoryIndex(newHistory.length - 1);\r\n        socket.emit(\"save-canvas\", { roomId, canvasData: dataURL });\r\n    };\r\n\r\n    const handleUndo = () => {\r\n        if (historyIndex > 0) {\r\n            const newIndex = historyIndex - 1;\r\n            const state = history[newIndex];\r\n            setHistoryIndex(newIndex);\r\n            applyCanvasState(state);\r\n            socket.emit(\"undo\", { roomId, canvasState: state });\r\n            socket.emit(\"save-canvas\", { roomId, canvasData: state });\r\n        }\r\n    };\r\n\r\n    const handleRedo = () => {\r\n        if (historyIndex < history.length - 1) {\r\n            const newIndex = historyIndex + 1;\r\n            const state = history[newIndex];\r\n            setHistoryIndex(newIndex);\r\n            applyCanvasState(state);\r\n            socket.emit(\"redo\", { roomId, canvasState: state });\r\n            socket.emit(\"save-canvas\", { roomId, canvasData: state });\r\n        }\r\n    };\r\n\r\n    const drawRemote = (data) => {\r\n        const { x, y, color, size } = data;\r\n        const context = contextRef.current;\r\n        const prevGCO = context.globalCompositeOperation;\r\n        const prevStrokeStyle = context.strokeStyle;\r\n        const prevLineWidth = context.lineWidth;\r\n\r\n        context.globalCompositeOperation = \"source-over\";\r\n        context.strokeStyle = color;\r\n        context.lineWidth = size;\r\n        context.beginPath();\r\n        context.arc(x, y, size / 2, 0, Math.PI * 2);\r\n        context.fillStyle = color;\r\n        context.fill();\r\n\r\n        context.globalCompositeOperation = prevGCO;\r\n        context.strokeStyle = prevStrokeStyle;\r\n        context.lineWidth = prevLineWidth;\r\n    };\r\n\r\n    const eraseRemote = (data) => {\r\n        const { x, y, size } = data;\r\n        const context = contextRef.current;\r\n        const prevGCO = context.globalCompositeOperation;\r\n        const prevLineWidth = context.lineWidth;\r\n\r\n        context.globalCompositeOperation = \"destination-out\";\r\n        context.lineWidth = size;\r\n        context.beginPath();\r\n        context.arc(x, y, size, 0, Math.PI * 2);\r\n        context.fill();\r\n\r\n        context.globalCompositeOperation = prevGCO;\r\n        context.lineWidth = prevLineWidth;\r\n    };\r\n\r\n    const handleSendMessage = (text) => {\r\n        if (socket) {\r\n            socket.emit(\"chat-message\", { roomId, message: text, userId: user._id, userName: user.name });\r\n        }\r\n    };\r\n\r\n    const handleClearBoard = () => {\r\n        if (user._id !== room?.host) {\r\n            toast.error(\"Only the host can clear the board\");\r\n            return;\r\n        }\r\n        if (window.confirm(\"This will clear the entire canvas for everyone. Proceed?\")) {\r\n            socket.emit(\"clear-board\", { roomId, userId: user._id });\r\n        }\r\n    };\r\n\r\n    const handleDownload = () => {\r\n        const canvas = canvasRef.current;\r\n        const dataURL = canvas.toDataURL(\"image/png\");\r\n        const link = document.createElement(\"a\");\r\n        link.href = dataURL;\r\n        link.download = `whiteboard-${room?.roomName || roomId}.png`;\r\n        link.click();\r\n        toast.success(\"Design exported successfully!\");\r\n    };\r\n\r\n    const handleShare = () => {\r\n        const url = window.location.href;\r\n        navigator.clipboard.writeText(url);\r\n        toast.success(\"Invitation link copied to clipboard!\");\r\n    };\r\n\r\n    const handleFileUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        const formData = new FormData();\r\n        formData.append(\"file\", file);\r\n\r\n        setLoadingFileUpload(true);\r\n        try {\r\n            const res = await roomService.uploadFile(roomId, formData);\r\n            socket.emit(\"file-shared\", { roomId, file: res.data.file });\r\n            setSharedFiles((prev) => [res.data.file, ...prev]);\r\n            toast.success(\"Asset shared with the team!\");\r\n        } catch (err) {\r\n            toast.error(\"Failed to share asset\");\r\n        } finally {\r\n            setLoadingFileUpload(false);\r\n        }\r\n    };\r\n\r\n    const handleScreenShare = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: false });\r\n            setScreenStream(stream);\r\n            stream.getVideoTracks()[0].onended = () => stopScreenShare();\r\n            if (screenVideoRef.current) screenVideoRef.current.srcObject = stream;\r\n            toast.success(\"Screen sharing active\");\r\n            socket.emit(\"screen-share-started\", { roomId, userId: user._id, userName: user.name });\r\n        } catch (err) {\r\n            toast.error(\"Screen sharing cancelled\");\r\n        }\r\n    };\r\n\r\n    const stopScreenShare = () => {\r\n        if (screenStream) {\r\n            screenStream.getTracks().forEach(track => track.stop());\r\n            setScreenStream(null);\r\n            socket.emit(\"screen-share-stopped\", { roomId });\r\n            toast.info(\"Screen sharing ended\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"h-screen w-screen bg-slate-950 flex flex-col overflow-hidden text-slate-100\">\r\n            {/* Main Header */}\r\n            <header className=\"glass h-16 px-6 flex items-center justify-between border-b border-white/5 z-40\">\r\n                <div className=\"flex items-center gap-6\">\r\n                    <div className=\"flex items-center gap-3 cursor-pointer\" onClick={() => navigate('/dashboard')}>\r\n                        <div className=\"w-8 h-8 rounded-lg bg-gradient-to-tr from-primary-600 to-indigo-600 flex items-center justify-center shadow-lg shadow-primary-900/40\">\r\n                            <span className=\"text-sm font-bold text-white\">C</span>\r\n                        </div>\r\n                        <h1 className=\"font-bold tracking-tight hidden md:block\">{room?.roomName}</h1>\r\n                    </div>\r\n\r\n                    <div className=\"h-4 w-px bg-white/10 mx-2 hidden md:block\"></div>\r\n\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <div className=\"px-3 py-1 rounded-full bg-white/5 border border-white/10 flex items-center gap-2 cursor-pointer group\"\r\n                            onClick={handleShare}>\r\n                            <span className=\"text-xs font-mono text-slate-400 group-hover:text-primary-400 transition-colors\">ID: {roomId}</span>\r\n                            <span className=\"text-[10px] bg-slate-800 px-1 rounded uppercase tracking-tighter text-slate-500\">Copy</span>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-1.5 px-3 py-1 bg-primary-500/10 border border-primary-500/20 rounded-full\">\r\n                            <div className=\"w-1.5 h-1.5 rounded-full bg-primary-500 animate-pulse\"></div>\r\n                            <span className=\"text-xs font-bold text-primary-400\">{participants.length} Online</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button\r\n                        className={`hidden sm:flex items-center gap-2 px-4 py-2 rounded-xl text-sm font-bold transition-all\r\n                                  ${screenStream ? \"bg-red-500/20 text-red-400 border border-red-500/30\" : \"bg-white/5 text-slate-300 border border-white/10 hover:bg-white/10\"}`}\r\n                        onClick={screenStream ? stopScreenShare : handleScreenShare}\r\n                    >\r\n                        {screenStream ? \"End Stream\" : \"Share Stream\"}\r\n                    </button>\r\n                    <button onClick={handleDownload} className=\"btn-secondary-premium !px-4 !py-2 text-sm flex items-center gap-2\">\r\n                        <span>Save Image</span>\r\n                    </button>\r\n                    <button onClick={() => navigate('/dashboard')} className=\"btn-premium !px-4 !py-2 text-sm\">\r\n                        Leave\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            <div className=\"flex-1 flex overflow-hidden relative\">\r\n                {/* Floating Toolbar */}\r\n                <div className=\"absolute left-6 top-1/2 -translate-y-1/2 z-30\">\r\n                    <Toolbar\r\n                        tool={tool}\r\n                        setTool={setTool}\r\n                        color={color}\r\n                        setColor={setColor}\r\n                        size={size}\r\n                        setSize={setSize}\r\n                        onClear={handleClearBoard}\r\n                        isHost={user._id === room?.host}\r\n                    />\r\n                </div>\r\n\r\n                {/* Main Canvas Area */}\r\n                <main className=\"flex-1 relative bg-slate-900 group\">\r\n                    <div className=\"absolute inset-0 z-10 canvas-container m-6 !rounded-3xl border border-white/5 shadow-2xl overflow-hidden shadow-black/50\">\r\n                        {screenStream && (\r\n                            <div className=\"absolute inset-0 bg-black/90 z-50 flex flex-col items-center justify-center gap-6 backdrop-blur-sm\">\r\n                                <video ref={screenVideoRef} autoPlay playsInline muted className=\"max-w-[80%] max-h-[70%] rounded-2xl border border-white/10 shadow-2xl shadow-primary-900/20\" />\r\n                                <div className=\"px-6 py-2 bg-red-500 text-white font-bold rounded-full text-sm animate-pulse flex items-center gap-2\">\r\n                                    <span className=\"w-2 h-2 rounded-full bg-white animate-ping\"></span>\r\n                                    LIVE SCREEN SHARE ACTIVE\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                        <canvas\r\n                            ref={canvasRef}\r\n                            onMouseDown={startDrawing}\r\n                            onMouseMove={draw}\r\n                            onMouseUp={stopDrawing}\r\n                            onMouseOut={stopDrawing}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Floating Zoom/Status Bar */}\r\n                    <div className=\"absolute bottom-10 left-1/2 -translate-x-1/2 z-20 glass px-4 py-2 rounded-full border border-white/10 flex items-center gap-6 shadow-xl\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest leading-none\">Tool</span>\r\n                            <span className=\"text-xs font-bold text-slate-200\">{tool === \"pencil\" ? \"âœï¸ Pencil\" : \"ðŸ§½ Eraser\"}</span>\r\n                        </div>\r\n                        <div className=\"w-px h-3 bg-white/10\"></div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest leading-none\">Role</span>\r\n                            <span className=\"text-xs font-bold text-primary-400\">{user._id === room?.host ? \"Host\" : \"Collaborator\"}</span>\r\n                        </div>\r\n                    </div>\r\n                </main>\r\n\r\n                {/* Collapsible Sidebar */}\r\n                <aside className=\"w-80 glass border-l border-white/5 flex flex-col z-30\">\r\n                    <div className=\"flex p-2 gap-1 bg-white/5 border-b border-white/5\">\r\n                        {['chat', 'files', 'users'].map((tab) => (\r\n                            <button\r\n                                key={tab}\r\n                                onClick={() => setActiveTab(tab)}\r\n                                className={`flex-1 py-1.5 rounded-lg text-xs font-bold transition-all uppercase tracking-widest\r\n                                          ${activeTab === tab ? \"bg-primary-600 text-white shadow-md shadow-primary-900/30\" : \"text-slate-500 hover:text-slate-300 hover:bg-white/5\"}`}\r\n                            >\r\n                                {tab}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n\r\n                    <div className=\"flex-1 overflow-hidden relative\">\r\n                        {activeTab === \"chat\" ? (\r\n                            <Chat\r\n                                messages={messages}\r\n                                onSendMessage={handleSendMessage}\r\n                                currentUser={user}\r\n                            />\r\n                        ) : activeTab === \"files\" ? (\r\n                            <div className=\"h-full flex flex-col p-4 overflow-hidden\">\r\n                                <div className=\"mb-4\">\r\n                                    <label className=\"btn-premium w-full !py-3 !rounded-2xl cursor-pointer flex items-center justify-center gap-2 text-sm tracking-tight\">\r\n                                        {loadingFileUpload ? (\r\n                                            <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\r\n                                        ) : <span>Share Asset â¬†ï¸</span>}\r\n                                        <input type=\"file\" onChange={handleFileUpload} className=\"hidden\" disabled={loadingFileUpload} />\r\n                                    </label>\r\n                                </div>\r\n                                <div className=\"flex-1 overflow-y-auto space-y-3 pr-1\">\r\n                                    {sharedFiles.length === 0 ? (\r\n                                        <div className=\"h-full flex flex-col items-center justify-center text-center opacity-30 mt-20\">\r\n                                            <span className=\"text-4xl mb-4\">ðŸ“</span>\r\n                                            <p className=\"text-sm font-medium text-slate-400\">No collaborative assets</p>\r\n                                        </div>\r\n                                    ) : (\r\n                                        sharedFiles.map((file, index) => (\r\n                                            <div key={index} className=\"p-3 glass rounded-xl border border-white/5 flex items-center gap-3 group transition-all hover:bg-white/5 hover:border-white/10\">\r\n                                                <div className=\"w-10 h-10 rounded-lg bg-indigo-600/10 text-indigo-400 flex items-center justify-center text-lg\">ðŸ“„</div>\r\n                                                <div className=\"flex-1 overflow-hidden\">\r\n                                                    <div className=\"text-xs font-bold text-slate-200 truncate\">{file.fileName}</div>\r\n                                                    <div className=\"text-[10px] text-slate-500 font-medium\">By {file.senderName}</div>\r\n                                                </div>\r\n                                                <a\r\n                                                    href={`${process.env.REACT_APP_API_URL || \"http://localhost:5000/api\"}${file.fileUrl.startsWith('/uploads') ? file.fileUrl.replace('/uploads', '/../../uploads') : file.fileUrl}`}\r\n                                                    target=\"_blank\" rel=\"noopener noreferrer\" download\r\n                                                    className=\"w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center hover:bg-primary-600 transition-all opacity-0 group-hover:opacity-100\"\r\n                                                >\r\n                                                    â¬‡ï¸\r\n                                                </a>\r\n                                            </div>\r\n                                        ))\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"p-4 space-y-3\">\r\n                                <div className=\"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4 px-1\">Participants</div>\r\n                                {participants.map((p, index) => (\r\n                                    <div key={index} className=\"flex items-center justify-between p-3 glass rounded-xl border border-white/5 hover:bg-white/5 hover:border-white/10 transition-all duration-300\">\r\n                                        <div className=\"flex items-center gap-3\">\r\n                                            <div className=\"w-8 h-8 rounded-full bg-gradient-to-tr from-slate-700 to-slate-800 border border-white/10 flex items-center justify-center text-xs font-bold text-white uppercase\">\r\n                                                {p.userName?.[0]}\r\n                                            </div>\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-xs font-bold text-slate-200\">{p.userName} {p.userId === user._id && \"(You)\"}</span>\r\n                                                <div className=\"flex items-center gap-1\">\r\n                                                    <div className=\"w-1.5 h-1.5 rounded-full bg-green-500\"></div>\r\n                                                    <span className=\"text-[10px] text-slate-500 font-medium\">Online</span>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                        {p.userId === room?.host && (\r\n                                            <span className=\"text-[10px] px-2 py-0.5 rounded-md bg-primary-500/10 border border-primary-500/20 text-primary-400 font-bold uppercase tracking-tighter shadow-sm\">\r\n                                                Host\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </aside>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WhiteboardRoom;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}