{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\components\\\\video\\\\WebRTCMeeting.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, Minimize2, Maximize2, GripHorizontal } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\n/**\r\n * WebRTCMeeting — Zoom-like group call via P2P mesh.\r\n *\r\n * Fixes:\r\n * - ICE candidate queuing (candidates buffered until remoteDescription is set)\r\n * - Proper peer lifecycle management (no ghost entries)\r\n * - Robust ontrack handling\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WebRTCMeeting = ({\n  socket,\n  roomId,\n  username,\n  onLeave\n}) => {\n  _s();\n  var _username$;\n  const [localStream, setLocalStream] = useState(null);\n  const [peers, setPeers] = useState({});\n  const [isMicEnabled, setIsMicEnabled] = useState(true);\n  const [isCamEnabled, setIsCamEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n  const localVideoRef = useRef(null);\n  const streamRef = useRef(null);\n  const screenRef = useRef(null);\n  const peersRef = useRef({}); // { socketId: { pc, stream, username, candidateQueue[] } }\n  const componentMounted = useRef(true);\n  const onLeaveRef = useRef(onLeave);\n  useEffect(() => {\n    onLeaveRef.current = onLeave;\n  }, [onLeave]);\n\n  // Drag state\n  const containerRef = useRef(null);\n  const isDragging = useRef(false);\n  const dragOffset = useRef({\n    x: 0,\n    y: 0\n  });\n  const [position, setPosition] = useState({\n    x: 16,\n    y: 70\n  });\n  const rtcConfig = useRef({\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }]\n  }).current;\n\n  // ── Flush queued ICE candidates for a peer ────────────────────────────────\n  const flushCandidates = useCallback(async socketId => {\n    var _peer$pc$remoteDescri;\n    const peer = peersRef.current[socketId];\n    if (!(peer !== null && peer !== void 0 && peer.pc) || !((_peer$pc$remoteDescri = peer.pc.remoteDescription) !== null && _peer$pc$remoteDescri !== void 0 && _peer$pc$remoteDescri.type)) return;\n    while (peer.candidateQueue && peer.candidateQueue.length > 0) {\n      const c = peer.candidateQueue.shift();\n      try {\n        await peer.pc.addIceCandidate(new RTCIceCandidate(c));\n      } catch (_) {}\n    }\n  }, []);\n\n  // ── Sync ref → state ──────────────────────────────────────────────────────\n  const syncPeersState = useCallback(() => {\n    const snapshot = {};\n    Object.entries(peersRef.current).forEach(([id, p]) => {\n      snapshot[id] = {\n        pc: p.pc,\n        stream: p.stream,\n        username: p.username\n      };\n    });\n    setPeers(snapshot);\n  }, []);\n\n  // ── Remove a peer cleanly ─────────────────────────────────────────────────\n  const removePeer = useCallback(socketId => {\n    const peer = peersRef.current[socketId];\n    if (peer) {\n      try {\n        var _peer$pc;\n        (_peer$pc = peer.pc) === null || _peer$pc === void 0 ? void 0 : _peer$pc.close();\n      } catch (_) {}\n      delete peersRef.current[socketId];\n      syncPeersState();\n    }\n  }, [syncPeersState]);\n\n  // ── Create a PeerConnection for a remote user ─────────────────────────────\n  const createPeer = useCallback((targetSocketId, targetUsername, stream, isInitiator) => {\n    // If peer already has a live connection, return it\n    const existing = peersRef.current[targetSocketId];\n    if (existing !== null && existing !== void 0 && existing.pc && existing.pc.connectionState !== 'closed' && existing.pc.connectionState !== 'failed') {\n      return existing.pc;\n    }\n    // Clean up any dead connection\n    if (existing) {\n      try {\n        var _existing$pc;\n        (_existing$pc = existing.pc) === null || _existing$pc === void 0 ? void 0 : _existing$pc.close();\n      } catch (_) {}\n    }\n    const pc = new RTCPeerConnection(rtcConfig);\n\n    // Add local tracks\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n\n    // Store immediately with candidate queue\n    peersRef.current[targetSocketId] = {\n      pc,\n      stream: null,\n      username: targetUsername,\n      candidateQueue: []\n    };\n\n    // Remote tracks handler\n    pc.ontrack = event => {\n      var _event$streams;\n      const remoteStream = (_event$streams = event.streams) === null || _event$streams === void 0 ? void 0 : _event$streams[0];\n      if (!remoteStream) return;\n      if (peersRef.current[targetSocketId]) {\n        peersRef.current[targetSocketId].stream = remoteStream;\n      }\n      syncPeersState();\n    };\n\n    // ICE candidates go to the remote peer\n    pc.onicecandidate = event => {\n      if (event.candidate) {\n        socket.emit('mesh:candidate', {\n          roomId,\n          to: targetSocketId,\n          candidate: event.candidate\n        });\n      }\n    };\n    pc.oniceconnectionstatechange = () => {\n      const s = pc.iceConnectionState;\n      if (s === 'connected' || s === 'completed') {\n        syncPeersState();\n      }\n      if (s === 'failed') {\n        console.warn(`[Mesh] ICE failed for ${targetSocketId}`);\n        removePeer(targetSocketId);\n      }\n    };\n    syncPeersState();\n\n    // If we are the initiator, create and send offer\n    if (isInitiator) {\n      (async () => {\n        try {\n          const offer = await pc.createOffer();\n          await pc.setLocalDescription(offer);\n          socket.emit('mesh:offer', {\n            roomId,\n            to: targetSocketId,\n            offer: pc.localDescription\n          });\n        } catch (err) {\n          console.error('[Mesh] Offer error:', err);\n        }\n      })();\n    }\n    return pc;\n  }, [socket, roomId, rtcConfig, removePeer, syncPeersState]);\n\n  // ── 1. Get media and join the call room ──────────────────────────────────\n  useEffect(() => {\n    componentMounted.current = true;\n    const start = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        if (!componentMounted.current) {\n          stream.getTracks().forEach(t => t.stop());\n          return;\n        }\n        streamRef.current = stream;\n        setLocalStream(stream);\n        if (localVideoRef.current) localVideoRef.current.srcObject = stream;\n\n        // Tell server we've joined the call\n        socket.emit('mesh:join', {\n          roomId,\n          username\n        });\n      } catch (err) {\n        console.error('[WebRTC] Media error:', err);\n        toast.error('Could not access camera or microphone.');\n      }\n    };\n    start();\n    return () => {\n      componentMounted.current = false;\n      Object.keys(peersRef.current).forEach(id => {\n        try {\n          var _peersRef$current$id, _peersRef$current$id$;\n          (_peersRef$current$id = peersRef.current[id]) === null || _peersRef$current$id === void 0 ? void 0 : (_peersRef$current$id$ = _peersRef$current$id.pc) === null || _peersRef$current$id$ === void 0 ? void 0 : _peersRef$current$id$.close();\n        } catch (_) {}\n      });\n      peersRef.current = {};\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(t => t.stop());\n        streamRef.current = null;\n      }\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n    };\n  }, [socket, roomId, username]);\n\n  // ── 2. Socket signaling (mesh topology) ──────────────────────────────────\n  useEffect(() => {\n    if (!socket) return;\n\n    // Server sends the list of existing call participants\n    const onExistingPeers = ({\n      peers: existingPeers\n    }) => {\n      if (!streamRef.current) return;\n      existingPeers.forEach(p => {\n        createPeer(p.socketId, p.username, streamRef.current, true);\n      });\n    };\n\n    // A NEW peer has joined the call — wait for their offer\n    const onNewPeer = ({\n      socketId,\n      username: peerUsername\n    }) => {\n      if (!streamRef.current) return;\n      // Don't initiate — the new peer will send us an offer\n      // (they received us via mesh:existing-peers and will initiate)\n      // But we pre-create the PC so it's ready when the offer arrives\n      createPeer(socketId, peerUsername, streamRef.current, false);\n    };\n\n    // Receive an offer from a peer\n    const onOffer = async ({\n      from,\n      offer,\n      username: peerUsername\n    }) => {\n      if (!streamRef.current) return;\n      let peer = peersRef.current[from];\n      let pc;\n      if (!peer || !peer.pc || peer.pc.signalingState === 'closed') {\n        // Peer doesn't exist yet — create it\n        pc = createPeer(from, peerUsername, streamRef.current, false);\n      } else {\n        pc = peer.pc;\n        // Update username if needed\n        if (peerUsername && peer.username !== peerUsername) {\n          peersRef.current[from].username = peerUsername;\n        }\n      }\n      if (!pc) return;\n      try {\n        // Handle glare (both sides sent offer simultaneously)\n        if (pc.signalingState === 'have-local-offer') {\n          // If we already sent an offer, the peer with the \"lower\" socket ID yields\n          const weYield = socket.id > from;\n          if (weYield) {\n            await pc.setLocalDescription({\n              type: 'rollback'\n            });\n          } else {\n            return; // Ignore their offer, they'll process our answer\n          }\n        }\n        await pc.setRemoteDescription(new RTCSessionDescription(offer));\n        await flushCandidates(from);\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        socket.emit('mesh:answer', {\n          roomId,\n          to: from,\n          answer: pc.localDescription\n        });\n      } catch (e) {\n        console.error('[Mesh] Offer handling error:', e);\n      }\n    };\n\n    // Receive an answer\n    const onAnswer = async ({\n      from,\n      answer\n    }) => {\n      const peer = peersRef.current[from];\n      if (!(peer !== null && peer !== void 0 && peer.pc)) return;\n      try {\n        if (peer.pc.signalingState !== 'have-local-offer') return; // Stale answer\n        await peer.pc.setRemoteDescription(new RTCSessionDescription(answer));\n        await flushCandidates(from);\n      } catch (e) {\n        console.error('[Mesh] Answer error:', e);\n      }\n    };\n\n    // Receive an ICE candidate — queue if remote description not yet set\n    const onCandidate = async ({\n      from,\n      candidate\n    }) => {\n      var _peer$pc$remoteDescri2;\n      const peer = peersRef.current[from];\n      if (!(peer !== null && peer !== void 0 && peer.pc)) return;\n      if ((_peer$pc$remoteDescri2 = peer.pc.remoteDescription) !== null && _peer$pc$remoteDescri2 !== void 0 && _peer$pc$remoteDescri2.type) {\n        try {\n          await peer.pc.addIceCandidate(new RTCIceCandidate(candidate));\n        } catch (_) {}\n      } else {\n        // Queue it — will be flushed after setRemoteDescription\n        if (!peer.candidateQueue) peer.candidateQueue = [];\n        peer.candidateQueue.push(candidate);\n      }\n    };\n\n    // A peer left the call\n    const onPeerLeft = ({\n      socketId\n    }) => {\n      removePeer(socketId);\n    };\n    socket.on('mesh:existing-peers', onExistingPeers);\n    socket.on('mesh:new-peer', onNewPeer);\n    socket.on('mesh:offer', onOffer);\n    socket.on('mesh:answer', onAnswer);\n    socket.on('mesh:candidate', onCandidate);\n    socket.on('mesh:peer-left', onPeerLeft);\n    return () => {\n      socket.off('mesh:existing-peers', onExistingPeers);\n      socket.off('mesh:new-peer', onNewPeer);\n      socket.off('mesh:offer', onOffer);\n      socket.off('mesh:answer', onAnswer);\n      socket.off('mesh:candidate', onCandidate);\n      socket.off('mesh:peer-left', onPeerLeft);\n    };\n  }, [socket, roomId, createPeer, removePeer, flushCandidates]);\n\n  // ── Controls ──────────────────────────────────────────────────────────────\n  const toggleMic = () => {\n    var _streamRef$current;\n    const track = (_streamRef$current = streamRef.current) === null || _streamRef$current === void 0 ? void 0 : _streamRef$current.getAudioTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsMicEnabled(track.enabled);\n    }\n  };\n  const toggleCam = () => {\n    var _streamRef$current2;\n    const track = (_streamRef$current2 = streamRef.current) === null || _streamRef$current2 === void 0 ? void 0 : _streamRef$current2.getVideoTracks()[0];\n    if (track) {\n      track.enabled = !track.enabled;\n      setIsCamEnabled(track.enabled);\n    }\n  };\n  const toggleScreenShare = async () => {\n    if (isScreenSharing) {\n      var _streamRef$current3;\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n      const camTrack = (_streamRef$current3 = streamRef.current) === null || _streamRef$current3 === void 0 ? void 0 : _streamRef$current3.getVideoTracks()[0];\n      Object.values(peersRef.current).forEach(({\n        pc\n      }) => {\n        var _pc$getSenders, _pc$getSenders$call;\n        const sender = pc === null || pc === void 0 ? void 0 : (_pc$getSenders = pc.getSenders) === null || _pc$getSenders === void 0 ? void 0 : (_pc$getSenders$call = _pc$getSenders.call(pc)) === null || _pc$getSenders$call === void 0 ? void 0 : _pc$getSenders$call.find(s => {\n          var _s$track;\n          return ((_s$track = s.track) === null || _s$track === void 0 ? void 0 : _s$track.kind) === 'video';\n        });\n        if (sender && camTrack) sender.replaceTrack(camTrack);\n      });\n      if (localVideoRef.current && streamRef.current) localVideoRef.current.srcObject = streamRef.current;\n      setIsScreenSharing(false);\n    } else {\n      try {\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({\n          video: true\n        });\n        screenRef.current = screenStream;\n        const screenTrack = screenStream.getVideoTracks()[0];\n        Object.values(peersRef.current).forEach(({\n          pc\n        }) => {\n          var _pc$getSenders2, _pc$getSenders2$call;\n          const sender = pc === null || pc === void 0 ? void 0 : (_pc$getSenders2 = pc.getSenders) === null || _pc$getSenders2 === void 0 ? void 0 : (_pc$getSenders2$call = _pc$getSenders2.call(pc)) === null || _pc$getSenders2$call === void 0 ? void 0 : _pc$getSenders2$call.find(s => {\n            var _s$track2;\n            return ((_s$track2 = s.track) === null || _s$track2 === void 0 ? void 0 : _s$track2.kind) === 'video';\n          });\n          if (sender) sender.replaceTrack(screenTrack);\n        });\n        if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\n        screenTrack.onended = () => toggleScreenShare();\n        setIsScreenSharing(true);\n      } catch (_) {}\n    }\n  };\n  const handleLeave = () => {\n    socket.emit('mesh:leave', {\n      roomId\n    });\n    Object.keys(peersRef.current).forEach(id => {\n      try {\n        var _peersRef$current$id2, _peersRef$current$id3;\n        (_peersRef$current$id2 = peersRef.current[id]) === null || _peersRef$current$id2 === void 0 ? void 0 : (_peersRef$current$id3 = _peersRef$current$id2.pc) === null || _peersRef$current$id3 === void 0 ? void 0 : _peersRef$current$id3.close();\n      } catch (_) {}\n    });\n    peersRef.current = {};\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(t => t.stop());\n      streamRef.current = null;\n    }\n    if (screenRef.current) {\n      screenRef.current.getTracks().forEach(t => t.stop());\n      screenRef.current = null;\n    }\n    onLeaveRef.current();\n  };\n\n  // ── Drag handler ──────────────────────────────────────────────────────────\n  const onDragStart = e => {\n    isDragging.current = true;\n    const rect = containerRef.current.getBoundingClientRect();\n    dragOffset.current = {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    };\n    const move = ev => {\n      if (!isDragging.current) return;\n      setPosition({\n        x: Math.max(0, Math.min(window.innerWidth - 120, ev.clientX - dragOffset.current.x)),\n        y: Math.max(0, Math.min(window.innerHeight - 80, ev.clientY - dragOffset.current.y))\n      });\n    };\n    const up = () => {\n      isDragging.current = false;\n      document.removeEventListener('mousemove', move);\n      document.removeEventListener('mouseup', up);\n    };\n    document.addEventListener('mousemove', move);\n    document.addEventListener('mouseup', up);\n  };\n  const peerEntries = Object.entries(peers).filter(([_, p]) => p.pc && p.pc.connectionState !== 'closed');\n  const participantCount = 1 + peerEntries.length;\n\n  // ── Minimized view ────────────────────────────────────────────────────────\n  if (isMinimized) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"wbrtc-floating wbrtc-minimized\",\n      style: {\n        left: position.x,\n        top: position.y\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-mini-bar\",\n        onMouseDown: onDragStart,\n        children: [/*#__PURE__*/_jsxDEV(GripHorizontal, {\n          size: 14,\n          className: \"wbrtc-grip\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-mini-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"wbrtc-mini-dot\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 372,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [participantCount, \" in call\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 373,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 371,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn\",\n          onClick: () => setIsMinimized(false),\n          title: \"Expand\",\n          children: /*#__PURE__*/_jsxDEV(Maximize2, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 109\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn wbrtc-mini-leave\",\n          onClick: handleLeave,\n          title: \"Leave\",\n          children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 109\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 376,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 13\n    }, this);\n  }\n\n  // ── Full floating view ────────────────────────────────────────────────────\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    className: \"wbrtc-floating\",\n    style: {\n      left: position.x,\n      top: position.y\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-drag-bar\",\n      onMouseDown: onDragStart,\n      children: [/*#__PURE__*/_jsxDEV(GripHorizontal, {\n        size: 14,\n        className: \"wbrtc-grip\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"wbrtc-drag-title\",\n        children: [participantCount, \" in call\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-drag-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn\",\n          onClick: () => setIsMinimized(true),\n          title: \"Minimize\",\n          children: /*#__PURE__*/_jsxDEV(Minimize2, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 110\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-tile\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localVideoRef,\n          autoPlay: true,\n          muted: true,\n          playsInline: true,\n          className: \"wbrtc-tile-video\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 402,\n          columnNumber: 21\n        }, this), !isCamEnabled && !isScreenSharing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile-avatar\",\n          children: username === null || username === void 0 ? void 0 : (_username$ = username[0]) === null || _username$ === void 0 ? void 0 : _username$.toUpperCase()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile-name\",\n          children: [username, \" (You)\", !isMicEnabled && /*#__PURE__*/_jsxDEV(MicOff, {\n            size: 10,\n            className: \"wbrtc-tile-muted\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 408,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 17\n      }, this), peerEntries.map(([socketId, peer]) => {\n        var _2;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile\",\n          children: [peer.stream ? /*#__PURE__*/_jsxDEV(RemoteVideo, {\n            stream: peer.stream\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wbrtc-tile-avatar\",\n            children: (_2 = (peer.username || '?')[0]) === null || _2 === void 0 ? void 0 : _2.toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wbrtc-tile-name\",\n            children: peer.username || 'Participant'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 420,\n            columnNumber: 25\n          }, this)]\n        }, socketId, true, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 21\n        }, this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMic,\n        className: `wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isMicEnabled ? 'Mute' : 'Unmute',\n        children: isMicEnabled ? /*#__PURE__*/_jsxDEV(Mic, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(MicOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 57\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 427,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleCam,\n        className: `wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isCamEnabled ? 'Stop Video' : 'Start Video',\n        children: isCamEnabled ? /*#__PURE__*/_jsxDEV(Video, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(VideoOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 59\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleScreenShare,\n        className: `wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`,\n        title: isScreenSharing ? 'Stop Sharing' : 'Share Screen',\n        children: isScreenSharing ? /*#__PURE__*/_jsxDEV(MonitorOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 40\n        }, this) : /*#__PURE__*/_jsxDEV(Monitor, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 67\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-divider\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLeave,\n        className: \"wbrtc-btn wbrtc-btn--leave\",\n        title: \"Leave call\",\n        children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 438,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 384,\n    columnNumber: 9\n  }, this);\n};\n\n// ── Helper: renders a remote video stream ─────────────────────────────────────\n_s(WebRTCMeeting, \"00xLTCf3vJcoV/9wKcDQV3vmL8g=\");\n_c = WebRTCMeeting;\nconst RemoteVideo = /*#__PURE__*/_s2(/*#__PURE__*/React.memo(_c2 = _s2(({\n  stream\n}) => {\n  _s2();\n  const ref = useRef(null);\n  useEffect(() => {\n    const video = ref.current;\n    if (!video || !stream) return;\n    video.srcObject = stream;\n    const tryPlay = () => {\n      video.play().catch(() => {\n        // Autoplay blocked — retry on user gesture\n        const retryPlay = () => {\n          video.play().catch(() => {});\n          document.removeEventListener('click', retryPlay);\n        };\n        document.addEventListener('click', retryPlay, {\n          once: true\n        });\n      });\n    };\n\n    // If tracks are already active, play immediately\n    if (stream.getVideoTracks().length > 0 && stream.getVideoTracks()[0].readyState === 'live') {\n      tryPlay();\n    }\n\n    // Also listen for new tracks being added\n    const onTrackAdded = () => tryPlay();\n    stream.addEventListener('addtrack', onTrackAdded);\n    return () => {\n      stream.removeEventListener('addtrack', onTrackAdded);\n    };\n  }, [stream]);\n  return /*#__PURE__*/_jsxDEV(\"video\", {\n    ref: ref,\n    autoPlay: true,\n    playsInline: true,\n    className: \"wbrtc-tile-video\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 477,\n    columnNumber: 12\n  }, this);\n}, \"8uVE59eA/r6b92xF80p7sH8rXLk=\")), \"8uVE59eA/r6b92xF80p7sH8rXLk=\");\n_c3 = RemoteVideo;\nexport default WebRTCMeeting;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"WebRTCMeeting\");\n$RefreshReg$(_c2, \"RemoteVideo$React.memo\");\n$RefreshReg$(_c3, \"RemoteVideo\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Mic","MicOff","Video","VideoOff","PhoneOff","Monitor","MonitorOff","Minimize2","Maximize2","GripHorizontal","toast","jsxDEV","_jsxDEV","WebRTCMeeting","socket","roomId","username","onLeave","_s","_username$","localStream","setLocalStream","peers","setPeers","isMicEnabled","setIsMicEnabled","isCamEnabled","setIsCamEnabled","isScreenSharing","setIsScreenSharing","isMinimized","setIsMinimized","localVideoRef","streamRef","screenRef","peersRef","componentMounted","onLeaveRef","current","containerRef","isDragging","dragOffset","x","y","position","setPosition","rtcConfig","iceServers","urls","flushCandidates","socketId","_peer$pc$remoteDescri","peer","pc","remoteDescription","type","candidateQueue","length","c","shift","addIceCandidate","RTCIceCandidate","_","syncPeersState","snapshot","Object","entries","forEach","id","p","stream","removePeer","_peer$pc","close","createPeer","targetSocketId","targetUsername","isInitiator","existing","connectionState","_existing$pc","RTCPeerConnection","getTracks","track","addTrack","ontrack","event","_event$streams","remoteStream","streams","onicecandidate","candidate","emit","to","oniceconnectionstatechange","s","iceConnectionState","console","warn","offer","createOffer","setLocalDescription","localDescription","err","error","start","navigator","mediaDevices","getUserMedia","video","audio","t","stop","srcObject","keys","_peersRef$current$id","_peersRef$current$id$","onExistingPeers","existingPeers","onNewPeer","peerUsername","onOffer","from","signalingState","weYield","setRemoteDescription","RTCSessionDescription","answer","createAnswer","e","onAnswer","onCandidate","_peer$pc$remoteDescri2","push","onPeerLeft","on","off","toggleMic","_streamRef$current","getAudioTracks","enabled","toggleCam","_streamRef$current2","getVideoTracks","toggleScreenShare","_streamRef$current3","camTrack","values","_pc$getSenders","_pc$getSenders$call","sender","getSenders","call","find","_s$track","kind","replaceTrack","screenStream","getDisplayMedia","screenTrack","_pc$getSenders2","_pc$getSenders2$call","_s$track2","onended","handleLeave","_peersRef$current$id2","_peersRef$current$id3","onDragStart","rect","getBoundingClientRect","clientX","left","clientY","top","move","ev","Math","max","min","window","innerWidth","innerHeight","up","document","removeEventListener","addEventListener","peerEntries","filter","participantCount","ref","className","style","children","onMouseDown","size","fileName","_jsxFileName","lineNumber","columnNumber","onClick","title","autoPlay","muted","playsInline","toUpperCase","map","_2","RemoteVideo","_c","_s2","memo","_c2","tryPlay","play","catch","retryPlay","once","readyState","onTrackAdded","_c3","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/components/video/WebRTCMeeting.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, Minimize2, Maximize2, GripHorizontal } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * WebRTCMeeting — Zoom-like group call via P2P mesh.\r\n *\r\n * Fixes:\r\n * - ICE candidate queuing (candidates buffered until remoteDescription is set)\r\n * - Proper peer lifecycle management (no ghost entries)\r\n * - Robust ontrack handling\r\n */\r\nconst WebRTCMeeting = ({ socket, roomId, username, onLeave }) => {\r\n    const [localStream, setLocalStream] = useState(null);\r\n    const [peers, setPeers] = useState({});\r\n    const [isMicEnabled, setIsMicEnabled] = useState(true);\r\n    const [isCamEnabled, setIsCamEnabled] = useState(true);\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const [isMinimized, setIsMinimized] = useState(false);\r\n\r\n    const localVideoRef = useRef(null);\r\n    const streamRef = useRef(null);\r\n    const screenRef = useRef(null);\r\n    const peersRef = useRef({});   // { socketId: { pc, stream, username, candidateQueue[] } }\r\n    const componentMounted = useRef(true);\r\n    const onLeaveRef = useRef(onLeave);\r\n    useEffect(() => { onLeaveRef.current = onLeave; }, [onLeave]);\r\n\r\n    // Drag state\r\n    const containerRef = useRef(null);\r\n    const isDragging = useRef(false);\r\n    const dragOffset = useRef({ x: 0, y: 0 });\r\n    const [position, setPosition] = useState({ x: 16, y: 70 });\r\n\r\n    const rtcConfig = useRef({\r\n        iceServers: [\r\n            { urls: 'stun:stun.l.google.com:19302' },\r\n            { urls: 'stun:stun1.l.google.com:19302' },\r\n        ],\r\n    }).current;\r\n\r\n    // ── Flush queued ICE candidates for a peer ────────────────────────────────\r\n    const flushCandidates = useCallback(async (socketId) => {\r\n        const peer = peersRef.current[socketId];\r\n        if (!peer?.pc || !peer.pc.remoteDescription?.type) return;\r\n        while (peer.candidateQueue && peer.candidateQueue.length > 0) {\r\n            const c = peer.candidateQueue.shift();\r\n            try { await peer.pc.addIceCandidate(new RTCIceCandidate(c)); } catch (_) { }\r\n        }\r\n    }, []);\r\n\r\n    // ── Sync ref → state ──────────────────────────────────────────────────────\r\n    const syncPeersState = useCallback(() => {\r\n        const snapshot = {};\r\n        Object.entries(peersRef.current).forEach(([id, p]) => {\r\n            snapshot[id] = { pc: p.pc, stream: p.stream, username: p.username };\r\n        });\r\n        setPeers(snapshot);\r\n    }, []);\r\n\r\n    // ── Remove a peer cleanly ─────────────────────────────────────────────────\r\n    const removePeer = useCallback((socketId) => {\r\n        const peer = peersRef.current[socketId];\r\n        if (peer) {\r\n            try { peer.pc?.close(); } catch (_) { }\r\n            delete peersRef.current[socketId];\r\n            syncPeersState();\r\n        }\r\n    }, [syncPeersState]);\r\n\r\n    // ── Create a PeerConnection for a remote user ─────────────────────────────\r\n    const createPeer = useCallback((targetSocketId, targetUsername, stream, isInitiator) => {\r\n        // If peer already has a live connection, return it\r\n        const existing = peersRef.current[targetSocketId];\r\n        if (existing?.pc && existing.pc.connectionState !== 'closed' && existing.pc.connectionState !== 'failed') {\r\n            return existing.pc;\r\n        }\r\n        // Clean up any dead connection\r\n        if (existing) {\r\n            try { existing.pc?.close(); } catch (_) { }\r\n        }\r\n\r\n        const pc = new RTCPeerConnection(rtcConfig);\r\n\r\n        // Add local tracks\r\n        stream.getTracks().forEach(track => pc.addTrack(track, stream));\r\n\r\n        // Store immediately with candidate queue\r\n        peersRef.current[targetSocketId] = {\r\n            pc,\r\n            stream: null,\r\n            username: targetUsername,\r\n            candidateQueue: [],\r\n        };\r\n\r\n        // Remote tracks handler\r\n        pc.ontrack = (event) => {\r\n            const remoteStream = event.streams?.[0];\r\n            if (!remoteStream) return;\r\n            if (peersRef.current[targetSocketId]) {\r\n                peersRef.current[targetSocketId].stream = remoteStream;\r\n            }\r\n            syncPeersState();\r\n        };\r\n\r\n        // ICE candidates go to the remote peer\r\n        pc.onicecandidate = (event) => {\r\n            if (event.candidate) {\r\n                socket.emit('mesh:candidate', { roomId, to: targetSocketId, candidate: event.candidate });\r\n            }\r\n        };\r\n\r\n        pc.oniceconnectionstatechange = () => {\r\n            const s = pc.iceConnectionState;\r\n            if (s === 'connected' || s === 'completed') {\r\n                syncPeersState();\r\n            }\r\n            if (s === 'failed') {\r\n                console.warn(`[Mesh] ICE failed for ${targetSocketId}`);\r\n                removePeer(targetSocketId);\r\n            }\r\n        };\r\n\r\n        syncPeersState();\r\n\r\n        // If we are the initiator, create and send offer\r\n        if (isInitiator) {\r\n            (async () => {\r\n                try {\r\n                    const offer = await pc.createOffer();\r\n                    await pc.setLocalDescription(offer);\r\n                    socket.emit('mesh:offer', { roomId, to: targetSocketId, offer: pc.localDescription });\r\n                } catch (err) {\r\n                    console.error('[Mesh] Offer error:', err);\r\n                }\r\n            })();\r\n        }\r\n\r\n        return pc;\r\n    }, [socket, roomId, rtcConfig, removePeer, syncPeersState]);\r\n\r\n    // ── 1. Get media and join the call room ──────────────────────────────────\r\n    useEffect(() => {\r\n        componentMounted.current = true;\r\n\r\n        const start = async () => {\r\n            try {\r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n                if (!componentMounted.current) { stream.getTracks().forEach(t => t.stop()); return; }\r\n\r\n                streamRef.current = stream;\r\n                setLocalStream(stream);\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = stream;\r\n\r\n                // Tell server we've joined the call\r\n                socket.emit('mesh:join', { roomId, username });\r\n            } catch (err) {\r\n                console.error('[WebRTC] Media error:', err);\r\n                toast.error('Could not access camera or microphone.');\r\n            }\r\n        };\r\n\r\n        start();\r\n\r\n        return () => {\r\n            componentMounted.current = false;\r\n            Object.keys(peersRef.current).forEach(id => {\r\n                try { peersRef.current[id]?.pc?.close(); } catch (_) { }\r\n            });\r\n            peersRef.current = {};\r\n            if (streamRef.current) { streamRef.current.getTracks().forEach(t => t.stop()); streamRef.current = null; }\r\n            if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n        };\r\n    }, [socket, roomId, username]);\r\n\r\n    // ── 2. Socket signaling (mesh topology) ──────────────────────────────────\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n\r\n        // Server sends the list of existing call participants\r\n        const onExistingPeers = ({ peers: existingPeers }) => {\r\n            if (!streamRef.current) return;\r\n            existingPeers.forEach(p => {\r\n                createPeer(p.socketId, p.username, streamRef.current, true);\r\n            });\r\n        };\r\n\r\n        // A NEW peer has joined the call — wait for their offer\r\n        const onNewPeer = ({ socketId, username: peerUsername }) => {\r\n            if (!streamRef.current) return;\r\n            // Don't initiate — the new peer will send us an offer\r\n            // (they received us via mesh:existing-peers and will initiate)\r\n            // But we pre-create the PC so it's ready when the offer arrives\r\n            createPeer(socketId, peerUsername, streamRef.current, false);\r\n        };\r\n\r\n        // Receive an offer from a peer\r\n        const onOffer = async ({ from, offer, username: peerUsername }) => {\r\n            if (!streamRef.current) return;\r\n\r\n            let peer = peersRef.current[from];\r\n            let pc;\r\n\r\n            if (!peer || !peer.pc || peer.pc.signalingState === 'closed') {\r\n                // Peer doesn't exist yet — create it\r\n                pc = createPeer(from, peerUsername, streamRef.current, false);\r\n            } else {\r\n                pc = peer.pc;\r\n                // Update username if needed\r\n                if (peerUsername && peer.username !== peerUsername) {\r\n                    peersRef.current[from].username = peerUsername;\r\n                }\r\n            }\r\n\r\n            if (!pc) return;\r\n\r\n            try {\r\n                // Handle glare (both sides sent offer simultaneously)\r\n                if (pc.signalingState === 'have-local-offer') {\r\n                    // If we already sent an offer, the peer with the \"lower\" socket ID yields\r\n                    const weYield = socket.id > from;\r\n                    if (weYield) {\r\n                        await pc.setLocalDescription({ type: 'rollback' });\r\n                    } else {\r\n                        return; // Ignore their offer, they'll process our answer\r\n                    }\r\n                }\r\n\r\n                await pc.setRemoteDescription(new RTCSessionDescription(offer));\r\n                await flushCandidates(from);\r\n\r\n                const answer = await pc.createAnswer();\r\n                await pc.setLocalDescription(answer);\r\n                socket.emit('mesh:answer', { roomId, to: from, answer: pc.localDescription });\r\n            } catch (e) {\r\n                console.error('[Mesh] Offer handling error:', e);\r\n            }\r\n        };\r\n\r\n        // Receive an answer\r\n        const onAnswer = async ({ from, answer }) => {\r\n            const peer = peersRef.current[from];\r\n            if (!peer?.pc) return;\r\n            try {\r\n                if (peer.pc.signalingState !== 'have-local-offer') return; // Stale answer\r\n                await peer.pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n                await flushCandidates(from);\r\n            } catch (e) {\r\n                console.error('[Mesh] Answer error:', e);\r\n            }\r\n        };\r\n\r\n        // Receive an ICE candidate — queue if remote description not yet set\r\n        const onCandidate = async ({ from, candidate }) => {\r\n            const peer = peersRef.current[from];\r\n            if (!peer?.pc) return;\r\n\r\n            if (peer.pc.remoteDescription?.type) {\r\n                try { await peer.pc.addIceCandidate(new RTCIceCandidate(candidate)); } catch (_) { }\r\n            } else {\r\n                // Queue it — will be flushed after setRemoteDescription\r\n                if (!peer.candidateQueue) peer.candidateQueue = [];\r\n                peer.candidateQueue.push(candidate);\r\n            }\r\n        };\r\n\r\n        // A peer left the call\r\n        const onPeerLeft = ({ socketId }) => {\r\n            removePeer(socketId);\r\n        };\r\n\r\n        socket.on('mesh:existing-peers', onExistingPeers);\r\n        socket.on('mesh:new-peer', onNewPeer);\r\n        socket.on('mesh:offer', onOffer);\r\n        socket.on('mesh:answer', onAnswer);\r\n        socket.on('mesh:candidate', onCandidate);\r\n        socket.on('mesh:peer-left', onPeerLeft);\r\n\r\n        return () => {\r\n            socket.off('mesh:existing-peers', onExistingPeers);\r\n            socket.off('mesh:new-peer', onNewPeer);\r\n            socket.off('mesh:offer', onOffer);\r\n            socket.off('mesh:answer', onAnswer);\r\n            socket.off('mesh:candidate', onCandidate);\r\n            socket.off('mesh:peer-left', onPeerLeft);\r\n        };\r\n    }, [socket, roomId, createPeer, removePeer, flushCandidates]);\r\n\r\n    // ── Controls ──────────────────────────────────────────────────────────────\r\n    const toggleMic = () => {\r\n        const track = streamRef.current?.getAudioTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsMicEnabled(track.enabled); }\r\n    };\r\n\r\n    const toggleCam = () => {\r\n        const track = streamRef.current?.getVideoTracks()[0];\r\n        if (track) { track.enabled = !track.enabled; setIsCamEnabled(track.enabled); }\r\n    };\r\n\r\n    const toggleScreenShare = async () => {\r\n        if (isScreenSharing) {\r\n            if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n            const camTrack = streamRef.current?.getVideoTracks()[0];\r\n            Object.values(peersRef.current).forEach(({ pc }) => {\r\n                const sender = pc?.getSenders?.()?.find(s => s.track?.kind === 'video');\r\n                if (sender && camTrack) sender.replaceTrack(camTrack);\r\n            });\r\n            if (localVideoRef.current && streamRef.current) localVideoRef.current.srcObject = streamRef.current;\r\n            setIsScreenSharing(false);\r\n        } else {\r\n            try {\r\n                const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });\r\n                screenRef.current = screenStream;\r\n                const screenTrack = screenStream.getVideoTracks()[0];\r\n                Object.values(peersRef.current).forEach(({ pc }) => {\r\n                    const sender = pc?.getSenders?.()?.find(s => s.track?.kind === 'video');\r\n                    if (sender) sender.replaceTrack(screenTrack);\r\n                });\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\r\n                screenTrack.onended = () => toggleScreenShare();\r\n                setIsScreenSharing(true);\r\n            } catch (_) { }\r\n        }\r\n    };\r\n\r\n    const handleLeave = () => {\r\n        socket.emit('mesh:leave', { roomId });\r\n        Object.keys(peersRef.current).forEach(id => {\r\n            try { peersRef.current[id]?.pc?.close(); } catch (_) { }\r\n        });\r\n        peersRef.current = {};\r\n        if (streamRef.current) { streamRef.current.getTracks().forEach(t => t.stop()); streamRef.current = null; }\r\n        if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n        onLeaveRef.current();\r\n    };\r\n\r\n    // ── Drag handler ──────────────────────────────────────────────────────────\r\n    const onDragStart = (e) => {\r\n        isDragging.current = true;\r\n        const rect = containerRef.current.getBoundingClientRect();\r\n        dragOffset.current = { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n        const move = (ev) => {\r\n            if (!isDragging.current) return;\r\n            setPosition({\r\n                x: Math.max(0, Math.min(window.innerWidth - 120, ev.clientX - dragOffset.current.x)),\r\n                y: Math.max(0, Math.min(window.innerHeight - 80, ev.clientY - dragOffset.current.y)),\r\n            });\r\n        };\r\n        const up = () => {\r\n            isDragging.current = false;\r\n            document.removeEventListener('mousemove', move);\r\n            document.removeEventListener('mouseup', up);\r\n        };\r\n        document.addEventListener('mousemove', move);\r\n        document.addEventListener('mouseup', up);\r\n    };\r\n\r\n    const peerEntries = Object.entries(peers).filter(([_, p]) => p.pc && p.pc.connectionState !== 'closed');\r\n    const participantCount = 1 + peerEntries.length;\r\n\r\n    // ── Minimized view ────────────────────────────────────────────────────────\r\n    if (isMinimized) {\r\n        return (\r\n            <div\r\n                ref={containerRef}\r\n                className=\"wbrtc-floating wbrtc-minimized\"\r\n                style={{ left: position.x, top: position.y }}\r\n            >\r\n                <div className=\"wbrtc-mini-bar\" onMouseDown={onDragStart}>\r\n                    <GripHorizontal size={14} className=\"wbrtc-grip\" />\r\n                    <div className=\"wbrtc-mini-info\">\r\n                        <span className=\"wbrtc-mini-dot\" />\r\n                        <span>{participantCount} in call</span>\r\n                    </div>\r\n                    <button className=\"wbrtc-mini-btn\" onClick={() => setIsMinimized(false)} title=\"Expand\"><Maximize2 size={13} /></button>\r\n                    <button className=\"wbrtc-mini-btn wbrtc-mini-leave\" onClick={handleLeave} title=\"Leave\"><PhoneOff size={13} /></button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ── Full floating view ────────────────────────────────────────────────────\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            className=\"wbrtc-floating\"\r\n            style={{ left: position.x, top: position.y }}\r\n        >\r\n            {/* Drag handle */}\r\n            <div className=\"wbrtc-drag-bar\" onMouseDown={onDragStart}>\r\n                <GripHorizontal size={14} className=\"wbrtc-grip\" />\r\n                <span className=\"wbrtc-drag-title\">{participantCount} in call</span>\r\n                <div className=\"wbrtc-drag-actions\">\r\n                    <button className=\"wbrtc-mini-btn\" onClick={() => setIsMinimized(true)} title=\"Minimize\"><Minimize2 size={13} /></button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Video grid */}\r\n            <div className=\"wbrtc-grid\">\r\n                {/* Local */}\r\n                <div className=\"wbrtc-tile\">\r\n                    <video ref={localVideoRef} autoPlay muted playsInline className=\"wbrtc-tile-video\" />\r\n                    {!isCamEnabled && !isScreenSharing && (\r\n                        <div className=\"wbrtc-tile-avatar\">{username?.[0]?.toUpperCase()}</div>\r\n                    )}\r\n                    <div className=\"wbrtc-tile-name\">\r\n                        {username} (You)\r\n                        {!isMicEnabled && <MicOff size={10} className=\"wbrtc-tile-muted\" />}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Remote peers */}\r\n                {peerEntries.map(([socketId, peer]) => (\r\n                    <div className=\"wbrtc-tile\" key={socketId}>\r\n                        {peer.stream ? (\r\n                            <RemoteVideo stream={peer.stream} />\r\n                        ) : (\r\n                            <div className=\"wbrtc-tile-avatar\">{(peer.username || '?')[0]?.toUpperCase()}</div>\r\n                        )}\r\n                        <div className=\"wbrtc-tile-name\">{peer.username || 'Participant'}</div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div className=\"wbrtc-controls\">\r\n                <button onClick={toggleMic} className={`wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`} title={isMicEnabled ? 'Mute' : 'Unmute'}>\r\n                    {isMicEnabled ? <Mic size={15} /> : <MicOff size={15} />}\r\n                </button>\r\n                <button onClick={toggleCam} className={`wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`} title={isCamEnabled ? 'Stop Video' : 'Start Video'}>\r\n                    {isCamEnabled ? <Video size={15} /> : <VideoOff size={15} />}\r\n                </button>\r\n                <button onClick={toggleScreenShare} className={`wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`} title={isScreenSharing ? 'Stop Sharing' : 'Share Screen'}>\r\n                    {isScreenSharing ? <MonitorOff size={15} /> : <Monitor size={15} />}\r\n                </button>\r\n                <div className=\"wbrtc-divider\" />\r\n                <button onClick={handleLeave} className=\"wbrtc-btn wbrtc-btn--leave\" title=\"Leave call\">\r\n                    <PhoneOff size={15} />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// ── Helper: renders a remote video stream ─────────────────────────────────────\r\nconst RemoteVideo = React.memo(({ stream }) => {\r\n    const ref = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const video = ref.current;\r\n        if (!video || !stream) return;\r\n\r\n        video.srcObject = stream;\r\n\r\n        const tryPlay = () => {\r\n            video.play().catch(() => {\r\n                // Autoplay blocked — retry on user gesture\r\n                const retryPlay = () => { video.play().catch(() => { }); document.removeEventListener('click', retryPlay); };\r\n                document.addEventListener('click', retryPlay, { once: true });\r\n            });\r\n        };\r\n\r\n        // If tracks are already active, play immediately\r\n        if (stream.getVideoTracks().length > 0 && stream.getVideoTracks()[0].readyState === 'live') {\r\n            tryPlay();\r\n        }\r\n\r\n        // Also listen for new tracks being added\r\n        const onTrackAdded = () => tryPlay();\r\n        stream.addEventListener('addtrack', onTrackAdded);\r\n\r\n        return () => {\r\n            stream.removeEventListener('addtrack', onTrackAdded);\r\n        };\r\n    }, [stream]);\r\n\r\n    return <video ref={ref} autoPlay playsInline className=\"wbrtc-tile-video\" />;\r\n});\r\n\r\nexport default WebRTCMeeting;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}