{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\pages\\\\WhiteboardRoom.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useSocket } from \"../context/SocketContext\";\nimport { roomService } from \"../services/api\";\nimport Toolbar from \"../components/Toolbar\";\nimport Chat from \"../components/Chat\";\nimport StylingPanel from \"../components/StylingPanel\";\nimport toast from \"react-hot-toast\";\nimport { Plus, Minus } from \"lucide-react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WhiteboardRoom = () => {\n  _s();\n  const {\n    roomId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth();\n  const {\n    socket\n  } = useSocket();\n  const canvasRef = useRef(null);\n  const viewportRef = useRef(null);\n  const contextRef = useRef(null);\n\n  // Tools & Styling\n  const [tool, setTool] = useState(\"pencil\");\n  const [showStyling, setShowStyling] = useState(true);\n  const [color, setColor] = useState(\"#000000\");\n  const [size, setSize] = useState(4);\n  const [opacity, setOpacity] = useState(1);\n  const [strokeStyle, setStrokeStyle] = useState('solid');\n  const [fill, setFill] = useState(false);\n\n  // Camera / Infinite Canvas States (Refs for performance, state for UI)\n  const [cameraScale, setCameraScale] = useState(1);\n  const [cameraOffset, setCameraOffset] = useState({\n    x: -4000 + window.innerWidth / 2,\n    y: -4000 + window.innerHeight / 2\n  });\n  const cameraScaleRef = useRef(1);\n  const cameraOffsetRef = useRef({\n    x: -4000 + window.innerWidth / 2,\n    y: -4000 + window.innerHeight / 2\n  });\n  const isPanningRef = useRef(false);\n  const panStartRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const worldRef = useRef(null);\n\n  // Structured Data State\n  const [strokes, setStrokes] = useState([]); // Array of { type, points, color, size, opacity, ... }\n\n  // Performance Refs for Drawing\n  const isDrawingRef = useRef(false);\n  const currentPointsRef = useRef([]);\n  const startPosRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const lastPosRef = useRef({\n    x: 0,\n    y: 0\n  });\n  const snapshotCanvasRef = useRef(null);\n  const animationFrameRef = useRef(null);\n  const colors = [\"#000000\", \"#475569\", \"#dc2626\", \"#ea580c\", \"#d97706\", \"#65a30d\", \"#0891b2\", \"#2563eb\", \"#7c3aed\", \"#db2777\"];\n  const isDrawingTool = [\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\", \"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\", \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\", \"cylinder\", \"document\", \"cloud\"].includes(tool);\n  const handleToolChange = newTool => {\n    if (tool === newTool) {\n      setShowStyling(!showStyling);\n    } else {\n      setTool(newTool);\n      setShowStyling(true);\n    }\n  };\n  const [room, setRoom] = useState(null);\n  const [participants, setParticipants] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [sharedFiles, setSharedFiles] = useState([]);\n  const [activeTab, setActiveTab] = useState(\"chat\");\n  const [loadingFileUpload, setLoadingFileUpload] = useState(false);\n  const [screenStream, setScreenStream] = useState(null);\n  const screenVideoRef = useRef(null);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(true);\n\n  // History & Dragging\n  const [history, setHistory] = useState([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  useEffect(() => {\n    const fetchRoomDetails = async () => {\n      try {\n        const res = await roomService.getRoom(roomId);\n        setRoom(res.data.room);\n        setSharedFiles(res.data.room.sharedFiles || []);\n      } catch (err) {\n        toast.error(\"Failed to load workspace\");\n        navigate(\"/dashboard\");\n      }\n    };\n    fetchRoomDetails();\n    if (socket) {\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user._id,\n        userName: user.name\n      });\n      socket.on(\"user-joined\", data => toast.success(`${data.userName} joined`));\n      socket.on(\"online-users\", users => setParticipants(users));\n      socket.on(\"chat-message\", msg => setMessages(prev => [...prev, msg]));\n      socket.on(\"chat-history\", h => setMessages(h));\n      socket.on(\"drawing\", data => drawRemote(data));\n      socket.on(\"erase\", data => eraseRemote(data));\n      socket.on(\"board-cleared\", () => {\n        clearCanvasLocal();\n        setHistory([]);\n        setHistoryIndex(-1);\n      });\n      socket.on(\"canvas-state\", data => {\n        if (data) {\n          applyCanvasState(data);\n          setHistory([data]);\n          setHistoryIndex(0);\n        }\n      });\n      socket.on(\"undo\", state => applyCanvasState(state));\n      socket.on(\"redo\", state => applyCanvasState(state));\n    }\n    return () => {\n      if (socket) socket.emit(\"leave-room\", {\n        roomId,\n        userId: user._id,\n        userName: user.name\n      });\n    };\n  }, [roomId, socket, user, navigate]);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    // Set a constant large size for the infinite canvas buffer\n    // 8192 is a safe maximum for most GPUs\n    const size = 8192;\n    const dpr = 1; // Keep internal buffer at 1:1 for predictable infinite math\n\n    canvas.width = size;\n    canvas.height = size;\n    canvas.style.width = `${size}px`;\n    canvas.style.height = `${size}px`;\n    const context = canvas.getContext(\"2d\", {\n      alpha: true\n    });\n    context.lineCap = \"round\";\n    context.lineJoin = \"round\";\n    contextRef.current = context;\n\n    // Note: We no longer use ResizeObserver to shrink/expand the canvas\n    // The canvas is a fixed large buffer, and the viewport handles the view.\n\n    // Setup snapshot canvas\n    if (!snapshotCanvasRef.current) {\n      snapshotCanvasRef.current = document.createElement('canvas');\n    }\n    snapshotCanvasRef.current.width = size;\n    snapshotCanvasRef.current.height = size;\n  }, []);\n  useEffect(() => {\n    const handleZoomIn = () => updateZoom(1.1);\n    const handleZoomOut = () => updateZoom(1 / 1.1);\n    const handleResetZoom = () => {\n      const newScale = 1;\n      const newOffset = {\n        x: -8192 / 2 + window.innerWidth / 2,\n        y: -8192 / 2 + window.innerHeight / 2\n      };\n      cameraScaleRef.current = newScale;\n      cameraOffsetRef.current = newOffset;\n      setCameraScale(newScale);\n      setCameraOffset(newOffset);\n      syncViewDOM();\n    };\n    window.addEventListener('wb-zoom-in', handleZoomIn);\n    window.addEventListener('wb-zoom-out', handleZoomOut);\n    window.addEventListener('wb-reset-view', handleResetZoom);\n    return () => {\n      window.removeEventListener('wb-zoom-in', handleZoomIn);\n      window.removeEventListener('wb-zoom-out', handleZoomOut);\n      window.removeEventListener('wb-reset-view', handleResetZoom);\n    };\n  }, []);\n  useEffect(() => {\n    const viewport = viewportRef.current;\n    if (!viewport) return;\n    const handleWheel = e => {\n      e.preventDefault();\n      if (e.ctrlKey) {\n        // Zoom centered on cursor\n        const zoomSpeed = 0.0012;\n        const delta = -e.deltaY * zoomSpeed * cameraScaleRef.current;\n        const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current + delta));\n        const rect = viewport.getBoundingClientRect();\n        const mouseX = e.clientX - rect.left;\n        const mouseY = e.clientY - rect.top;\n\n        // Relative point on the world map\n        const worldX = (mouseX - cameraOffsetRef.current.x) / cameraScaleRef.current;\n        const worldY = (mouseY - cameraOffsetRef.current.y) / cameraScaleRef.current;\n        cameraScaleRef.current = newScale;\n        cameraOffsetRef.current = {\n          x: mouseX - worldX * newScale,\n          y: mouseY - worldY * newScale\n        };\n        setCameraScale(newScale);\n        setCameraOffset(cameraOffsetRef.current);\n        syncViewDOM();\n      } else {\n        // Precise Panning\n        cameraOffsetRef.current = {\n          x: cameraOffsetRef.current.x - e.deltaX,\n          y: cameraOffsetRef.current.y - e.deltaY\n        };\n        syncViewDOM();\n        // Optionally throttle state update for UI\n        setCameraOffset(cameraOffsetRef.current);\n      }\n    };\n    viewport.addEventListener('wheel', handleWheel, {\n      passive: false\n    });\n    return () => viewport.removeEventListener('wheel', handleWheel);\n  }, []);\n  const updateZoom = factor => {\n    const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current * factor));\n    const centerX = window.innerWidth / 2;\n    const centerY = window.innerHeight / 2;\n    const worldX = (centerX - cameraOffsetRef.current.x) / cameraScaleRef.current;\n    const worldY = (centerY - cameraOffsetRef.current.y) / cameraScaleRef.current;\n    cameraScaleRef.current = newScale;\n    cameraOffsetRef.current = {\n      x: centerX - worldX * newScale,\n      y: centerY - worldY * newScale\n    };\n    setCameraScale(newScale);\n    setCameraOffset(cameraOffsetRef.current);\n    syncViewDOM();\n  };\n  const syncViewDOM = () => {\n    if (worldRef.current) {\n      worldRef.current.style.transform = `translate(${cameraOffsetRef.current.x}px, ${cameraOffsetRef.current.y}px) scale(${cameraScaleRef.current})`;\n    }\n    if (viewportRef.current) {\n      viewportRef.current.style.backgroundSize = `${24 * cameraScaleRef.current}px ${24 * cameraScaleRef.current}px`;\n      viewportRef.current.style.backgroundPosition = `${cameraOffsetRef.current.x}px ${cameraOffsetRef.current.y}px`;\n    }\n  };\n  const applyCanvasState = state => {\n    if (!state) return clearCanvasLocal();\n    const image = new Image();\n    image.src = state;\n    image.onload = () => {\n      const canvas = canvasRef.current;\n      if (!canvas || !contextRef.current) return;\n      clearCanvasLocal();\n      contextRef.current.drawImage(image, 0, 0, canvas.width, canvas.height);\n    };\n  };\n  useEffect(() => {\n    redrawCanvas();\n  }, [strokes]);\n  const redrawCanvas = () => {\n    const canvas = canvasRef.current;\n    if (!canvas || !contextRef.current) return;\n    clearCanvasLocal();\n    const ctx = contextRef.current;\n    strokes.forEach(stroke => {\n      renderStroke(ctx, stroke);\n    });\n  };\n  const renderStroke = (ctx, stroke) => {\n    const {\n      type,\n      points,\n      color,\n      size,\n      opacity,\n      strokeStyle,\n      fill\n    } = stroke;\n    ctx.save();\n    if (type === 'eraser-precision' || type === 'mask') {\n      ctx.globalCompositeOperation = \"destination-out\";\n    } else {\n      ctx.globalCompositeOperation = \"source-over\";\n      ctx.globalAlpha = opacity;\n      ctx.strokeStyle = color;\n      ctx.fillStyle = color;\n      ctx.lineWidth = size;\n      ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\n      if (type === 'soft-brush') {\n        ctx.shadowBlur = size / 2;\n        ctx.shadowColor = color;\n      }\n      if (type === 'marker') {\n        ctx.globalAlpha = opacity * 0.6;\n      }\n    }\n    if (['pencil', 'highlighter', 'soft-brush', 'marker', 'smooth-pencil', 'eraser-precision'].includes(type)) {\n      if (points.length < 2) {\n        ctx.restore();\n        return;\n      }\n      ctx.beginPath();\n      ctx.moveTo(points[0].x, points[0].y);\n      for (let i = 1; i < points.length; i++) {\n        ctx.lineTo(points[i].x, points[i].y);\n      }\n      ctx.stroke();\n    } else {\n      drawShape(ctx, type, points, {\n        color,\n        size,\n        opacity,\n        strokeStyle,\n        fill\n      });\n    }\n    ctx.restore();\n  };\n  const drawShape = (ctx, type, points, style) => {\n    const start = points[0];\n    const end = points[points.length - 1];\n    const w = end.x - start.x;\n    const h = end.y - start.y;\n    if (type === 'rect') {\n      if (style.fill) ctx.fillRect(start.x, start.y, w, h);\n      ctx.strokeRect(start.x, start.y, w, h);\n    } else if (type === 'rounded-rect') {\n      ctx.beginPath();\n      ctx.roundRect(start.x, start.y, w, h, Math.min(Math.abs(w), Math.abs(h)) * 0.2);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'circle' || type === 'ellipse') {\n      ctx.beginPath();\n      if (type === 'circle') {\n        const radius = Math.sqrt(w * w + h * h);\n        ctx.arc(start.x, start.y, radius, 0, 2 * Math.PI);\n      } else {\n        ctx.ellipse(start.x + w / 2, start.y + h / 2, Math.abs(w / 2), Math.abs(h / 2), 0, 0, 2 * Math.PI);\n      }\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'triangle') {\n      ctx.beginPath();\n      ctx.moveTo(start.x + w / 2, start.y);\n      ctx.lineTo(end.x, end.y);\n      ctx.lineTo(start.x, end.y);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'diamond') {\n      ctx.beginPath();\n      ctx.moveTo(start.x + w / 2, start.y);\n      ctx.lineTo(end.x, start.y + h / 2);\n      ctx.lineTo(start.x + w / 2, end.y);\n      ctx.lineTo(start.x, start.y + h / 2);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'line' || type === 'arrow' || type === 'double-arrow') {\n      ctx.beginPath();\n      ctx.moveTo(start.x, start.y);\n      ctx.lineTo(end.x, end.y);\n      ctx.stroke();\n      if (type === 'arrow' || type === 'double-arrow') {\n        drawArrowHead(ctx, start.x, start.y, end.x, end.y, style.size);\n      }\n      if (type === 'double-arrow') {\n        drawArrowHead(ctx, end.x, end.y, start.x, start.y, style.size);\n      }\n    } else if (type === 'sticky') {\n      ctx.save();\n      ctx.fillStyle = style.fill ? style.color : \"#fef08a\"; // Default yellow sticky\n      ctx.shadowBlur = 10;\n      ctx.shadowColor = \"rgba(0,0,0,0.1)\";\n      ctx.fillRect(start.x, start.y, w, h);\n      ctx.strokeStyle = \"rgba(0,0,0,0.05)\";\n      ctx.strokeRect(start.x, start.y, w, h);\n      ctx.restore();\n    } else if (type === 'speech-bubble') {\n      ctx.beginPath();\n      ctx.roundRect(start.x, start.y, w, h * 0.8, 10);\n      ctx.moveTo(start.x + w * 0.2, start.y + h * 0.8);\n      ctx.lineTo(start.x + w * 0.1, end.y);\n      ctx.lineTo(start.x + w * 0.4, start.y + h * 0.8);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'parallelogram') {\n      const shift = w * 0.2;\n      ctx.beginPath();\n      ctx.moveTo(start.x + shift, start.y);\n      ctx.lineTo(end.x, start.y);\n      ctx.lineTo(end.x - shift, end.y);\n      ctx.lineTo(start.x, end.y);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'cylinder') {\n      const ry = Math.abs(h * 0.1);\n      // Bottom face\n      ctx.beginPath();\n      ctx.ellipse(start.x + w / 2, end.y - ry, Math.abs(w / 2), ry, 0, 0, Math.PI, false);\n      ctx.stroke();\n      // Side lines\n      ctx.beginPath();\n      ctx.moveTo(start.x, start.y + ry);\n      ctx.lineTo(start.x, end.y - ry);\n      ctx.moveTo(end.x, start.y + ry);\n      ctx.lineTo(end.x, end.y - ry);\n      ctx.stroke();\n      // Top face\n      ctx.beginPath();\n      ctx.ellipse(start.x + w / 2, start.y + ry, Math.abs(w / 2), ry, 0, 0, 2 * Math.PI);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    } else if (type === 'document') {\n      const fold = Math.min(w, h) * 0.2;\n      ctx.beginPath();\n      ctx.moveTo(start.x, start.y);\n      ctx.lineTo(end.x - fold, start.y);\n      ctx.lineTo(end.x, start.y + fold);\n      ctx.lineTo(end.x, end.y);\n      ctx.lineTo(start.x, end.y);\n      ctx.closePath();\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n      // Fold line\n      ctx.beginPath();\n      ctx.moveTo(end.x - fold, start.y);\n      ctx.lineTo(end.x - fold, start.y + fold);\n      ctx.lineTo(end.x, start.y + fold);\n      ctx.stroke();\n    } else if (type === 'cloud') {\n      ctx.beginPath();\n      const mw = start.x + w / 2;\n      const mh = start.y + h / 2;\n      ctx.arc(mw - w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      ctx.arc(mw + w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      ctx.arc(mw, mh - h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      ctx.arc(mw, mh + h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\n      if (style.fill) ctx.fill();\n      ctx.stroke();\n    }\n  };\n  const drawArrowHead = (ctx, fromx, fromy, tox, toy, weight) => {\n    const headlen = weight * 4;\n    const angle = Math.atan2(toy - fromy, tox - fromx);\n    ctx.save();\n    ctx.translate(tox, toy);\n    ctx.rotate(angle);\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(-headlen, -headlen / 2);\n    ctx.lineTo(-headlen, headlen / 2);\n    ctx.closePath();\n    ctx.fill();\n    ctx.restore();\n  };\n  const clearCanvasLocal = () => {\n    const canvas = canvasRef.current;\n    if (!canvas || !contextRef.current) return;\n    contextRef.current.clearRect(0, 0, canvas.width, canvas.height);\n  };\n  const getMousePos = e => {\n    const viewport = viewportRef.current;\n    if (!viewport) return {\n      x: 0,\n      y: 0\n    };\n    const rect = viewport.getBoundingClientRect();\n\n    // Convert screen coordinates to world coordinates\n    return {\n      x: (e.clientX - rect.left - cameraOffsetRef.current.x) / cameraScaleRef.current,\n      y: (e.clientY - rect.top - cameraOffsetRef.current.y) / cameraScaleRef.current\n    };\n  };\n  const startDrawing = e => {\n    // Handle Panning with Middle Mouse or Pan Tool\n    if (e.button === 1 || tool === 'pan') {\n      isPanningRef.current = true;\n      panStartRef.current = {\n        x: e.clientX - cameraOffsetRef.current.x,\n        y: e.clientY - cameraOffsetRef.current.y\n      };\n      return;\n    }\n    const canvas = canvasRef.current;\n    if (!canvas || !contextRef.current) return;\n    const pos = getMousePos(e);\n    if (tool === 'eraser') {\n      eraseObjectAt(pos);\n      return;\n    }\n\n    // Initialize drawing refs\n    isDrawingRef.current = true;\n    currentPointsRef.current = [pos];\n    startPosRef.current = pos;\n    lastPosRef.current = pos;\n\n    // Take efficient snapshot\n    const snapCtx = snapshotCanvasRef.current.getContext('2d');\n    snapCtx.clearRect(0, 0, canvas.width, canvas.height);\n    snapCtx.drawImage(canvas, 0, 0);\n    if (tool === \"pencil\" || tool === \"highlighter\" || tool === \"eraser\" || tool === \"precision-eraser\" || tool === \"soft-brush\" || tool === \"marker\" || tool === \"smooth-pencil\") {\n      const ctx = contextRef.current;\n      ctx.beginPath();\n      ctx.moveTo(pos.x, pos.y);\n\n      // Set styles once on start\n      ctx.lineWidth = size;\n      ctx.strokeStyle = color;\n      ctx.globalAlpha = tool === \"highlighter\" ? opacity * 0.4 : tool === \"marker\" ? opacity * 0.6 : opacity;\n      ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\n      ctx.lineCap = \"round\";\n      ctx.lineJoin = \"round\";\n      if (tool === 'soft-brush') {\n        ctx.shadowBlur = size / 2;\n        ctx.shadowColor = color;\n      } else {\n        ctx.shadowBlur = 0;\n      }\n    }\n  };\n  const handleMouseMove = e => {\n    if (isPanningRef.current) {\n      cameraOffsetRef.current = {\n        x: e.clientX - panStartRef.current.x,\n        y: e.clientY - panStartRef.current.y\n      };\n      syncViewDOM();\n      return;\n    }\n    if (isDrawingRef.current) {\n      if (animationFrameRef.current) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      // Extract data from event because React event pooling may nullify 'e' inside rAF\n      const clientX = e.clientX;\n      const clientY = e.clientY;\n      const shiftKey = e.shiftKey;\n      animationFrameRef.current = requestAnimationFrame(() => draw({\n        clientX,\n        clientY,\n        shiftKey\n      }));\n    } else if (tool === 'eraser' && e.buttons === 1) {\n      eraseObjectAt(getMousePos(e));\n    }\n  };\n  const eraseObjectAt = pos => {\n    // Distance-based object erasing\n    const threshold = 15; // pixels\n    const updatedStrokes = strokes.filter(stroke => {\n      return !stroke.points.some(p => {\n        const dist = Math.sqrt(Math.pow(p.x - pos.x, 2) + Math.pow(p.y - pos.y, 2));\n        return dist < threshold;\n      });\n    });\n    if (updatedStrokes.length !== strokes.length) {\n      setStrokes(updatedStrokes);\n      socket.emit(\"update-board-state\", {\n        roomId,\n        strokes: updatedStrokes\n      });\n    }\n  };\n  const draw = e => {\n    if (!isDrawingRef.current || !contextRef.current) return;\n    const pos = getMousePos(e);\n    let currentPos = pos;\n\n    // Smooth Stroke Mode: Apply simple smoothing\n    if (tool === 'smooth-pencil' && currentPointsRef.current.length > 0) {\n      const lastPoint = currentPointsRef.current[currentPointsRef.current.length - 1];\n      currentPos = {\n        x: lastPoint.x * 0.8 + pos.x * 0.2,\n        // Linear interpolation for smoothing\n        y: lastPoint.y * 0.8 + pos.y * 0.2,\n        shiftKey: e.shiftKey\n      };\n    } else {\n      currentPos = {\n        ...pos,\n        shiftKey: e.shiftKey\n      };\n    }\n    currentPointsRef.current.push(currentPos);\n    const ctx = contextRef.current;\n    if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\"].includes(tool)) {\n      ctx.globalCompositeOperation = \"source-over\";\n\n      // Straight Line Mode (Shift Key)\n      if (e.shiftKey) {\n        clearCanvasLocal();\n        ctx.drawImage(snapshotCanvasRef.current, 0, 0);\n        ctx.beginPath();\n        ctx.moveTo(startPosRef.current.x, startPosRef.current.y);\n        ctx.lineTo(currentPos.x, currentPos.y);\n        ctx.stroke();\n        return;\n      }\n      ctx.lineTo(currentPos.x, currentPos.y);\n      ctx.stroke();\n\n      // Emit drawing segment for real-time collab\n      socket.emit(\"drawing\", {\n        roomId,\n        drawingData: {\n          x: currentPos.x,\n          y: currentPos.y,\n          prevX: lastPosRef.current.x,\n          prevY: lastPosRef.current.y,\n          color,\n          size,\n          opacity: ctx.globalAlpha,\n          tool\n        }\n      });\n      lastPosRef.current = currentPos;\n    } else if (tool === \"eraser\" || tool === \"precision-eraser\") {\n      ctx.globalCompositeOperation = \"destination-out\";\n      const eraserSize = tool === \"precision-eraser\" ? 10 : size * 2;\n      ctx.lineWidth = eraserSize;\n      ctx.lineTo(pos.x, pos.y);\n      ctx.stroke();\n      socket.emit(\"erase\", {\n        roomId,\n        eraseData: {\n          x: pos.x,\n          y: pos.y,\n          size: eraserSize\n        }\n      });\n    } else if ([\"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\", \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\", \"cylinder\", \"document\", \"cloud\"].includes(tool)) {\n      clearCanvasLocal();\n      ctx.drawImage(snapshotCanvasRef.current, 0, 0);\n      drawShape(ctx, tool, [startPosRef.current, currentPos], {\n        color,\n        size,\n        opacity,\n        strokeStyle,\n        fill\n      });\n    }\n  };\n  const drawArrow = (ctx, fromx, fromy, tox, toy) => {\n    const headlen = size * 3;\n    const angle = Math.atan2(toy - fromy, tox - fromx);\n    ctx.moveTo(fromx, fromy);\n    ctx.lineTo(tox, toy);\n    ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));\n    ctx.moveTo(tox, toy);\n    ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));\n  };\n  const stopDrawing = () => {\n    if (isPanningRef.current) {\n      isPanningRef.current = false;\n      // Final sync to state for UI consistency\n      setCameraOffset(cameraOffsetRef.current);\n      return;\n    }\n    const canvas = canvasRef.current;\n    if (!isDrawingRef.current || !canvas) return;\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    isDrawingRef.current = false;\n\n    // Save current stroke to state\n    let points = [...currentPointsRef.current];\n\n    // Straight Line Mode: If shift was held, only keep start and end points\n    if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\"].includes(tool) && points.length > 1 && points[points.length - 1].shiftKey) {\n      points = [points[0], points[points.length - 1]];\n    }\n    const newStroke = {\n      id: Date.now() + Math.random(),\n      type: tool === 'precision-eraser' ? 'eraser-precision' : tool,\n      points: points,\n      color: color,\n      size: tool === 'precision-eraser' ? 10 : size,\n      opacity: tool === 'highlighter' ? 0.4 : tool === 'marker' ? 0.6 : opacity,\n      strokeStyle,\n      fill\n    };\n    if (tool !== 'eraser') {\n      // Only save non-eraser strokes to the strokes array\n      setStrokes(prev => [...prev, newStroke]);\n      socket.emit(\"new-stroke\", {\n        roomId,\n        stroke: newStroke\n      });\n    }\n    currentPointsRef.current = [];\n\n    // The following block is for canvas state history, which is now separate from strokes\n    const dataURL = canvas.toDataURL();\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(dataURL);\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n    socket.emit(\"save-canvas\", {\n      roomId,\n      canvasData: dataURL\n    });\n  };\n  const handleUndo = () => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      const state = history[newIndex];\n      setHistoryIndex(newIndex);\n      applyCanvasState(state);\n      socket.emit(\"undo\", {\n        roomId,\n        canvasState: state\n      });\n      socket.emit(\"save-canvas\", {\n        roomId,\n        canvasData: state\n      });\n    }\n  };\n  const handleRedo = () => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      const state = history[newIndex];\n      setHistoryIndex(newIndex);\n      applyCanvasState(state);\n      socket.emit(\"redo\", {\n        roomId,\n        canvasState: state\n      });\n      socket.emit(\"save-canvas\", {\n        roomId,\n        canvasData: state\n      });\n    }\n  };\n  const drawRemote = data => {\n    const {\n      x,\n      y,\n      prevX,\n      prevY,\n      color,\n      size,\n      opacity\n    } = data;\n    const ctx = contextRef.current;\n    if (!ctx) return;\n    ctx.save();\n    ctx.globalAlpha = opacity || 1;\n    ctx.strokeStyle = color;\n    ctx.lineWidth = size;\n    ctx.lineCap = \"round\";\n    ctx.lineJoin = \"round\";\n    ctx.beginPath();\n    if (prevX && prevY) {\n      ctx.moveTo(prevX, prevY);\n    } else {\n      ctx.moveTo(x, y);\n    }\n    ctx.lineTo(x, y);\n    ctx.stroke();\n    ctx.restore();\n  };\n  const eraseRemote = data => {\n    const {\n      x,\n      y,\n      size\n    } = data;\n    const ctx = contextRef.current;\n    const prevGCO = ctx.globalCompositeOperation;\n    ctx.globalCompositeOperation = \"destination-out\";\n    ctx.beginPath();\n    ctx.arc(x, y, size, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.globalCompositeOperation = prevGCO;\n  };\n  const handleClearBoard = () => {\n    if (window.confirm(\"Clear all?\")) socket.emit(\"clear-board\", {\n      roomId,\n      userId: user._id\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wb-layout-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"wb-header-miro\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-9 h-9 bg-violet-600 rounded-lg flex items-center justify-center cursor-pointer shadow-lg shadow-violet-200\",\n            onClick: () => navigate('/dashboard'),\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-white font-black text-lg\",\n              children: \"C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 777,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 776,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n              className: \"font-bold text-slate-800 leading-tight text-sm truncate max-w-[150px]\",\n              children: (room === null || room === void 0 ? void 0 : room.roomName) || 'Untitled Board'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 780,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[10px] text-slate-400 font-bold uppercase tracking-widest\",\n              children: [participants.length, \" online\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 781,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 779,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 775,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-px h-8 bg-slate-100\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 785,\n          columnNumber: 21\n        }, this), isDrawingTool && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-6 animate-in fade-in slide-in-from-left-4 duration-300\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"grid grid-cols-5 gap-1 pt-0.5\",\n              children: colors.slice(0, 5).map(c => /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setColor(c),\n                className: `w-4 h-4 rounded-full border border-slate-200 transition-all ${color === c ? 'ring-2 ring-violet-500 ring-offset-1 scale-110' : 'hover:scale-110'}`,\n                style: {\n                  backgroundColor: c\n                }\n              }, c, false, {\n                fileName: _jsxFileName,\n                lineNumber: 794,\n                columnNumber: 41\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 792,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"grid grid-cols-5 gap-1 pt-0.5\",\n              children: colors.slice(5).map(c => /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => setColor(c),\n                className: `w-4 h-4 rounded-full border border-slate-200 transition-all ${color === c ? 'ring-2 ring-violet-500 ring-offset-1 scale-110' : 'hover:scale-110'}`,\n                style: {\n                  backgroundColor: c\n                }\n              }, c, false, {\n                fileName: _jsxFileName,\n                lineNumber: 804,\n                columnNumber: 41\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 802,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 791,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-px h-6 bg-slate-100\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 814,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-3 w-32\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[9px] font-bold text-slate-400 uppercase tracking-widest\",\n              children: \"Size\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 818,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"range\",\n              min: \"1\",\n              max: \"40\",\n              value: size,\n              onChange: e => setSize(parseInt(e.target.value)),\n              className: \"w-full accent-violet-600 h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 819,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[10px] font-mono font-bold text-slate-600 min-w-[20px]\",\n              children: size\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 824,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 817,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-px h-6 bg-slate-100\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 827,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-3 w-32\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[9px] font-bold text-slate-400 uppercase tracking-widest\",\n              children: \"Opacity\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 831,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"range\",\n              min: \"0.1\",\n              max: \"1\",\n              step: \"0.1\",\n              value: opacity,\n              onChange: e => setOpacity(parseFloat(e.target.value)),\n              className: \"w-full accent-violet-600 h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 832,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-[10px] font-mono font-bold text-slate-600 min-w-[25px]\",\n              children: [Math.round(opacity * 100), \"%\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 837,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 830,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 789,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 774,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-secondary-miro\",\n          onClick: () => {\n            navigator.clipboard.writeText(window.location.href);\n            toast.success(\"Link copied!\");\n          },\n          children: \"Invite Collaborators\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 844,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-primary-miro\",\n          children: \"Share Screen\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 848,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-px h-6 bg-slate-200 mx-1\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 849,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"tool-button\",\n          onClick: () => setIsSidebarOpen(!isSidebarOpen),\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-lg\",\n            children: \"\\uD83D\\uDCAC\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 851,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 850,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 843,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 773,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n      className: \"wb-left-panel\",\n      children: /*#__PURE__*/_jsxDEV(Toolbar, {\n        activeTool: tool,\n        setTool: handleToolChange,\n        isHost: user._id === (room === null || room === void 0 ? void 0 : room.host),\n        onClear: handleClearBoard,\n        onUndo: handleUndo,\n        onRedo: handleRedo,\n        onDelete: () => {}\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 858,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 857,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      ref: viewportRef,\n      className: \"wb-viewport overflow-hidden cursor-default bg-white\",\n      style: {\n        backgroundImage: 'radial-gradient(#cbd5e1 1px, transparent 1px)',\n        backgroundSize: `${24 * cameraScale}px ${24 * cameraScale}px`,\n        backgroundPosition: `${cameraOffset.x}px ${cameraOffset.y}px`\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        ref: worldRef,\n        className: \"absolute inset-0 pointer-events-none\",\n        style: {\n          transform: `translate(${cameraOffset.x}px, ${cameraOffset.y}px) scale(${cameraScale})`,\n          transformOrigin: '0 0'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            width: '8192px',\n            height: '8192px',\n            pointerEvents: 'auto'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n            ref: canvasRef,\n            className: \"bg-transparent\",\n            onMouseDown: startDrawing,\n            onMouseMove: handleMouseMove,\n            onMouseUp: stopDrawing,\n            onMouseOut: stopDrawing\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 892,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 889,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 880,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(StylingPanel, {\n        tool: tool,\n        visible: showStyling,\n        strokeStyle: strokeStyle,\n        setStrokeStyle: setStrokeStyle,\n        fill: fill,\n        setFill: setFill\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 904,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute bottom-6 right-6 flex items-center gap-2 bg-white p-1 rounded-xl shadow-lg border border-slate-200 z-50\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            setCameraScale(1);\n            setCameraOffset({\n              x: 0,\n              y: 0\n            });\n          },\n          className: \"w-12 h-8 hover:bg-slate-50 rounded-lg text-xs font-bold text-slate-600 transition-colors\",\n          children: [Math.round(cameraScale * 100), \"%\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 913,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-px h-4 bg-slate-100\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 919,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setCameraScale(prev => prev * 1.1),\n          className: \"w-8 h-8 hover:bg-slate-50 rounded-lg flex items-center justify-center text-slate-600\",\n          children: /*#__PURE__*/_jsxDEV(Plus, {\n            size: 14\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 924,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 920,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setCameraScale(prev => prev / 1.1),\n          className: \"w-8 h-8 hover:bg-slate-50 rounded-lg flex items-center justify-center text-slate-600\",\n          children: /*#__PURE__*/_jsxDEV(Minus, {\n            size: 14\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 930,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 926,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 912,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 870,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n      className: `wb-right-panel ${isSidebarOpen ? 'open' : ''}`,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col h-full\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex p-2 bg-slate-50 border-b border-slate-200\",\n          children: ['chat', 'files', 'users'].map(tab => /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setActiveTab(tab),\n            className: `flex-1 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase tracking-widest\n                                          ${activeTab === tab ? \"bg-white text-violet-700 shadow-sm border border-slate-200\" : \"text-slate-500 hover:text-slate-700\"}`,\n            children: tab\n          }, tab, false, {\n            fileName: _jsxFileName,\n            lineNumber: 940,\n            columnNumber: 29\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 938,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 overflow-hidden\",\n          children: activeTab === \"chat\" ? /*#__PURE__*/_jsxDEV(Chat, {\n            messages: messages,\n            onSendMessage: txt => socket.emit(\"chat-message\", {\n              roomId,\n              message: txt,\n              userId: user._id,\n              userName: user.name\n            }),\n            currentUser: user\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 952,\n            columnNumber: 29\n          }, this) : activeTab === \"files\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"btn-secondary-miro w-full flex justify-center cursor-pointer text-xs mb-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                children: \"Share Asset\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 956,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"file\",\n                className: \"hidden\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 957,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 955,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"space-y-2\",\n              children: sharedFiles.map((f, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"p-3 bg-slate-50 rounded-lg border border-slate-100 flex items-center justify-between\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-xs font-medium truncate max-w-[150px]\",\n                  children: f.fileName\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 962,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-violet-600\",\n                  children: \"\\u2B07\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 963,\n                  columnNumber: 45\n                }, this)]\n              }, i, true, {\n                fileName: _jsxFileName,\n                lineNumber: 961,\n                columnNumber: 41\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 959,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 954,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"p-4 space-y-2\",\n            children: participants.map((p, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center gap-3 p-2 hover:bg-slate-50 rounded-lg\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-6 h-6 rounded-full bg-violet-100 flex items-center justify-center text-[10px] font-bold text-violet-700\",\n                children: p.userName[0]\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 972,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-xs font-medium text-slate-700\",\n                children: p.userName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 973,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"w-1.5 h-1.5 rounded-full bg-green-500 ml-auto\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 974,\n                columnNumber: 41\n              }, this)]\n            }, i, true, {\n              fileName: _jsxFileName,\n              lineNumber: 971,\n              columnNumber: 37\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 969,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 950,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 937,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 936,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 771,\n    columnNumber: 9\n  }, this);\n};\n_s(WhiteboardRoom, \"iM7vjKUPWFQV5uNA8FLcRGRgPOY=\", false, function () {\n  return [useParams, useNavigate, useAuth, useSocket];\n});\n_c = WhiteboardRoom;\nexport default WhiteboardRoom;\nvar _c;\n$RefreshReg$(_c, \"WhiteboardRoom\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","useNavigate","useAuth","useSocket","roomService","Toolbar","Chat","StylingPanel","toast","Plus","Minus","jsxDEV","_jsxDEV","WhiteboardRoom","_s","roomId","navigate","user","socket","canvasRef","viewportRef","contextRef","tool","setTool","showStyling","setShowStyling","color","setColor","size","setSize","opacity","setOpacity","strokeStyle","setStrokeStyle","fill","setFill","cameraScale","setCameraScale","cameraOffset","setCameraOffset","x","window","innerWidth","y","innerHeight","cameraScaleRef","cameraOffsetRef","isPanningRef","panStartRef","worldRef","strokes","setStrokes","isDrawingRef","currentPointsRef","startPosRef","lastPosRef","snapshotCanvasRef","animationFrameRef","colors","isDrawingTool","includes","handleToolChange","newTool","room","setRoom","participants","setParticipants","messages","setMessages","sharedFiles","setSharedFiles","activeTab","setActiveTab","loadingFileUpload","setLoadingFileUpload","screenStream","setScreenStream","screenVideoRef","isSidebarOpen","setIsSidebarOpen","history","setHistory","historyIndex","setHistoryIndex","fetchRoomDetails","res","getRoom","data","err","error","emit","userId","_id","userName","name","on","success","users","msg","prev","h","drawRemote","eraseRemote","clearCanvasLocal","applyCanvasState","state","canvas","current","dpr","width","height","style","context","getContext","alpha","lineCap","lineJoin","document","createElement","handleZoomIn","updateZoom","handleZoomOut","handleResetZoom","newScale","newOffset","syncViewDOM","addEventListener","removeEventListener","viewport","handleWheel","e","preventDefault","ctrlKey","zoomSpeed","delta","deltaY","Math","max","min","rect","getBoundingClientRect","mouseX","clientX","left","mouseY","clientY","top","worldX","worldY","deltaX","passive","factor","centerX","centerY","transform","backgroundSize","backgroundPosition","image","Image","src","onload","drawImage","redrawCanvas","ctx","forEach","stroke","renderStroke","type","points","save","globalCompositeOperation","globalAlpha","fillStyle","lineWidth","setLineDash","shadowBlur","shadowColor","length","restore","beginPath","moveTo","i","lineTo","drawShape","start","end","w","fillRect","strokeRect","roundRect","abs","radius","sqrt","arc","PI","ellipse","closePath","drawArrowHead","shift","ry","fold","mw","mh","fromx","fromy","tox","toy","weight","headlen","angle","atan2","translate","rotate","clearRect","getMousePos","startDrawing","button","pos","eraseObjectAt","snapCtx","handleMouseMove","cancelAnimationFrame","shiftKey","requestAnimationFrame","draw","buttons","threshold","updatedStrokes","filter","some","p","dist","pow","currentPos","lastPoint","push","drawingData","prevX","prevY","eraserSize","eraseData","drawArrow","cos","sin","stopDrawing","newStroke","id","Date","now","random","dataURL","toDataURL","newHistory","slice","canvasData","handleUndo","newIndex","canvasState","handleRedo","prevGCO","handleClearBoard","confirm","className","children","onClick","fileName","_jsxFileName","lineNumber","columnNumber","roomName","map","c","backgroundColor","value","onChange","parseInt","target","step","parseFloat","round","navigator","clipboard","writeText","location","href","activeTool","isHost","host","onClear","onUndo","onRedo","onDelete","ref","backgroundImage","transformOrigin","pointerEvents","onMouseDown","onMouseMove","onMouseUp","onMouseOut","visible","tab","onSendMessage","txt","message","currentUser","f","_c","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/pages/WhiteboardRoom.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport { useSocket } from \"../context/SocketContext\";\r\nimport { roomService } from \"../services/api\";\r\nimport Toolbar from \"../components/Toolbar\";\r\nimport Chat from \"../components/Chat\";\r\nimport StylingPanel from \"../components/StylingPanel\";\r\nimport toast from \"react-hot-toast\";\r\nimport { Plus, Minus } from \"lucide-react\";\r\n\r\nconst WhiteboardRoom = () => {\r\n    const { roomId } = useParams();\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const { socket } = useSocket();\r\n\r\n    const canvasRef = useRef(null);\r\n    const viewportRef = useRef(null);\r\n    const contextRef = useRef(null);\r\n\r\n    // Tools & Styling\r\n    const [tool, setTool] = useState(\"pencil\");\r\n    const [showStyling, setShowStyling] = useState(true);\r\n    const [color, setColor] = useState(\"#000000\");\r\n    const [size, setSize] = useState(4);\r\n    const [opacity, setOpacity] = useState(1);\r\n    const [strokeStyle, setStrokeStyle] = useState('solid');\r\n    const [fill, setFill] = useState(false);\r\n\r\n    // Camera / Infinite Canvas States (Refs for performance, state for UI)\r\n    const [cameraScale, setCameraScale] = useState(1);\r\n    const [cameraOffset, setCameraOffset] = useState({ x: -4000 + window.innerWidth / 2, y: -4000 + window.innerHeight / 2 });\r\n\r\n    const cameraScaleRef = useRef(1);\r\n    const cameraOffsetRef = useRef({ x: -4000 + window.innerWidth / 2, y: -4000 + window.innerHeight / 2 });\r\n    const isPanningRef = useRef(false);\r\n    const panStartRef = useRef({ x: 0, y: 0 });\r\n    const worldRef = useRef(null);\r\n\r\n    // Structured Data State\r\n    const [strokes, setStrokes] = useState([]); // Array of { type, points, color, size, opacity, ... }\r\n\r\n    // Performance Refs for Drawing\r\n    const isDrawingRef = useRef(false);\r\n    const currentPointsRef = useRef([]);\r\n    const startPosRef = useRef({ x: 0, y: 0 });\r\n    const lastPosRef = useRef({ x: 0, y: 0 });\r\n    const snapshotCanvasRef = useRef(null);\r\n    const animationFrameRef = useRef(null);\r\n\r\n    const colors = [\r\n        \"#000000\", \"#475569\", \"#dc2626\", \"#ea580c\", \"#d97706\",\r\n        \"#65a30d\", \"#0891b2\", \"#2563eb\", \"#7c3aed\", \"#db2777\"\r\n    ];\r\n\r\n    const isDrawingTool = [\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\", \"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\", \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\", \"cylinder\", \"document\", \"cloud\"].includes(tool);\r\n\r\n    const handleToolChange = (newTool) => {\r\n        if (tool === newTool) {\r\n            setShowStyling(!showStyling);\r\n        } else {\r\n            setTool(newTool);\r\n            setShowStyling(true);\r\n        }\r\n    };\r\n\r\n    const [room, setRoom] = useState(null);\r\n    const [participants, setParticipants] = useState([]);\r\n    const [messages, setMessages] = useState([]);\r\n    const [sharedFiles, setSharedFiles] = useState([]);\r\n    const [activeTab, setActiveTab] = useState(\"chat\");\r\n    const [loadingFileUpload, setLoadingFileUpload] = useState(false);\r\n    const [screenStream, setScreenStream] = useState(null);\r\n    const screenVideoRef = useRef(null);\r\n    const [isSidebarOpen, setIsSidebarOpen] = useState(true);\r\n\r\n    // History & Dragging\r\n    const [history, setHistory] = useState([]);\r\n    const [historyIndex, setHistoryIndex] = useState(-1);\r\n\r\n    useEffect(() => {\r\n        const fetchRoomDetails = async () => {\r\n            try {\r\n                const res = await roomService.getRoom(roomId);\r\n                setRoom(res.data.room);\r\n                setSharedFiles(res.data.room.sharedFiles || []);\r\n            } catch (err) {\r\n                toast.error(\"Failed to load workspace\");\r\n                navigate(\"/dashboard\");\r\n            }\r\n        };\r\n\r\n        fetchRoomDetails();\r\n\r\n        if (socket) {\r\n            socket.emit(\"join-room\", { roomId, userId: user._id, userName: user.name });\r\n\r\n            socket.on(\"user-joined\", (data) => toast.success(`${data.userName} joined`));\r\n            socket.on(\"online-users\", (users) => setParticipants(users));\r\n            socket.on(\"chat-message\", (msg) => setMessages((prev) => [...prev, msg]));\r\n            socket.on(\"chat-history\", (h) => setMessages(h));\r\n            socket.on(\"drawing\", (data) => drawRemote(data));\r\n            socket.on(\"erase\", (data) => eraseRemote(data));\r\n            socket.on(\"board-cleared\", () => {\r\n                clearCanvasLocal();\r\n                setHistory([]);\r\n                setHistoryIndex(-1);\r\n            });\r\n            socket.on(\"canvas-state\", (data) => {\r\n                if (data) {\r\n                    applyCanvasState(data);\r\n                    setHistory([data]);\r\n                    setHistoryIndex(0);\r\n                }\r\n            });\r\n            socket.on(\"undo\", (state) => applyCanvasState(state));\r\n            socket.on(\"redo\", (state) => applyCanvasState(state));\r\n        }\r\n\r\n        return () => {\r\n            if (socket) socket.emit(\"leave-room\", { roomId, userId: user._id, userName: user.name });\r\n        };\r\n    }, [roomId, socket, user, navigate]);\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) return;\r\n\r\n        // Set a constant large size for the infinite canvas buffer\r\n        // 8192 is a safe maximum for most GPUs\r\n        const size = 8192;\r\n        const dpr = 1; // Keep internal buffer at 1:1 for predictable infinite math\r\n\r\n        canvas.width = size;\r\n        canvas.height = size;\r\n        canvas.style.width = `${size}px`;\r\n        canvas.style.height = `${size}px`;\r\n\r\n        const context = canvas.getContext(\"2d\", { alpha: true });\r\n        context.lineCap = \"round\";\r\n        context.lineJoin = \"round\";\r\n        contextRef.current = context;\r\n\r\n        // Note: We no longer use ResizeObserver to shrink/expand the canvas\r\n        // The canvas is a fixed large buffer, and the viewport handles the view.\r\n\r\n        // Setup snapshot canvas\r\n        if (!snapshotCanvasRef.current) {\r\n            snapshotCanvasRef.current = document.createElement('canvas');\r\n        }\r\n        snapshotCanvasRef.current.width = size;\r\n        snapshotCanvasRef.current.height = size;\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const handleZoomIn = () => updateZoom(1.1);\r\n        const handleZoomOut = () => updateZoom(1 / 1.1);\r\n        const handleResetZoom = () => {\r\n            const newScale = 1;\r\n            const newOffset = { x: -8192 / 2 + window.innerWidth / 2, y: -8192 / 2 + window.innerHeight / 2 };\r\n            cameraScaleRef.current = newScale;\r\n            cameraOffsetRef.current = newOffset;\r\n            setCameraScale(newScale);\r\n            setCameraOffset(newOffset);\r\n            syncViewDOM();\r\n        };\r\n\r\n        window.addEventListener('wb-zoom-in', handleZoomIn);\r\n        window.addEventListener('wb-zoom-out', handleZoomOut);\r\n        window.addEventListener('wb-reset-view', handleResetZoom);\r\n\r\n        return () => {\r\n            window.removeEventListener('wb-zoom-in', handleZoomIn);\r\n            window.removeEventListener('wb-zoom-out', handleZoomOut);\r\n            window.removeEventListener('wb-reset-view', handleResetZoom);\r\n        };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const viewport = viewportRef.current;\r\n        if (!viewport) return;\r\n\r\n        const handleWheel = (e) => {\r\n            e.preventDefault();\r\n\r\n            if (e.ctrlKey) {\r\n                // Zoom centered on cursor\r\n                const zoomSpeed = 0.0012;\r\n                const delta = -e.deltaY * zoomSpeed * cameraScaleRef.current;\r\n                const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current + delta));\r\n\r\n                const rect = viewport.getBoundingClientRect();\r\n                const mouseX = e.clientX - rect.left;\r\n                const mouseY = e.clientY - rect.top;\r\n\r\n                // Relative point on the world map\r\n                const worldX = (mouseX - cameraOffsetRef.current.x) / cameraScaleRef.current;\r\n                const worldY = (mouseY - cameraOffsetRef.current.y) / cameraScaleRef.current;\r\n\r\n                cameraScaleRef.current = newScale;\r\n                cameraOffsetRef.current = {\r\n                    x: mouseX - worldX * newScale,\r\n                    y: mouseY - worldY * newScale\r\n                };\r\n\r\n                setCameraScale(newScale);\r\n                setCameraOffset(cameraOffsetRef.current);\r\n                syncViewDOM();\r\n            } else {\r\n                // Precise Panning\r\n                cameraOffsetRef.current = {\r\n                    x: cameraOffsetRef.current.x - e.deltaX,\r\n                    y: cameraOffsetRef.current.y - e.deltaY\r\n                };\r\n                syncViewDOM();\r\n                // Optionally throttle state update for UI\r\n                setCameraOffset(cameraOffsetRef.current);\r\n            }\r\n        };\r\n\r\n        viewport.addEventListener('wheel', handleWheel, { passive: false });\r\n        return () => viewport.removeEventListener('wheel', handleWheel);\r\n    }, []);\r\n\r\n    const updateZoom = (factor) => {\r\n        const newScale = Math.max(0.05, Math.min(10, cameraScaleRef.current * factor));\r\n        const centerX = window.innerWidth / 2;\r\n        const centerY = window.innerHeight / 2;\r\n\r\n        const worldX = (centerX - cameraOffsetRef.current.x) / cameraScaleRef.current;\r\n        const worldY = (centerY - cameraOffsetRef.current.y) / cameraScaleRef.current;\r\n\r\n        cameraScaleRef.current = newScale;\r\n        cameraOffsetRef.current = {\r\n            x: centerX - worldX * newScale,\r\n            y: centerY - worldY * newScale\r\n        };\r\n\r\n        setCameraScale(newScale);\r\n        setCameraOffset(cameraOffsetRef.current);\r\n        syncViewDOM();\r\n    };\r\n\r\n    const syncViewDOM = () => {\r\n        if (worldRef.current) {\r\n            worldRef.current.style.transform = `translate(${cameraOffsetRef.current.x}px, ${cameraOffsetRef.current.y}px) scale(${cameraScaleRef.current})`;\r\n        }\r\n        if (viewportRef.current) {\r\n            viewportRef.current.style.backgroundSize = `${24 * cameraScaleRef.current}px ${24 * cameraScaleRef.current}px`;\r\n            viewportRef.current.style.backgroundPosition = `${cameraOffsetRef.current.x}px ${cameraOffsetRef.current.y}px`;\r\n        }\r\n    };\r\n\r\n    const applyCanvasState = (state) => {\r\n        if (!state) return clearCanvasLocal();\r\n        const image = new Image();\r\n        image.src = state;\r\n        image.onload = () => {\r\n            const canvas = canvasRef.current;\r\n            if (!canvas || !contextRef.current) return;\r\n            clearCanvasLocal();\r\n            contextRef.current.drawImage(image, 0, 0, canvas.width, canvas.height);\r\n        };\r\n    };\r\n\r\n    useEffect(() => {\r\n        redrawCanvas();\r\n    }, [strokes]);\r\n\r\n    const redrawCanvas = () => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas || !contextRef.current) return;\r\n\r\n        clearCanvasLocal();\r\n        const ctx = contextRef.current;\r\n\r\n        strokes.forEach(stroke => {\r\n            renderStroke(ctx, stroke);\r\n        });\r\n    };\r\n\r\n    const renderStroke = (ctx, stroke) => {\r\n        const { type, points, color, size, opacity, strokeStyle, fill } = stroke;\r\n        ctx.save();\r\n\r\n        if (type === 'eraser-precision' || type === 'mask') {\r\n            ctx.globalCompositeOperation = \"destination-out\";\r\n        } else {\r\n            ctx.globalCompositeOperation = \"source-over\";\r\n            ctx.globalAlpha = opacity;\r\n            ctx.strokeStyle = color;\r\n            ctx.fillStyle = color;\r\n            ctx.lineWidth = size;\r\n            ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\r\n\r\n            if (type === 'soft-brush') {\r\n                ctx.shadowBlur = size / 2;\r\n                ctx.shadowColor = color;\r\n            }\r\n            if (type === 'marker') {\r\n                ctx.globalAlpha = opacity * 0.6;\r\n            }\r\n        }\r\n\r\n        if (['pencil', 'highlighter', 'soft-brush', 'marker', 'smooth-pencil', 'eraser-precision'].includes(type)) {\r\n            if (points.length < 2) {\r\n                ctx.restore();\r\n                return;\r\n            }\r\n            ctx.beginPath();\r\n            ctx.moveTo(points[0].x, points[0].y);\r\n            for (let i = 1; i < points.length; i++) {\r\n                ctx.lineTo(points[i].x, points[i].y);\r\n            }\r\n            ctx.stroke();\r\n        } else {\r\n            drawShape(ctx, type, points, { color, size, opacity, strokeStyle, fill });\r\n        }\r\n        ctx.restore();\r\n    };\r\n\r\n    const drawShape = (ctx, type, points, style) => {\r\n        const start = points[0];\r\n        const end = points[points.length - 1];\r\n        const w = end.x - start.x;\r\n        const h = end.y - start.y;\r\n\r\n        if (type === 'rect') {\r\n            if (style.fill) ctx.fillRect(start.x, start.y, w, h);\r\n            ctx.strokeRect(start.x, start.y, w, h);\r\n        } else if (type === 'rounded-rect') {\r\n            ctx.beginPath();\r\n            ctx.roundRect(start.x, start.y, w, h, Math.min(Math.abs(w), Math.abs(h)) * 0.2);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'circle' || type === 'ellipse') {\r\n            ctx.beginPath();\r\n            if (type === 'circle') {\r\n                const radius = Math.sqrt(w * w + h * h);\r\n                ctx.arc(start.x, start.y, radius, 0, 2 * Math.PI);\r\n            } else {\r\n                ctx.ellipse(start.x + w / 2, start.y + h / 2, Math.abs(w / 2), Math.abs(h / 2), 0, 0, 2 * Math.PI);\r\n            }\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'triangle') {\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x + w / 2, start.y);\r\n            ctx.lineTo(end.x, end.y);\r\n            ctx.lineTo(start.x, end.y);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'diamond') {\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x + w / 2, start.y);\r\n            ctx.lineTo(end.x, start.y + h / 2);\r\n            ctx.lineTo(start.x + w / 2, end.y);\r\n            ctx.lineTo(start.x, start.y + h / 2);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'line' || type === 'arrow' || type === 'double-arrow') {\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x, start.y);\r\n            ctx.lineTo(end.x, end.y);\r\n            ctx.stroke();\r\n            if (type === 'arrow' || type === 'double-arrow') {\r\n                drawArrowHead(ctx, start.x, start.y, end.x, end.y, style.size);\r\n            }\r\n            if (type === 'double-arrow') {\r\n                drawArrowHead(ctx, end.x, end.y, start.x, start.y, style.size);\r\n            }\r\n        } else if (type === 'sticky') {\r\n            ctx.save();\r\n            ctx.fillStyle = style.fill ? style.color : \"#fef08a\"; // Default yellow sticky\r\n            ctx.shadowBlur = 10;\r\n            ctx.shadowColor = \"rgba(0,0,0,0.1)\";\r\n            ctx.fillRect(start.x, start.y, w, h);\r\n            ctx.strokeStyle = \"rgba(0,0,0,0.05)\";\r\n            ctx.strokeRect(start.x, start.y, w, h);\r\n            ctx.restore();\r\n        } else if (type === 'speech-bubble') {\r\n            ctx.beginPath();\r\n            ctx.roundRect(start.x, start.y, w, h * 0.8, 10);\r\n            ctx.moveTo(start.x + w * 0.2, start.y + h * 0.8);\r\n            ctx.lineTo(start.x + w * 0.1, end.y);\r\n            ctx.lineTo(start.x + w * 0.4, start.y + h * 0.8);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'parallelogram') {\r\n            const shift = w * 0.2;\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x + shift, start.y);\r\n            ctx.lineTo(end.x, start.y);\r\n            ctx.lineTo(end.x - shift, end.y);\r\n            ctx.lineTo(start.x, end.y);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'cylinder') {\r\n            const ry = Math.abs(h * 0.1);\r\n            // Bottom face\r\n            ctx.beginPath();\r\n            ctx.ellipse(start.x + w / 2, end.y - ry, Math.abs(w / 2), ry, 0, 0, Math.PI, false);\r\n            ctx.stroke();\r\n            // Side lines\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x, start.y + ry);\r\n            ctx.lineTo(start.x, end.y - ry);\r\n            ctx.moveTo(end.x, start.y + ry);\r\n            ctx.lineTo(end.x, end.y - ry);\r\n            ctx.stroke();\r\n            // Top face\r\n            ctx.beginPath();\r\n            ctx.ellipse(start.x + w / 2, start.y + ry, Math.abs(w / 2), ry, 0, 0, 2 * Math.PI);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        } else if (type === 'document') {\r\n            const fold = Math.min(w, h) * 0.2;\r\n            ctx.beginPath();\r\n            ctx.moveTo(start.x, start.y);\r\n            ctx.lineTo(end.x - fold, start.y);\r\n            ctx.lineTo(end.x, start.y + fold);\r\n            ctx.lineTo(end.x, end.y);\r\n            ctx.lineTo(start.x, end.y);\r\n            ctx.closePath();\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n            // Fold line\r\n            ctx.beginPath();\r\n            ctx.moveTo(end.x - fold, start.y);\r\n            ctx.lineTo(end.x - fold, start.y + fold);\r\n            ctx.lineTo(end.x, start.y + fold);\r\n            ctx.stroke();\r\n        } else if (type === 'cloud') {\r\n            ctx.beginPath();\r\n            const mw = start.x + w / 2;\r\n            const mh = start.y + h / 2;\r\n            ctx.arc(mw - w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            ctx.arc(mw + w * 0.2, mh, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            ctx.arc(mw, mh - h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            ctx.arc(mw, mh + h * 0.2, Math.abs(h * 0.3), 0, 2 * Math.PI);\r\n            if (style.fill) ctx.fill();\r\n            ctx.stroke();\r\n        }\r\n    };\r\n\r\n    const drawArrowHead = (ctx, fromx, fromy, tox, toy, weight) => {\r\n        const headlen = weight * 4;\r\n        const angle = Math.atan2(toy - fromy, tox - fromx);\r\n        ctx.save();\r\n        ctx.translate(tox, toy);\r\n        ctx.rotate(angle);\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, 0);\r\n        ctx.lineTo(-headlen, -headlen / 2);\r\n        ctx.lineTo(-headlen, headlen / 2);\r\n        ctx.closePath();\r\n        ctx.fill();\r\n        ctx.restore();\r\n    };\r\n\r\n    const clearCanvasLocal = () => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas || !contextRef.current) return;\r\n        contextRef.current.clearRect(0, 0, canvas.width, canvas.height);\r\n    };\r\n\r\n    const getMousePos = (e) => {\r\n        const viewport = viewportRef.current;\r\n        if (!viewport) return { x: 0, y: 0 };\r\n        const rect = viewport.getBoundingClientRect();\r\n\r\n        // Convert screen coordinates to world coordinates\r\n        return {\r\n            x: (e.clientX - rect.left - cameraOffsetRef.current.x) / cameraScaleRef.current,\r\n            y: (e.clientY - rect.top - cameraOffsetRef.current.y) / cameraScaleRef.current\r\n        };\r\n    };\r\n\r\n    const startDrawing = (e) => {\r\n        // Handle Panning with Middle Mouse or Pan Tool\r\n        if (e.button === 1 || tool === 'pan') {\r\n            isPanningRef.current = true;\r\n            panStartRef.current = { x: e.clientX - cameraOffsetRef.current.x, y: e.clientY - cameraOffsetRef.current.y };\r\n            return;\r\n        }\r\n\r\n        const canvas = canvasRef.current;\r\n        if (!canvas || !contextRef.current) return;\r\n\r\n        const pos = getMousePos(e);\r\n\r\n        if (tool === 'eraser') {\r\n            eraseObjectAt(pos);\r\n            return;\r\n        }\r\n\r\n        // Initialize drawing refs\r\n        isDrawingRef.current = true;\r\n        currentPointsRef.current = [pos];\r\n        startPosRef.current = pos;\r\n        lastPosRef.current = pos;\r\n\r\n        // Take efficient snapshot\r\n        const snapCtx = snapshotCanvasRef.current.getContext('2d');\r\n        snapCtx.clearRect(0, 0, canvas.width, canvas.height);\r\n        snapCtx.drawImage(canvas, 0, 0);\r\n\r\n        if (tool === \"pencil\" || tool === \"highlighter\" || tool === \"eraser\" || tool === \"precision-eraser\" || tool === \"soft-brush\" || tool === \"marker\" || tool === \"smooth-pencil\") {\r\n            const ctx = contextRef.current;\r\n            ctx.beginPath();\r\n            ctx.moveTo(pos.x, pos.y);\r\n\r\n            // Set styles once on start\r\n            ctx.lineWidth = size;\r\n            ctx.strokeStyle = color;\r\n            ctx.globalAlpha = tool === \"highlighter\" ? (opacity * 0.4) :\r\n                tool === \"marker\" ? (opacity * 0.6) : opacity;\r\n            ctx.setLineDash(strokeStyle === 'dashed' ? [10, 10] : []);\r\n            ctx.lineCap = \"round\";\r\n            ctx.lineJoin = \"round\";\r\n\r\n            if (tool === 'soft-brush') {\r\n                ctx.shadowBlur = size / 2;\r\n                ctx.shadowColor = color;\r\n            } else {\r\n                ctx.shadowBlur = 0;\r\n            }\r\n        }\r\n    };\r\n\r\n    const handleMouseMove = (e) => {\r\n        if (isPanningRef.current) {\r\n            cameraOffsetRef.current = {\r\n                x: e.clientX - panStartRef.current.x,\r\n                y: e.clientY - panStartRef.current.y\r\n            };\r\n            syncViewDOM();\r\n            return;\r\n        }\r\n\r\n        if (isDrawingRef.current) {\r\n            if (animationFrameRef.current) {\r\n                cancelAnimationFrame(animationFrameRef.current);\r\n            }\r\n            // Extract data from event because React event pooling may nullify 'e' inside rAF\r\n            const clientX = e.clientX;\r\n            const clientY = e.clientY;\r\n            const shiftKey = e.shiftKey;\r\n\r\n            animationFrameRef.current = requestAnimationFrame(() => draw({ clientX, clientY, shiftKey }));\r\n        } else if (tool === 'eraser' && e.buttons === 1) {\r\n            eraseObjectAt(getMousePos(e));\r\n        }\r\n    };\r\n\r\n    const eraseObjectAt = (pos) => {\r\n        // Distance-based object erasing\r\n        const threshold = 15; // pixels\r\n        const updatedStrokes = strokes.filter(stroke => {\r\n            return !stroke.points.some(p => {\r\n                const dist = Math.sqrt(Math.pow(p.x - pos.x, 2) + Math.pow(p.y - pos.y, 2));\r\n                return dist < threshold;\r\n            });\r\n        });\r\n\r\n        if (updatedStrokes.length !== strokes.length) {\r\n            setStrokes(updatedStrokes);\r\n            socket.emit(\"update-board-state\", { roomId, strokes: updatedStrokes });\r\n        }\r\n    };\r\n\r\n    const draw = (e) => {\r\n        if (!isDrawingRef.current || !contextRef.current) return;\r\n        const pos = getMousePos(e);\r\n        let currentPos = pos;\r\n\r\n        // Smooth Stroke Mode: Apply simple smoothing\r\n        if (tool === 'smooth-pencil' && currentPointsRef.current.length > 0) {\r\n            const lastPoint = currentPointsRef.current[currentPointsRef.current.length - 1];\r\n            currentPos = {\r\n                x: lastPoint.x * 0.8 + pos.x * 0.2, // Linear interpolation for smoothing\r\n                y: lastPoint.y * 0.8 + pos.y * 0.2,\r\n                shiftKey: e.shiftKey\r\n            };\r\n        } else {\r\n            currentPos = { ...pos, shiftKey: e.shiftKey };\r\n        }\r\n\r\n        currentPointsRef.current.push(currentPos);\r\n        const ctx = contextRef.current;\r\n\r\n        if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\"].includes(tool)) {\r\n            ctx.globalCompositeOperation = \"source-over\";\r\n\r\n            // Straight Line Mode (Shift Key)\r\n            if (e.shiftKey) {\r\n                clearCanvasLocal();\r\n                ctx.drawImage(snapshotCanvasRef.current, 0, 0);\r\n                ctx.beginPath();\r\n                ctx.moveTo(startPosRef.current.x, startPosRef.current.y);\r\n                ctx.lineTo(currentPos.x, currentPos.y);\r\n                ctx.stroke();\r\n                return;\r\n            }\r\n\r\n            ctx.lineTo(currentPos.x, currentPos.y);\r\n            ctx.stroke();\r\n\r\n            // Emit drawing segment for real-time collab\r\n            socket.emit(\"drawing\", {\r\n                roomId,\r\n                drawingData: {\r\n                    x: currentPos.x,\r\n                    y: currentPos.y,\r\n                    prevX: lastPosRef.current.x,\r\n                    prevY: lastPosRef.current.y,\r\n                    color,\r\n                    size,\r\n                    opacity: ctx.globalAlpha,\r\n                    tool\r\n                }\r\n            });\r\n\r\n            lastPosRef.current = currentPos;\r\n        } else if (tool === \"eraser\" || tool === \"precision-eraser\") {\r\n            ctx.globalCompositeOperation = \"destination-out\";\r\n            const eraserSize = tool === \"precision-eraser\" ? 10 : size * 2;\r\n            ctx.lineWidth = eraserSize;\r\n            ctx.lineTo(pos.x, pos.y);\r\n            ctx.stroke();\r\n\r\n            socket.emit(\"erase\", {\r\n                roomId,\r\n                eraseData: { x: pos.x, y: pos.y, size: eraserSize }\r\n            });\r\n        } else if ([\"rect\", \"circle\", \"line\", \"arrow\", \"double-arrow\", \"rounded-rect\", \"ellipse\", \"triangle\", \"diamond\", \"sticky\", \"speech-bubble\", \"parallelogram\", \"cylinder\", \"document\", \"cloud\"].includes(tool)) {\r\n            clearCanvasLocal();\r\n            ctx.drawImage(snapshotCanvasRef.current, 0, 0);\r\n            drawShape(ctx, tool, [startPosRef.current, currentPos], { color, size, opacity, strokeStyle, fill });\r\n        }\r\n    };\r\n\r\n    const drawArrow = (ctx, fromx, fromy, tox, toy) => {\r\n        const headlen = size * 3;\r\n        const angle = Math.atan2(toy - fromy, tox - fromx);\r\n        ctx.moveTo(fromx, fromy);\r\n        ctx.lineTo(tox, toy);\r\n        ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));\r\n        ctx.moveTo(tox, toy);\r\n        ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));\r\n    };\r\n\r\n    const stopDrawing = () => {\r\n        if (isPanningRef.current) {\r\n            isPanningRef.current = false;\r\n            // Final sync to state for UI consistency\r\n            setCameraOffset(cameraOffsetRef.current);\r\n            return;\r\n        }\r\n\r\n        const canvas = canvasRef.current;\r\n        if (!isDrawingRef.current || !canvas) return;\r\n\r\n        if (animationFrameRef.current) {\r\n            cancelAnimationFrame(animationFrameRef.current);\r\n        }\r\n\r\n        isDrawingRef.current = false;\r\n\r\n        // Save current stroke to state\r\n        let points = [...currentPointsRef.current];\r\n\r\n        // Straight Line Mode: If shift was held, only keep start and end points\r\n        if ([\"pencil\", \"highlighter\", \"soft-brush\", \"marker\", \"smooth-pencil\"].includes(tool) && points.length > 1 && points[points.length - 1].shiftKey) {\r\n            points = [points[0], points[points.length - 1]];\r\n        }\r\n\r\n        const newStroke = {\r\n            id: Date.now() + Math.random(),\r\n            type: tool === 'precision-eraser' ? 'eraser-precision' : tool,\r\n            points: points,\r\n            color: color,\r\n            size: tool === 'precision-eraser' ? 10 : size,\r\n            opacity: tool === 'highlighter' ? 0.4 :\r\n                tool === 'marker' ? 0.6 : opacity,\r\n            strokeStyle,\r\n            fill\r\n        };\r\n\r\n        if (tool !== 'eraser') { // Only save non-eraser strokes to the strokes array\r\n            setStrokes(prev => [...prev, newStroke]);\r\n            socket.emit(\"new-stroke\", { roomId, stroke: newStroke });\r\n        }\r\n\r\n        currentPointsRef.current = [];\r\n\r\n        // The following block is for canvas state history, which is now separate from strokes\r\n        const dataURL = canvas.toDataURL();\r\n        const newHistory = history.slice(0, historyIndex + 1);\r\n        newHistory.push(dataURL);\r\n        setHistory(newHistory);\r\n        setHistoryIndex(newHistory.length - 1);\r\n        socket.emit(\"save-canvas\", { roomId, canvasData: dataURL });\r\n    };\r\n\r\n    const handleUndo = () => {\r\n        if (historyIndex > 0) {\r\n            const newIndex = historyIndex - 1;\r\n            const state = history[newIndex];\r\n            setHistoryIndex(newIndex);\r\n            applyCanvasState(state);\r\n            socket.emit(\"undo\", { roomId, canvasState: state });\r\n            socket.emit(\"save-canvas\", { roomId, canvasData: state });\r\n        }\r\n    };\r\n\r\n    const handleRedo = () => {\r\n        if (historyIndex < history.length - 1) {\r\n            const newIndex = historyIndex + 1;\r\n            const state = history[newIndex];\r\n            setHistoryIndex(newIndex);\r\n            applyCanvasState(state);\r\n            socket.emit(\"redo\", { roomId, canvasState: state });\r\n            socket.emit(\"save-canvas\", { roomId, canvasData: state });\r\n        }\r\n    };\r\n\r\n    const drawRemote = (data) => {\r\n        const { x, y, prevX, prevY, color, size, opacity } = data;\r\n        const ctx = contextRef.current;\r\n        if (!ctx) return;\r\n\r\n        ctx.save();\r\n        ctx.globalAlpha = opacity || 1;\r\n        ctx.strokeStyle = color;\r\n        ctx.lineWidth = size;\r\n        ctx.lineCap = \"round\";\r\n        ctx.lineJoin = \"round\";\r\n\r\n        ctx.beginPath();\r\n        if (prevX && prevY) {\r\n            ctx.moveTo(prevX, prevY);\r\n        } else {\r\n            ctx.moveTo(x, y);\r\n        }\r\n        ctx.lineTo(x, y);\r\n        ctx.stroke();\r\n        ctx.restore();\r\n    };\r\n\r\n    const eraseRemote = (data) => {\r\n        const { x, y, size } = data;\r\n        const ctx = contextRef.current;\r\n        const prevGCO = ctx.globalCompositeOperation;\r\n        ctx.globalCompositeOperation = \"destination-out\";\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, size, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        ctx.globalCompositeOperation = prevGCO;\r\n    };\r\n\r\n    const handleClearBoard = () => {\r\n        if (window.confirm(\"Clear all?\")) socket.emit(\"clear-board\", { roomId, userId: user._id });\r\n    };\r\n\r\n    return (\r\n        <div className=\"wb-layout-container\">\r\n            {/* Header */}\r\n            <header className=\"wb-header-miro\">\r\n                <div className=\"flex items-center gap-6\">\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"w-9 h-9 bg-violet-600 rounded-lg flex items-center justify-center cursor-pointer shadow-lg shadow-violet-200\" onClick={() => navigate('/dashboard')}>\r\n                            <span className=\"text-white font-black text-lg\">C</span>\r\n                        </div>\r\n                        <div>\r\n                            <h1 className=\"font-bold text-slate-800 leading-tight text-sm truncate max-w-[150px]\">{room?.roomName || 'Untitled Board'}</h1>\r\n                            <span className=\"text-[10px] text-slate-400 font-bold uppercase tracking-widest\">{participants.length} online</span>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"w-px h-8 bg-slate-100\"></div>\r\n\r\n                    {/* Navbar Styling Controls */}\r\n                    {isDrawingTool && (\r\n                        <div className=\"flex items-center gap-6 animate-in fade-in slide-in-from-left-4 duration-300\">\r\n                            {/* Color Picker */}\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <div className=\"grid grid-cols-5 gap-1 pt-0.5\">\r\n                                    {colors.slice(0, 5).map(c => (\r\n                                        <button\r\n                                            key={c}\r\n                                            onClick={() => setColor(c)}\r\n                                            className={`w-4 h-4 rounded-full border border-slate-200 transition-all ${color === c ? 'ring-2 ring-violet-500 ring-offset-1 scale-110' : 'hover:scale-110'}`}\r\n                                            style={{ backgroundColor: c }}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                                <div className=\"grid grid-cols-5 gap-1 pt-0.5\">\r\n                                    {colors.slice(5).map(c => (\r\n                                        <button\r\n                                            key={c}\r\n                                            onClick={() => setColor(c)}\r\n                                            className={`w-4 h-4 rounded-full border border-slate-200 transition-all ${color === c ? 'ring-2 ring-violet-500 ring-offset-1 scale-110' : 'hover:scale-110'}`}\r\n                                            style={{ backgroundColor: c }}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"w-px h-6 bg-slate-100\"></div>\r\n\r\n                            {/* Size Slider */}\r\n                            <div className=\"flex items-center gap-3 w-32\">\r\n                                <span className=\"text-[9px] font-bold text-slate-400 uppercase tracking-widest\">Size</span>\r\n                                <input\r\n                                    type=\"range\" min=\"1\" max=\"40\" value={size}\r\n                                    onChange={(e) => setSize(parseInt(e.target.value))}\r\n                                    className=\"w-full accent-violet-600 h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer\"\r\n                                />\r\n                                <span className=\"text-[10px] font-mono font-bold text-slate-600 min-w-[20px]\">{size}</span>\r\n                            </div>\r\n\r\n                            <div className=\"w-px h-6 bg-slate-100\"></div>\r\n\r\n                            {/* Opacity Control */}\r\n                            <div className=\"flex items-center gap-3 w-32\">\r\n                                <span className=\"text-[9px] font-bold text-slate-400 uppercase tracking-widest\">Opacity</span>\r\n                                <input\r\n                                    type=\"range\" min=\"0.1\" max=\"1\" step=\"0.1\" value={opacity}\r\n                                    onChange={(e) => setOpacity(parseFloat(e.target.value))}\r\n                                    className=\"w-full accent-violet-600 h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer\"\r\n                                />\r\n                                <span className=\"text-[10px] font-mono font-bold text-slate-600 min-w-[25px]\">{Math.round(opacity * 100)}%</span>\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button className=\"btn-secondary-miro\" onClick={() => {\r\n                        navigator.clipboard.writeText(window.location.href);\r\n                        toast.success(\"Link copied!\");\r\n                    }}>Invite Collaborators</button>\r\n                    <button className=\"btn-primary-miro\">Share Screen</button>\r\n                    <div className=\"w-px h-6 bg-slate-200 mx-1\"></div>\r\n                    <button className=\"tool-button\" onClick={() => setIsSidebarOpen(!isSidebarOpen)}>\r\n                        <span className=\"text-lg\"></span>\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            {/* Left Sidebar */}\r\n            <aside className=\"wb-left-panel\">\r\n                <Toolbar\r\n                    activeTool={tool}\r\n                    setTool={handleToolChange}\r\n                    isHost={user._id === room?.host}\r\n                    onClear={handleClearBoard}\r\n                    onUndo={handleUndo}\r\n                    onRedo={handleRedo}\r\n                    onDelete={() => { }}\r\n                />\r\n            </aside>\r\n\r\n            {/* Viewport & Canvas (Infinite Background) */}\r\n            <main\r\n                ref={viewportRef}\r\n                className=\"wb-viewport overflow-hidden cursor-default bg-white\"\r\n                style={{\r\n                    backgroundImage: 'radial-gradient(#cbd5e1 1px, transparent 1px)',\r\n                    backgroundSize: `${24 * cameraScale}px ${24 * cameraScale}px`,\r\n                    backgroundPosition: `${cameraOffset.x}px ${cameraOffset.y}px`\r\n                }}\r\n            >\r\n                {/* The 'World' Container */}\r\n                <div\r\n                    ref={worldRef}\r\n                    className=\"absolute inset-0 pointer-events-none\"\r\n                    style={{\r\n                        transform: `translate(${cameraOffset.x}px, ${cameraOffset.y}px) scale(${cameraScale})`,\r\n                        transformOrigin: '0 0'\r\n                    }}\r\n                >\r\n                    {/* Main Canvas Buffer (Large Stable Surface) */}\r\n                    <div\r\n                        style={{ width: '8192px', height: '8192px', pointerEvents: 'auto' }}\r\n                    >\r\n                        <canvas\r\n                            ref={canvasRef}\r\n                            className=\"bg-transparent\"\r\n                            onMouseDown={startDrawing}\r\n                            onMouseMove={handleMouseMove}\r\n                            onMouseUp={stopDrawing}\r\n                            onMouseOut={stopDrawing}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Floating Styling Panel (Secondary Controls: Stroke & Fill) */}\r\n                <StylingPanel\r\n                    tool={tool}\r\n                    visible={showStyling}\r\n                    strokeStyle={strokeStyle} setStrokeStyle={setStrokeStyle}\r\n                    fill={fill} setFill={setFill}\r\n                />\r\n\r\n                {/* Zoom Controls Overlay */}\r\n                <div className=\"absolute bottom-6 right-6 flex items-center gap-2 bg-white p-1 rounded-xl shadow-lg border border-slate-200 z-50\">\r\n                    <button\r\n                        onClick={() => { setCameraScale(1); setCameraOffset({ x: 0, y: 0 }); }}\r\n                        className=\"w-12 h-8 hover:bg-slate-50 rounded-lg text-xs font-bold text-slate-600 transition-colors\"\r\n                    >\r\n                        {Math.round(cameraScale * 100)}%\r\n                    </button>\r\n                    <div className=\"w-px h-4 bg-slate-100\"></div>\r\n                    <button\r\n                        onClick={() => setCameraScale(prev => prev * 1.1)}\r\n                        className=\"w-8 h-8 hover:bg-slate-50 rounded-lg flex items-center justify-center text-slate-600\"\r\n                    >\r\n                        <Plus size={14} />\r\n                    </button>\r\n                    <button\r\n                        onClick={() => setCameraScale(prev => prev / 1.1)}\r\n                        className=\"w-8 h-8 hover:bg-slate-50 rounded-lg flex items-center justify-center text-slate-600\"\r\n                    >\r\n                        <Minus size={14} />\r\n                    </button>\r\n                </div>\r\n            </main>\r\n\r\n            {/* Right Sidebar */}\r\n            <aside className={`wb-right-panel ${isSidebarOpen ? 'open' : ''}`}>\r\n                <div className=\"flex flex-col h-full\">\r\n                    <div className=\"flex p-2 bg-slate-50 border-b border-slate-200\">\r\n                        {['chat', 'files', 'users'].map((tab) => (\r\n                            <button\r\n                                key={tab}\r\n                                onClick={() => setActiveTab(tab)}\r\n                                className={`flex-1 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase tracking-widest\r\n                                          ${activeTab === tab ? \"bg-white text-violet-700 shadow-sm border border-slate-200\" : \"text-slate-500 hover:text-slate-700\"}`}\r\n                            >\r\n                                {tab}\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                    <div className=\"flex-1 overflow-hidden\">\r\n                        {activeTab === \"chat\" ? (\r\n                            <Chat messages={messages} onSendMessage={(txt) => socket.emit(\"chat-message\", { roomId, message: txt, userId: user._id, userName: user.name })} currentUser={user} />\r\n                        ) : activeTab === \"files\" ? (\r\n                            <div className=\"p-4\">\r\n                                <label className=\"btn-secondary-miro w-full flex justify-center cursor-pointer text-xs mb-4\">\r\n                                    <span>Share Asset</span>\r\n                                    <input type=\"file\" className=\"hidden\" />\r\n                                </label>\r\n                                <div className=\"space-y-2\">\r\n                                    {sharedFiles.map((f, i) => (\r\n                                        <div key={i} className=\"p-3 bg-slate-50 rounded-lg border border-slate-100 flex items-center justify-between\">\r\n                                            <span className=\"text-xs font-medium truncate max-w-[150px]\">{f.fileName}</span>\r\n                                            <span className=\"text-violet-600\"></span>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"p-4 space-y-2\">\r\n                                {participants.map((p, i) => (\r\n                                    <div key={i} className=\"flex items-center gap-3 p-2 hover:bg-slate-50 rounded-lg\">\r\n                                        <div className=\"w-6 h-6 rounded-full bg-violet-100 flex items-center justify-center text-[10px] font-bold text-violet-700\">{p.userName[0]}</div>\r\n                                        <span className=\"text-xs font-medium text-slate-700\">{p.userName}</span>\r\n                                        <div className=\"w-1.5 h-1.5 rounded-full bg-green-500 ml-auto\"></div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </aside>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WhiteboardRoom;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}