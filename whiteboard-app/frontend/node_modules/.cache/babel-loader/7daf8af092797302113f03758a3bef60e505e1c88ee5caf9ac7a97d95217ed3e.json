{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\pages\\\\WhiteboardRoom.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { useSocket } from \"../context/SocketContext\";\nimport { roomService } from \"../services/api\";\nimport Toolbar from \"../components/Toolbar\";\nimport Chat from \"../components/Chat\";\nimport toast from \"react-hot-toast\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WhiteboardRoom = () => {\n  _s();\n  const {\n    roomId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth();\n  const {\n    socket\n  } = useSocket();\n  const canvasRef = useRef(null);\n  const contextRef = useRef(null);\n  const [isDrawing, setIsDrawing] = useState(false);\n  const [tool, setTool] = useState(\"pencil\");\n  const [color, setColor] = useState(\"#000000\");\n  const [size, setSize] = useState(5);\n  const [room, setRoom] = useState(null);\n  const [participants, setParticipants] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [sharedFiles, setSharedFiles] = useState([]);\n  const [activeTab, setActiveTab] = useState(\"chat\");\n  const [loadingFileUpload, setLoadingFileUpload] = useState(false);\n  const [screenStream, setScreenStream] = useState(null);\n  const screenVideoRef = useRef(null);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n\n  // History for Undo/Redo\n  const [history, setHistory] = useState([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  useEffect(() => {\n    const fetchRoomDetails = async () => {\n      try {\n        const res = await roomService.getRoom(roomId);\n        setRoom(res.data.room);\n        setSharedFiles(res.data.room.sharedFiles || []);\n      } catch (err) {\n        toast.error(\"Failed to load workspace\");\n        navigate(\"/dashboard\");\n      }\n    };\n    fetchRoomDetails();\n    if (socket) {\n      socket.emit(\"join-room\", {\n        roomId,\n        userId: user._id,\n        userName: user.name\n      });\n      socket.on(\"user-joined\", data => {\n        toast.success(`${data.userName} joined`);\n      });\n      socket.on(\"online-users\", users => {\n        setParticipants(users);\n      });\n      socket.on(\"chat-message\", msg => {\n        setMessages(prev => [...prev, msg]);\n      });\n      socket.on(\"chat-history\", history => {\n        setMessages(history);\n      });\n      socket.on(\"new-file\", file => {\n        setSharedFiles(prev => [file, ...prev]);\n        toast.success(`New file shared: ${file.fileName}`);\n      });\n      socket.on(\"drawing\", data => {\n        drawRemote(data);\n      });\n      socket.on(\"erase\", data => {\n        eraseRemote(data);\n      });\n      socket.on(\"board-cleared\", () => {\n        clearCanvasLocal();\n        setHistory([]);\n        setHistoryIndex(-1);\n        toast.info(\"Board cleared\");\n      });\n      socket.on(\"canvas-state\", data => {\n        if (data) {\n          applyCanvasState(data);\n          setHistory([data]);\n          setHistoryIndex(0);\n        }\n      });\n      socket.on(\"undo\", state => {\n        applyCanvasState(state);\n      });\n      socket.on(\"redo\", state => {\n        applyCanvasState(state);\n      });\n      socket.on(\"error-message\", msg => {\n        toast.error(msg);\n      });\n    }\n    const handleUndoEvent = () => handleUndo();\n    const handleRedoEvent = () => handleRedo();\n    window.addEventListener('wb-undo', handleUndoEvent);\n    window.addEventListener('wb-redo', handleRedoEvent);\n    return () => {\n      if (socket) {\n        socket.emit(\"leave-room\", {\n          roomId,\n          userId: user._id,\n          userName: user.name\n        });\n        socket.off(\"user-joined\");\n        socket.off(\"online-users\");\n        socket.off(\"chat-message\");\n        socket.off(\"chat-history\");\n        socket.off(\"new-file\");\n        socket.off(\"drawing\");\n        socket.off(\"erase\");\n        socket.off(\"board-cleared\");\n        socket.off(\"canvas-state\");\n        socket.off(\"undo\");\n        socket.off(\"redo\");\n        socket.off(\"error-message\");\n      }\n      window.removeEventListener('wb-undo', handleUndoEvent);\n      window.removeEventListener('wb-redo', handleRedoEvent);\n    };\n  }, [roomId, socket, user, navigate]);\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    const container = canvas.parentElement;\n    const ResizeCanvas = () => {\n      const rect = container.getBoundingClientRect();\n\n      // Handle high DPI displays\n      const dpr = window.devicePixelRatio || 1;\n      const tempCanvas = document.createElement('canvas');\n      const tempCtx = tempCanvas.getContext('2d');\n      tempCanvas.width = canvas.width;\n      tempCanvas.height = canvas.height;\n      tempCtx.drawImage(canvas, 0, 0);\n      canvas.width = rect.width * dpr;\n      canvas.height = rect.height * dpr;\n      canvas.style.width = `${rect.width}px`;\n      canvas.style.height = `${rect.height}px`;\n      const context = canvas.getContext(\"2d\");\n      context.scale(dpr, dpr);\n      context.lineCap = \"round\";\n      context.lineJoin = \"round\";\n      context.drawImage(tempCanvas, 0, 0, tempCanvas.width / dpr, tempCanvas.height / dpr, 0, 0, rect.width, rect.height);\n      contextRef.current = context;\n    };\n    const resizeObserver = new ResizeObserver(() => {\n      ResizeCanvas();\n    });\n    resizeObserver.observe(container);\n    ResizeCanvas();\n    const dataURL = canvas.toDataURL();\n    setHistory([dataURL]);\n    setHistoryIndex(0);\n    return () => resizeObserver.disconnect();\n  }, []);\n  const applyCanvasState = state => {\n    if (!state) {\n      clearCanvasLocal();\n      return;\n    }\n    const image = new Image();\n    image.src = state;\n    image.onload = () => {\n      clearCanvasLocal();\n      const canvas = canvasRef.current;\n      contextRef.current.drawImage(image, 0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1));\n    };\n  };\n  const clearCanvasLocal = () => {\n    const canvas = canvasRef.current;\n    const dpr = window.devicePixelRatio || 1;\n    contextRef.current.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);\n  };\n  const startDrawing = ({\n    nativeEvent\n  }) => {\n    const {\n      offsetX,\n      offsetY\n    } = nativeEvent;\n    contextRef.current.beginPath();\n    contextRef.current.moveTo(offsetX, offsetY);\n    setIsDrawing(true);\n  };\n  const draw = ({\n    nativeEvent\n  }) => {\n    if (!isDrawing) return;\n    const {\n      offsetX,\n      offsetY\n    } = nativeEvent;\n    contextRef.current.lineWidth = size;\n    if (tool === \"pencil\") {\n      contextRef.current.strokeStyle = color;\n      contextRef.current.globalCompositeOperation = \"source-over\";\n      contextRef.current.lineTo(offsetX, offsetY);\n      contextRef.current.stroke();\n      socket.emit(\"drawing\", {\n        roomId,\n        drawingData: {\n          x: offsetX,\n          y: offsetY,\n          color,\n          size\n        }\n      });\n    } else {\n      contextRef.current.globalCompositeOperation = \"destination-out\";\n      contextRef.current.lineTo(offsetX, offsetY);\n      contextRef.current.stroke();\n      socket.emit(\"erase\", {\n        roomId,\n        eraseData: {\n          x: offsetX,\n          y: offsetY,\n          size: size * 2\n        }\n      });\n    }\n  };\n  const stopDrawing = () => {\n    if (!isDrawing) return;\n    contextRef.current.closePath();\n    setIsDrawing(false);\n    const dataURL = canvasRef.current.toDataURL();\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push(dataURL);\n    if (newHistory.length > 50) newHistory.shift();\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n    socket.emit(\"save-canvas\", {\n      roomId,\n      canvasData: dataURL\n    });\n  };\n  const handleUndo = () => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      const state = history[newIndex];\n      setHistoryIndex(newIndex);\n      applyCanvasState(state);\n      socket.emit(\"undo\", {\n        roomId,\n        canvasState: state\n      });\n      socket.emit(\"save-canvas\", {\n        roomId,\n        canvasData: state\n      });\n    }\n  };\n  const handleRedo = () => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      const state = history[newIndex];\n      setHistoryIndex(newIndex);\n      applyCanvasState(state);\n      socket.emit(\"redo\", {\n        roomId,\n        canvasState: state\n      });\n      socket.emit(\"save-canvas\", {\n        roomId,\n        canvasData: state\n      });\n    }\n  };\n  const drawRemote = data => {\n    const {\n      x,\n      y,\n      color,\n      size\n    } = data;\n    const context = contextRef.current;\n    const prevGCO = context.globalCompositeOperation;\n    const prevStrokeStyle = context.strokeStyle;\n    const prevLineWidth = context.lineWidth;\n    context.globalCompositeOperation = \"source-over\";\n    context.strokeStyle = color;\n    context.lineWidth = size;\n    context.beginPath();\n    context.arc(x, y, size / 2, 0, Math.PI * 2);\n    context.fillStyle = color;\n    context.fill();\n    context.globalCompositeOperation = prevGCO;\n    context.strokeStyle = prevStrokeStyle;\n    context.lineWidth = prevLineWidth;\n  };\n  const eraseRemote = data => {\n    const {\n      x,\n      y,\n      size\n    } = data;\n    const context = contextRef.current;\n    const prevGCO = context.globalCompositeOperation;\n    const prevLineWidth = context.lineWidth;\n    context.globalCompositeOperation = \"destination-out\";\n    context.lineWidth = size;\n    context.beginPath();\n    context.arc(x, y, size, 0, Math.PI * 2);\n    context.fill();\n    context.globalCompositeOperation = prevGCO;\n    context.lineWidth = prevLineWidth;\n  };\n  const handleSendMessage = text => {\n    if (socket) {\n      socket.emit(\"chat-message\", {\n        roomId,\n        message: text,\n        userId: user._id,\n        userName: user.name\n      });\n    }\n  };\n  const handleClearBoard = () => {\n    if (user._id !== (room === null || room === void 0 ? void 0 : room.host)) {\n      toast.error(\"Only host can clear\");\n      return;\n    }\n    if (window.confirm(\"Clear board?\")) {\n      socket.emit(\"clear-board\", {\n        roomId,\n        userId: user._id\n      });\n    }\n  };\n  const handleDownload = () => {\n    const canvas = canvasRef.current;\n    const dataURL = canvas.toDataURL(\"image/png\");\n    const link = document.createElement(\"a\");\n    link.href = dataURL;\n    link.download = `board-${(room === null || room === void 0 ? void 0 : room.roomName) || \"whiteboard\"}.png`;\n    link.click();\n  };\n  const handleShare = () => {\n    navigator.clipboard.writeText(window.location.href);\n    toast.success(\"Link copied!\");\n  };\n  const handleFileUpload = async e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    const formData = new FormData();\n    formData.append(\"file\", file);\n    setLoadingFileUpload(true);\n    try {\n      const res = await roomService.uploadFile(roomId, formData);\n      socket.emit(\"file-shared\", {\n        roomId,\n        file: res.data.file\n      });\n      setSharedFiles(prev => [res.data.file, ...prev]);\n      toast.success(\"File shared!\");\n    } catch (err) {\n      toast.error(\"Upload failed\");\n    } finally {\n      setLoadingFileUpload(false);\n    }\n  };\n  const handleScreenShare = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getDisplayMedia({\n        video: true\n      });\n      setScreenStream(stream);\n      stream.getVideoTracks()[0].onended = () => stopScreenShare();\n      if (screenVideoRef.current) screenVideoRef.current.srcObject = stream;\n      socket.emit(\"screen-share-started\", {\n        roomId,\n        userId: user._id,\n        userName: user.name\n      });\n    } catch (err) {\n      toast.error(\"Screen share failed\");\n    }\n  };\n  const stopScreenShare = () => {\n    if (screenStream) {\n      screenStream.getTracks().forEach(track => track.stop());\n      setScreenStream(null);\n      socket.emit(\"screen-share-stopped\", {\n        roomId\n      });\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wb-grid-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"wb-header glass flex items-center justify-between px-6 z-50\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-3 cursor-pointer\",\n          onClick: () => navigate('/dashboard'),\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-8 h-8 rounded-lg bg-primary-600 flex items-center justify-center font-black\",\n            children: \"C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n            className: \"font-bold text-lg hidden md:block\",\n            children: room === null || room === void 0 ? void 0 : room.roomName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 385,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 383,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/10 text-xs\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-2 h-2 rounded-full bg-green-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 388,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [\"ID: \", roomId]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"hidden sm:block text-xs font-bold text-slate-400 hover:text-white transition-colors\",\n          onClick: handleShare,\n          children: \"Invite\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-secondary-premium !py-1.5 !px-4 text-xs\",\n          onClick: screenStream ? stopScreenShare : handleScreenShare,\n          children: screenStream ? \"Stop Share\" : \"Share Stream\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 395,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn-premium !py-1.5 !px-4 text-xs\",\n          onClick: () => setIsSidebarOpen(!isSidebarOpen),\n          children: \"Chat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n      className: \"wb-sidebar-left flex flex-col items-center py-6 gap-6 bg-slate-900/50\",\n      children: /*#__PURE__*/_jsxDEV(Toolbar, {\n        tool: tool,\n        setTool: setTool,\n        color: color,\n        setColor: setColor,\n        size: size,\n        setSize: setSize,\n        onClear: handleClearBoard,\n        isHost: user._id === (room === null || room === void 0 ? void 0 : room.host)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"wb-canvas-main\",\n      children: [screenStream && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"absolute inset-0 z-40 bg-black/90 flex flex-col items-center justify-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: screenVideoRef,\n          autoPlay: true,\n          playsInline: true,\n          muted: true,\n          className: \"max-w-[90%] max-h-[80%] rounded-xl\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-4 text-sm font-bold animate-pulse text-red-500\",\n          children: \"YOU ARE SHARING SCREEN\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 423,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        onMouseDown: startDrawing,\n        onMouseMove: draw,\n        onMouseUp: stopDrawing,\n        onMouseOut: stopDrawing,\n        className: \"cursor-crosshair w-full h-full\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 426,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 419,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n      className: `wb-sidebar-right glass flex flex-col ${isSidebarOpen ? 'open' : ''}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex p-3 bg-white/5 border-b border-white/5\",\n        children: ['chat', 'files', 'users'].map(tab => /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setActiveTab(tab),\n          className: `flex-1 py-1.5 rounded-lg text-xs font-bold transition-all uppercase tracking-widest\n                                      ${activeTab === tab ? \"bg-primary-600 text-white\" : \"text-slate-500 hover:text-slate-300\"}`,\n          children: tab\n        }, tab, false, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 25\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-y-auto\",\n        children: activeTab === \"chat\" ? /*#__PURE__*/_jsxDEV(Chat, {\n          messages: messages,\n          onSendMessage: handleSendMessage,\n          currentUser: user\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 453,\n          columnNumber: 25\n        }, this) : activeTab === \"files\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 flex flex-col gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"btn-premium w-full !py-2 text-xs flex justify-center cursor-pointer\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: loadingFileUpload ? \"Uploading...\" : \"Share Asset\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 457,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"file\",\n              className: \"hidden\",\n              onChange: handleFileUpload\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 458,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 456,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-col gap-2\",\n            children: sharedFiles.map((file, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-3 bg-white/5 rounded-xl border border-white/5 flex items-center justify-between\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"text-xs truncate max-w-[150px]\",\n                children: file.fileName\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 463,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n                href: `${process.env.REACT_APP_API_URL}${file.fileUrl}`,\n                target: \"_blank\",\n                rel: \"noreferrer\",\n                className: \"text-primary-500\",\n                children: \"\\u2B07\\uFE0F\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 464,\n                columnNumber: 41\n              }, this)]\n            }, i, true, {\n              fileName: _jsxFileName,\n              lineNumber: 462,\n              columnNumber: 37\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 460,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 455,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 flex flex-col gap-2\",\n          children: participants.map((p, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center gap-2 p-2 bg-white/5 rounded-lg text-xs\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-2 h-2 rounded-full bg-green-500\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 473,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: p.userName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 474,\n              columnNumber: 37\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 33\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 470,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 379,\n    columnNumber: 9\n  }, this);\n};\n_s(WhiteboardRoom, \"WmtvOwDVRSKxB2FqtC/sNwX150k=\", false, function () {\n  return [useParams, useNavigate, useAuth, useSocket];\n});\n_c = WhiteboardRoom;\nexport default WhiteboardRoom;\nvar _c;\n$RefreshReg$(_c, \"WhiteboardRoom\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","useNavigate","useAuth","useSocket","roomService","Toolbar","Chat","toast","jsxDEV","_jsxDEV","WhiteboardRoom","_s","roomId","navigate","user","socket","canvasRef","contextRef","isDrawing","setIsDrawing","tool","setTool","color","setColor","size","setSize","room","setRoom","participants","setParticipants","messages","setMessages","sharedFiles","setSharedFiles","activeTab","setActiveTab","loadingFileUpload","setLoadingFileUpload","screenStream","setScreenStream","screenVideoRef","isSidebarOpen","setIsSidebarOpen","history","setHistory","historyIndex","setHistoryIndex","fetchRoomDetails","res","getRoom","data","err","error","emit","userId","_id","userName","name","on","success","users","msg","prev","file","fileName","drawRemote","eraseRemote","clearCanvasLocal","info","applyCanvasState","state","handleUndoEvent","handleUndo","handleRedoEvent","handleRedo","window","addEventListener","off","removeEventListener","canvas","current","container","parentElement","ResizeCanvas","rect","getBoundingClientRect","dpr","devicePixelRatio","tempCanvas","document","createElement","tempCtx","getContext","width","height","drawImage","style","context","scale","lineCap","lineJoin","resizeObserver","ResizeObserver","observe","dataURL","toDataURL","disconnect","image","Image","src","onload","clearRect","startDrawing","nativeEvent","offsetX","offsetY","beginPath","moveTo","draw","lineWidth","strokeStyle","globalCompositeOperation","lineTo","stroke","drawingData","x","y","eraseData","stopDrawing","closePath","newHistory","slice","push","length","shift","canvasData","newIndex","canvasState","prevGCO","prevStrokeStyle","prevLineWidth","arc","Math","PI","fillStyle","fill","handleSendMessage","text","message","handleClearBoard","host","confirm","handleDownload","link","href","download","roomName","click","handleShare","navigator","clipboard","writeText","location","handleFileUpload","e","target","files","formData","FormData","append","uploadFile","handleScreenShare","stream","mediaDevices","getDisplayMedia","video","getVideoTracks","onended","stopScreenShare","srcObject","getTracks","forEach","track","stop","className","children","onClick","_jsxFileName","lineNumber","columnNumber","onClear","isHost","ref","autoPlay","playsInline","muted","onMouseDown","onMouseMove","onMouseUp","onMouseOut","map","tab","onSendMessage","currentUser","type","onChange","i","process","env","REACT_APP_API_URL","fileUrl","rel","p","_c","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/pages/WhiteboardRoom.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\nimport { useSocket } from \"../context/SocketContext\";\r\nimport { roomService } from \"../services/api\";\r\nimport Toolbar from \"../components/Toolbar\";\r\nimport Chat from \"../components/Chat\";\r\nimport toast from \"react-hot-toast\";\r\n\r\nconst WhiteboardRoom = () => {\r\n    const { roomId } = useParams();\r\n    const navigate = useNavigate();\r\n    const { user } = useAuth();\r\n    const { socket } = useSocket();\r\n\r\n    const canvasRef = useRef(null);\r\n    const contextRef = useRef(null);\r\n    const [isDrawing, setIsDrawing] = useState(false);\r\n    const [tool, setTool] = useState(\"pencil\");\r\n    const [color, setColor] = useState(\"#000000\");\r\n    const [size, setSize] = useState(5);\r\n\r\n    const [room, setRoom] = useState(null);\r\n    const [participants, setParticipants] = useState([]);\r\n    const [messages, setMessages] = useState([]);\r\n    const [sharedFiles, setSharedFiles] = useState([]);\r\n    const [activeTab, setActiveTab] = useState(\"chat\");\r\n    const [loadingFileUpload, setLoadingFileUpload] = useState(false);\r\n    const [screenStream, setScreenStream] = useState(null);\r\n    const screenVideoRef = useRef(null);\r\n    const [isSidebarOpen, setIsSidebarOpen] = useState(false);\r\n\r\n    // History for Undo/Redo\r\n    const [history, setHistory] = useState([]);\r\n    const [historyIndex, setHistoryIndex] = useState(-1);\r\n\r\n    useEffect(() => {\r\n        const fetchRoomDetails = async () => {\r\n            try {\r\n                const res = await roomService.getRoom(roomId);\r\n                setRoom(res.data.room);\r\n                setSharedFiles(res.data.room.sharedFiles || []);\r\n            } catch (err) {\r\n                toast.error(\"Failed to load workspace\");\r\n                navigate(\"/dashboard\");\r\n            }\r\n        };\r\n\r\n        fetchRoomDetails();\r\n\r\n        if (socket) {\r\n            socket.emit(\"join-room\", { roomId, userId: user._id, userName: user.name });\r\n\r\n            socket.on(\"user-joined\", (data) => {\r\n                toast.success(`${data.userName} joined`);\r\n            });\r\n\r\n            socket.on(\"online-users\", (users) => {\r\n                setParticipants(users);\r\n            });\r\n\r\n            socket.on(\"chat-message\", (msg) => {\r\n                setMessages((prev) => [...prev, msg]);\r\n            });\r\n\r\n            socket.on(\"chat-history\", (history) => {\r\n                setMessages(history);\r\n            });\r\n\r\n            socket.on(\"new-file\", (file) => {\r\n                setSharedFiles((prev) => [file, ...prev]);\r\n                toast.success(`New file shared: ${file.fileName}`);\r\n            });\r\n\r\n            socket.on(\"drawing\", (data) => {\r\n                drawRemote(data);\r\n            });\r\n\r\n            socket.on(\"erase\", (data) => {\r\n                eraseRemote(data);\r\n            });\r\n\r\n            socket.on(\"board-cleared\", () => {\r\n                clearCanvasLocal();\r\n                setHistory([]);\r\n                setHistoryIndex(-1);\r\n                toast.info(\"Board cleared\");\r\n            });\r\n\r\n            socket.on(\"canvas-state\", (data) => {\r\n                if (data) {\r\n                    applyCanvasState(data);\r\n                    setHistory([data]);\r\n                    setHistoryIndex(0);\r\n                }\r\n            });\r\n\r\n            socket.on(\"undo\", (state) => {\r\n                applyCanvasState(state);\r\n            });\r\n\r\n            socket.on(\"redo\", (state) => {\r\n                applyCanvasState(state);\r\n            });\r\n\r\n            socket.on(\"error-message\", (msg) => {\r\n                toast.error(msg);\r\n            });\r\n        }\r\n\r\n        const handleUndoEvent = () => handleUndo();\r\n        const handleRedoEvent = () => handleRedo();\r\n\r\n        window.addEventListener('wb-undo', handleUndoEvent);\r\n        window.addEventListener('wb-redo', handleRedoEvent);\r\n\r\n        return () => {\r\n            if (socket) {\r\n                socket.emit(\"leave-room\", { roomId, userId: user._id, userName: user.name });\r\n                socket.off(\"user-joined\");\r\n                socket.off(\"online-users\");\r\n                socket.off(\"chat-message\");\r\n                socket.off(\"chat-history\");\r\n                socket.off(\"new-file\");\r\n                socket.off(\"drawing\");\r\n                socket.off(\"erase\");\r\n                socket.off(\"board-cleared\");\r\n                socket.off(\"canvas-state\");\r\n                socket.off(\"undo\");\r\n                socket.off(\"redo\");\r\n                socket.off(\"error-message\");\r\n            }\r\n            window.removeEventListener('wb-undo', handleUndoEvent);\r\n            window.removeEventListener('wb-redo', handleRedoEvent);\r\n        };\r\n    }, [roomId, socket, user, navigate]);\r\n\r\n    useEffect(() => {\r\n        const canvas = canvasRef.current;\r\n        const container = canvas.parentElement;\r\n\r\n        const ResizeCanvas = () => {\r\n            const rect = container.getBoundingClientRect();\r\n\r\n            // Handle high DPI displays\r\n            const dpr = window.devicePixelRatio || 1;\r\n\r\n            const tempCanvas = document.createElement('canvas');\r\n            const tempCtx = tempCanvas.getContext('2d');\r\n            tempCanvas.width = canvas.width;\r\n            tempCanvas.height = canvas.height;\r\n            tempCtx.drawImage(canvas, 0, 0);\r\n\r\n            canvas.width = rect.width * dpr;\r\n            canvas.height = rect.height * dpr;\r\n            canvas.style.width = `${rect.width}px`;\r\n            canvas.style.height = `${rect.height}px`;\r\n\r\n            const context = canvas.getContext(\"2d\");\r\n            context.scale(dpr, dpr);\r\n            context.lineCap = \"round\";\r\n            context.lineJoin = \"round\";\r\n            context.drawImage(tempCanvas, 0, 0, tempCanvas.width / dpr, tempCanvas.height / dpr, 0, 0, rect.width, rect.height);\r\n            contextRef.current = context;\r\n        };\r\n\r\n        const resizeObserver = new ResizeObserver(() => {\r\n            ResizeCanvas();\r\n        });\r\n        resizeObserver.observe(container);\r\n\r\n        ResizeCanvas();\r\n\r\n        const dataURL = canvas.toDataURL();\r\n        setHistory([dataURL]);\r\n        setHistoryIndex(0);\r\n\r\n        return () => resizeObserver.disconnect();\r\n    }, []);\r\n\r\n    const applyCanvasState = (state) => {\r\n        if (!state) {\r\n            clearCanvasLocal();\r\n            return;\r\n        }\r\n        const image = new Image();\r\n        image.src = state;\r\n        image.onload = () => {\r\n            clearCanvasLocal();\r\n            const canvas = canvasRef.current;\r\n            contextRef.current.drawImage(image, 0, 0, canvas.width / (window.devicePixelRatio || 1), canvas.height / (window.devicePixelRatio || 1));\r\n        };\r\n    };\r\n\r\n    const clearCanvasLocal = () => {\r\n        const canvas = canvasRef.current;\r\n        const dpr = window.devicePixelRatio || 1;\r\n        contextRef.current.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);\r\n    };\r\n\r\n    const startDrawing = ({ nativeEvent }) => {\r\n        const { offsetX, offsetY } = nativeEvent;\r\n        contextRef.current.beginPath();\r\n        contextRef.current.moveTo(offsetX, offsetY);\r\n        setIsDrawing(true);\r\n    };\r\n\r\n    const draw = ({ nativeEvent }) => {\r\n        if (!isDrawing) return;\r\n        const { offsetX, offsetY } = nativeEvent;\r\n        contextRef.current.lineWidth = size;\r\n\r\n        if (tool === \"pencil\") {\r\n            contextRef.current.strokeStyle = color;\r\n            contextRef.current.globalCompositeOperation = \"source-over\";\r\n            contextRef.current.lineTo(offsetX, offsetY);\r\n            contextRef.current.stroke();\r\n\r\n            socket.emit(\"drawing\", {\r\n                roomId,\r\n                drawingData: { x: offsetX, y: offsetY, color, size }\r\n            });\r\n        } else {\r\n            contextRef.current.globalCompositeOperation = \"destination-out\";\r\n            contextRef.current.lineTo(offsetX, offsetY);\r\n            contextRef.current.stroke();\r\n\r\n            socket.emit(\"erase\", {\r\n                roomId,\r\n                eraseData: { x: offsetX, y: offsetY, size: size * 2 }\r\n            });\r\n        }\r\n    };\r\n\r\n    const stopDrawing = () => {\r\n        if (!isDrawing) return;\r\n        contextRef.current.closePath();\r\n        setIsDrawing(false);\r\n\r\n        const dataURL = canvasRef.current.toDataURL();\r\n        const newHistory = history.slice(0, historyIndex + 1);\r\n        newHistory.push(dataURL);\r\n        if (newHistory.length > 50) newHistory.shift();\r\n\r\n        setHistory(newHistory);\r\n        setHistoryIndex(newHistory.length - 1);\r\n        socket.emit(\"save-canvas\", { roomId, canvasData: dataURL });\r\n    };\r\n\r\n    const handleUndo = () => {\r\n        if (historyIndex > 0) {\r\n            const newIndex = historyIndex - 1;\r\n            const state = history[newIndex];\r\n            setHistoryIndex(newIndex);\r\n            applyCanvasState(state);\r\n            socket.emit(\"undo\", { roomId, canvasState: state });\r\n            socket.emit(\"save-canvas\", { roomId, canvasData: state });\r\n        }\r\n    };\r\n\r\n    const handleRedo = () => {\r\n        if (historyIndex < history.length - 1) {\r\n            const newIndex = historyIndex + 1;\r\n            const state = history[newIndex];\r\n            setHistoryIndex(newIndex);\r\n            applyCanvasState(state);\r\n            socket.emit(\"redo\", { roomId, canvasState: state });\r\n            socket.emit(\"save-canvas\", { roomId, canvasData: state });\r\n        }\r\n    };\r\n\r\n    const drawRemote = (data) => {\r\n        const { x, y, color, size } = data;\r\n        const context = contextRef.current;\r\n        const prevGCO = context.globalCompositeOperation;\r\n        const prevStrokeStyle = context.strokeStyle;\r\n        const prevLineWidth = context.lineWidth;\r\n\r\n        context.globalCompositeOperation = \"source-over\";\r\n        context.strokeStyle = color;\r\n        context.lineWidth = size;\r\n        context.beginPath();\r\n        context.arc(x, y, size / 2, 0, Math.PI * 2);\r\n        context.fillStyle = color;\r\n        context.fill();\r\n\r\n        context.globalCompositeOperation = prevGCO;\r\n        context.strokeStyle = prevStrokeStyle;\r\n        context.lineWidth = prevLineWidth;\r\n    };\r\n\r\n    const eraseRemote = (data) => {\r\n        const { x, y, size } = data;\r\n        const context = contextRef.current;\r\n        const prevGCO = context.globalCompositeOperation;\r\n        const prevLineWidth = context.lineWidth;\r\n\r\n        context.globalCompositeOperation = \"destination-out\";\r\n        context.lineWidth = size;\r\n        context.beginPath();\r\n        context.arc(x, y, size, 0, Math.PI * 2);\r\n        context.fill();\r\n\r\n        context.globalCompositeOperation = prevGCO;\r\n        context.lineWidth = prevLineWidth;\r\n    };\r\n\r\n    const handleSendMessage = (text) => {\r\n        if (socket) {\r\n            socket.emit(\"chat-message\", { roomId, message: text, userId: user._id, userName: user.name });\r\n        }\r\n    };\r\n\r\n    const handleClearBoard = () => {\r\n        if (user._id !== room?.host) {\r\n            toast.error(\"Only host can clear\");\r\n            return;\r\n        }\r\n        if (window.confirm(\"Clear board?\")) {\r\n            socket.emit(\"clear-board\", { roomId, userId: user._id });\r\n        }\r\n    };\r\n\r\n    const handleDownload = () => {\r\n        const canvas = canvasRef.current;\r\n        const dataURL = canvas.toDataURL(\"image/png\");\r\n        const link = document.createElement(\"a\");\r\n        link.href = dataURL;\r\n        link.download = `board-${room?.roomName || \"whiteboard\"}.png`;\r\n        link.click();\r\n    };\r\n\r\n    const handleShare = () => {\r\n        navigator.clipboard.writeText(window.location.href);\r\n        toast.success(\"Link copied!\");\r\n    };\r\n\r\n    const handleFileUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        const formData = new FormData();\r\n        formData.append(\"file\", file);\r\n\r\n        setLoadingFileUpload(true);\r\n        try {\r\n            const res = await roomService.uploadFile(roomId, formData);\r\n            socket.emit(\"file-shared\", { roomId, file: res.data.file });\r\n            setSharedFiles((prev) => [res.data.file, ...prev]);\r\n            toast.success(\"File shared!\");\r\n        } catch (err) {\r\n            toast.error(\"Upload failed\");\r\n        } finally {\r\n            setLoadingFileUpload(false);\r\n        }\r\n    };\r\n\r\n    const handleScreenShare = async () => {\r\n        try {\r\n            const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });\r\n            setScreenStream(stream);\r\n            stream.getVideoTracks()[0].onended = () => stopScreenShare();\r\n            if (screenVideoRef.current) screenVideoRef.current.srcObject = stream;\r\n            socket.emit(\"screen-share-started\", { roomId, userId: user._id, userName: user.name });\r\n        } catch (err) {\r\n            toast.error(\"Screen share failed\");\r\n        }\r\n    };\r\n\r\n    const stopScreenShare = () => {\r\n        if (screenStream) {\r\n            screenStream.getTracks().forEach(track => track.stop());\r\n            setScreenStream(null);\r\n            socket.emit(\"screen-share-stopped\", { roomId });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"wb-grid-container\">\r\n            {/* wb-header component mapping implicitly to row 1 */}\r\n            <header className=\"wb-header glass flex items-center justify-between px-6 z-50\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <div className=\"flex items-center gap-3 cursor-pointer\" onClick={() => navigate('/dashboard')}>\r\n                        <div className=\"w-8 h-8 rounded-lg bg-primary-600 flex items-center justify-center font-black\">C</div>\r\n                        <h1 className=\"font-bold text-lg hidden md:block\">{room?.roomName}</h1>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/10 text-xs\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-green-500\"></div>\r\n                        <span>ID: {roomId}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex items-center gap-3\">\r\n                    <button className=\"hidden sm:block text-xs font-bold text-slate-400 hover:text-white transition-colors\" onClick={handleShare}>Invite</button>\r\n                    <button className=\"btn-secondary-premium !py-1.5 !px-4 text-xs\" onClick={screenStream ? stopScreenShare : handleScreenShare}>\r\n                        {screenStream ? \"Stop Share\" : \"Share Stream\"}\r\n                    </button>\r\n                    <button className=\"btn-premium !py-1.5 !px-4 text-xs\" onClick={() => setIsSidebarOpen(!isSidebarOpen)}>\r\n                        Chat\r\n                    </button>\r\n                </div>\r\n            </header>\r\n\r\n            {/* tools sidebar */}\r\n            <aside className=\"wb-sidebar-left flex flex-col items-center py-6 gap-6 bg-slate-900/50\">\r\n                <Toolbar\r\n                    tool={tool}\r\n                    setTool={setTool}\r\n                    color={color}\r\n                    setColor={setColor}\r\n                    size={size}\r\n                    setSize={setSize}\r\n                    onClear={handleClearBoard}\r\n                    isHost={user._id === room?.host}\r\n                />\r\n            </aside>\r\n\r\n            {/* Main Canvas */}\r\n            <main className=\"wb-canvas-main\">\r\n                {screenStream && (\r\n                    <div className=\"absolute inset-0 z-40 bg-black/90 flex flex-col items-center justify-center\">\r\n                        <video ref={screenVideoRef} autoPlay playsInline muted className=\"max-w-[90%] max-h-[80%] rounded-xl\" />\r\n                        <p className=\"mt-4 text-sm font-bold animate-pulse text-red-500\">YOU ARE SHARING SCREEN</p>\r\n                    </div>\r\n                )}\r\n                <canvas\r\n                    ref={canvasRef}\r\n                    onMouseDown={startDrawing}\r\n                    onMouseMove={draw}\r\n                    onMouseUp={stopDrawing}\r\n                    onMouseOut={stopDrawing}\r\n                    className=\"cursor-crosshair w-full h-full\"\r\n                />\r\n            </main>\r\n\r\n            {/* Chat Sidebar */}\r\n            <aside className={`wb-sidebar-right glass flex flex-col ${isSidebarOpen ? 'open' : ''}`}>\r\n                <div className=\"flex p-3 bg-white/5 border-b border-white/5\">\r\n                    {['chat', 'files', 'users'].map((tab) => (\r\n                        <button\r\n                            key={tab}\r\n                            onClick={() => setActiveTab(tab)}\r\n                            className={`flex-1 py-1.5 rounded-lg text-xs font-bold transition-all uppercase tracking-widest\r\n                                      ${activeTab === tab ? \"bg-primary-600 text-white\" : \"text-slate-500 hover:text-slate-300\"}`}\r\n                        >\r\n                            {tab}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n\r\n                <div className=\"flex-1 overflow-y-auto\">\r\n                    {activeTab === \"chat\" ? (\r\n                        <Chat messages={messages} onSendMessage={handleSendMessage} currentUser={user} />\r\n                    ) : activeTab === \"files\" ? (\r\n                        <div className=\"p-4 flex flex-col gap-4\">\r\n                            <label className=\"btn-premium w-full !py-2 text-xs flex justify-center cursor-pointer\">\r\n                                <span>{loadingFileUpload ? \"Uploading...\" : \"Share Asset\"}</span>\r\n                                <input type=\"file\" className=\"hidden\" onChange={handleFileUpload} />\r\n                            </label>\r\n                            <div className=\"flex flex-col gap-2\">\r\n                                {sharedFiles.map((file, i) => (\r\n                                    <div key={i} className=\"p-3 bg-white/5 rounded-xl border border-white/5 flex items-center justify-between\">\r\n                                        <div className=\"text-xs truncate max-w-[150px]\">{file.fileName}</div>\r\n                                        <a href={`${process.env.REACT_APP_API_URL}${file.fileUrl}`} target=\"_blank\" rel=\"noreferrer\" className=\"text-primary-500\">⬇️</a>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"p-4 flex flex-col gap-2\">\r\n                            {participants.map((p, i) => (\r\n                                <div key={i} className=\"flex items-center gap-2 p-2 bg-white/5 rounded-lg text-xs\">\r\n                                    <div className=\"w-2 h-2 rounded-full bg-green-500\"></div>\r\n                                    <span>{p.userName}</span>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </aside>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WhiteboardRoom;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}