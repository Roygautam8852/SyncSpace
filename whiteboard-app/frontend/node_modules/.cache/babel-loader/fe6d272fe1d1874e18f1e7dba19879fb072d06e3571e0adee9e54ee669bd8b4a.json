{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\components\\\\video\\\\WebRTCMeeting.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, Minimize2, Maximize2, GripHorizontal } from 'lucide-react';\nimport toast from 'react-hot-toast';\n\n/**\r\n * WebRTCMeeting â€” Zoom-like group call via P2P mesh.\r\n *\r\n * Key guarantees:\r\n * - NEVER creates a peer connection to self (filters own socketId)\r\n * - Only one mesh:join emission per mount (joinedRef guard)\r\n * - ICE candidates are queued until remoteDescription is set\r\n * - Local <video> always has `muted` to prevent echo\r\n * - Mute uses track.enabled (not track.stop) so unmute works\r\n * - Only one RTCPeerConnection per remote socketId\r\n * - Broadcasts mic/cam state to all peers via socket so remote tiles\r\n *   can show avatar (cam off) and mute icon (mic off)\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WebRTCMeeting = ({\n  socket,\n  roomId,\n  username,\n  onLeave\n}) => {\n  _s();\n  var _username$;\n  const [localStream, setLocalStream] = useState(null);\n  const [peers, setPeers] = useState({});\n  const [isMicEnabled, setIsMicEnabled] = useState(true);\n  const [isCamEnabled, setIsCamEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [isMinimized, setIsMinimized] = useState(false);\n\n  // Track remote peer media states:  { [socketId]: { mic: bool, cam: bool } }\n  const [remotePeerStates, setRemotePeerStates] = useState({});\n  const localVideoRef = useRef(null);\n  const streamRef = useRef(null);\n  const screenRef = useRef(null);\n  const peersRef = useRef({});\n  const componentMounted = useRef(true);\n  const joinedRef = useRef(false); // Prevent duplicate mesh:join\n  const onLeaveRef = useRef(onLeave);\n  useEffect(() => {\n    onLeaveRef.current = onLeave;\n  }, [onLeave]);\n\n  // Drag\n  const containerRef = useRef(null);\n  const isDragging = useRef(false);\n  const dragOffset = useRef({\n    x: 0,\n    y: 0\n  });\n  const [position, setPosition] = useState({\n    x: 16,\n    y: 70\n  });\n  const rtcConfig = useRef({\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }]\n  }).current;\n\n  // â”€â”€ Flush queued ICE candidates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  const flushCandidates = useCallback(async socketId => {\n    var _peer$pc$remoteDescri;\n    const peer = peersRef.current[socketId];\n    if (!(peer !== null && peer !== void 0 && peer.pc) || !((_peer$pc$remoteDescri = peer.pc.remoteDescription) !== null && _peer$pc$remoteDescri !== void 0 && _peer$pc$remoteDescri.type)) return;\n    while (((_peer$candidateQueue = peer.candidateQueue) === null || _peer$candidateQueue === void 0 ? void 0 : _peer$candidateQueue.length) > 0) {\n      var _peer$candidateQueue;\n      const c = peer.candidateQueue.shift();\n      try {\n        await peer.pc.addIceCandidate(new RTCIceCandidate(c));\n      } catch (_) {}\n    }\n  }, []);\n\n  // â”€â”€ Push ref state â†’ React state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  const syncPeersState = useCallback(() => {\n    const snap = {};\n    Object.entries(peersRef.current).forEach(([id, p]) => {\n      snap[id] = {\n        stream: p.stream,\n        username: p.username\n      };\n    });\n    setPeers(snap);\n  }, []);\n\n  // â”€â”€ Remove a peer cleanly â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  const removePeer = useCallback(socketId => {\n    const peer = peersRef.current[socketId];\n    if (peer) {\n      try {\n        var _peer$pc;\n        (_peer$pc = peer.pc) === null || _peer$pc === void 0 ? void 0 : _peer$pc.close();\n      } catch (_) {}\n      delete peersRef.current[socketId];\n      syncPeersState();\n      // Also remove their media state\n      setRemotePeerStates(prev => {\n        const n = {\n          ...prev\n        };\n        delete n[socketId];\n        return n;\n      });\n    }\n  }, [syncPeersState]);\n\n  // â”€â”€ Create ONE PeerConnection per remote socketId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  const createPeer = useCallback((targetSocketId, targetUsername, stream, isInitiator) => {\n    // NEVER connect to self\n    if (targetSocketId === (socket === null || socket === void 0 ? void 0 : socket.id)) return null;\n\n    // If we already have a live PC for this peer, return it\n    const existing = peersRef.current[targetSocketId];\n    if (existing !== null && existing !== void 0 && existing.pc) {\n      const state = existing.pc.connectionState || existing.pc.iceConnectionState;\n      if (state !== 'closed' && state !== 'failed') {\n        return existing.pc;\n      }\n      // Dead connection â€” clean up\n      try {\n        existing.pc.close();\n      } catch (_) {}\n    }\n    const pc = new RTCPeerConnection(rtcConfig);\n\n    // Add every local track\n    stream.getTracks().forEach(track => pc.addTrack(track, stream));\n\n    // Store immediately with candidate queue\n    peersRef.current[targetSocketId] = {\n      pc,\n      stream: null,\n      username: targetUsername,\n      candidateQueue: []\n    };\n\n    // â”€â”€ Remote tracks â”€â”€\n    pc.ontrack = event => {\n      var _event$streams;\n      const rStream = (_event$streams = event.streams) === null || _event$streams === void 0 ? void 0 : _event$streams[0];\n      if (!rStream) return;\n      const entry = peersRef.current[targetSocketId];\n      if (entry) entry.stream = rStream;\n      syncPeersState();\n    };\n\n    // â”€â”€ ICE candidates â†’ remote â”€â”€\n    pc.onicecandidate = event => {\n      if (event.candidate) {\n        socket.emit('mesh:candidate', {\n          roomId,\n          to: targetSocketId,\n          candidate: event.candidate\n        });\n      }\n    };\n\n    // â”€â”€ Connection state changes â”€â”€\n    pc.oniceconnectionstatechange = () => {\n      const s = pc.iceConnectionState;\n      if (s === 'connected' || s === 'completed') syncPeersState();\n      if (s === 'failed') removePeer(targetSocketId);\n    };\n    syncPeersState();\n\n    // Initiator sends offer\n    if (isInitiator) {\n      (async () => {\n        try {\n          const offer = await pc.createOffer();\n          await pc.setLocalDescription(offer);\n          socket.emit('mesh:offer', {\n            roomId,\n            to: targetSocketId,\n            offer: pc.localDescription\n          });\n        } catch (err) {\n          console.error('[Mesh] Offer error:', err);\n        }\n      })();\n    }\n    return pc;\n  }, [socket, roomId, rtcConfig, removePeer, syncPeersState]);\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  //  1. Get media â†’ join call (runs ONCE per mount)\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  useEffect(() => {\n    componentMounted.current = true;\n    joinedRef.current = false;\n    const start = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: {\n            echoCancellation: true,\n            noiseSuppression: true\n          }\n        });\n        if (!componentMounted.current) {\n          stream.getTracks().forEach(t => t.stop());\n          return;\n        }\n        streamRef.current = stream;\n        setLocalStream(stream);\n\n        // Attach to <video> â€” always muted to prevent echo\n        if (localVideoRef.current) {\n          localVideoRef.current.srcObject = stream;\n          localVideoRef.current.muted = true;\n        }\n\n        // Emit mesh:join exactly once\n        if (!joinedRef.current) {\n          joinedRef.current = true;\n          socket.emit('mesh:join', {\n            roomId,\n            username\n          });\n        }\n      } catch (err) {\n        console.error('[WebRTC] Media error:', err);\n        toast.error('Could not access camera or microphone.');\n      }\n    };\n    start();\n    return () => {\n      componentMounted.current = false;\n      joinedRef.current = false;\n\n      // Close every peer connection\n      Object.keys(peersRef.current).forEach(id => {\n        try {\n          var _peersRef$current$id, _peersRef$current$id$;\n          (_peersRef$current$id = peersRef.current[id]) === null || _peersRef$current$id === void 0 ? void 0 : (_peersRef$current$id$ = _peersRef$current$id.pc) === null || _peersRef$current$id$ === void 0 ? void 0 : _peersRef$current$id$.close();\n        } catch (_) {}\n      });\n      peersRef.current = {};\n\n      // Stop local tracks\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(t => t.stop());\n        streamRef.current = null;\n      }\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n    };\n    // eslint-disable-next-line\n  }, []); // Empty deps â€” run once on mount, clean up on unmount\n\n  // â”€â”€ Re-attach local video srcObject when un-minimizing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  useEffect(() => {\n    if (!isMinimized && localVideoRef.current) {\n      const activeStream = screenRef.current || streamRef.current;\n      if (activeStream) {\n        localVideoRef.current.srcObject = activeStream;\n        localVideoRef.current.muted = true;\n        localVideoRef.current.play().catch(() => {});\n      }\n    }\n  }, [isMinimized]);\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  //  2. Socket signaling (mesh topology)\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  useEffect(() => {\n    if (!socket) return;\n    const myId = socket.id;\n\n    // Server sends existing call participants\n    const onExistingPeers = ({\n      peers: existingPeers\n    }) => {\n      if (!streamRef.current) return;\n      existingPeers.forEach(p => {\n        // Never connect to self\n        if (p.socketId === myId) return;\n        createPeer(p.socketId, p.username, streamRef.current, true);\n      });\n\n      // Send our current media state to all existing peers\n      socket.emit('mesh:media-state', {\n        roomId,\n        mic: true,\n        cam: true\n      });\n    };\n\n    // A new peer joined â€” pre-create PC (they will send us an offer)\n    const onNewPeer = ({\n      socketId,\n      username: peerName\n    }) => {\n      var _streamRef$current, _streamRef$current2, _audioTrack$enabled, _videoTrack$enabled;\n      if (!streamRef.current || socketId === myId) return;\n      createPeer(socketId, peerName, streamRef.current, false);\n\n      // Send our current media state to the new peer\n      const audioTrack = (_streamRef$current = streamRef.current) === null || _streamRef$current === void 0 ? void 0 : _streamRef$current.getAudioTracks()[0];\n      const videoTrack = (_streamRef$current2 = streamRef.current) === null || _streamRef$current2 === void 0 ? void 0 : _streamRef$current2.getVideoTracks()[0];\n      socket.emit('mesh:media-state', {\n        roomId,\n        mic: (_audioTrack$enabled = audioTrack === null || audioTrack === void 0 ? void 0 : audioTrack.enabled) !== null && _audioTrack$enabled !== void 0 ? _audioTrack$enabled : true,\n        cam: (_videoTrack$enabled = videoTrack === null || videoTrack === void 0 ? void 0 : videoTrack.enabled) !== null && _videoTrack$enabled !== void 0 ? _videoTrack$enabled : true\n      });\n    };\n\n    // Receive offer\n    const onOffer = async ({\n      from,\n      offer,\n      username: peerName\n    }) => {\n      if (!streamRef.current || from === myId) return;\n      let peer = peersRef.current[from];\n      let pc;\n      if (!(peer !== null && peer !== void 0 && peer.pc) || peer.pc.signalingState === 'closed') {\n        pc = createPeer(from, peerName, streamRef.current, false);\n      } else {\n        pc = peer.pc;\n        if (peerName) peersRef.current[from].username = peerName;\n      }\n      if (!pc) return;\n      try {\n        // Glare: both sides sent offers â€” higher ID yields\n        if (pc.signalingState === 'have-local-offer') {\n          if (myId > from) {\n            await pc.setLocalDescription({\n              type: 'rollback'\n            });\n          } else {\n            return;\n          }\n        }\n        await pc.setRemoteDescription(new RTCSessionDescription(offer));\n        await flushCandidates(from);\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        socket.emit('mesh:answer', {\n          roomId,\n          to: from,\n          answer: pc.localDescription\n        });\n      } catch (e) {\n        console.error('[Mesh] Offer handling error:', e);\n      }\n    };\n\n    // Receive answer\n    const onAnswer = async ({\n      from,\n      answer\n    }) => {\n      const peer = peersRef.current[from];\n      if (!(peer !== null && peer !== void 0 && peer.pc) || peer.pc.signalingState !== 'have-local-offer') return;\n      try {\n        await peer.pc.setRemoteDescription(new RTCSessionDescription(answer));\n        await flushCandidates(from);\n      } catch (e) {\n        console.error('[Mesh] Answer error:', e);\n      }\n    };\n\n    // Receive ICE candidate â€” queue if remote description not ready\n    const onCandidate = async ({\n      from,\n      candidate\n    }) => {\n      var _peer$pc$remoteDescri2;\n      const peer = peersRef.current[from];\n      if (!(peer !== null && peer !== void 0 && peer.pc)) return;\n      if ((_peer$pc$remoteDescri2 = peer.pc.remoteDescription) !== null && _peer$pc$remoteDescri2 !== void 0 && _peer$pc$remoteDescri2.type) {\n        try {\n          await peer.pc.addIceCandidate(new RTCIceCandidate(candidate));\n        } catch (_) {}\n      } else {\n        peer.candidateQueue = peer.candidateQueue || [];\n        peer.candidateQueue.push(candidate);\n      }\n    };\n\n    // A peer left\n    const onPeerLeft = ({\n      socketId\n    }) => removePeer(socketId);\n\n    // Call creator ended the call â€” everyone must leave\n    const onCallEnded = () => {\n      console.log('[Mesh] Call ended by creator â€” cleaning up');\n      // Close all peer connections\n      Object.keys(peersRef.current).forEach(id => {\n        try {\n          var _peersRef$current$id2, _peersRef$current$id3;\n          (_peersRef$current$id2 = peersRef.current[id]) === null || _peersRef$current$id2 === void 0 ? void 0 : (_peersRef$current$id3 = _peersRef$current$id2.pc) === null || _peersRef$current$id3 === void 0 ? void 0 : _peersRef$current$id3.close();\n        } catch (_) {}\n      });\n      peersRef.current = {};\n      // Stop local media tracks\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(t => t.stop());\n        streamRef.current = null;\n      }\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n      toast('ðŸ“ž Call ended by the host', {\n        icon: 'ðŸ“ž'\n      });\n      onLeaveRef.current();\n    };\n\n    // Remote peer toggled mic/cam â€” update UI state\n    const onMediaState = ({\n      from,\n      mic,\n      cam\n    }) => {\n      setRemotePeerStates(prev => ({\n        ...prev,\n        [from]: {\n          mic,\n          cam\n        }\n      }));\n    };\n    socket.on('mesh:existing-peers', onExistingPeers);\n    socket.on('mesh:new-peer', onNewPeer);\n    socket.on('mesh:offer', onOffer);\n    socket.on('mesh:answer', onAnswer);\n    socket.on('mesh:candidate', onCandidate);\n    socket.on('mesh:peer-left', onPeerLeft);\n    socket.on('mesh:call-ended', onCallEnded);\n    socket.on('mesh:media-state', onMediaState);\n    return () => {\n      socket.off('mesh:existing-peers', onExistingPeers);\n      socket.off('mesh:new-peer', onNewPeer);\n      socket.off('mesh:offer', onOffer);\n      socket.off('mesh:answer', onAnswer);\n      socket.off('mesh:candidate', onCandidate);\n      socket.off('mesh:peer-left', onPeerLeft);\n      socket.off('mesh:call-ended', onCallEnded);\n      socket.off('mesh:media-state', onMediaState);\n    };\n  }, [socket, roomId, createPeer, removePeer, flushCandidates]);\n\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  //  Controls\n  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n  const toggleMic = () => {\n    var _streamRef$current3, _streamRef$current4, _videoTrack$enabled2;\n    const audioTrack = (_streamRef$current3 = streamRef.current) === null || _streamRef$current3 === void 0 ? void 0 : _streamRef$current3.getAudioTracks()[0];\n    if (!audioTrack) return;\n    const newEnabled = !audioTrack.enabled;\n\n    // 1. Toggle on the local stream track\n    audioTrack.enabled = newEnabled;\n\n    // 2. Also propagate to every peer connection's audio sender\n    Object.values(peersRef.current).forEach(({\n      pc\n    }) => {\n      var _pc$getSenders;\n      if (!pc) return;\n      const senders = ((_pc$getSenders = pc.getSenders) === null || _pc$getSenders === void 0 ? void 0 : _pc$getSenders.call(pc)) || [];\n      senders.forEach(sender => {\n        if (sender.track && sender.track.kind === 'audio') {\n          sender.track.enabled = newEnabled;\n        }\n      });\n    });\n    setIsMicEnabled(newEnabled);\n\n    // 3. Broadcast state to all peers via socket\n    const videoTrack = (_streamRef$current4 = streamRef.current) === null || _streamRef$current4 === void 0 ? void 0 : _streamRef$current4.getVideoTracks()[0];\n    socket.emit('mesh:media-state', {\n      roomId,\n      mic: newEnabled,\n      cam: (_videoTrack$enabled2 = videoTrack === null || videoTrack === void 0 ? void 0 : videoTrack.enabled) !== null && _videoTrack$enabled2 !== void 0 ? _videoTrack$enabled2 : isCamEnabled\n    });\n  };\n  const toggleCam = () => {\n    var _streamRef$current5, _streamRef$current6, _audioTrack$enabled2;\n    const videoTrack = (_streamRef$current5 = streamRef.current) === null || _streamRef$current5 === void 0 ? void 0 : _streamRef$current5.getVideoTracks()[0];\n    if (!videoTrack) return;\n    const newEnabled = !videoTrack.enabled;\n    videoTrack.enabled = newEnabled;\n\n    // Also propagate to every peer connection's video sender\n    Object.values(peersRef.current).forEach(({\n      pc\n    }) => {\n      var _pc$getSenders2;\n      if (!pc) return;\n      const senders = ((_pc$getSenders2 = pc.getSenders) === null || _pc$getSenders2 === void 0 ? void 0 : _pc$getSenders2.call(pc)) || [];\n      senders.forEach(sender => {\n        if (sender.track && sender.track.kind === 'video') {\n          sender.track.enabled = newEnabled;\n        }\n      });\n    });\n    setIsCamEnabled(newEnabled);\n\n    // Broadcast state to all peers via socket\n    const audioTrack = (_streamRef$current6 = streamRef.current) === null || _streamRef$current6 === void 0 ? void 0 : _streamRef$current6.getAudioTracks()[0];\n    socket.emit('mesh:media-state', {\n      roomId,\n      mic: (_audioTrack$enabled2 = audioTrack === null || audioTrack === void 0 ? void 0 : audioTrack.enabled) !== null && _audioTrack$enabled2 !== void 0 ? _audioTrack$enabled2 : isMicEnabled,\n      cam: newEnabled\n    });\n  };\n  const toggleScreenShare = async () => {\n    if (isScreenSharing) {\n      var _streamRef$current7;\n      if (screenRef.current) {\n        screenRef.current.getTracks().forEach(t => t.stop());\n        screenRef.current = null;\n      }\n      const camTrack = (_streamRef$current7 = streamRef.current) === null || _streamRef$current7 === void 0 ? void 0 : _streamRef$current7.getVideoTracks()[0];\n      Object.values(peersRef.current).forEach(({\n        pc\n      }) => {\n        var _pc$getSenders3, _pc$getSenders3$call;\n        const sender = pc === null || pc === void 0 ? void 0 : (_pc$getSenders3 = pc.getSenders) === null || _pc$getSenders3 === void 0 ? void 0 : (_pc$getSenders3$call = _pc$getSenders3.call(pc)) === null || _pc$getSenders3$call === void 0 ? void 0 : _pc$getSenders3$call.find(s => {\n          var _s$track;\n          return ((_s$track = s.track) === null || _s$track === void 0 ? void 0 : _s$track.kind) === 'video';\n        });\n        if (sender && camTrack) sender.replaceTrack(camTrack);\n      });\n      if (localVideoRef.current && streamRef.current) localVideoRef.current.srcObject = streamRef.current;\n      setIsScreenSharing(false);\n    } else {\n      try {\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({\n          video: true\n        });\n        screenRef.current = screenStream;\n        const screenTrack = screenStream.getVideoTracks()[0];\n        Object.values(peersRef.current).forEach(({\n          pc\n        }) => {\n          var _pc$getSenders4, _pc$getSenders4$call;\n          const sender = pc === null || pc === void 0 ? void 0 : (_pc$getSenders4 = pc.getSenders) === null || _pc$getSenders4 === void 0 ? void 0 : (_pc$getSenders4$call = _pc$getSenders4.call(pc)) === null || _pc$getSenders4$call === void 0 ? void 0 : _pc$getSenders4$call.find(s => {\n            var _s$track2;\n            return ((_s$track2 = s.track) === null || _s$track2 === void 0 ? void 0 : _s$track2.kind) === 'video';\n          });\n          if (sender) sender.replaceTrack(screenTrack);\n        });\n        if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\n        screenTrack.onended = () => toggleScreenShare();\n        setIsScreenSharing(true);\n      } catch (_) {}\n    }\n  };\n  const handleLeave = () => {\n    socket.emit('mesh:leave', {\n      roomId\n    });\n    Object.keys(peersRef.current).forEach(id => {\n      try {\n        var _peersRef$current$id4, _peersRef$current$id5;\n        (_peersRef$current$id4 = peersRef.current[id]) === null || _peersRef$current$id4 === void 0 ? void 0 : (_peersRef$current$id5 = _peersRef$current$id4.pc) === null || _peersRef$current$id5 === void 0 ? void 0 : _peersRef$current$id5.close();\n      } catch (_) {}\n    });\n    peersRef.current = {};\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(t => t.stop());\n      streamRef.current = null;\n    }\n    if (screenRef.current) {\n      screenRef.current.getTracks().forEach(t => t.stop());\n      screenRef.current = null;\n    }\n    onLeaveRef.current();\n  };\n\n  // â”€â”€ Drag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  const onDragStart = e => {\n    isDragging.current = true;\n    const rect = containerRef.current.getBoundingClientRect();\n    dragOffset.current = {\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top\n    };\n    const move = ev => {\n      if (!isDragging.current) return;\n      setPosition({\n        x: Math.max(0, Math.min(window.innerWidth - 120, ev.clientX - dragOffset.current.x)),\n        y: Math.max(0, Math.min(window.innerHeight - 80, ev.clientY - dragOffset.current.y))\n      });\n    };\n    const up = () => {\n      isDragging.current = false;\n      document.removeEventListener('mousemove', move);\n      document.removeEventListener('mouseup', up);\n    };\n    document.addEventListener('mousemove', move);\n    document.addEventListener('mouseup', up);\n  };\n\n  // â”€â”€ Only render remote peers that are alive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  const peerEntries = Object.entries(peers).filter(([id]) => id !== (socket === null || socket === void 0 ? void 0 : socket.id) // Extra safety: never render self as remote\n  );\n  const participantCount = 1 + peerEntries.length;\n\n  // â”€â”€ Minimized â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  if (isMinimized) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: containerRef,\n      className: \"wbrtc-floating wbrtc-minimized\",\n      style: {\n        left: position.x,\n        top: position.y\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-mini-bar\",\n        onMouseDown: onDragStart,\n        children: [/*#__PURE__*/_jsxDEV(GripHorizontal, {\n          size: 14,\n          className: \"wbrtc-grip\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 518,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-mini-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"wbrtc-mini-dot\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 520,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [participantCount, \" in call\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 521,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 519,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn\",\n          onClick: () => setIsMinimized(false),\n          title: \"Expand\",\n          children: /*#__PURE__*/_jsxDEV(Maximize2, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 523,\n            columnNumber: 109\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 523,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn wbrtc-mini-leave\",\n          onClick: handleLeave,\n          title: \"Leave\",\n          children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 524,\n            columnNumber: 109\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 516,\n      columnNumber: 13\n    }, this);\n  }\n\n  // â”€â”€ Full floating window â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: containerRef,\n    className: \"wbrtc-floating\",\n    style: {\n      left: position.x,\n      top: position.y\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-drag-bar\",\n      onMouseDown: onDragStart,\n      children: [/*#__PURE__*/_jsxDEV(GripHorizontal, {\n        size: 14,\n        className: \"wbrtc-grip\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"wbrtc-drag-title\",\n        children: [participantCount, \" in call\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 536,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-drag-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wbrtc-mini-btn\",\n          onClick: () => setIsMinimized(true),\n          title: \"Minimize\",\n          children: /*#__PURE__*/_jsxDEV(Minimize2, {\n            size: 13\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 538,\n            columnNumber: 110\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 538,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 537,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 534,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-grid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-tile\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localVideoRef,\n          autoPlay: true,\n          muted: true /* â† ALWAYS muted to prevent echo */,\n          playsInline: true,\n          className: \"wbrtc-tile-video wbrtc-tile-mirror\",\n          style: {\n            display: !isCamEnabled && !isScreenSharing ? 'none' : 'block'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 546,\n          columnNumber: 21\n        }, this), !isCamEnabled && !isScreenSharing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile-avatar\",\n          children: username === null || username === void 0 ? void 0 : (_username$ = username[0]) === null || _username$ === void 0 ? void 0 : _username$.toUpperCase()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 555,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile-name\",\n          children: [username, \" (You)\", !isMicEnabled && /*#__PURE__*/_jsxDEV(MicOff, {\n            size: 10,\n            className: \"wbrtc-tile-muted\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 559,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 557,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 545,\n        columnNumber: 17\n      }, this), peerEntries.map(([socketId, peer]) => {\n        var _2;\n        const remoteState = remotePeerStates[socketId];\n        const remoteCamOff = remoteState ? !remoteState.cam : false;\n        const remoteMicOff = remoteState ? !remoteState.mic : false;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wbrtc-tile\",\n          children: [peer.stream && !remoteCamOff ? /*#__PURE__*/_jsxDEV(RemoteVideo, {\n            stream: peer.stream\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 572,\n            columnNumber: 33\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wbrtc-tile-avatar\",\n            children: (_2 = (peer.username || '?')[0]) === null || _2 === void 0 ? void 0 : _2.toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 574,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wbrtc-tile-name\",\n            children: [peer.username || 'Participant', remoteMicOff && /*#__PURE__*/_jsxDEV(MicOff, {\n              size: 10,\n              className: \"wbrtc-tile-muted\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 580,\n              columnNumber: 50\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 578,\n            columnNumber: 29\n          }, this)]\n        }, socketId, true, {\n          fileName: _jsxFileName,\n          lineNumber: 570,\n          columnNumber: 25\n        }, this);\n      })]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 543,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wbrtc-controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleMic,\n        className: `wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isMicEnabled ? 'Mute' : 'Unmute',\n        children: isMicEnabled ? /*#__PURE__*/_jsxDEV(Mic, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 590,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(MicOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 590,\n          columnNumber: 57\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 589,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleCam,\n        className: `wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`,\n        title: isCamEnabled ? 'Stop Video' : 'Start Video',\n        children: isCamEnabled ? /*#__PURE__*/_jsxDEV(Video, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 593,\n          columnNumber: 37\n        }, this) : /*#__PURE__*/_jsxDEV(VideoOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 593,\n          columnNumber: 59\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 592,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleScreenShare,\n        className: `wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`,\n        title: isScreenSharing ? 'Stop Sharing' : 'Share Screen',\n        children: isScreenSharing ? /*#__PURE__*/_jsxDEV(MonitorOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 596,\n          columnNumber: 40\n        }, this) : /*#__PURE__*/_jsxDEV(Monitor, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 596,\n          columnNumber: 67\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 595,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wbrtc-divider\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 598,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleLeave,\n        className: \"wbrtc-btn wbrtc-btn--leave\",\n        title: \"Leave call\",\n        children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n          size: 15\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 600,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 599,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 588,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 532,\n    columnNumber: 9\n  }, this);\n};\n\n// â”€â”€ Remote video renderer (memoized, never muted) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n_s(WebRTCMeeting, \"wlnYMfKMn07bY9WZ6LTTVB1TWKs=\");\n_c = WebRTCMeeting;\nconst RemoteVideo = /*#__PURE__*/_s2(/*#__PURE__*/React.memo(_c2 = _s2(({\n  stream\n}) => {\n  _s2();\n  const ref = useRef(null);\n  useEffect(() => {\n    const vid = ref.current;\n    if (!vid || !stream) return;\n    vid.srcObject = stream;\n    vid.muted = false; // Remote audio MUST be audible\n\n    const tryPlay = () => vid.play().catch(() => {});\n    if (stream.active) tryPlay();\n    stream.addEventListener('addtrack', tryPlay);\n    return () => stream.removeEventListener('addtrack', tryPlay);\n  }, [stream]);\n  return /*#__PURE__*/_jsxDEV(\"video\", {\n    ref: ref,\n    autoPlay: true,\n    playsInline: true,\n    className: \"wbrtc-tile-video\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 625,\n    columnNumber: 12\n  }, this);\n}, \"8uVE59eA/r6b92xF80p7sH8rXLk=\")), \"8uVE59eA/r6b92xF80p7sH8rXLk=\");\n_c3 = RemoteVideo;\nexport default WebRTCMeeting;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"WebRTCMeeting\");\n$RefreshReg$(_c2, \"RemoteVideo$React.memo\");\n$RefreshReg$(_c3, \"RemoteVideo\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","Mic","MicOff","Video","VideoOff","PhoneOff","Monitor","MonitorOff","Minimize2","Maximize2","GripHorizontal","toast","jsxDEV","_jsxDEV","WebRTCMeeting","socket","roomId","username","onLeave","_s","_username$","localStream","setLocalStream","peers","setPeers","isMicEnabled","setIsMicEnabled","isCamEnabled","setIsCamEnabled","isScreenSharing","setIsScreenSharing","isMinimized","setIsMinimized","remotePeerStates","setRemotePeerStates","localVideoRef","streamRef","screenRef","peersRef","componentMounted","joinedRef","onLeaveRef","current","containerRef","isDragging","dragOffset","x","y","position","setPosition","rtcConfig","iceServers","urls","flushCandidates","socketId","_peer$pc$remoteDescri","peer","pc","remoteDescription","type","_peer$candidateQueue","candidateQueue","length","c","shift","addIceCandidate","RTCIceCandidate","_","syncPeersState","snap","Object","entries","forEach","id","p","stream","removePeer","_peer$pc","close","prev","n","createPeer","targetSocketId","targetUsername","isInitiator","existing","state","connectionState","iceConnectionState","RTCPeerConnection","getTracks","track","addTrack","ontrack","event","_event$streams","rStream","streams","entry","onicecandidate","candidate","emit","to","oniceconnectionstatechange","s","offer","createOffer","setLocalDescription","localDescription","err","console","error","start","navigator","mediaDevices","getUserMedia","video","audio","echoCancellation","noiseSuppression","t","stop","srcObject","muted","keys","_peersRef$current$id","_peersRef$current$id$","activeStream","play","catch","myId","onExistingPeers","existingPeers","mic","cam","onNewPeer","peerName","_streamRef$current","_streamRef$current2","_audioTrack$enabled","_videoTrack$enabled","audioTrack","getAudioTracks","videoTrack","getVideoTracks","enabled","onOffer","from","signalingState","setRemoteDescription","RTCSessionDescription","answer","createAnswer","e","onAnswer","onCandidate","_peer$pc$remoteDescri2","push","onPeerLeft","onCallEnded","log","_peersRef$current$id2","_peersRef$current$id3","icon","onMediaState","on","off","toggleMic","_streamRef$current3","_streamRef$current4","_videoTrack$enabled2","newEnabled","values","_pc$getSenders","senders","getSenders","call","sender","kind","toggleCam","_streamRef$current5","_streamRef$current6","_audioTrack$enabled2","_pc$getSenders2","toggleScreenShare","_streamRef$current7","camTrack","_pc$getSenders3","_pc$getSenders3$call","find","_s$track","replaceTrack","screenStream","getDisplayMedia","screenTrack","_pc$getSenders4","_pc$getSenders4$call","_s$track2","onended","handleLeave","_peersRef$current$id4","_peersRef$current$id5","onDragStart","rect","getBoundingClientRect","clientX","left","clientY","top","move","ev","Math","max","min","window","innerWidth","innerHeight","up","document","removeEventListener","addEventListener","peerEntries","filter","participantCount","ref","className","style","children","onMouseDown","size","fileName","_jsxFileName","lineNumber","columnNumber","onClick","title","autoPlay","playsInline","display","toUpperCase","map","_2","remoteState","remoteCamOff","remoteMicOff","RemoteVideo","_c","_s2","memo","_c2","vid","tryPlay","active","_c3","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/components/video/WebRTCMeeting.js"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff, Minimize2, Maximize2, GripHorizontal } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\n/**\r\n * WebRTCMeeting â€” Zoom-like group call via P2P mesh.\r\n *\r\n * Key guarantees:\r\n * - NEVER creates a peer connection to self (filters own socketId)\r\n * - Only one mesh:join emission per mount (joinedRef guard)\r\n * - ICE candidates are queued until remoteDescription is set\r\n * - Local <video> always has `muted` to prevent echo\r\n * - Mute uses track.enabled (not track.stop) so unmute works\r\n * - Only one RTCPeerConnection per remote socketId\r\n * - Broadcasts mic/cam state to all peers via socket so remote tiles\r\n *   can show avatar (cam off) and mute icon (mic off)\r\n */\r\nconst WebRTCMeeting = ({ socket, roomId, username, onLeave }) => {\r\n    const [localStream, setLocalStream] = useState(null);\r\n    const [peers, setPeers] = useState({});\r\n    const [isMicEnabled, setIsMicEnabled] = useState(true);\r\n    const [isCamEnabled, setIsCamEnabled] = useState(true);\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const [isMinimized, setIsMinimized] = useState(false);\r\n\r\n    // Track remote peer media states:  { [socketId]: { mic: bool, cam: bool } }\r\n    const [remotePeerStates, setRemotePeerStates] = useState({});\r\n\r\n    const localVideoRef = useRef(null);\r\n    const streamRef = useRef(null);\r\n    const screenRef = useRef(null);\r\n    const peersRef = useRef({});\r\n    const componentMounted = useRef(true);\r\n    const joinedRef = useRef(false);  // Prevent duplicate mesh:join\r\n    const onLeaveRef = useRef(onLeave);\r\n    useEffect(() => { onLeaveRef.current = onLeave; }, [onLeave]);\r\n\r\n    // Drag\r\n    const containerRef = useRef(null);\r\n    const isDragging = useRef(false);\r\n    const dragOffset = useRef({ x: 0, y: 0 });\r\n    const [position, setPosition] = useState({ x: 16, y: 70 });\r\n\r\n    const rtcConfig = useRef({\r\n        iceServers: [\r\n            { urls: 'stun:stun.l.google.com:19302' },\r\n            { urls: 'stun:stun1.l.google.com:19302' },\r\n        ],\r\n    }).current;\r\n\r\n    // â”€â”€ Flush queued ICE candidates â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    const flushCandidates = useCallback(async (socketId) => {\r\n        const peer = peersRef.current[socketId];\r\n        if (!peer?.pc || !peer.pc.remoteDescription?.type) return;\r\n        while (peer.candidateQueue?.length > 0) {\r\n            const c = peer.candidateQueue.shift();\r\n            try { await peer.pc.addIceCandidate(new RTCIceCandidate(c)); } catch (_) { }\r\n        }\r\n    }, []);\r\n\r\n    // â”€â”€ Push ref state â†’ React state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    const syncPeersState = useCallback(() => {\r\n        const snap = {};\r\n        Object.entries(peersRef.current).forEach(([id, p]) => {\r\n            snap[id] = { stream: p.stream, username: p.username };\r\n        });\r\n        setPeers(snap);\r\n    }, []);\r\n\r\n    // â”€â”€ Remove a peer cleanly â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    const removePeer = useCallback((socketId) => {\r\n        const peer = peersRef.current[socketId];\r\n        if (peer) {\r\n            try { peer.pc?.close(); } catch (_) { }\r\n            delete peersRef.current[socketId];\r\n            syncPeersState();\r\n            // Also remove their media state\r\n            setRemotePeerStates(prev => {\r\n                const n = { ...prev };\r\n                delete n[socketId];\r\n                return n;\r\n            });\r\n        }\r\n    }, [syncPeersState]);\r\n\r\n    // â”€â”€ Create ONE PeerConnection per remote socketId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    const createPeer = useCallback((targetSocketId, targetUsername, stream, isInitiator) => {\r\n        // NEVER connect to self\r\n        if (targetSocketId === socket?.id) return null;\r\n\r\n        // If we already have a live PC for this peer, return it\r\n        const existing = peersRef.current[targetSocketId];\r\n        if (existing?.pc) {\r\n            const state = existing.pc.connectionState || existing.pc.iceConnectionState;\r\n            if (state !== 'closed' && state !== 'failed') {\r\n                return existing.pc;\r\n            }\r\n            // Dead connection â€” clean up\r\n            try { existing.pc.close(); } catch (_) { }\r\n        }\r\n\r\n        const pc = new RTCPeerConnection(rtcConfig);\r\n\r\n        // Add every local track\r\n        stream.getTracks().forEach(track => pc.addTrack(track, stream));\r\n\r\n        // Store immediately with candidate queue\r\n        peersRef.current[targetSocketId] = {\r\n            pc,\r\n            stream: null,\r\n            username: targetUsername,\r\n            candidateQueue: [],\r\n        };\r\n\r\n        // â”€â”€ Remote tracks â”€â”€\r\n        pc.ontrack = (event) => {\r\n            const rStream = event.streams?.[0];\r\n            if (!rStream) return;\r\n            const entry = peersRef.current[targetSocketId];\r\n            if (entry) entry.stream = rStream;\r\n            syncPeersState();\r\n        };\r\n\r\n        // â”€â”€ ICE candidates â†’ remote â”€â”€\r\n        pc.onicecandidate = (event) => {\r\n            if (event.candidate) {\r\n                socket.emit('mesh:candidate', {\r\n                    roomId,\r\n                    to: targetSocketId,\r\n                    candidate: event.candidate,\r\n                });\r\n            }\r\n        };\r\n\r\n        // â”€â”€ Connection state changes â”€â”€\r\n        pc.oniceconnectionstatechange = () => {\r\n            const s = pc.iceConnectionState;\r\n            if (s === 'connected' || s === 'completed') syncPeersState();\r\n            if (s === 'failed') removePeer(targetSocketId);\r\n        };\r\n\r\n        syncPeersState();\r\n\r\n        // Initiator sends offer\r\n        if (isInitiator) {\r\n            (async () => {\r\n                try {\r\n                    const offer = await pc.createOffer();\r\n                    await pc.setLocalDescription(offer);\r\n                    socket.emit('mesh:offer', {\r\n                        roomId,\r\n                        to: targetSocketId,\r\n                        offer: pc.localDescription,\r\n                    });\r\n                } catch (err) {\r\n                    console.error('[Mesh] Offer error:', err);\r\n                }\r\n            })();\r\n        }\r\n\r\n        return pc;\r\n    }, [socket, roomId, rtcConfig, removePeer, syncPeersState]);\r\n\r\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n    //  1. Get media â†’ join call (runs ONCE per mount)\r\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n    useEffect(() => {\r\n        componentMounted.current = true;\r\n        joinedRef.current = false;\r\n\r\n        const start = async () => {\r\n            try {\r\n                const stream = await navigator.mediaDevices.getUserMedia({\r\n                    video: true,\r\n                    audio: { echoCancellation: true, noiseSuppression: true },\r\n                });\r\n                if (!componentMounted.current) {\r\n                    stream.getTracks().forEach(t => t.stop());\r\n                    return;\r\n                }\r\n\r\n                streamRef.current = stream;\r\n                setLocalStream(stream);\r\n\r\n                // Attach to <video> â€” always muted to prevent echo\r\n                if (localVideoRef.current) {\r\n                    localVideoRef.current.srcObject = stream;\r\n                    localVideoRef.current.muted = true;\r\n                }\r\n\r\n                // Emit mesh:join exactly once\r\n                if (!joinedRef.current) {\r\n                    joinedRef.current = true;\r\n                    socket.emit('mesh:join', { roomId, username });\r\n                }\r\n            } catch (err) {\r\n                console.error('[WebRTC] Media error:', err);\r\n                toast.error('Could not access camera or microphone.');\r\n            }\r\n        };\r\n\r\n        start();\r\n\r\n        return () => {\r\n            componentMounted.current = false;\r\n            joinedRef.current = false;\r\n\r\n            // Close every peer connection\r\n            Object.keys(peersRef.current).forEach(id => {\r\n                try { peersRef.current[id]?.pc?.close(); } catch (_) { }\r\n            });\r\n            peersRef.current = {};\r\n\r\n            // Stop local tracks\r\n            if (streamRef.current) {\r\n                streamRef.current.getTracks().forEach(t => t.stop());\r\n                streamRef.current = null;\r\n            }\r\n            if (screenRef.current) {\r\n                screenRef.current.getTracks().forEach(t => t.stop());\r\n                screenRef.current = null;\r\n            }\r\n        };\r\n        // eslint-disable-next-line\r\n    }, []);  // Empty deps â€” run once on mount, clean up on unmount\r\n\r\n    // â”€â”€ Re-attach local video srcObject when un-minimizing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    useEffect(() => {\r\n        if (!isMinimized && localVideoRef.current) {\r\n            const activeStream = screenRef.current || streamRef.current;\r\n            if (activeStream) {\r\n                localVideoRef.current.srcObject = activeStream;\r\n                localVideoRef.current.muted = true;\r\n                localVideoRef.current.play().catch(() => { });\r\n            }\r\n        }\r\n    }, [isMinimized]);\r\n\r\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n    //  2. Socket signaling (mesh topology)\r\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n        const myId = socket.id;\r\n\r\n        // Server sends existing call participants\r\n        const onExistingPeers = ({ peers: existingPeers }) => {\r\n            if (!streamRef.current) return;\r\n            existingPeers.forEach(p => {\r\n                // Never connect to self\r\n                if (p.socketId === myId) return;\r\n                createPeer(p.socketId, p.username, streamRef.current, true);\r\n            });\r\n\r\n            // Send our current media state to all existing peers\r\n            socket.emit('mesh:media-state', { roomId, mic: true, cam: true });\r\n        };\r\n\r\n        // A new peer joined â€” pre-create PC (they will send us an offer)\r\n        const onNewPeer = ({ socketId, username: peerName }) => {\r\n            if (!streamRef.current || socketId === myId) return;\r\n            createPeer(socketId, peerName, streamRef.current, false);\r\n\r\n            // Send our current media state to the new peer\r\n            const audioTrack = streamRef.current?.getAudioTracks()[0];\r\n            const videoTrack = streamRef.current?.getVideoTracks()[0];\r\n            socket.emit('mesh:media-state', {\r\n                roomId,\r\n                mic: audioTrack?.enabled ?? true,\r\n                cam: videoTrack?.enabled ?? true\r\n            });\r\n        };\r\n\r\n        // Receive offer\r\n        const onOffer = async ({ from, offer, username: peerName }) => {\r\n            if (!streamRef.current || from === myId) return;\r\n\r\n            let peer = peersRef.current[from];\r\n            let pc;\r\n\r\n            if (!peer?.pc || peer.pc.signalingState === 'closed') {\r\n                pc = createPeer(from, peerName, streamRef.current, false);\r\n            } else {\r\n                pc = peer.pc;\r\n                if (peerName) peersRef.current[from].username = peerName;\r\n            }\r\n            if (!pc) return;\r\n\r\n            try {\r\n                // Glare: both sides sent offers â€” higher ID yields\r\n                if (pc.signalingState === 'have-local-offer') {\r\n                    if (myId > from) {\r\n                        await pc.setLocalDescription({ type: 'rollback' });\r\n                    } else {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                await pc.setRemoteDescription(new RTCSessionDescription(offer));\r\n                await flushCandidates(from);\r\n\r\n                const answer = await pc.createAnswer();\r\n                await pc.setLocalDescription(answer);\r\n                socket.emit('mesh:answer', { roomId, to: from, answer: pc.localDescription });\r\n            } catch (e) {\r\n                console.error('[Mesh] Offer handling error:', e);\r\n            }\r\n        };\r\n\r\n        // Receive answer\r\n        const onAnswer = async ({ from, answer }) => {\r\n            const peer = peersRef.current[from];\r\n            if (!peer?.pc || peer.pc.signalingState !== 'have-local-offer') return;\r\n            try {\r\n                await peer.pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n                await flushCandidates(from);\r\n            } catch (e) {\r\n                console.error('[Mesh] Answer error:', e);\r\n            }\r\n        };\r\n\r\n        // Receive ICE candidate â€” queue if remote description not ready\r\n        const onCandidate = async ({ from, candidate }) => {\r\n            const peer = peersRef.current[from];\r\n            if (!peer?.pc) return;\r\n\r\n            if (peer.pc.remoteDescription?.type) {\r\n                try { await peer.pc.addIceCandidate(new RTCIceCandidate(candidate)); } catch (_) { }\r\n            } else {\r\n                peer.candidateQueue = peer.candidateQueue || [];\r\n                peer.candidateQueue.push(candidate);\r\n            }\r\n        };\r\n\r\n        // A peer left\r\n        const onPeerLeft = ({ socketId }) => removePeer(socketId);\r\n\r\n        // Call creator ended the call â€” everyone must leave\r\n        const onCallEnded = () => {\r\n            console.log('[Mesh] Call ended by creator â€” cleaning up');\r\n            // Close all peer connections\r\n            Object.keys(peersRef.current).forEach(id => {\r\n                try { peersRef.current[id]?.pc?.close(); } catch (_) { }\r\n            });\r\n            peersRef.current = {};\r\n            // Stop local media tracks\r\n            if (streamRef.current) {\r\n                streamRef.current.getTracks().forEach(t => t.stop());\r\n                streamRef.current = null;\r\n            }\r\n            if (screenRef.current) {\r\n                screenRef.current.getTracks().forEach(t => t.stop());\r\n                screenRef.current = null;\r\n            }\r\n            toast('ðŸ“ž Call ended by the host', { icon: 'ðŸ“ž' });\r\n            onLeaveRef.current();\r\n        };\r\n\r\n        // Remote peer toggled mic/cam â€” update UI state\r\n        const onMediaState = ({ from, mic, cam }) => {\r\n            setRemotePeerStates(prev => ({\r\n                ...prev,\r\n                [from]: { mic, cam }\r\n            }));\r\n        };\r\n\r\n        socket.on('mesh:existing-peers', onExistingPeers);\r\n        socket.on('mesh:new-peer', onNewPeer);\r\n        socket.on('mesh:offer', onOffer);\r\n        socket.on('mesh:answer', onAnswer);\r\n        socket.on('mesh:candidate', onCandidate);\r\n        socket.on('mesh:peer-left', onPeerLeft);\r\n        socket.on('mesh:call-ended', onCallEnded);\r\n        socket.on('mesh:media-state', onMediaState);\r\n\r\n        return () => {\r\n            socket.off('mesh:existing-peers', onExistingPeers);\r\n            socket.off('mesh:new-peer', onNewPeer);\r\n            socket.off('mesh:offer', onOffer);\r\n            socket.off('mesh:answer', onAnswer);\r\n            socket.off('mesh:candidate', onCandidate);\r\n            socket.off('mesh:peer-left', onPeerLeft);\r\n            socket.off('mesh:call-ended', onCallEnded);\r\n            socket.off('mesh:media-state', onMediaState);\r\n        };\r\n    }, [socket, roomId, createPeer, removePeer, flushCandidates]);\r\n\r\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n    //  Controls\r\n    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\r\n    const toggleMic = () => {\r\n        const audioTrack = streamRef.current?.getAudioTracks()[0];\r\n        if (!audioTrack) return;\r\n        const newEnabled = !audioTrack.enabled;\r\n\r\n        // 1. Toggle on the local stream track\r\n        audioTrack.enabled = newEnabled;\r\n\r\n        // 2. Also propagate to every peer connection's audio sender\r\n        Object.values(peersRef.current).forEach(({ pc }) => {\r\n            if (!pc) return;\r\n            const senders = pc.getSenders?.() || [];\r\n            senders.forEach(sender => {\r\n                if (sender.track && sender.track.kind === 'audio') {\r\n                    sender.track.enabled = newEnabled;\r\n                }\r\n            });\r\n        });\r\n\r\n        setIsMicEnabled(newEnabled);\r\n\r\n        // 3. Broadcast state to all peers via socket\r\n        const videoTrack = streamRef.current?.getVideoTracks()[0];\r\n        socket.emit('mesh:media-state', {\r\n            roomId,\r\n            mic: newEnabled,\r\n            cam: videoTrack?.enabled ?? isCamEnabled\r\n        });\r\n    };\r\n\r\n    const toggleCam = () => {\r\n        const videoTrack = streamRef.current?.getVideoTracks()[0];\r\n        if (!videoTrack) return;\r\n        const newEnabled = !videoTrack.enabled;\r\n        videoTrack.enabled = newEnabled;\r\n\r\n        // Also propagate to every peer connection's video sender\r\n        Object.values(peersRef.current).forEach(({ pc }) => {\r\n            if (!pc) return;\r\n            const senders = pc.getSenders?.() || [];\r\n            senders.forEach(sender => {\r\n                if (sender.track && sender.track.kind === 'video') {\r\n                    sender.track.enabled = newEnabled;\r\n                }\r\n            });\r\n        });\r\n\r\n        setIsCamEnabled(newEnabled);\r\n\r\n        // Broadcast state to all peers via socket\r\n        const audioTrack = streamRef.current?.getAudioTracks()[0];\r\n        socket.emit('mesh:media-state', {\r\n            roomId,\r\n            mic: audioTrack?.enabled ?? isMicEnabled,\r\n            cam: newEnabled\r\n        });\r\n    };\r\n\r\n    const toggleScreenShare = async () => {\r\n        if (isScreenSharing) {\r\n            if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n            const camTrack = streamRef.current?.getVideoTracks()[0];\r\n            Object.values(peersRef.current).forEach(({ pc }) => {\r\n                const sender = pc?.getSenders?.()?.find(s => s.track?.kind === 'video');\r\n                if (sender && camTrack) sender.replaceTrack(camTrack);\r\n            });\r\n            if (localVideoRef.current && streamRef.current) localVideoRef.current.srcObject = streamRef.current;\r\n            setIsScreenSharing(false);\r\n        } else {\r\n            try {\r\n                const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });\r\n                screenRef.current = screenStream;\r\n                const screenTrack = screenStream.getVideoTracks()[0];\r\n                Object.values(peersRef.current).forEach(({ pc }) => {\r\n                    const sender = pc?.getSenders?.()?.find(s => s.track?.kind === 'video');\r\n                    if (sender) sender.replaceTrack(screenTrack);\r\n                });\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\r\n                screenTrack.onended = () => toggleScreenShare();\r\n                setIsScreenSharing(true);\r\n            } catch (_) { }\r\n        }\r\n    };\r\n\r\n    const handleLeave = () => {\r\n        socket.emit('mesh:leave', { roomId });\r\n        Object.keys(peersRef.current).forEach(id => {\r\n            try { peersRef.current[id]?.pc?.close(); } catch (_) { }\r\n        });\r\n        peersRef.current = {};\r\n        if (streamRef.current) { streamRef.current.getTracks().forEach(t => t.stop()); streamRef.current = null; }\r\n        if (screenRef.current) { screenRef.current.getTracks().forEach(t => t.stop()); screenRef.current = null; }\r\n        onLeaveRef.current();\r\n    };\r\n\r\n    // â”€â”€ Drag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    const onDragStart = (e) => {\r\n        isDragging.current = true;\r\n        const rect = containerRef.current.getBoundingClientRect();\r\n        dragOffset.current = { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n        const move = (ev) => {\r\n            if (!isDragging.current) return;\r\n            setPosition({\r\n                x: Math.max(0, Math.min(window.innerWidth - 120, ev.clientX - dragOffset.current.x)),\r\n                y: Math.max(0, Math.min(window.innerHeight - 80, ev.clientY - dragOffset.current.y)),\r\n            });\r\n        };\r\n        const up = () => {\r\n            isDragging.current = false;\r\n            document.removeEventListener('mousemove', move);\r\n            document.removeEventListener('mouseup', up);\r\n        };\r\n        document.addEventListener('mousemove', move);\r\n        document.addEventListener('mouseup', up);\r\n    };\r\n\r\n    // â”€â”€ Only render remote peers that are alive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    const peerEntries = Object.entries(peers).filter(\r\n        ([id]) => id !== socket?.id  // Extra safety: never render self as remote\r\n    );\r\n    const participantCount = 1 + peerEntries.length;\r\n\r\n    // â”€â”€ Minimized â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    if (isMinimized) {\r\n        return (\r\n            <div ref={containerRef} className=\"wbrtc-floating wbrtc-minimized\" style={{ left: position.x, top: position.y }}>\r\n                <div className=\"wbrtc-mini-bar\" onMouseDown={onDragStart}>\r\n                    <GripHorizontal size={14} className=\"wbrtc-grip\" />\r\n                    <div className=\"wbrtc-mini-info\">\r\n                        <span className=\"wbrtc-mini-dot\" />\r\n                        <span>{participantCount} in call</span>\r\n                    </div>\r\n                    <button className=\"wbrtc-mini-btn\" onClick={() => setIsMinimized(false)} title=\"Expand\"><Maximize2 size={13} /></button>\r\n                    <button className=\"wbrtc-mini-btn wbrtc-mini-leave\" onClick={handleLeave} title=\"Leave\"><PhoneOff size={13} /></button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // â”€â”€ Full floating window â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n    return (\r\n        <div ref={containerRef} className=\"wbrtc-floating\" style={{ left: position.x, top: position.y }}>\r\n            {/* Drag handle */}\r\n            <div className=\"wbrtc-drag-bar\" onMouseDown={onDragStart}>\r\n                <GripHorizontal size={14} className=\"wbrtc-grip\" />\r\n                <span className=\"wbrtc-drag-title\">{participantCount} in call</span>\r\n                <div className=\"wbrtc-drag-actions\">\r\n                    <button className=\"wbrtc-mini-btn\" onClick={() => setIsMinimized(true)} title=\"Minimize\"><Minimize2 size={13} /></button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Video grid */}\r\n            <div className=\"wbrtc-grid\">\r\n                {/* â”€â”€ LOCAL tile (always first, always muted) â”€â”€ */}\r\n                <div className=\"wbrtc-tile\">\r\n                    <video\r\n                        ref={localVideoRef}\r\n                        autoPlay\r\n                        muted          /* â† ALWAYS muted to prevent echo */\r\n                        playsInline\r\n                        className=\"wbrtc-tile-video wbrtc-tile-mirror\"\r\n                        style={{ display: (!isCamEnabled && !isScreenSharing) ? 'none' : 'block' }}\r\n                    />\r\n                    {!isCamEnabled && !isScreenSharing && (\r\n                        <div className=\"wbrtc-tile-avatar\">{username?.[0]?.toUpperCase()}</div>\r\n                    )}\r\n                    <div className=\"wbrtc-tile-name\">\r\n                        {username} (You)\r\n                        {!isMicEnabled && <MicOff size={10} className=\"wbrtc-tile-muted\" />}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* â”€â”€ REMOTE tiles (one per unique socketId, self excluded) â”€â”€ */}\r\n                {peerEntries.map(([socketId, peer]) => {\r\n                    const remoteState = remotePeerStates[socketId];\r\n                    const remoteCamOff = remoteState ? !remoteState.cam : false;\r\n                    const remoteMicOff = remoteState ? !remoteState.mic : false;\r\n\r\n                    return (\r\n                        <div className=\"wbrtc-tile\" key={socketId}>\r\n                            {peer.stream && !remoteCamOff ? (\r\n                                <RemoteVideo stream={peer.stream} />\r\n                            ) : (\r\n                                <div className=\"wbrtc-tile-avatar\">\r\n                                    {(peer.username || '?')[0]?.toUpperCase()}\r\n                                </div>\r\n                            )}\r\n                            <div className=\"wbrtc-tile-name\">\r\n                                {peer.username || 'Participant'}\r\n                                {remoteMicOff && <MicOff size={10} className=\"wbrtc-tile-muted\" />}\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n\r\n            {/* Controls */}\r\n            <div className=\"wbrtc-controls\">\r\n                <button onClick={toggleMic} className={`wbrtc-btn ${!isMicEnabled ? 'wbrtc-btn--danger' : ''}`} title={isMicEnabled ? 'Mute' : 'Unmute'}>\r\n                    {isMicEnabled ? <Mic size={15} /> : <MicOff size={15} />}\r\n                </button>\r\n                <button onClick={toggleCam} className={`wbrtc-btn ${!isCamEnabled ? 'wbrtc-btn--danger' : ''}`} title={isCamEnabled ? 'Stop Video' : 'Start Video'}>\r\n                    {isCamEnabled ? <Video size={15} /> : <VideoOff size={15} />}\r\n                </button>\r\n                <button onClick={toggleScreenShare} className={`wbrtc-btn ${isScreenSharing ? 'wbrtc-btn--active' : ''}`} title={isScreenSharing ? 'Stop Sharing' : 'Share Screen'}>\r\n                    {isScreenSharing ? <MonitorOff size={15} /> : <Monitor size={15} />}\r\n                </button>\r\n                <div className=\"wbrtc-divider\" />\r\n                <button onClick={handleLeave} className=\"wbrtc-btn wbrtc-btn--leave\" title=\"Leave call\">\r\n                    <PhoneOff size={15} />\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// â”€â”€ Remote video renderer (memoized, never muted) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\nconst RemoteVideo = React.memo(({ stream }) => {\r\n    const ref = useRef(null);\r\n\r\n    useEffect(() => {\r\n        const vid = ref.current;\r\n        if (!vid || !stream) return;\r\n\r\n        vid.srcObject = stream;\r\n        vid.muted = false;  // Remote audio MUST be audible\r\n\r\n        const tryPlay = () => vid.play().catch(() => { });\r\n\r\n        if (stream.active) tryPlay();\r\n        stream.addEventListener('addtrack', tryPlay);\r\n        return () => stream.removeEventListener('addtrack', tryPlay);\r\n    }, [stream]);\r\n\r\n    return <video ref={ref} autoPlay playsInline className=\"wbrtc-tile-video\" />;\r\n});\r\n\r\nexport default WebRTCMeeting;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}