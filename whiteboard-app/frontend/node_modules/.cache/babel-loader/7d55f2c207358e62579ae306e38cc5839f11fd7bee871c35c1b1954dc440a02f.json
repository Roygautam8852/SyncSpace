{"ast":null,"code":"var _jsxFileName = \"D:\\\\CapstoneProject\\\\whiteboard-app\\\\frontend\\\\src\\\\components\\\\video\\\\WebRTCMeeting.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff } from 'lucide-react';\nimport toast from 'react-hot-toast';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst WebRTCMeeting = ({\n  socket,\n  roomId,\n  signalingId,\n  isCaller,\n  username,\n  onLeave\n}) => {\n  _s();\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const [isMicEnabled, setIsMicEnabled] = useState(true);\n  const [isCamEnabled, setIsCamEnabled] = useState(true);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [connectionStatus, setConnectionStatus] = useState('Initializing...');\n  const pcRef = useRef(null);\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const candidateBuffer = useRef([]);\n  const screenStreamRef = useRef(null);\n  const isNegotiating = useRef(false);\n  const hasInitialized = useRef(false);\n  const currentLocalStream = useRef(null);\n\n  // Google STUN servers\n  const rtcConfig = {\n    iceServers: [{\n      urls: 'stun:stun.l.google.com:19302'\n    }, {\n      urls: 'stun:stun1.l.google.com:19302'\n    }, {\n      urls: 'stun:stun2.l.google.com:19302'\n    }]\n  };\n\n  // ─── 1. MEDIA & PC LIFECYCLE (Runs once) ───\n  useEffect(() => {\n    let isStopped = false;\n    const initMedia = async () => {\n      try {\n        console.log('[WebRTC] Requesting media...');\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        if (isStopped) {\n          stream.getTracks().forEach(t => t.stop());\n          return;\n        }\n        setLocalStream(stream);\n        currentLocalStream.current = stream;\n        if (localVideoRef.current) localVideoRef.current.srcObject = stream;\n        const pc = new RTCPeerConnection(rtcConfig);\n        pcRef.current = pc;\n        stream.getTracks().forEach(track => {\n          pc.addTrack(track, stream);\n        });\n        pc.ontrack = event => {\n          console.log('[WebRTC] Remote track received:', event.track.kind);\n          const rStream = event.streams[0];\n          setRemoteStream(rStream);\n          if (remoteVideoRef.current) remoteVideoRef.current.srcObject = rStream;\n        };\n        pc.oniceconnectionstatechange = () => {\n          setConnectionStatus(`Status: ${pc.iceConnectionState}`);\n        };\n        pc.onicecandidate = event => {\n          if (event.candidate && signalingId) {\n            socket.emit('call:candidate', {\n              roomId,\n              to: signalingId,\n              candidate: event.candidate\n            });\n          }\n        };\n        if (pc.oniceconnectionstatechange) pc.oniceconnectionstatechange(); // Force initial state log\n      } catch (err) {\n        console.error('[WebRTC] Media Init Error:', err);\n        toast.error('Camera/Mic access failed');\n      }\n    };\n    if (!hasInitialized.current) {\n      hasInitialized.current = true;\n      initMedia();\n    }\n    return () => {\n      isStopped = true;\n    };\n  }, [roomId]); // Only depend on roomId\n\n  // ─── 1.5 NEGOTIATION (Triggers when signalingId is available) ───\n  useEffect(() => {\n    const pc = pcRef.current;\n    if (isCaller && signalingId && pc && pc.signalingState === 'stable') {\n      const startNegotiation = async () => {\n        if (isNegotiating.current) return;\n        try {\n          isNegotiating.current = true;\n          console.log('[WebRTC] Creating offer for:', signalingId);\n          const offer = await pc.createOffer();\n          await pc.setLocalDescription(offer);\n          socket.emit('call:offer', {\n            roomId,\n            to: signalingId,\n            offer\n          });\n        } catch (e) {\n          console.error('[WebRTC] Negotiation offer failed:', e);\n        } finally {\n          isNegotiating.current = false;\n        }\n      };\n      startNegotiation();\n    }\n  }, [isCaller, signalingId, roomId, socket]);\n\n  // ─── 2. SIGNALING LIFECYCLE (Re-binds on socket changes) ───\n  useEffect(() => {\n    if (!socket) return;\n    const processCandidates = async () => {\n      while (candidateBuffer.current.length > 0 && (_pcRef$current = pcRef.current) !== null && _pcRef$current !== void 0 && _pcRef$current.remoteDescription) {\n        var _pcRef$current;\n        const cand = candidateBuffer.current.shift();\n        try {\n          await pcRef.current.addIceCandidate(new RTCIceCandidate(cand));\n        } catch (e) {}\n      }\n    };\n    const handleOffer = async ({\n      from,\n      offer\n    }) => {\n      const pc = pcRef.current;\n      if (!pc || isNegotiating.current || pc.signalingState !== 'stable') return;\n      try {\n        isNegotiating.current = true;\n        await pc.setRemoteDescription(new RTCSessionDescription(offer));\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        socket.emit('call:answer', {\n          roomId,\n          to: from,\n          answer\n        });\n        processCandidates();\n      } catch (e) {\n        console.error('Offer handling failed:', e);\n      } finally {\n        isNegotiating.current = false;\n      }\n    };\n    const handleAnswer = async ({\n      from,\n      answer\n    }) => {\n      const pc = pcRef.current;\n      if (!pc || isNegotiating.current || pc.signalingState !== 'have-local-offer') return;\n      try {\n        isNegotiating.current = true;\n        await pc.setRemoteDescription(new RTCSessionDescription(answer));\n        processCandidates();\n      } catch (e) {\n        console.error('Answer handling failed:', e);\n      } finally {\n        isNegotiating.current = false;\n      }\n    };\n    const handleCandidate = async ({\n      from,\n      candidate\n    }) => {\n      const pc = pcRef.current;\n      if (!pc) return;\n      if (pc.remoteDescription && pc.remoteDescription.type) {\n        try {\n          await pc.addIceCandidate(new RTCIceCandidate(candidate));\n        } catch (e) {}\n      } else {\n        candidateBuffer.current.push(candidate);\n      }\n    };\n    const handleCallEnded = () => {\n      stopAllTracks();\n      onLeave();\n    };\n    socket.on('call:offer', handleOffer);\n    socket.on('call:answer', handleAnswer);\n    socket.on('call:candidate', handleCandidate);\n    socket.on('call:ended', handleCallEnded);\n    return () => {\n      socket.off('call:offer', handleOffer);\n      socket.off('call:answer', handleAnswer);\n      socket.off('call:candidate', handleCandidate);\n      socket.off('call:ended', handleCallEnded);\n    };\n  }, [socket, roomId, signalingId, onLeave]);\n\n  // ─── 3. VIDEO ELEMENT SYNC ───\n  useEffect(() => {\n    const video = localVideoRef.current;\n    if (video && localStream) {\n      video.srcObject = localStream;\n      video.onloadedmetadata = () => {\n        video.play().catch(e => console.error('[WebRTC] Local video play error:', e));\n      };\n    }\n  }, [localStream]);\n  useEffect(() => {\n    const video = remoteVideoRef.current;\n    if (video && remoteStream) {\n      video.srcObject = remoteStream;\n      video.onloadedmetadata = () => {\n        video.play().catch(e => console.error('[WebRTC] Remote video play error:', e));\n      };\n    }\n  }, [remoteStream]);\n\n  // Ensure tracks stop on component unmount\n  useEffect(() => {\n    return () => stopAllTracks();\n  }, []);\n  const stopAllTracks = () => {\n    if (pcRef.current) {\n      pcRef.current.close();\n      pcRef.current = null;\n    }\n    if (localStream) {\n      localStream.getTracks().forEach(t => t.stop());\n      setLocalStream(null);\n    }\n    if (screenStreamRef.current) {\n      screenStreamRef.current.getTracks().forEach(t => t.stop());\n      screenStreamRef.current = null;\n    }\n    if (localVideoRef.current) localVideoRef.current.srcObject = null;\n    if (remoteVideoRef.current) remoteVideoRef.current.srcObject = null;\n    setRemoteStream(null);\n  };\n  const toggleMic = () => {\n    if (localStream) {\n      const track = localStream.getAudioTracks()[0];\n      if (track) {\n        track.enabled = !track.enabled;\n        setIsMicEnabled(track.enabled);\n      }\n    }\n  };\n  const toggleCam = () => {\n    if (localStream) {\n      const track = localStream.getVideoTracks()[0];\n      if (track) {\n        track.enabled = !track.enabled;\n        setIsCamEnabled(track.enabled);\n      }\n    }\n  };\n  const toggleScreenShare = async () => {\n    if (!isScreenSharing) {\n      try {\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({\n          video: true\n        });\n        screenStreamRef.current = screenStream;\n        const screenTrack = screenStream.getVideoTracks()[0];\n\n        // Replace video track in PC\n        if (pcRef.current) {\n          const sender = pcRef.current.getSenders().find(s => {\n            var _s$track;\n            return ((_s$track = s.track) === null || _s$track === void 0 ? void 0 : _s$track.kind) === 'video';\n          });\n          if (sender) sender.replaceTrack(screenTrack);\n        }\n\n        // Update local preview\n        if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\n        screenTrack.onended = () => stopScreenShare();\n        setIsScreenSharing(true);\n      } catch (err) {\n        console.error('[WebRTC] Screen share failed:', err);\n      }\n    } else {\n      stopScreenShare();\n    }\n  };\n  const stopScreenShare = () => {\n    if (screenStreamRef.current) {\n      screenStreamRef.current.getTracks().forEach(t => t.stop());\n      screenStreamRef.current = null;\n    }\n    // Replace back with camera track\n    if (localStream && pcRef.current) {\n      const camTrack = localStream.getVideoTracks()[0];\n      const sender = pcRef.current.getSenders().find(s => {\n        var _s$track2;\n        return ((_s$track2 = s.track) === null || _s$track2 === void 0 ? void 0 : _s$track2.kind) === 'video';\n      });\n      if (sender && camTrack) sender.replaceTrack(camTrack);\n      if (localVideoRef.current) localVideoRef.current.srcObject = localStream;\n    }\n    setIsScreenSharing(false);\n  };\n  const handleManualLeave = () => {\n    socket.emit('call:end', {\n      roomId,\n      to: signalingId\n    });\n    stopAllTracks();\n    onLeave();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wb-meeting-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wb-v-grid-main\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wb-video-tile\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localVideoRef,\n          autoPlay: true,\n          muted: true,\n          playsInline: true,\n          className: \"wb-video-element\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 21\n        }, this), !isCamEnabled && !isScreenSharing && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-video-placeholder\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-v-avatar\",\n            children: username[0].toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 290,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-video-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"wb-video-name\",\n            children: [username, \" (You)\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 25\n          }, this), !isMicEnabled && /*#__PURE__*/_jsxDEV(MicOff, {\n            size: 10,\n            className: \"text-red-500\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 43\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `wb-video-tile ${remoteStream ? 'active-host' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: remoteVideoRef,\n          autoPlay: true,\n          playsInline: true,\n          className: \"wb-video-element\",\n          style: {\n            display: remoteStream ? 'block' : 'none'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 21\n        }, this), !remoteStream && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-video-placeholder\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"wb-v-avatar\",\n            children: \"?\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 303,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs mt-2 text-white/50\",\n            children: \"Connecting...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"wb-video-info\",\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"wb-video-name\",\n            children: \"Remote Participant\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 52\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 285,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wb-video-controls-bar-fixed\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wb-video-controls-bar\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: `wb-v-btn ${!isMicEnabled ? 'muted' : ''}`,\n          onClick: toggleMic,\n          title: \"Mute\",\n          children: isMicEnabled ? /*#__PURE__*/_jsxDEV(Mic, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 41\n          }, this) : /*#__PURE__*/_jsxDEV(MicOff, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 314,\n            columnNumber: 61\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `wb-v-btn ${!isCamEnabled ? 'muted' : ''}`,\n          onClick: toggleCam,\n          title: \"Video\",\n          children: isCamEnabled ? /*#__PURE__*/_jsxDEV(Video, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 41\n          }, this) : /*#__PURE__*/_jsxDEV(VideoOff, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 63\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: `wb-v-btn ${isScreenSharing ? 'active' : ''}`,\n          onClick: toggleScreenShare,\n          title: \"Share Screen\",\n          children: isScreenSharing ? /*#__PURE__*/_jsxDEV(MonitorOff, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 44\n          }, this) : /*#__PURE__*/_jsxDEV(Monitor, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 320,\n            columnNumber: 71\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"wb-v-btn leave\",\n          onClick: handleManualLeave,\n          title: \"End Call\",\n          children: /*#__PURE__*/_jsxDEV(PhoneOff, {\n            size: 18\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 323,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"wb-call-status-pill\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"wb-status-dot\",\n        style: {\n          backgroundColor: connectionStatus.includes('connected') ? '#10b981' : '#f59e0b'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 329,\n        columnNumber: 17\n      }, this), connectionStatus]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 284,\n    columnNumber: 9\n  }, this);\n};\n_s(WebRTCMeeting, \"62wMAncTOdevhFpW9kbspkHGVpM=\");\n_c = WebRTCMeeting;\nexport default WebRTCMeeting;\nvar _c;\n$RefreshReg$(_c, \"WebRTCMeeting\");","map":{"version":3,"names":["React","useEffect","useRef","useState","Mic","MicOff","Video","VideoOff","PhoneOff","Monitor","MonitorOff","toast","jsxDEV","_jsxDEV","WebRTCMeeting","socket","roomId","signalingId","isCaller","username","onLeave","_s","localStream","setLocalStream","remoteStream","setRemoteStream","isMicEnabled","setIsMicEnabled","isCamEnabled","setIsCamEnabled","isScreenSharing","setIsScreenSharing","connectionStatus","setConnectionStatus","pcRef","localVideoRef","remoteVideoRef","candidateBuffer","screenStreamRef","isNegotiating","hasInitialized","currentLocalStream","rtcConfig","iceServers","urls","isStopped","initMedia","console","log","stream","navigator","mediaDevices","getUserMedia","video","audio","getTracks","forEach","t","stop","current","srcObject","pc","RTCPeerConnection","track","addTrack","ontrack","event","kind","rStream","streams","oniceconnectionstatechange","iceConnectionState","onicecandidate","candidate","emit","to","err","error","signalingState","startNegotiation","offer","createOffer","setLocalDescription","e","processCandidates","length","_pcRef$current","remoteDescription","cand","shift","addIceCandidate","RTCIceCandidate","handleOffer","from","setRemoteDescription","RTCSessionDescription","answer","createAnswer","handleAnswer","handleCandidate","type","push","handleCallEnded","stopAllTracks","on","off","onloadedmetadata","play","catch","close","toggleMic","getAudioTracks","enabled","toggleCam","getVideoTracks","toggleScreenShare","screenStream","getDisplayMedia","screenTrack","sender","getSenders","find","s","_s$track","replaceTrack","onended","stopScreenShare","camTrack","_s$track2","handleManualLeave","className","children","ref","autoPlay","muted","playsInline","fileName","_jsxFileName","lineNumber","columnNumber","toUpperCase","size","style","display","onClick","title","backgroundColor","includes","_c","$RefreshReg$"],"sources":["D:/CapstoneProject/whiteboard-app/frontend/src/components/video/WebRTCMeeting.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { Mic, MicOff, Video, VideoOff, PhoneOff, Monitor, MonitorOff } from 'lucide-react';\r\nimport toast from 'react-hot-toast';\r\n\r\nconst WebRTCMeeting = ({ socket, roomId, signalingId, isCaller, username, onLeave }) => {\r\n    const [localStream, setLocalStream] = useState(null);\r\n    const [remoteStream, setRemoteStream] = useState(null);\r\n    const [isMicEnabled, setIsMicEnabled] = useState(true);\r\n    const [isCamEnabled, setIsCamEnabled] = useState(true);\r\n    const [isScreenSharing, setIsScreenSharing] = useState(false);\r\n    const [connectionStatus, setConnectionStatus] = useState('Initializing...');\r\n\r\n    const pcRef = useRef(null);\r\n    const localVideoRef = useRef(null);\r\n    const remoteVideoRef = useRef(null);\r\n    const candidateBuffer = useRef([]);\r\n    const screenStreamRef = useRef(null);\r\n    const isNegotiating = useRef(false);\r\n    const hasInitialized = useRef(false);\r\n    const currentLocalStream = useRef(null);\r\n\r\n    // Google STUN servers\r\n    const rtcConfig = {\r\n        iceServers: [\r\n            { urls: 'stun:stun.l.google.com:19302' },\r\n            { urls: 'stun:stun1.l.google.com:19302' },\r\n            { urls: 'stun:stun2.l.google.com:19302' },\r\n        ],\r\n    };\r\n\r\n    // ─── 1. MEDIA & PC LIFECYCLE (Runs once) ───\r\n    useEffect(() => {\r\n        let isStopped = false;\r\n\r\n        const initMedia = async () => {\r\n            try {\r\n                console.log('[WebRTC] Requesting media...');\r\n                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\r\n                if (isStopped) { stream.getTracks().forEach(t => t.stop()); return; }\r\n\r\n                setLocalStream(stream);\r\n                currentLocalStream.current = stream;\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = stream;\r\n\r\n                const pc = new RTCPeerConnection(rtcConfig);\r\n                pcRef.current = pc;\r\n\r\n                stream.getTracks().forEach(track => {\r\n                    pc.addTrack(track, stream);\r\n                });\r\n\r\n                pc.ontrack = (event) => {\r\n                    console.log('[WebRTC] Remote track received:', event.track.kind);\r\n                    const rStream = event.streams[0];\r\n                    setRemoteStream(rStream);\r\n                    if (remoteVideoRef.current) remoteVideoRef.current.srcObject = rStream;\r\n                };\r\n\r\n                pc.oniceconnectionstatechange = () => {\r\n                    setConnectionStatus(`Status: ${pc.iceConnectionState}`);\r\n                };\r\n\r\n                pc.onicecandidate = (event) => {\r\n                    if (event.candidate && signalingId) {\r\n                        socket.emit('call:candidate', { roomId, to: signalingId, candidate: event.candidate });\r\n                    }\r\n                };\r\n\r\n                if (pc.oniceconnectionstatechange) pc.oniceconnectionstatechange(); // Force initial state log\r\n            } catch (err) {\r\n                console.error('[WebRTC] Media Init Error:', err);\r\n                toast.error('Camera/Mic access failed');\r\n            }\r\n        };\r\n\r\n        if (!hasInitialized.current) {\r\n            hasInitialized.current = true;\r\n            initMedia();\r\n        }\r\n\r\n        return () => {\r\n            isStopped = true;\r\n        };\r\n    }, [roomId]); // Only depend on roomId\r\n\r\n    // ─── 1.5 NEGOTIATION (Triggers when signalingId is available) ───\r\n    useEffect(() => {\r\n        const pc = pcRef.current;\r\n        if (isCaller && signalingId && pc && pc.signalingState === 'stable') {\r\n            const startNegotiation = async () => {\r\n                if (isNegotiating.current) return;\r\n                try {\r\n                    isNegotiating.current = true;\r\n                    console.log('[WebRTC] Creating offer for:', signalingId);\r\n                    const offer = await pc.createOffer();\r\n                    await pc.setLocalDescription(offer);\r\n                    socket.emit('call:offer', { roomId, to: signalingId, offer });\r\n                } catch (e) {\r\n                    console.error('[WebRTC] Negotiation offer failed:', e);\r\n                } finally {\r\n                    isNegotiating.current = false;\r\n                }\r\n            };\r\n            startNegotiation();\r\n        }\r\n    }, [isCaller, signalingId, roomId, socket]);\r\n\r\n    // ─── 2. SIGNALING LIFECYCLE (Re-binds on socket changes) ───\r\n    useEffect(() => {\r\n        if (!socket) return;\r\n\r\n        const processCandidates = async () => {\r\n            while (candidateBuffer.current.length > 0 && pcRef.current?.remoteDescription) {\r\n                const cand = candidateBuffer.current.shift();\r\n                try { await pcRef.current.addIceCandidate(new RTCIceCandidate(cand)); } catch (e) { }\r\n            }\r\n        };\r\n\r\n        const handleOffer = async ({ from, offer }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc || isNegotiating.current || pc.signalingState !== 'stable') return;\r\n            try {\r\n                isNegotiating.current = true;\r\n                await pc.setRemoteDescription(new RTCSessionDescription(offer));\r\n                const answer = await pc.createAnswer();\r\n                await pc.setLocalDescription(answer);\r\n                socket.emit('call:answer', { roomId, to: from, answer });\r\n                processCandidates();\r\n            } catch (e) { console.error('Offer handling failed:', e); }\r\n            finally { isNegotiating.current = false; }\r\n        };\r\n\r\n        const handleAnswer = async ({ from, answer }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc || isNegotiating.current || pc.signalingState !== 'have-local-offer') return;\r\n            try {\r\n                isNegotiating.current = true;\r\n                await pc.setRemoteDescription(new RTCSessionDescription(answer));\r\n                processCandidates();\r\n            } catch (e) { console.error('Answer handling failed:', e); }\r\n            finally { isNegotiating.current = false; }\r\n        };\r\n\r\n        const handleCandidate = async ({ from, candidate }) => {\r\n            const pc = pcRef.current;\r\n            if (!pc) return;\r\n            if (pc.remoteDescription && pc.remoteDescription.type) {\r\n                try { await pc.addIceCandidate(new RTCIceCandidate(candidate)); } catch (e) { }\r\n            } else {\r\n                candidateBuffer.current.push(candidate);\r\n            }\r\n        };\r\n\r\n        const handleCallEnded = () => {\r\n            stopAllTracks();\r\n            onLeave();\r\n        };\r\n\r\n        socket.on('call:offer', handleOffer);\r\n        socket.on('call:answer', handleAnswer);\r\n        socket.on('call:candidate', handleCandidate);\r\n        socket.on('call:ended', handleCallEnded);\r\n\r\n        return () => {\r\n            socket.off('call:offer', handleOffer);\r\n            socket.off('call:answer', handleAnswer);\r\n            socket.off('call:candidate', handleCandidate);\r\n            socket.off('call:ended', handleCallEnded);\r\n        };\r\n    }, [socket, roomId, signalingId, onLeave]);\r\n\r\n    // ─── 3. VIDEO ELEMENT SYNC ───\r\n    useEffect(() => {\r\n        const video = localVideoRef.current;\r\n        if (video && localStream) {\r\n            video.srcObject = localStream;\r\n            video.onloadedmetadata = () => {\r\n                video.play().catch(e => console.error('[WebRTC] Local video play error:', e));\r\n            };\r\n        }\r\n    }, [localStream]);\r\n\r\n    useEffect(() => {\r\n        const video = remoteVideoRef.current;\r\n        if (video && remoteStream) {\r\n            video.srcObject = remoteStream;\r\n            video.onloadedmetadata = () => {\r\n                video.play().catch(e => console.error('[WebRTC] Remote video play error:', e));\r\n            };\r\n        }\r\n    }, [remoteStream]);\r\n\r\n    // Ensure tracks stop on component unmount\r\n    useEffect(() => {\r\n        return () => stopAllTracks();\r\n    }, []);\r\n\r\n    const stopAllTracks = () => {\r\n        if (pcRef.current) {\r\n            pcRef.current.close();\r\n            pcRef.current = null;\r\n        }\r\n        if (localStream) {\r\n            localStream.getTracks().forEach(t => t.stop());\r\n            setLocalStream(null);\r\n        }\r\n        if (screenStreamRef.current) {\r\n            screenStreamRef.current.getTracks().forEach(t => t.stop());\r\n            screenStreamRef.current = null;\r\n        }\r\n        if (localVideoRef.current) localVideoRef.current.srcObject = null;\r\n        if (remoteVideoRef.current) remoteVideoRef.current.srcObject = null;\r\n        setRemoteStream(null);\r\n    };\r\n\r\n    const toggleMic = () => {\r\n        if (localStream) {\r\n            const track = localStream.getAudioTracks()[0];\r\n            if (track) {\r\n                track.enabled = !track.enabled;\r\n                setIsMicEnabled(track.enabled);\r\n            }\r\n        }\r\n    };\r\n\r\n    const toggleCam = () => {\r\n        if (localStream) {\r\n            const track = localStream.getVideoTracks()[0];\r\n            if (track) {\r\n                track.enabled = !track.enabled;\r\n                setIsCamEnabled(track.enabled);\r\n            }\r\n        }\r\n    };\r\n\r\n    const toggleScreenShare = async () => {\r\n        if (!isScreenSharing) {\r\n            try {\r\n                const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });\r\n                screenStreamRef.current = screenStream;\r\n                const screenTrack = screenStream.getVideoTracks()[0];\r\n\r\n                // Replace video track in PC\r\n                if (pcRef.current) {\r\n                    const sender = pcRef.current.getSenders().find(s => s.track?.kind === 'video');\r\n                    if (sender) sender.replaceTrack(screenTrack);\r\n                }\r\n\r\n                // Update local preview\r\n                if (localVideoRef.current) localVideoRef.current.srcObject = screenStream;\r\n\r\n                screenTrack.onended = () => stopScreenShare();\r\n                setIsScreenSharing(true);\r\n            } catch (err) {\r\n                console.error('[WebRTC] Screen share failed:', err);\r\n            }\r\n        } else {\r\n            stopScreenShare();\r\n        }\r\n    };\r\n\r\n    const stopScreenShare = () => {\r\n        if (screenStreamRef.current) {\r\n            screenStreamRef.current.getTracks().forEach(t => t.stop());\r\n            screenStreamRef.current = null;\r\n        }\r\n        // Replace back with camera track\r\n        if (localStream && pcRef.current) {\r\n            const camTrack = localStream.getVideoTracks()[0];\r\n            const sender = pcRef.current.getSenders().find(s => s.track?.kind === 'video');\r\n            if (sender && camTrack) sender.replaceTrack(camTrack);\r\n            if (localVideoRef.current) localVideoRef.current.srcObject = localStream;\r\n        }\r\n        setIsScreenSharing(false);\r\n    };\r\n\r\n    const handleManualLeave = () => {\r\n        socket.emit('call:end', { roomId, to: signalingId });\r\n        stopAllTracks();\r\n        onLeave();\r\n    };\r\n\r\n    return (\r\n        <div className=\"wb-meeting-container\">\r\n            <div className=\"wb-v-grid-main\">\r\n                <div className=\"wb-video-tile\">\r\n                    <video ref={localVideoRef} autoPlay muted playsInline className=\"wb-video-element\" />\r\n                    {!isCamEnabled && !isScreenSharing && (\r\n                        <div className=\"wb-video-placeholder\">\r\n                            <div className=\"wb-v-avatar\">{username[0].toUpperCase()}</div>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"wb-video-info\">\r\n                        <span className=\"wb-video-name\">{username} (You)</span>\r\n                        {!isMicEnabled && <MicOff size={10} className=\"text-red-500\" />}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className={`wb-video-tile ${remoteStream ? 'active-host' : ''}`}>\r\n                    <video ref={remoteVideoRef} autoPlay playsInline className=\"wb-video-element\" style={{ display: remoteStream ? 'block' : 'none' }} />\r\n                    {!remoteStream && (\r\n                        <div className=\"wb-video-placeholder\">\r\n                            <div className=\"wb-v-avatar\">?</div>\r\n                            <p className=\"text-xs mt-2 text-white/50\">Connecting...</p>\r\n                        </div>\r\n                    )}\r\n                    <div className=\"wb-video-info\"><span className=\"wb-video-name\">Remote Participant</span></div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"wb-video-controls-bar-fixed\">\r\n                <div className=\"wb-video-controls-bar\">\r\n                    <button className={`wb-v-btn ${!isMicEnabled ? 'muted' : ''}`} onClick={toggleMic} title=\"Mute\">\r\n                        {isMicEnabled ? <Mic size={18} /> : <MicOff size={18} />}\r\n                    </button>\r\n                    <button className={`wb-v-btn ${!isCamEnabled ? 'muted' : ''}`} onClick={toggleCam} title=\"Video\">\r\n                        {isCamEnabled ? <Video size={18} /> : <VideoOff size={18} />}\r\n                    </button>\r\n                    <button className={`wb-v-btn ${isScreenSharing ? 'active' : ''}`} onClick={toggleScreenShare} title=\"Share Screen\">\r\n                        {isScreenSharing ? <MonitorOff size={18} /> : <Monitor size={18} />}\r\n                    </button>\r\n                    <button className=\"wb-v-btn leave\" onClick={handleManualLeave} title=\"End Call\">\r\n                        <PhoneOff size={18} />\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"wb-call-status-pill\">\r\n                <div className=\"wb-status-dot\" style={{ backgroundColor: connectionStatus.includes('connected') ? '#10b981' : '#f59e0b' }}></div>\r\n                {connectionStatus}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default WebRTCMeeting;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}